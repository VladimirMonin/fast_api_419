# –ü–∞–∫–µ—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –ø—Ä–æ–µ–∫—Ç–∞: fast_api_419

## `alembic/env.py`

```py
from logging.config import fileConfig
from sqlalchemy import pool
from sqlalchemy.engine import Connection
from sqlalchemy.ext.asyncio import async_engine_from_config
from alembic import context

# –ò–ú–ü–û–†–¢–ò–†–£–ï–ú –í–°–ï –ú–û–î–ï–õ–ò –ò BASE
from models.base import Base
from models.product import Product, Category, Tag, product_tag_association
from models.user import User  # noqa: F401
from models.commerce import Cart, CartItem, Order, OrderItem  # noqa: F401
from core.config import settings

# this is the Alembic Config object, which provides
# access to the values within the .ini file in use.
config = context.config

# Interpret the config file for Python logging.
# This line sets up loggers basically.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# add your model's MetaData object here
# for 'autogenerate' support
target_metadata = Base.metadata


def get_url():
    """–ü–æ–ª—É—á–∞–µ—Ç DATABASE_URL –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
    return settings.DATABASE_URL


def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode.

    This configures the context with just a URL
    and not an Engine, though an Engine is acceptable
    here as well.  By skipping the Engine creation
    we don't even need a DBAPI to be available.

    Calls to context.execute() here emit the given string to the
    script output.
    """
    url = get_url()
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def do_run_migrations(connection: Connection) -> None:
    """
    –≠–¢–ê –§–£–ù–ö–¶–ò–Ø –û–¢–°–£–¢–°–¢–í–û–í–ê–õ–ê! –û–ù–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–ê!
    –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
    """
    context.configure(connection=connection, target_metadata=target_metadata)

    with context.begin_transaction():
        context.run_migrations()


async def run_async_migrations() -> None:
    """Run migrations in 'online' mode with async support."""
    configuration = config.get_section(config.config_ini_section)
    configuration["sqlalchemy.url"] = get_url()

    connectable = async_engine_from_config(
        configuration,
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    async with connectable.connect() as connection:
        await connection.run_sync(do_run_migrations)

    await connectable.dispose()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode."""
    import asyncio

    asyncio.run(run_async_migrations())


# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞
if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

```

## `alembic/versions/33e05a6a546e_initial_migration_create_all_tables.py`

```py
"""Initial migration: create all tables

Revision ID: 33e05a6a546e
Revises: 
Create Date: 2025-11-10 23:36:29.618325

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '33e05a6a546e'
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('categories',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_categories_name'), 'categories', ['name'], unique=True)
    op.create_table('tags',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=50), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_tags_name'), 'tags', ['name'], unique=True)
    op.create_table('products',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('image_url', sa.String(length=200), nullable=True),
    sa.Column('price_shmeckles', sa.Float(), nullable=False),
    sa.Column('price_flurbos', sa.Float(), nullable=False),
    sa.Column('category_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['category_id'], ['categories.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_product_category_price', 'products', ['category_id', 'price_shmeckles'], unique=False)
    op.create_index(op.f('ix_products_category_id'), 'products', ['category_id'], unique=False)
    op.create_index(op.f('ix_products_name'), 'products', ['name'], unique=False)
    op.create_index(op.f('ix_products_price_flurbos'), 'products', ['price_flurbos'], unique=False)
    op.create_index(op.f('ix_products_price_shmeckles'), 'products', ['price_shmeckles'], unique=False)
    op.create_table('product_tag_association',
    sa.Column('product_id', sa.Integer(), nullable=False),
    sa.Column('tag_id', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['tag_id'], ['tags.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('product_id', 'tag_id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('product_tag_association')
    op.drop_index(op.f('ix_products_price_shmeckles'), table_name='products')
    op.drop_index(op.f('ix_products_price_flurbos'), table_name='products')
    op.drop_index(op.f('ix_products_name'), table_name='products')
    op.drop_index(op.f('ix_products_category_id'), table_name='products')
    op.drop_index('ix_product_category_price', table_name='products')
    op.drop_table('products')
    op.drop_index(op.f('ix_tags_name'), table_name='tags')
    op.drop_table('tags')
    op.drop_index(op.f('ix_categories_name'), table_name='categories')
    op.drop_table('categories')
    # ### end Alembic commands ###

```

## `alembic/versions/76c483643cf0_add_user_table.py`

```py
"""add_user_table

Revision ID: 76c483643cf0
Revises: c1aafa661e54
Create Date: 2025-11-17 11:42:26.240575

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '76c483643cf0'
down_revision: Union[str, Sequence[str], None] = 'c1aafa661e54'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('user',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('email', sa.String(length=320), nullable=False),
    sa.Column('hashed_password', sa.String(length=1024), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('is_superuser', sa.Boolean(), nullable=False),
    sa.Column('is_verified', sa.Boolean(), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_user_email'), 'user', ['email'], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_user_email'), table_name='user')
    op.drop_table('user')
    # ### end Alembic commands ###

```

## `alembic/versions/771513fdda7d_add_commerce_tables.py`

```py
"""add commerce tables

Revision ID: 771513fdda7d
Revises: 76c483643cf0
Create Date: 2025-11-24 20:21:36.684322

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '771513fdda7d'
down_revision: Union[str, Sequence[str], None] = '76c483643cf0'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('carts',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['user.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('user_id')
    )
    op.create_table('orders',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('user_id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('status', sa.String(length=50), nullable=False),
    sa.Column('total_amount', sa.Float(), nullable=False),
    sa.Column('delivery_address', sa.Text(), nullable=False),
    sa.Column('phone', sa.String(length=20), nullable=False),
    sa.ForeignKeyConstraint(['user_id'], ['user.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_orders_status'), 'orders', ['status'], unique=False)
    op.create_index(op.f('ix_orders_user_id'), 'orders', ['user_id'], unique=False)
    op.create_table('cart_items',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('cart_id', sa.Integer(), nullable=False),
    sa.Column('product_id', sa.Integer(), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.ForeignKeyConstraint(['cart_id'], ['carts.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_table('order_items',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('order_id', sa.Integer(), nullable=False),
    sa.Column('product_id', sa.Integer(), nullable=False),
    sa.Column('quantity', sa.Integer(), nullable=False),
    sa.Column('frozen_name', sa.String(length=100), nullable=False),
    sa.Column('frozen_price', sa.Float(), nullable=False),
    sa.ForeignKeyConstraint(['order_id'], ['orders.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('order_items')
    op.drop_table('cart_items')
    op.drop_index(op.f('ix_orders_user_id'), table_name='orders')
    op.drop_index(op.f('ix_orders_status'), table_name='orders')
    op.drop_table('orders')
    op.drop_table('carts')
    # ### end Alembic commands ###

```

## `alembic/versions/c1aafa661e54_add_user_table.py`

```py
"""add_user_table

Revision ID: c1aafa661e54
Revises: increase_image_url
Create Date: 2025-11-17 11:14:16.331422

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'c1aafa661e54'
down_revision: Union[str, Sequence[str], None] = 'increase_image_url'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    pass
    # ### end Alembic commands ###

```

## `alembic/versions/increase_image_url_length.py`

```py
"""–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ø–æ–ª—è image_url –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤

Revision ID: increase_image_url
Revises: 33e05a6a546e
Create Date: 2025-11-12 22:05:00.000000

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "increase_image_url"
down_revision: Union[str, Sequence[str], None] = "33e05a6a546e"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã image_url —Å 200 –¥–æ 500 —Å–∏–º–≤–æ–ª–æ–≤."""
    # SQLite –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ALTER COLUMN, –∏—Å–ø–æ–ª—å–∑—É–µ–º batch mode
    with op.batch_alter_table("products", schema=None) as batch_op:
        batch_op.alter_column(
            "image_url",
            existing_type=sa.String(length=200),
            type_=sa.String(length=500),
            existing_nullable=True,
        )


def downgrade() -> None:
    """–í–æ–∑–≤—Ä–∞—Ç –¥–ª–∏–Ω—ã image_url –∫ 200 —Å–∏–º–≤–æ–ª–∞–º."""
    # SQLite –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç ALTER COLUMN, –∏—Å–ø–æ–ª—å–∑—É–µ–º batch mode
    with op.batch_alter_table("products", schema=None) as batch_op:
        batch_op.alter_column(
            "image_url",
            existing_type=sa.String(length=500),
            type_=sa.String(length=200),
            existing_nullable=True,
        )

```

## `auth/__init__.py`

```py

```

## `auth/backend.py`

```py
"""
–ú–æ–¥—É–ª—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ JWT —Ç–æ–∫–µ–Ω—ã.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É fastapi-users –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - Bearer —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
    - JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
    - Backend –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
    –í main.py —ç—Ç–æ—Ç backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ—É—Ç–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

    app.include_router(
        fastapi_users.get_auth_router(auth_backend),
        prefix="/auth",
        tags=["auth"]
    )
"""

from fastapi_users.authentication import (
    AuthenticationBackend,
    BearerTransport,
    JWTStrategy,
)

from core.config import settings

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
# –ë–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
SECRET = settings.SECRET_KEY

# Bearer —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º
# tokenUrl —É–∫–∞–∑—ã–≤–∞–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Swagger UI)
bearer_transport = BearerTransport(tokenUrl="/auth/login")


def get_jwt_strategy() -> JWTStrategy:
    """
    –°–æ–∑–¥–∞—ë—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é JWT –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

    JWT (JSON Web Token) - —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ. –¢–æ–∫–µ–Ω –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å.

    Returns:
        JWTStrategy: –°—Ç—Ä–∞—Ç–µ–≥–∏—è JWT —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞

    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:
        secret: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
        lifetime_seconds: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (3600 = 1 —á–∞—Å)

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º,
        –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ.
    """
    return JWTStrategy(secret=SECRET, lifetime_seconds=3600)


# Backend –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –≥–ª–∞–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
# –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FastAPI Users –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è endpoints –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
auth_backend = AuthenticationBackend(
    name="jwt",  # –ò–º—è backend'–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
    transport=bearer_transport,  # –ö–∞–∫ —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è (Bearer –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization)
    get_strategy=get_jwt_strategy,  # –ö–∞–∫ —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (JWT)
)

```

## `auth/database.py`

```py
"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
—á–µ—Ä–µ–∑ SQLAlchemy ORM. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω Dependency Injection FastAPI
–¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è database session.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - get_user_db: Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏:
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç core.database –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è database session
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç models.user.User –∫–∞–∫ –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ auth.manager –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
"""

from typing import AsyncGenerator

from fastapi import Depends
from fastapi_users_db_sqlalchemy import SQLAlchemyUserDatabase
from sqlalchemy.ext.asyncio import AsyncSession

from core.database import get_db_session
from models.user import User


async def get_user_db(
    session: AsyncSession = Depends(get_db_session),
) -> AsyncGenerator[SQLAlchemyUserDatabase[User, int], None]:
    """
    Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è - —ç—Ç–æ FastAPI Dependency, –∫–æ—Ç–æ—Ä–∞—è:
    1. –ü–æ–ª—É—á–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é database session —á–µ—Ä–µ–∑ Depends(get_db_session)
    2. –°–æ–∑–¥–∞—ë—Ç SQLAlchemyUserDatabase - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞–¥–∞–ø—Ç–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    3. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è FastAPI

    Yields:
        SQLAlchemyUserDatabase[User, int]: –û–±—ä–µ–∫—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–ª–∏—Ü–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            - User: –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (SQLAlchemy –º–æ–¥–µ–ª—å)
            - int: –¢–∏–ø ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ)

    –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
        @app.get("/users/me")
        async def get_current_user(
            user_db: SQLAlchemyUserDatabase = Depends(get_user_db)
        ):
            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å user_db –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
            user = await user_db.get(user_id)
            return user

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        AsyncGenerator –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏.
        –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
    """

    yield SQLAlchemyUserDatabase(session, User)

```

## `auth/manager.py`

```py
"""
–ú–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (User Manager).

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:
—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, —Å–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email –∏ –¥—Ä—É–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    - UserManager: –ö–ª–∞—Å—Å —Å –ª–æ–≥–∏–∫–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    - get_user_manager: Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ UserManager

–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ UserManager:
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ email
    - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email –∞–¥—Ä–µ—Å–æ–≤
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

–°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏:
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç auth.database –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç models.user.User –∫–∞–∫ –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç core.config –¥–ª—è —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π
"""

from typing import AsyncGenerator, Optional

from fastapi import Depends, Request
from fastapi_users import BaseUserManager, IntegerIDMixin

from auth.database import get_user_db
from core.config import settings
from models.user import User

# –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
SECRET = settings.SECRET_KEY


class UserManager(IntegerIDMixin, BaseUserManager[User, int]):
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

    –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç BaseUserManager –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É
    —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö ID —á–µ—Ä–µ–∑ IntegerIDMixin.

    Attributes:
        reset_password_token_secret: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
        verification_token_secret: –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email

    –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã (—É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç BaseUserManager):
        - create(): –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        - get(): –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
        - get_by_email(): –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
        - authenticate(): –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        - update(): –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        - delete(): –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        - request_verify(): –ó–∞–ø—Ä–æ—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email
        - verify(): –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email –ø–æ —Ç–æ–∫–µ–Ω—É
        - forgot_password(): –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
        - reset_password(): –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å, –¥–æ–±–∞–≤–ª—è—è —Å–≤–æ–∏ –º–µ—Ç–æ–¥—ã –∏–ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—è
        —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏.
    """

    # –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤
    # –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
    reset_password_token_secret = SECRET
    verification_token_secret = SECRET

    async def on_after_register(
        self, user: User, request: Optional[Request] = None
    ) -> None:
        """
        Callback-–º–µ—Ç–æ–¥, –≤—ã–∑—ã–≤–∞–µ–º—ã–π –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
        –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:
        - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ email
        - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        - –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
        - –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
        - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ –Ω–æ–≤–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

        Args:
            user: –¢–æ–ª—å–∫–æ —á—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            request: HTTP request –æ–±—ä–µ–∫—Ç (–º–æ–∂–µ—Ç –±—ã—Ç—å None, –µ—Å–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ —á–µ—Ä–µ–∑ HTTP endpoint)

        –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
            async def on_after_register(self, user: User, request: Optional[Request] = None):
                print(f"User {user.id} has registered.")
                # –û—Ç–ø—Ä–∞–≤–∫–∞ email
                await send_welcome_email(user.email)
                # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
                await notify_admin_new_user(user.email)
        """
        print(f"User {user.id} has registered.")


async def get_user_manager(
    user_db=Depends(get_user_db),
) -> AsyncGenerator[UserManager, None]:
    """
    Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ UserManager.

    –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç UserManager –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    –≤ FastAPI endpoints. UserManager —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –¥–ª—è
    —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

    Args:
        user_db: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Depends

    Yields:
        UserManager: –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –≥–æ—Ç–æ–≤—ã–π –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

    –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
        @app.post("/register")
        async def register(
            user_manager: UserManager = Depends(get_user_manager)
        ):
            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å user_manager –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
            new_user = await user_manager.create(user_data)
            return new_user

    –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FastAPI Users –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        endpoints —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –ª–æ–≥–∏–Ω–∞ –∏ –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
    """
    yield UserManager(user_db)

```

## `core/__init__.py`

```py

```

## `core/cart_crud.py`

```py
# core/cart_crud.py
"""
CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã —Å —É–º–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ (UPSERT).
UPSERT –æ–∑–Ω–∞—á–∞–µ—Ç:
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω–µ, —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (UPDATE)
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å (INSERT)

"""

import logging
from typing import List

from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload

from models.commerce import Cart, CartItem
from models.product import Product
from schemas.commerce import CartItemCreate

logger = logging.getLogger(__name__)


async def get_or_create_cart(
    session: AsyncSession, user_id: int, auto_commit: bool = True
) -> Cart:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        auto_commit: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—Ç—å commit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)

    Returns:
        Cart: –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
    stmt = select(Cart).where(Cart.user_id == user_id)
    result = await session.execute(stmt)
    cart = result.scalar_one_or_none()

    if cart is None:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É
        cart = Cart(user_id=user_id)
        session.add(cart)

        if auto_commit:
            await session.commit()
            await session.refresh(cart)
        else:
            await session.flush()
            await session.refresh(cart)

        logger.info(f"üõí –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∫–æ—Ä–∑–∏–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
    else:
        logger.info(
            f"üõí –ù–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ—Ä–∑–∏–Ω–∞ {cart.id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}"
        )

    return cart


async def add_to_cart(
    session: AsyncSession,
    user_id: int,
    product_id: int,
    quantity: int = 1,
    auto_commit: bool = True,
) -> CartItem:
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É —Å UPSERT –ª–æ–≥–∏–∫–æ–π.
    - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ -> —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
    - –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç -> —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        product_id: ID —Ç–æ–≤–∞—Ä–∞
        quantity: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1)
        auto_commit: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—Ç—å commit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)

    Returns:
        CartItem: –°–æ–∑–¥–∞–Ω–Ω–∞—è –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã

    Raises:
        ValueError: –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º ID –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    product_stmt = select(Product).where(Product.id == product_id)
    product_result = await session.execute(product_stmt)
    product = product_result.scalar_one_or_none()

    if product is None:
        raise ValueError(f"–¢–æ–≤–∞—Ä —Å ID {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É (–ë–ï–ó auto_commit, —Ç.–∫. –º—ã —Å–∞–º–∏ —Ä–µ—à–∞–µ–º –∫–æ–≥–¥–∞ –∫–æ–º–º–∏—Ç–∏—Ç—å)
    cart = await get_or_create_cart(session, user_id, auto_commit=False)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ
    stmt = select(CartItem).where(
        CartItem.cart_id == cart.id, CartItem.product_id == product_id
    )
    result = await session.execute(stmt)
    cart_item = result.scalar_one_or_none()

    if cart_item:
        # –¢–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (UPSERT - UPDATE)
        cart_item.quantity += quantity
        logger.info(
            f"‚ûï –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ {product_id} –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–æ {cart_item.quantity}"
        )
    else:
        # –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å (UPSERT - INSERT)
        cart_item = CartItem(cart_id=cart.id, product_id=product_id, quantity=quantity)
        session.add(cart_item)
        logger.info(
            f"‚ú® –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä {product_id} –≤ –∫–æ—Ä–∑–∏–Ω—É (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: {quantity})"
        )

    if auto_commit:
        await session.commit()
        await session.refresh(cart_item)
    else:
        await session.flush()
        await session.refresh(cart_item)

    return cart_item


async def merge_cart(
    session: AsyncSession, user_id: int, items: List[CartItemCreate]
) -> None:
    """
    –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ).
    –ü—Ä–æ–≥–æ–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –ª–æ–≥–∏–∫—É add_to_cart.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        items: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

    Example:
        items = [
            CartItemCreate(product_id=1, quantity=2),
            CartItemCreate(product_id=5, quantity=1),
        ]
        await merge_cart(session, user_id=42, items=items)
    """
    logger.info(
        f"üîÑ –ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}. –¢–æ–≤–∞—Ä–æ–≤: {len(items)}"
    )

    for item in items:
        try:
            await add_to_cart(
                session,
                user_id=user_id,
                product_id=item.product_id,
                quantity=item.quantity,
            )
        except ValueError as e:
            # –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
            logger.warning(f"‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω —Ç–æ–≤–∞—Ä –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: {e}")
            continue

    logger.info(f"‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")


async def get_cart_with_items(session: AsyncSession, user_id: int) -> Cart | None:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ (eager loading).

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        Cart | None: –ö–æ—Ä–∑–∏–Ω–∞ —Å–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ CartItem –∏ Product, –∏–ª–∏ None –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ—Ç
    """
    stmt = (
        select(Cart)
        .where(Cart.user_id == user_id)
        .options(selectinload(Cart.items).selectinload(CartItem.product))
    )
    result = await session.execute(stmt)
    cart = result.scalar_one_or_none()

    return cart


async def update_cart_item_quantity(
    session: AsyncSession,
    user_id: int,
    item_id: int,
    quantity: int,
    auto_commit: bool = True,
) -> CartItem:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
        item_id: ID –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ
        quantity: –ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        auto_commit: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—Ç—å commit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)

    Returns:
        CartItem: –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è

    Raises:
        ValueError: –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –∫ –Ω–µ–π –¥–æ—Å—Ç—É–ø–∞
    """
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–∞
    stmt = (
        select(CartItem)
        .join(Cart)
        .where(CartItem.id == item_id, Cart.user_id == user_id)
    )
    result = await session.execute(stmt)
    cart_item = result.scalar_one_or_none()

    if cart_item is None:
        raise ValueError(f"–ü–æ–∑–∏—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã {item_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")

    cart_item.quantity = quantity

    if auto_commit:
        await session.commit()
        await session.refresh(cart_item)
    else:
        await session.flush()
        await session.refresh(cart_item)

    logger.info(f"üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∑–∏—Ü–∏–∏ {item_id} –¥–æ {quantity}")

    return cart_item


async def remove_cart_item(
    session: AsyncSession, user_id: int, item_id: int, auto_commit: bool = True
) -> None:
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
        item_id: ID –ø–æ–∑–∏—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        auto_commit: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—Ç—å commit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)

    Raises:
        ValueError: –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏–º–µ–µ—Ç –∫ –Ω–µ–π –¥–æ—Å—Ç—É–ø–∞
    """
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–ª–∞–¥–µ–ª—å—Ü–∞
    stmt = (
        select(CartItem)
        .join(Cart)
        .where(CartItem.id == item_id, Cart.user_id == user_id)
    )
    result = await session.execute(stmt)
    cart_item = result.scalar_one_or_none()

    if cart_item is None:
        raise ValueError(f"–ü–æ–∑–∏—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã {item_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞")

    await session.delete(cart_item)

    if auto_commit:
        await session.commit()

    logger.info(f"üóëÔ∏è –£–¥–∞–ª–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è {item_id} –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")


async def clear_cart(
    session: AsyncSession, user_id: int, auto_commit: bool = True
) -> None:
    """
    –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        auto_commit: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞—Ç—å commit (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é True)
    """
    cart = await get_or_create_cart(session, user_id, auto_commit=False)

    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    stmt = select(CartItem).where(CartItem.cart_id == cart.id)
    result = await session.execute(stmt)
    items = result.scalars().all()

    for item in items:
        await session.delete(item)

    if auto_commit:
        await session.commit()

    logger.info(f"üßπ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id} –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω–∞")

```

## `core/config.py`

```py
# core/config.py
from pydantic_settings import BaseSettings, SettingsConfigDict


class Settings(BaseSettings):
    TELEGRAM_BOT_API_KEY: str = ""
    TELEGRAM_USER_ID: str = ""
    DATABASE_URL: str = ""
    SECRET_KEY: str = "change_me"

    model_config = SettingsConfigDict(env_file=".env", env_file_encoding="utf-8")


settings = Settings()

```

## `core/database.py`

```py
# core/database.py
import logging
from sqlalchemy import select, or_
from sqlalchemy.orm import selectinload
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker, AsyncSession
from core.config import settings
from typing import AsyncGenerator, Optional

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Base.metadata
from models.base import Base  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Base –∏–∑ –ø–∞–∫–µ—Ç–∞ models
from models.product import Product as ProductORM, Category as CategoryORM, Tag as TagORM
from schemas.product import (
    CategoryCreate,
    Category,
    TagCreate,
    Tag,
    ProductCreate,
    ProductUpdate,
    Product,
)

logger = logging.getLogger(__name__)

# URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π SQLite
DATABASE_URL = settings.DATABASE_URL

logger.info(f"üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î: {DATABASE_URL}")

# C–æ–∑–¥–∞–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
#  echo=True ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫–æ–Ω—Å–æ–ª—å
engine = create_async_engine(DATABASE_URL, echo=True)
logger.info("‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω")

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
AsyncSessionLocal = async_sessionmaker(
    # bind - —ç—Ç–æ –¥–≤–∏–∂–æ–∫, —Å –∫–æ—Ç–æ—Ä—ã–º –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Å—Å–∏–∏
    # expire_on_commit=False - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞
    # –µ—Å–ª–∏ –µ–≥–æ –Ω–µ –æ—Ç–∫–ª—é—á–∏—Ç—å, —Ç–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –Ω–∞–¥–æ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –∏–∑ –±–∞–∑—ã
    bind=engine,
    expire_on_commit=False,
    class_=AsyncSession,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
)

logger.info("‚úÖ –§–∞–±—Ä–∏–∫–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π —Å–æ–∑–¥–∞–Ω–∞")

# AsyncSession - —Ç–∏–ø –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π

# –í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –±–¥ —Å—Ç–∞–Ω—É—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏
"""
- `session.execute(stmt)` -> `await session.execute(stmt)`
- `session.get(Model, id)` -> `await session.get(Model, id)`
- `session.scalars(stmt).all()` -> `(await session.execute(stmt)).scalars().all()`
- `session.flush()` -> `await session.flush()`
- `session.refresh(obj)` -> `await session.refresh(obj)`
- `session.delete(obj)` -> `await session.delete(obj)`
- __–í–∞–∂–Ω–æ:__ `session.add(obj)` –∏ `session.add_all([..])` __–Ω–µ —Ç—Ä–µ–±—É—é—Ç__ `await`, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç –æ–±—ä–µ–∫—Ç—ã –≤ —Å–µ—Å—Å–∏–∏, –Ω–µ –¥–µ–ª–∞—è I/O –∑–∞–ø—Ä–æ—Å–∞."""


async def get_db_session() -> AsyncGenerator[AsyncSession, None]:
    """
    –§—É–Ω–∫—Ü–∏—è-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å FastAPI –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

    –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–≤–æ—é —Å–µ—Å—Å–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã—Ç–∞
    –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–∏–ª–∏ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏).

    –ö–æ–≥–¥–∞ fastAPI –≤–∏–¥–∏—Ç —á—Ç–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–º, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º. –ö–æ–¥ –¥–æ yield –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∞ –∫–æ–¥ –ø–æ—Å–ª–µ yield - –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
    """
    async with AsyncSessionLocal() as session:
        try:
            logger.debug("üîå –û—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î")
            yield session
            await session.commit()
            logger.debug("‚úÖ –°–µ—Å—Å–∏—è –ë–î –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞ –∏ –∑–∞–∫—Ä—ã—Ç–∞")
        except Exception as e:
            await session.rollback()
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Å–µ—Å—Å–∏–∏ –ë–î, –≤—ã–ø–æ–ª–Ω–µ–Ω rollback: {e}")
            raise


######################## Create –æ–ø–µ—Ä–∞—Ü–∏–∏ ########################


async def tag_create(session: AsyncSession, tag_data: TagCreate) -> Tag:
    """
    –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param tag_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞
    :return: Tag —Å id –∏ name —Ç–µ–≥–∞
    """
    logger.info(f"üìù –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞: {tag_data.name}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏
    existing = await session.scalar(select(TagORM).where(TagORM.name == tag_data.name))

    if existing:
        logger.warning(
            f"‚ö†Ô∏è –¢–µ–≥ '{tag_data.name}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π"
        )
        return Tag.model_validate(existing)

    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —Ç–µ–≥
    new_tag = TagORM(name=tag_data.name)

    session.add(new_tag)
    await session.flush()
    await session.refresh(new_tag)

    result = Tag.model_validate(new_tag)
    logger.info(f"‚úÖ –¢–µ–≥ —Å–æ–∑–¥–∞–Ω: ID={result.id}, Name={result.name}")
    return result


async def category_create(
    session: AsyncSession, category_data: CategoryCreate
) -> Category:
    """
    –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param category_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    :return: Category —Å id –∏ name –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    """
    logger.info(f"üìù –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category_data.name}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏
    existing = await session.scalar(
        select(CategoryORM).where(CategoryORM.name == category_data.name)
    )

    if existing:
        logger.warning(
            f"‚ö†Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è '{category_data.name}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é"
        )
        return Category.model_validate(existing)

    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    new_category = CategoryORM(name=category_data.name)

    session.add(new_category)
    await session.flush()
    await session.refresh(new_category)

    result = Category.model_validate(new_category)
    logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞: ID={result.id}, Name={result.name}")
    return result


async def product_create(session: AsyncSession, product_data: ProductCreate) -> Product:
    """
    –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param product_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
    :return: Product —Å id, name, description, category –∏ tags –ø—Ä–æ–¥—É–∫—Ç–∞
    """
    logger.info(f"üìù –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞: {product_data.name}")

    # –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –±–µ–∑ —Å–≤—è–∑–µ–π
    product_dict = product_data.model_dump(exclude={"category_id", "tag_ids"})
    new_product = ProductORM(**product_dict)

    # –°–≤—è–∑—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
    if product_data.category_id is not None:
        category = await session.get(CategoryORM, product_data.category_id)
        if category:
            new_product.category = category
            logger.debug(
                f"üîó –ü—Ä–æ–¥—É–∫—Ç —Å–≤—è–∑–∞–Ω —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π ID={product_data.category_id}"
            )
        else:
            logger.error(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={product_data.category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
            raise ValueError(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={product_data.category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    # –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ–≥–∏, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
    if product_data.tag_ids:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–µ–≥–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
        tags_stmt = select(TagORM).where(TagORM.id.in_(product_data.tag_ids))
        # ASK - –ê –≤ —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Å–∏–Ω—Ö –∏ –∞—Å–∏–Ω—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–º? –£ –º–µ–Ω—è —Ä–∞–Ω—å—à–µ –±—ã–ª–æ tags_stmt = select(TagORM).where(TagORM.id.in_(product_data.tag_ids)) tags_orm = session.execute(tags_stmt).scalars().all()
        tags_orm = await session.scalars(tags_stmt)
        tags_list = tags_orm.all()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Ç–µ–≥–∏ –Ω–∞–π–¥–µ–Ω—ã
        found_ids = {tag.id for tag in tags_list}
        missing_ids = set(product_data.tag_ids) - found_ids

        if missing_ids:
            logger.error(f"‚ùå –¢–µ–≥–∏ —Å ID={missing_ids} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
            raise ValueError(f"–¢–µ–≥–∏ —Å ID={missing_ids} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

        # –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ–≥–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º
        new_product.tags = list(tags_list)
        logger.debug(f"üîó –ü—Ä–æ–¥—É–∫—Ç —Å–≤—è–∑–∞–Ω —Å —Ç–µ–≥–∞–º–∏: {[tag.name for tag in tags_list]}")

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–¥—É–∫—Ç –≤ –±–∞–∑–µ
    session.add(new_product)
    await session.flush()

    # –ú—ã –Ω–µ –æ–±–æ–π–¥–µ–º—Å—è refresh - —Ç–∞–∫ –∫–∞–∫ –æ–Ω –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¢–û–õ–¨–ö–û –æ–¥–Ω—É —Ç–∞–±–ª–∏—Ü—É. –ù–∞–º –Ω—É–∂–Ω–∞ —è–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π
    stmt = (
        select(ProductORM)
        .where(ProductORM.id == new_product.id)
        .options(selectinload(ProductORM.category), selectinload(ProductORM.tags))
    )

    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∞–µ–º –æ–¥–∏–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
    refreshed_product_with_relations = await session.scalar(stmt)

    # –í–∞–ª–∏–¥–∏—Ä—É–µ–º –∏ –ø–∞–∫—É–µ–º –≤ Pydantic –º–æ–¥–µ–ª—å
    result = Product.model_validate(refreshed_product_with_relations)
    logger.info(f"‚úÖ –ü—Ä–æ–¥—É–∫—Ç —Å–æ–∑–¥–∞–Ω: ID={result.id}, Name={result.name}")
    return result


######################## Delete –æ–ø–µ—Ä–∞—Ü–∏–∏ ########################


async def category_delete(session: AsyncSession, category_id: int) -> None:
    """
    –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param category_id: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    """
    logger.info(f"üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}")

    category = await session.get(CategoryORM, category_id)
    if not category:
        logger.error(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        raise ValueError(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    await session.delete(category)
    logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} —É–¥–∞–ª–µ–Ω–∞")


async def tag_delete(session: AsyncSession, tag_id: int) -> None:
    """
    –£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ –ø–æ ID.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param tag_id: ID —Ç–µ–≥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    """
    logger.info(f"üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–≥–∞ ID={tag_id}")

    tag = await session.get(TagORM, tag_id)
    if not tag:
        logger.error(f"‚ùå –¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise ValueError(f"–¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    await session.delete(tag)
    logger.info(f"‚úÖ –¢–µ–≥ —Å ID={tag_id} —É–¥–∞–ª—ë–Ω")


async def product_delete(session: AsyncSession, product_id: int) -> None:
    """
    –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ ID.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param product_id: ID –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    """
    logger.info(f"üóëÔ∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ ID={product_id}")

    product = await session.get(ProductORM, product_id)
    if not product:
        logger.error(f"‚ùå –ü—Ä–æ–¥—É–∫—Ç —Å ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise ValueError(f"–ü—Ä–æ–¥—É–∫—Ç —Å ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    await session.delete(product)
    logger.info(f"‚úÖ –ü—Ä–æ–¥—É–∫—Ç —Å ID={product_id} —É–¥–∞–ª—ë–Ω")


######################## Read –æ–ø–µ—Ä–∞—Ü–∏–∏ ########################
# –ö–∞—Ç–µ–≥–æ—Ä–∏—è, —Ç–µ–≥, –ø—Ä–æ–¥—É–∫—Ç –ø–æ ID
# –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–µ–≥–∏, –ø—Ä–æ–¥—É–∫—Ç—ã
# –ü—Ä–æ–¥—É–∫—Ç like name


async def category_get_by_id(session: AsyncSession, category_id: int) -> Category:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param category_id: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
    :return: Category —Å id –∏ name –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    """
    category = await session.get(CategoryORM, category_id)
    if not category:
        raise ValueError(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
    return Category.model_validate(category)


async def tag_get_by_id(session: AsyncSession, tag_id: int) -> Tag:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–≥–∞ –ø–æ ID.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param tag_id: ID —Ç–µ–≥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
    :return: Tag —Å id –∏ name —Ç–µ–≥–∞
    """
    tag = await session.get(TagORM, tag_id)
    if not tag:
        raise ValueError(f"–¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return Tag.model_validate(tag)


async def product_get_by_id(session: AsyncSession, product_id: int) -> Product:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ ID.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param product_id: ID –ø—Ä–æ–¥—É–∫—Ç–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
    :return: Product —Å id, name, description, category –∏ tags –ø—Ä–æ–¥—É–∫—Ç–∞
    """
    stmt = (
        select(ProductORM)
        .where(ProductORM.id == product_id)
        .options(selectinload(ProductORM.category), selectinload(ProductORM.tags))
    )
    product = await session.scalar(stmt)
    if not product:
        raise ValueError(f"–ü—Ä–æ–¥—É–∫—Ç —Å ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return Product.model_validate(product)


async def categories_get_all(session: AsyncSession) -> list[Category]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :return: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    """
    stmt = select(CategoryORM)
    categories = await session.scalars(stmt)
    return [Category.model_validate(cat) for cat in categories]


async def category_has_products(session: AsyncSession, category_id: int) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param category_id: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
    :return: True –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã, False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    stmt = select(ProductORM).where(ProductORM.category_id == category_id).limit(1)
    result = await session.scalar(stmt)
    return result is not None


async def tags_get_all(session: AsyncSession) -> list[Tag]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :return: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤
    """
    stmt = select(TagORM)
    tags = await session.scalars(stmt)
    return [Tag.model_validate(tag) for tag in tags]


async def products_get_all(session: AsyncSession) -> list[Product]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :return: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ç–µ–≥–∞–º–∏
    """
    stmt = select(ProductORM).options(
        selectinload(ProductORM.category), selectinload(ProductORM.tags)
    )
    products = await session.scalars(stmt)
    return [Product.model_validate(prod) for prod in products]


async def products_get_like_name(
    session: AsyncSession, name_substring: str
) -> list[Product]:
    """
    –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ —Ç–µ–≥–∞–º.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param name_substring: –ü–æ–¥—Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏—è –≤ –∏–º—è –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –≤ –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏/—Ç–µ–≥–∞
    """
    stmt = (
        select(ProductORM)
        .outerjoin(ProductORM.category)
        .outerjoin(ProductORM.tags)
        .where(
            or_(
                ProductORM.name.ilike(f"%{name_substring}%"),
                CategoryORM.name.ilike(f"%{name_substring}%"),
                TagORM.name.ilike(f"%{name_substring}%"),
            )
        )
        # –í–∞–∂–Ω–æ —è–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å options –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–µ–π
        # –ü–æ—Ç–æ–º—É —á—Ç–æ join \ outerjoin - –¥–ª—è where, –∞ options - –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–µ–π
    ).options(selectinload(ProductORM.category), selectinload(ProductORM.tags))

    products = await session.scalars(stmt)
    return [Product.model_validate(prod) for prod in products]


async def products_get_with_filters(
    session: AsyncSession,
    search: Optional[str] = None,
    sort: Optional[str] = None,
    has_image: bool = False,
) -> list[Product]:
    """
    –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π.

    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param search: –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–ª–∏ —Ç–µ–≥–∞–º
    :param sort: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "currency_direction" (–Ω–∞–ø—Ä–∏–º–µ—Ä, "shmeckles_asc", "flurbos_desc")
    :param has_image: –ï—Å–ª–∏ True, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
    :return: –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
    """
    # –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å –∑–∞–≥—Ä—É–∑–∫–æ–π —Å–≤—è–∑–µ–π
    stmt = select(ProductORM).options(
        selectinload(ProductORM.category), selectinload(ProductORM.tags)
    )

    # –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
    if search:
        stmt = (
            stmt.outerjoin(ProductORM.category)
            .outerjoin(ProductORM.tags)
            .where(
                or_(
                    ProductORM.name.ilike(f"%{search}%"),
                    CategoryORM.name.ilike(f"%{search}%"),
                    TagORM.name.ilike(f"%{search}%"),
                )
            )
        )

    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    products_result = await session.scalars(stmt)
    products = [Product.model_validate(prod) for prod in products_result]

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
    if has_image:
        products = [product for product in products if product.image_url]

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
    if sort:
        try:
            currency, direction = sort.split("_")
            reverse = direction == "desc"

            if currency == "shmeckles":
                products.sort(
                    key=lambda item: item.price_shmeckles
                    if item.price_shmeckles is not None
                    else float("inf"),
                    reverse=reverse,
                )
            elif currency == "flurbos":
                products.sort(
                    key=lambda item: item.price_flurbos
                    if item.price_flurbos is not None
                    else float("inf"),
                    reverse=reverse,
                )
            else:
                raise ValueError(
                    "–ù–µ–≤–µ—Ä–Ω–∞—è –≤–∞–ª—é—Ç–∞ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 'shmeckles' –∏–ª–∏ 'flurbos'."
                )
        except ValueError as e:
            raise ValueError(f"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ sort: {e}")

    return products


######################## Update –æ–ø–µ—Ä–∞—Ü–∏–∏ ########################


async def category_update(session: AsyncSession, category_data: Category) -> Category:
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param category_id: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    :param category_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    :return: –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
    """
    category = await session.get(CategoryORM, category_data.id)
    if not category:
        raise ValueError(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_data.id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    for field, value in category_data.model_dump().items():
        setattr(category, field, value)

    return Category.model_validate(category)


async def tag_update(session: AsyncSession, tag_data: Tag) -> Tag:
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ –ø–æ ID.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param tag_id: ID —Ç–µ–≥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    :param tag_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞
    :return: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ç–µ–≥
    """
    tag = await session.get(TagORM, tag_data.id)
    if not tag:
        raise ValueError(f"–¢–µ–≥ —Å ID={tag_data.id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    for field, value in tag_data.model_dump().items():
        setattr(tag, field, value)

    return Tag.model_validate(tag)


async def product_update(session: AsyncSession, product_data: ProductUpdate) -> Product:
    """
    –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –ø–æ ID –≤–∫–ª—é—á–∞—è —Å–≤—è–∑–∏.
    :param session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è SQLAlchemy
    :param product_data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
    :return: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç
    """
    # –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ–¥—É–∫—Ç
    product = await session.get(ProductORM, product_data.id)
    if not product:
        raise ValueError(f"–ü—Ä–æ–¥—É–∫—Ç —Å ID={product_data.id} –Ω–µ –Ω–∞–π–¥–µ–Ω")

    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞ —á–µ—Ä–µ–∑ —Ä–∞—Å–ø–∞–∫–æ–≤–∫—É DTO
    product_dict = product_data.model_dump(exclude={"category_id", "tag_ids"})
    for key, value in product_dict.items():
        setattr(product, key, value)

    # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞
    if product_data.category_id is not None:
        category = await session.get(CategoryORM, product_data.category_id)
        if category:
            product.category = category
        else:
            raise ValueError(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={product_data.category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")

    else:
        # –ï—Å–ª–∏ category_id –Ω–µ —É–∫–∞–∑–∞–Ω, –æ—Ç–≤—è–∑—ã–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        product.category = None

    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–≥–∏, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω—ã
    if product_data.tag_ids is not None:
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Ç–µ–≥–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
        tags_stmt = select(TagORM).where(TagORM.id.in_(product_data.tag_ids))
        tags_orm = await session.scalars(tags_stmt)
        tags_list = tags_orm.all()

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ —Ç–µ–≥–∏ –Ω–∞–π–¥–µ–Ω—ã
        found_ids = {tag.id for tag in tags_list}
        missing_ids = set(product_data.tag_ids) - found_ids

        if missing_ids:
            raise ValueError(f"–¢–µ–≥–∏ —Å ID={missing_ids} –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")

        # –°–≤—è–∑—ã–≤–∞–µ–º —Ç–µ–≥–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º
        product.tags = list(tags_list)
    else:
        # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫, –æ—Ç–≤—è–∑—ã–≤–∞–µ–º –≤—Å–µ —Ç–µ–≥–∏
        product.tags = []

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏
    await session.flush()

    # –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç —Å —Å–≤—è–∑—è–º–∏ –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
    stmt = (
        select(ProductORM)
        .where(ProductORM.id == product.id)
        .options(selectinload(ProductORM.category), selectinload(ProductORM.tags))
    )

    result = await session.scalars(stmt)
    updated_product = result.one()
    return Product.model_validate(updated_product)

```

## `core/logging_config.py`

```py
"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI.
–ë–∞–∑–æ–≤—ã–π –ª–æ–≥–≥–µ—Ä —Å –≤—ã–≤–æ–¥–æ–º –≤ –∫–æ–Ω—Å–æ–ª—å –∏ —Ñ–∞–π–ª.
"""

import logging
import logging.config
from pathlib import Path

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤
LOG_DIR = Path("logs")
LOG_DIR.mkdir(exist_ok=True)

# –§–∞–π–ª –ª–æ–≥–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_LOG_FILE = LOG_DIR / "app.log"


def setup_logging(
    log_level: str = "INFO", log_file: str | Path = DEFAULT_LOG_FILE
) -> None:
    """
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

    Args:
        log_level: –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR, CRITICAL)
        log_file: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤
    """
    config = {
        "version": 1,
        "disable_existing_loggers": False,
        "formatters": {
            "standard": {
                "format": "%(asctime)s | %(levelname)-8s | %(name)s:%(lineno)d | %(message)s",
                "datefmt": "%Y-%m-%d %H:%M:%S",
            },
        },
        "handlers": {
            "console": {
                "class": "logging.StreamHandler",
                "level": log_level,
                "formatter": "standard",
                "stream": "ext://sys.stdout",
            },
            "file": {
                "class": "logging.FileHandler",
                "level": log_level,
                "formatter": "standard",
                "filename": str(log_file),
                "encoding": "utf-8",
                "mode": "a",  # append mode
            },
        },
        "loggers": {
            "": {  # root logger
                "handlers": ["console", "file"],
                "level": log_level,
                "propagate": False,
            },
            "uvicorn": {
                "handlers": ["console", "file"],
                "level": log_level,
                "propagate": False,
            },
            "uvicorn.error": {
                "handlers": ["console", "file"],
                "level": log_level,
                "propagate": False,
            },
            "uvicorn.access": {
                "handlers": ["console"],
                "level": "INFO",
                "propagate": False,
            },
        },
    }

    logging.config.dictConfig(config)
    logger = logging.getLogger(__name__)
    logger.info(f"–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ. –£—Ä–æ–≤–µ–Ω—å: {log_level}, –§–∞–π–ª: {log_file}")

```

## `core/order_crud.py`

```py
# core/order_crud.py
"""
CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –∫–æ–ø–∏—Ä—É–µ—Ç —Ü–µ–Ω—ã –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –≤ OrderItem (—Å–ª–µ–ø–æ–∫ –¥–∞–Ω–Ω—ã—Ö).
"""

import logging
from datetime import datetime
from typing import List

from sqlalchemy import select
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy.orm import selectinload

from core.cart_crud import clear_cart, get_cart_with_items
from models.commerce import Order, OrderItem
from schemas.commerce import OrderCreate

logger = logging.getLogger(__name__)


async def create_order(
    session: AsyncSession, user_id: int, order_data: OrderCreate
) -> Order:
    """
    –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –¢–†–ê–ù–ó–ê–ö–¶–ò–û–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê (—è–≤–Ω–∞—è —á–µ—Ä–µ–∑ async with session.begin()):
    1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞
    2. –°—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
    3. –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å Order
    4. –ò—Ç–µ—Ä–∏—Ä—É–µ–º—Å—è –ø–æ –∫–æ—Ä–∑–∏–Ω–µ –∏ —Å–æ–∑–¥–∞–µ–º OrderItem —Å –ö–û–ü–ò–†–û–í–ê–ù–ò–ï–ú —Ü–µ–Ω—ã –∏ –Ω–∞–∑–≤–∞–Ω–∏—è (frozen_price, frozen_name)
    5. –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    6. –ö–æ–º–º–∏—Ç–∏–º –≤—Å—ë –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –±–ª–æ–∫–∞)

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        order_data: –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ (–∞–¥—Ä–µ—Å, —Ç–µ–ª–µ—Ñ–æ–Ω)

    Returns:
        Order: –°–æ–∑–¥–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑ —Å–æ –≤—Å–µ–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏

    Raises:
        ValueError: –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
    """
    # –®–∞–≥ 1: –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É —Å —Ç–æ–≤–∞—Ä–∞–º–∏ (–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
    cart = await get_cart_with_items(session, user_id)

    if cart is None or len(cart.items) == 0:
        logger.warning(f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ —Å –ø—É—Å—Ç–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π (user_id={user_id})")
        raise ValueError("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑.")

    logger.info(
        f"üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}. –¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ: {len(cart.items)}"
    )

    # –®–∞–≥ 2: –°—á–∏—Ç–∞–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É (—Ñ–∏–∫—Å–∏—Ä—É–µ–º –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è)
    # –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: total_amount - —ç—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–ª–µ –≤ –ë–î (snapshot), –∞ –Ω–µ computed property.
    # –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è e-commerce: —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É–º–º—É "–∫–∞–∫ –±—ã–ª–æ", –¥–∞–∂–µ –µ—Å–ª–∏ —Ü–µ–Ω—ã –∏–∑–º–µ–Ω—è—Ç—Å—è.
    total_amount = sum(
        item.product.price_shmeckles * item.quantity for item in cart.items
    )

    # –®–∞–≥ 3: –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –∑–∞–∫–∞–∑–∞
    order = Order(
        user_id=user_id,
        created_at=datetime.utcnow(),
        status="pending",
        total_amount=total_amount,
        delivery_address=order_data.delivery_address,
        phone=order_data.phone,
    )
    session.add(order)
    # –î–µ–ª–∞–µ–º flush, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å order.id –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ OrderItem
    await session.flush()

    logger.info(f"‚úÖ –°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ #{order.id} –Ω–∞ —Å—É–º–º—É {total_amount} —à–º–µ–∫–ª–µ–π")

    # –®–∞–≥ 4: –°–æ–∑–¥–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –ó–ê–ú–û–†–û–ñ–ï–ù–ù–´–ú–ò –¥–∞–Ω–Ω—ã–º–∏
    for cart_item in cart.items:
        order_item = OrderItem(
            order_id=order.id,
            product_id=cart_item.product_id,
            quantity=cart_item.quantity,
            # === –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏ ===
            frozen_name=cart_item.product.name,
            frozen_price=cart_item.product.price_shmeckles,
        )
        session.add(order_item)

        logger.info(
            f"  üìã –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è: {order_item.frozen_name} "
            f"x{order_item.quantity} –ø–æ {order_item.frozen_price} —à–º–µ–∫–ª–µ–π"
        )

    # –®–∞–≥ 5: –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ë–ï–ó auto_commit (commit —Å–¥–µ–ª–∞–µ—Ç get_db_session)
    await clear_cart(session, user_id, auto_commit=False)

    # –®–∞–≥ 6: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ get_db_session()
    # –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

    # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ (eager loading)
    # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ç.–∫. —ç—Ç–æ —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ
    stmt = select(Order).where(Order.id == order.id).options(selectinload(Order.items))
    result = await session.execute(stmt)
    order = result.scalar_one()

    logger.info(f"üéâ –ó–∞–∫–∞–∑ #{order.id} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –∏ –∫–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞")

    return order


async def get_user_orders(session: AsyncSession, user_id: int) -> List[Order]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è, –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É).

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        List[Order]: –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
    """
    stmt = (
        select(Order)
        .where(Order.user_id == user_id)
        .options(selectinload(Order.items))
        .order_by(Order.created_at.desc())
    )
    result = await session.execute(stmt)
    orders = result.scalars().all()

    logger.info(f"üìú –ü–æ–ª—É—á–µ–Ω–æ {len(orders)} –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")

    return list(orders)


async def get_order_by_id(
    session: AsyncSession, user_id: int, order_id: int
) -> Order | None:
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç—É–ø–∞.

    Args:
        session: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è –ë–î
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞)
        order_id: ID –∑–∞–∫–∞–∑–∞

    Returns:
        Order | None: –ó–∞–∫–∞–∑ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω/–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    """
    stmt = (
        select(Order)
        .where(Order.id == order_id, Order.user_id == user_id)
        .options(selectinload(Order.items))
    )
    result = await session.execute(stmt)
    order = result.scalar_one_or_none()

    if order:
        logger.info(f"üîç –ù–∞–π–¥–µ–Ω –∑–∞–∫–∞–∑ #{order_id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
    else:
        logger.warning(
            f"‚ö†Ô∏è –ó–∞–∫–∞–∑ #{order_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}"
        )

    return order

```

## `core/storage.py`

```py
"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤.
–ü—Ä–æ—Å—Ç–æ–µ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞.
"""

import logging
import uuid
from pathlib import Path
from fastapi import UploadFile, HTTPException

logger = logging.getLogger(__name__)

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
UPLOAD_DIR = Path("uploads/products")
UPLOAD_DIR.mkdir(parents=True, exist_ok=True)

# –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
ALLOWED_EXTENSIONS = {".jpg", ".jpeg", ".png", ".gif", ".webp"}

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (5 –ú–ë)
MAX_FILE_SIZE = 5 * 1024 * 1024


async def save_product_image(file: UploadFile) -> str:
    """
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL.

    Args:
        file: –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (UploadFile)

    Returns:
        str: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL –∫ —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: /uploads/products/abc123.jpg)

    Raises:
        HTTPException: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    """
    logger.info(f"üì• –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: {file.filename}")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    if not file.filename:
        logger.error("‚ùå –ò–º—è —Ñ–∞–π–ª–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")
        raise HTTPException(status_code=400, detail="–ò–º—è —Ñ–∞–π–ª–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
    ext = Path(file.filename).suffix.lower()
    if ext not in ALLOWED_EXTENSIONS:
        logger.error(f"‚ùå –ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞: {ext}")
        raise HTTPException(
            status_code=400,
            detail=f"–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {', '.join(ALLOWED_EXTENSIONS)}",
        )

    # –ß—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
    content = await file.read()

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    file_size = len(content)
    if file_size > MAX_FILE_SIZE:
        logger.error(f"‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: {file_size} –±–∞–π—Ç")
        raise HTTPException(
            status_code=400,
            detail=f"–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º: {MAX_FILE_SIZE / (1024 * 1024):.1f} –ú–ë",
        )

    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    filename = f"{uuid.uuid4()}{ext}"
    filepath = UPLOAD_DIR / filename

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    try:
        with open(filepath, "wb") as f:
            f.write(content)
        logger.info(f"‚úÖ –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {filename} ({file_size} –±–∞–π—Ç)")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {e}")
        raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞: {e}")

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL
    image_url = f"/uploads/products/{filename}"
    logger.info(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: {image_url}")
    return image_url


def delete_product_image(image_url: str) -> bool:
    """
    –£–¥–∞–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.

    Args:
        image_url: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: /uploads/products/abc123.jpg)

    Returns:
        bool: True –µ—Å–ª–∏ —Ñ–∞–π–ª —É–¥–∞–ª—ë–Ω, False –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –æ—à–∏–±–∫–∞
    """
    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ URL
        filename = Path(image_url).name
        filepath = UPLOAD_DIR / filename

        if filepath.exists():
            filepath.unlink()
            logger.info(f"üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {filename}")
            return True
        else:
            logger.warning(f"‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: {filename}")
            return False
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
        return False

```

## `data.py`

```py
# data.py
products = [
    {
        "id": 1,
        "name": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ü–ª—é–º–±—É—Å",
        "description": "–ö–∞–∂–¥—ã–π –¥–æ–º –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–ª—é–º–±—É—Å. –ú—ã –Ω–µ –∑–Ω–∞–µ–º, —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç, –Ω–æ –æ–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ. –í –∫–æ–º–ø–ª–µ–∫—Ç–µ: —à–ª–µ–µ, –≥—Ä—É–º–±–æ –∏ —Ñ–ª–∏–±.",
        "prices": {"shmeckles": 6.5, "credits": 4.8, "flurbos": 3.2},
        "image_url": "/images/plumbus.webp",
    },
    {
        "id": 2,
        "name": "–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏",
        "description": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø–æ –¥–æ–º—É? –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –∏ –ø–æ—è–≤–∏—Ç—Å—è –ú–∏—Å–∏–∫—Å, –≥–æ—Ç–æ–≤—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ –≤–∞—à–µ –ø–æ—Ä—É—á–µ–Ω–∏–µ. –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ–≥–æ ‚Äî –±–æ–ª—å, —Ç–∞–∫ —á—Ç–æ –Ω–µ –∑–∞—Ç—è–≥–∏–≤–∞–π—Ç–µ!",
        "prices": {"shmeckles": 19.99, "credits": 14.5, "flurbos": 9.8},
        "image_url": "/images/meeseeks-box.webp",
    },
    {
        "id": 3,
        "name": "–ü–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞ (–±/—É)",
        "description": "–°–ª–µ–≥–∫–∞ –ø–æ—Ü–∞—Ä–∞–ø–∞–Ω–∞, –∑–∞—Ä—è–¥ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏ –Ω–∞ 37%. –í–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç. –ú–æ–∂–µ—Ç –ø–∞—Ö–Ω—É—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏ —á—É–∂–∏–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ: –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –¶–∏—Ç–∞–¥–µ–ª–∏.",
        "prices": {"shmeckles": 9999.99, "credits": 7500.0, "flurbos": 4999.99},
        "image_url": "/images/portal-gun.webp",
    },
    {
        "id": 4,
        "name": "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è –º–∞—Ç–µ—Ä–∏—è",
        "description": "–ò–¥–µ–∞–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–∞–±–ª—è. –í—Å–µ–≥–æ –æ–¥–Ω–∞ –∫–∞–ø–ª—è –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —É–ª–µ—Ç–µ—Ç—å –æ—Ç –ª—é–±—ã—Ö —ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫—Ä–∏–∑–∏—Å–æ–≤. –ù–µ —É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –≤–Ω—É—Ç—Ä—å!",
        "prices": {"shmeckles": 850.0, "credits": 620.0, "flurbos": 415.0},
        "image_url": "/images/dark-matter.webp",
    },
    {
        "id": 5,
        "name": "–ú–∞—Å–ª–æ-—Ä–æ–±–æ—Ç '–ü–µ—Ä–µ–¥–∞–π –º–∞—Å–ª–æ'",
        "description": "–ï–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ª—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–∞—Å–ª–æ. –û–Ω –æ—Å–æ–∑–Ω–∞–µ—Ç —ç—Ç–æ –∏ –≤–ø–∞–¥–∞–µ—Ç –≤ –¥–µ–ø—Ä–µ—Å—Å–∏—é. –û—Ç–ª–∏—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞ –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ.",
        "prices": {"shmeckles": 25.5, "credits": 18.2, "flurbos": 12.5},
        "image_url": "/images/butter-robot.webp",
    },
    {
        "id": 6,
        "name": "–®–ª–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è –º—ã—Å–ª–µ–π —Å–æ–±–∞–∫",
        "description": "–¢–µ–ø–µ—Ä—å –≤—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —É–∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –≤–∞—à –ø—ë—Å —Å–ø—Ä—è—Ç–∞–ª —Ç–∞–ø–∫–∏ –∏ –ø–æ—á–µ–º—É –æ–Ω –ª–∞–µ—Ç –Ω–∞ –ø—ã–ª–µ—Å–æ—Å. –°–ø–æ–π–ª–µ—Ä: –æ–Ω —Å—á–∏—Ç–∞–µ—Ç –≤–∞—Å —Ö–æ—Ä–æ—à–∏–º –º–∞–ª—å—á–∏–∫–æ–º.",
        "prices": {"shmeckles": 120.0, "credits": 88.0, "flurbos": 59.0},
        "image_url": "/images/dog-helmet.webp",
    },
    {
        "id": 7,
        "name": "–ó–µ—Ä–Ω–æ–≤—ã–µ '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–∏'",
        "description": "–ú–∞–ª–µ–Ω—å–∫–∏–µ –≥–ª–∞–∑–∞—Å—Ç—ã–µ —á–µ–ª–æ–≤–µ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∂–∏–≤—É—Ç –≤ –∫–æ—Ä–æ–±–∫–µ –∏ —É–º–æ–ª—è—é—Ç –≤–∞—Å —Å—ä–µ—Å—Ç—å –∏—Ö. –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫ —Å –Ω–æ—Ç–∫–∞–º–∏ –æ—Ç—á–∞—è–Ω–∏—è.",
        "prices": {"shmeckles": 4.20, "credits": 3.1, "flurbos": 2.05},
        "image_url": "/images/eyeholes.webp",
    },
    {
        "id": 8,
        "name": "–ú–∏–∫—Ä–æ-–≤—Å–µ–ª–µ–Ω–Ω–∞—è –≤ –∫–æ—Ä–æ–±–∫–µ",
        "description": "–ò—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ï—ë –∂–∏—Ç–µ–ª–∏ –ø–æ–∫–ª–æ–Ω—è—é—Ç—Å—è –≤–∞–º –∫–∞–∫ –±–æ–≥—É, –ø–æ–∫–∞ –≤—ã –Ω–µ –∑–∞–≤–æ–¥–∏—Ç–µ –º–∞—à–∏–Ω—É. –≠—Ç–∏—á–Ω–æ? –†–µ—à–∞—Ç—å –≤–∞–º.",
        "prices": {"shmeckles": 2500.0, "credits": 1850.0, "flurbos": 1225.0},
        "image_url": "/images/microverse-battery.webp",
    },
    {
        "id": 9,
        "name": "–ù–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏",
        "description": "–í–∏–¥–µ–ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ –Ω–µ —Å–ª–µ–¥–æ–≤–∞–ª–æ? –°–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –∏–∑ —Å–≤–æ–µ–π –ø–∞–º—è—Ç–∏ –∏–ª–∏ –ø–∞–º—è—Ç–∏ –¥—Ä—É–∑–µ–π. –ü–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞–±—É–¥–µ—Ç–µ, –∫–∞–∫ –∑–∞–≤—è–∑—ã–≤–∞—Ç—å —à–Ω—É—Ä–∫–∏.",
        "prices": {"shmeckles": 350.75, "credits": 256.0, "flurbos": 172.5},
        "image_url": "/images/memory-neutralizer.webp",
    },
    {
        "id": 10,
        "name": "–°–µ–º–µ–Ω–∞ –∏–∑ –ú–µ–≥–∞-–¥–µ—Ä–µ–≤—å–µ–≤",
        "description": "–ü—Ä–∏–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç. –î–ª—è –ø—Ä–æ–≤–æ–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ –æ—á–µ–Ω—å... —É–∫—Ä–æ–º–Ω–æ–µ –º–µ—Å—Ç–æ. –¢–∞–º–æ–∂–Ω—è –Ω–µ –æ–¥–æ–±—Ä–∏—Ç.",
        "prices": {"shmeckles": 55.0, "credits": 40.5, "flurbos": 27.0},
        "image_url": "/images/mega-seeds.webp",
    },
    {
        "id": 11,
        "name": "–ê–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫ (–ù–∞–±–æ—Ä '–°–¥–µ–ª–∞–π —Å–∞–º')",
        "description": "–£–º–µ–Ω—å—à–∏—Ç–µ—Å—å –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –±–µ–∑–¥–æ–º–Ω–æ–≥–æ! –í –Ω–∞–±–æ—Ä–µ –≤—Å–µ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã: '–ü–∏—Ä–∞—Ç—Å–∫–∞—è –°–µ–ª–µ–∑–µ–Ω–∫–∞', '–ö–æ—Å—Ç—è–Ω–æ–π –≠–∫—Å–ø—Ä–µ—Å—Å' –∏ –¥—Ä—É–≥–∏–µ. –ë–µ–∑–¥–æ–º–Ω—ã–π –≤ –∫–æ–º–ø–ª–µ–∫—Ç –Ω–µ –≤—Ö–æ–¥–∏—Ç.",
        "prices": {"shmeckles": 199.99, "credits": 146.0, "flurbos": 98.5},
        "image_url": "/images/anatomy-park.webp",
    },
    {
        "id": 12,
        "name": "–ö—Ä–∏—Å—Ç–∞–ª–ª —Å–º–µ—Ä—Ç–∏",
        "description": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–∞—à–µ–π —Å–º–µ—Ä—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä–æ–≤ –∏ –∏–ø–æ—Ö–æ–Ω–¥—Ä–∏–∫–æ–≤.",
        "prices": {"shmeckles": 77.0, "credits": 56.5, "flurbos": 37.8},
        "image_url": "/images/death-crystal.webp",
    },
    {
        "id": 13,
        "name": "–ì–æ–≤–æ—Ä—è—â–∏–π –∫–æ—Ç (–±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π)",
        "description": "–û–Ω —É–º–µ–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å, –Ω–æ –ª—É—á—à–µ –±—ã –≤—ã –Ω–µ –∑–Ω–∞–ª–∏, –æ —á—ë–º. –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –µ–≥–æ, —á—Ç–æ –æ–Ω –≤–∏–¥–µ–ª. –ü—Ä–æ—Å—Ç–æ –∫–æ—Ä–º–∏—Ç–µ –∏ –Ω–∞–¥–µ–π—Ç–µ—Å—å –Ω–∞ –ª—É—á—à–µ–µ.",
        "prices": {"shmeckles": 5.0, "credits": 3.6, "flurbos": 2.4},
        "image_url": "/images/talking-cat.webp",
    },
    {
        "id": 14,
        "name": "–ë–æ—Ç–∏–Ω–∫–∏ –¥–ª—è —Ö–æ–¥—å–±—ã –ø–æ —Å—Ç–µ–Ω–∞–º",
        "description": "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è ‚Äî –¥–ª—è —Å–ª–∞–±–∞–∫–æ–≤. –¢–µ–ø–µ—Ä—å –ø–æ–ª, —Å—Ç–µ–Ω—ã –∏ –ø–æ—Ç–æ–ª–æ–∫ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–ª–æ—Ç–Ω–æ–≥–æ –æ–±–µ–¥–∞.",
        "prices": {"shmeckles": 210.0, "credits": 154.0, "flurbos": 103.0},
        "image_url": "/images/gravity-shoes.webp",
    },
    {
        "id": 15,
        "name": "–ü—Ä–∏–±–æ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–Ω–∞–º–∏",
        "description": "–ü—Ä–æ–Ω–∏–∫–Ω–∏—Ç–µ –≤ —Å–Ω—ã –≤–∞—à–µ–≥–æ —É—á–∏—Ç–µ–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –∑–∞—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∞–º –ø—è—Ç–µ—Ä–∫—É. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞—Ç–∞–π—Ç–µ—Å—å –Ω–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–µ. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã!",
        "prices": {"shmeckles": 400.0, "credits": 292.0, "flurbos": 196.0},
        "image_url": "/images/dream-inator.webp",
    },
    {
        "id": 16,
        "name": "–ö–ª–æ–Ω-–ø–∏—Å—Ç–æ–ª–µ—Ç",
        "description": "–°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—É—é –∫–æ–ø–∏—é –ª—é–±–æ–≥–æ –∂–∏–≤–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞. –ö–æ–ø–∏—è –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∞—è—Ç—å —á–µ—Ä–µ–∑ —á–∞—Å. –ò–¥–µ–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–æ–Ω–∞ –Ω–∞ —Å–∫—É—á–Ω–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ.",
        "prices": {"shmeckles": 555.55, "credits": 405.0, "flurbos": 272.5},
        "image_url": "/images/clone-gun.webp",
    },
    {
        "id": 17,
        "name": "–ü–∏—Å—Ç–æ–ª–µ—Ç-—É–º–µ–Ω—å—à–∏—Ç–µ–ª—å",
        "description": "–£–º–µ–Ω—å—à–∞–µ—Ç –ª—é–±–æ–π –ø—Ä–µ–¥–º–µ—Ç –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ –¥–æ –∫–∞—Ä–º–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–æ–≤ –∏–ª–∏ –µ—Å–ª–∏ –≤—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π –±—É—Ç–µ—Ä–±—Ä–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –≤ —Ä—É–∫–µ.",
        "prices": {"shmeckles": 320.0, "credits": 234.0, "flurbos": 157.0},
        "image_url": "/images/shrinking-ray.webp",
    },
    {
        "id": 18,
        "name": "–ö—Ä–µ–º '–í–µ—á–Ω–∞—è –º–æ–ª–æ–¥–æ—Å—Ç—å'",
        "description": "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å—Ç–∞—Ä–µ–Ω–∏—è. –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ. –ü–æ–¥—É–º–∞–π—Ç–µ –¥–≤–∞–∂–¥—ã, –ø—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –Ω–∞ —Å–≤–æ–µ–º —Ä–µ–±–µ–Ω–∫–µ. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è, –Ω–æ –∫—Ç–æ –µ–µ —á–∏—Ç–∞–µ—Ç?",
        "prices": {"shmeckles": 680.0, "credits": 496.0, "flurbos": 334.0},
        "image_url": "/images/age-cream.webp",
    },
    {
        "id": 19,
        "name": "–°–∏–º—É–ª—è—Ç–æ—Ä '–†–æ–π'",
        "description": "–ü—Ä–æ–∂–∏–≤–∏—Ç–µ —Ü–µ–ª—É—é –∂–∏–∑–Ω—å –æ–±—ã—á–Ω–æ–≥–æ –ø–∞—Ä–Ω—è –ø–æ –∏–º–µ–Ω–∏ –†–æ–π. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ, –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤—ã–∫–∞–Ω–∏–µ –∏ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–≤—Ä–æ–≤.",
        "prices": {"shmeckles": 12.50, "credits": 9.15, "flurbos": 6.1},
        "image_url": "/images/roy-game.webp",
    },
    {
        "id": 20,
        "name": "–ì–∞—Ä–º–æ–Ω–∏–∑–∞—Ç–æ—Ä –º–µ–∂–≤—Å–µ–ª–µ–Ω—Å–∫–æ–≥–æ –¢–í",
        "description": "–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–∞—à–µ–º—É –æ–±—ã—á–Ω–æ–º—É —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º—É —á–∏—Å–ª—É –∫–∞–Ω–∞–ª–æ–≤ —Å–æ –≤—Å–µ–π –º—É–ª—å—Ç–∏–≤—Å–µ–ª–µ–Ω–Ω–æ–π. –í–∫–ª—é—á–∞—è —Ä–µ–∫–ª–∞–º—É '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–æ–≤' –∏ —Å–µ—Ä–∏–∞–ª '–ú–∏—Å—Ç–∏–∫—Å-–ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–π'.",
        "prices": {"shmeckles": 49.99, "credits": 36.5, "flurbos": 24.5},
        "image_url": "/images/interdimensional-cable.webp",
    },
]

```

## `doc/architecture_diagrams.md`

```md
# üìä –î–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã FastAPI + Celery + Redis

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```mermaid
graph TB
    subgraph "–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å"
        Client[üë§ –ö–ª–∏–µ–Ω—Ç<br/>–ë—Ä–∞—É–∑–µ—Ä/Postman]
    end
    
    subgraph "Backend - FastAPI Application"
        FastAPI[üöÄ FastAPI Server<br/>uvicorn main:app<br/>Port: 8000]
        Routes[üìç Routes<br/>products.py]
        Tasks[üì¶ Tasks Module<br/>notifications.py]
        Config[‚öôÔ∏è Config<br/>settings from .env]
    end
    
    subgraph "Message Broker & Backend"
        Redis[(üóÑÔ∏è Redis Server<br/>Port: 6379<br/>Database: 0)]
        Queue[üì¨ Task Queue<br/>–ó–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏]
        Results[üìã Results Backend<br/>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è]
    end
    
    subgraph "Background Worker"
        Celery[‚öôÔ∏è Celery Worker<br/>celery worker --pool=solo]
        Executor[üîß Task Executor<br/>send_tg_notification]
    end
    
    Client -->|HTTP Request| FastAPI
    FastAPI --> Routes
    Routes --> Tasks
    Tasks -->|.delay()| Redis
    Redis --> Queue
    Queue -->|Poll| Celery
    Celery --> Executor
    Executor -->|Save Result| Results
    Results --> Redis
    FastAPI -->|Read Settings| Config
    Celery -->|Read Settings| Config
    
    style FastAPI fill:#61dafb,stroke:#333,stroke-width:2px
    style Redis fill:#dc382d,stroke:#333,stroke-width:2px
    style Celery fill:#37814a,stroke:#333,stroke-width:2px
    style Client fill:#ffd700,stroke:#333,stroke-width:2px
```

---

## 2. –ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ —Å —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π

```mermaid
graph LR
    A[üë§ –ö–ª–∏–µ–Ω—Ç] -->|POST /products/| B[üöÄ FastAPI]
    B -->|1. –í–∞–ª–∏–¥–∞—Ü–∏—è| C{–î–∞–Ω–Ω—ã–µ OK?}
    C -->|‚ùå –ù–µ—Ç| D[400 Bad Request]
    C -->|‚úÖ –î–∞| E[–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä]
    E -->|2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å| F[üìù products list]
    E -->|3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É| G[send_tg_notification.delay]
    G -->|–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å| H[(üóÑÔ∏è Redis Queue)]
    B -->|4. –í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç| I[201 Created]
    I --> A
    H -->|Celery –∑–∞–±–∏—Ä–∞–µ—Ç| J[‚öôÔ∏è Celery Worker]
    J -->|5. –í—ã–ø–æ–ª–Ω–∏—Ç—å 30 —Å–µ–∫| K[üì± Send to Telegram]
    K -->|6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç| L[(üóÑÔ∏è Redis Backend)]
    
    style A fill:#ffd700
    style B fill:#61dafb
    style H fill:#dc382d
    style J fill:#37814a
    style I fill:#90EE90
    style D fill:#ffcccb
```

---

## 3. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏ Celery

```mermaid
stateDiagram-v2
    [*] --> Pending: –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞<br/>.delay()
    Pending --> Received: Worker –ø–æ–ª—É—á–∏–ª –∑–∞–¥–∞—á—É
    Received --> Started: –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    Started --> Success: –í—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
    Started --> Retry: –û—à–∏–±–∫–∞ (–ø–æ–ø—ã—Ç–∫–∞ 1)
    Retry --> Started: –ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ 5 —Å–µ–∫
    Retry --> Retry: –û—à–∏–±–∫–∞ (–ø–æ–ø—ã—Ç–∫–∞ 2)
    Retry --> Failed: max_retries=3<br/>–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –∏—Å—á–µ—Ä–ø–∞–Ω—ã
    Success --> [*]: –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ Redis
    Failed --> [*]: –ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞
    
    note right of Pending
        task.id = UUID
        task.state = 'PENDING'
    end note
    
    note right of Started
        task.state = 'STARTED'
        –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 30 —Å–µ–∫—É–Ω–¥
    end note
    
    note right of Success
        task.state = 'SUCCESS'
        task.result = {...}
    end note
    
    note right of Retry
        self.retry(countdown=5)
        max_retries=3
    end note
```

---

## 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

```mermaid
graph TB
    subgraph "Process 1: FastAPI"
        A1[main.py<br/>FastAPI app]
        A2[routes/products.py<br/>–ú–∞—Ä—à—Ä—É—Ç—ã API]
        A3[tasks/notifications.py<br/>–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á]
        A4[config.py<br/>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env]
        
        A1 --> A2
        A2 --> A3
        A1 --> A4
    end
    
    subgraph "Process 2: Redis Server"
        B1[(Redis Database 0)]
        B2[Queue: celery]
        B3[Results: celery-task-meta-*]
        
        B1 --> B2
        B1 --> B3
    end
    
    subgraph "Process 3: Celery Worker"
        C1[tasks/celery_app.py<br/>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è]
        C2[tasks/notifications.py<br/>–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á]
        C3[–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è<br/>worker_pool=solo]
        
        C1 --> C2
        C1 --> C3
    end
    
    A3 -->|send_tg_notification.delay| B2
    B2 -->|Poll for tasks| C2
    C2 -->|Save result| B3
    
    style A1 fill:#61dafb
    style B1 fill:#dc382d
    style C1 fill:#37814a
```

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery –¥–ª—è Windows

```mermaid
mindmap
  root((Celery Config<br/>Windows))
    Broker
      Redis URL
        redis://localhost:6379/0
      Retry on Startup
        broker_connection_retry_on_startup=True
    Backend
      Redis URL
        redis://localhost:6379/0
      Store Results
        –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis
    Worker Pool
      Type: solo
        worker_pool="solo"
      Concurrency: 1
        worker_concurrency=1
      –ü—Ä–∏—á–∏–Ω–∞
        Windows –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç fork
    Task Settings
      Acknowledge
        task_acks_late=True
      Max Retries
        max_retries=3
      Retry Countdown
        countdown=5 —Å–µ–∫
```

---

## 6. –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã

```mermaid
sequenceDiagram
    participant Dev as üë®‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
    participant T1 as Terminal 1
    participant T2 as Terminal 2
    participant T3 as Terminal 3
    participant Redis as Redis Server
    participant FastAPI as FastAPI App
    participant Celery as Celery Worker
    
    Note over Dev,Celery: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)
    Dev->>Dev: python -m venv venv
    Dev->>Dev: pip install -r requirements.txt
    Dev->>Dev: Copy .env.example ‚Üí .env
    
    Note over Dev,Celery: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã (–∫–∞–∂–¥—ã–π —Ä–∞–∑)
    
    Dev->>T1: –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª 1
    T1->>Redis: redis-server
    activate Redis
    Redis-->>T1: Redis server started<br/>Port: 6379
    
    Dev->>T2: –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª 2
    T2->>T2: .\venv\Scripts\Activate.ps1
    T2->>FastAPI: uvicorn main:app --reload
    activate FastAPI
    FastAPI->>FastAPI: –ó–∞–≥—Ä—É–∑–∫–∞ config.py
    FastAPI->>FastAPI: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è routes
    FastAPI->>FastAPI: –ò–º–ø–æ—Ä—Ç tasks
    FastAPI-->>T2: Uvicorn running on<br/>http://0.0.0.0:8000
    
    Dev->>T3: –û—Ç–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª 3
    T3->>T3: .\venv\Scripts\Activate.ps1
    T3->>Celery: celery -A tasks.celery_app<br/>worker --pool=solo -l info
    activate Celery
    Celery->>Redis: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±—Ä–æ–∫–µ—Ä—É
    Redis-->>Celery: –ü–æ–¥–∫–ª—é—á–µ–Ω–æ
    Celery->>Celery: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á
    Celery-->>T3: celery@WIN-... ready
    
    Note over Dev,Celery: ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!
    
    Dev->>FastAPI: –û—Ç–∫—Ä—ã—Ç—å http://localhost:8000/docs
    FastAPI-->>Dev: Swagger UI
```

---

## 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

```mermaid
flowchart TD
    Start([–ó–∞–¥–∞—á–∞ –ø–æ–ª—É—á–µ–Ω–∞<br/>Celery Worker]) --> Execute[–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ<br/>send_tg_notification]
    Execute --> Check{–£—Å–ø–µ—à–Ω–æ?}
    
    Check -->|‚úÖ –î–∞| SaveResult[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç<br/>–≤ Redis Backend]
    SaveResult --> ACK[–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ<br/>task_acks_late=True]
    ACK --> Done([–ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞])
    
    Check -->|‚ùå –ù–µ—Ç| CountRetries{–ü–æ–ø—ã—Ç–∫–∏ < 3?}
    CountRetries -->|–î–∞| Wait[–û–∂–∏–¥–∞–Ω–∏–µ<br/>countdown=5 —Å–µ–∫]
    Wait --> Retry[–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞]
    Retry --> Execute
    
    CountRetries -->|–ù–µ—Ç| Failed[–ó–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞<br/>FAILED]
    Failed --> SaveError[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫—É<br/>–≤ Redis]
    SaveError --> Done
    
    style Start fill:#90EE90
    style Done fill:#90EE90
    style Failed fill:#ffcccb
    style SaveResult fill:#87CEEB
    style ACK fill:#87CEEB
```

---

## 8. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

```mermaid
graph TD
    Root[fast_api_419/]
    
    Root --> Main[main.py<br/>üöÄ FastAPI app]
    Root --> Config[config.py<br/>‚öôÔ∏è Settings]
    Root --> Data[data.py<br/>üìä Products data]
    Root --> Env[.env<br/>üîê Environment vars]
    Root --> Req[requirements.txt<br/>üì¶ Dependencies]
    
    Root --> Routes[routes/]
    Routes --> RoutesInit[__init__.py]
    Routes --> Products[products.py<br/>üìç API endpoints]
    
    Root --> Schemas[schemas/]
    Schemas --> SchemasInit[__init__.py]
    Schemas --> Product[product.py<br/>üìã Pydantic models]
    
    Root --> Tasks[tasks/]
    Tasks --> TasksInit[__init__.py]
    Tasks --> CeleryApp[celery_app.py<br/>‚öôÔ∏è Celery config]
    Tasks --> Notifications[notifications.py<br/>üì® Task functions]
    
    Root --> Doc[doc/]
    Doc --> DetailedExpl[celery_detailed_explanation.md]
    Doc --> Diagrams[architecture_diagrams.md]
    
    style Main fill:#61dafb
    style CeleryApp fill:#37814a
    style Config fill:#ffa500
    style Products fill:#61dafb
```

---

## 9. Redis: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```mermaid
graph TB
    subgraph Redis[(Redis Server<br/>localhost:6379)]
        DB0[Database 0]
        
        subgraph "Broker - –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á"
            Queue[Queue: 'celery'<br/>Type: List]
            Task1[Task 1: JSON]
            Task2[Task 2: JSON]
            Task3[Task 3: JSON]
            
            Queue --> Task1
            Queue --> Task2
            Queue --> Task3
        end
        
        subgraph "Backend - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã"
            Meta1[celery-task-meta-uuid1<br/>Type: String<br/>TTL: 1 day]
            Meta2[celery-task-meta-uuid2<br/>Type: String<br/>TTL: 1 day]
            
            Result1[Status: SUCCESS<br/>Result: {...}]
            Result2[Status: PENDING<br/>Result: null]
            
            Meta1 --> Result1
            Meta2 --> Result2
        end
        
        DB0 --> Queue
        DB0 --> Meta1
        DB0 --> Meta2
    end
    
    FastAPI[FastAPI] -->|LPUSH| Queue
    Celery[Celery Worker] -->|BRPOP| Queue
    Celery -->|SET| Meta1
    
    style Redis fill:#dc382d,color:#fff
    style Queue fill:#ff6b6b
    style Meta1 fill:#4ecdc4
    style Meta2 fill:#4ecdc4
```

---

## 10. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –° Celery vs –ë–µ–∑ Celery

```mermaid
graph TB
    subgraph "‚ùå –ë–ï–ó Celery - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"
        A1[–ö–ª–∏–µ–Ω—Ç] -->|POST /products/| B1[FastAPI]
        B1 --> C1[–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä]
        C1 --> D1[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram<br/>‚è±Ô∏è 30 —Å–µ–∫—É–Ω–¥ –û–ñ–ò–î–ê–ù–ò–ï]
        D1 --> E1[–í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç]
        E1 --> A1
        
        Note1[–ö–ª–∏–µ–Ω—Ç –∂–¥—ë—Ç 30 —Å–µ–∫—É–Ω–¥!<br/>–ü–ª–æ—Ö–æ–π UX<br/>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Ç–æ–∫–∞]
    end
    
    subgraph "‚úÖ –° Celery - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"
        A2[–ö–ª–∏–µ–Ω—Ç] -->|POST /products/| B2[FastAPI]
        B2 --> C2[–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä]
        C2 --> D2[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É<br/>–≤ –æ—á–µ—Ä–µ–¥—å ‚ö° 1–º—Å]
        D2 --> E2[–í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç<br/>–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ]
        E2 --> A2
        
        D2 -.->|–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ| F2[Celery Worker]
        F2 --> G2[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram<br/>‚è±Ô∏è 30 —Å–µ–∫—É–Ω–¥ –≤ —Ñ–æ–Ω–µ]
        
        Note2[–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç<br/>–º–≥–Ω–æ–≤–µ–Ω–Ω–æ!<br/>–û—Ç–ª–∏—á–Ω—ã–π UX<br/>–ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏]
    end
    
    style Note1 fill:#ffcccb
    style Note2 fill:#90EE90
    style D1 fill:#ff6b6b
    style D2 fill:#4ecdc4
```

---

## üìù –ü–æ—è—Å–Ω–µ–Ω–∏—è –∫ –¥–∏–∞–≥—Ä–∞–º–º–∞–º

### –î–∏–∞–≥—Ä–∞–º–º–∞ 1: –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∏. –¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 2: –ü–æ—Ç–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞

–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—É—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ FastAPI –∫ Redis –∏ Celery Worker.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 3: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏

State-–¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á–∏: –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ —É—Å–ø–µ—Ö–∞/–ø—Ä–æ–≤–∞–ª–∞.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç—Ä—ë—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –∏—Ö —Ñ–∞–π–ª–æ–≤.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 5: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery

Mind map –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è Windows.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 6: –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

Sequence diagram –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 7: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

Flowchart –ª–æ–≥–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ —Å max_retries=3.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 8: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

–î–µ—Ä–µ–≤–æ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 9: Redis —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ Redis: –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

### –î–∏–∞–≥—Ä–∞–º–º–∞ 10: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

–ù–∞–≥–ª—è–¥–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏–∑ –¥–∏–∞–≥—Ä–∞–º–º

1. **–¢—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞**: Redis, FastAPI, Celery Worker
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: FastAPI –Ω–µ –∂–¥—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
3. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: task_acks_late=True + max_retries=3
4. **Windows —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: worker_pool="solo" –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
5. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞**: Redis ‚Üí FastAPI ‚Üí Celery

---

**–í—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å Mermaid –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ GitHub, GitLab, VS Code**

```

## `doc/plan.md`

```md
## –£—Ä–æ–∫ 1: –û—Å–Ω–æ–≤—ã FastAPI –∏ —Å–∏–ª–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏

### **1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É FastAPI?**

1.1. **–ö—Ä—é—á–æ–∫:** –ù–∞—á–∞—Ç—å —Å –∞–Ω–∞–ª–æ–≥–∏–∏. –°–ø—Ä–æ—Å–∏—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏—é: "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –Ω–µ–±–æ—Å–∫—Ä–µ–±, –Ω–æ —É –≤–∞—Å –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–∞—è –¥—Ä–µ–ª—å –∏ –º–æ–ª–æ—Ç–æ–∫. –ú–æ–∂–Ω–æ –ª–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å? –î–∞. –ë—É–¥–µ—Ç –ª–∏ —ç—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ? –ù–µ—Ç." –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (–∫–∞–∫ Flask/Django –≤ –∏—Ö –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å —Ç–æ—Ç —Å–∞–º—ã–π –º–æ–ª–æ—Ç–æ–∫. –û–Ω–∏ –Ω–∞–¥–µ–∂–Ω—ã, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å —Ç—ã—Å—è—á–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.
1.2. **–ü—Ä–æ–±–ª–µ–º–∞ I/O-bound –æ–ø–µ—Ä–∞—Ü–∏–π:** –û–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º, —á—Ç–æ —Ç–∞–∫–æ–µ I/O-bound –∑–∞–¥–∞—á–∞ (–∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –¥—Ä—É–≥–æ–º—É API, —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞). –í —ç—Ç–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä "–ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç". –í —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –º–∏—Ä–µ –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞, –±–ª–æ–∫–∏—Ä—É—è –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
1.3. **–†–µ—à–µ–Ω–∏–µ FastAPI:** –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å FastAPI –∫–∞–∫ "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç" –≤ –Ω–∞—à–µ–π –∞–Ω–∞–ª–æ–≥–∏–∏. –û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏** (–±–ª–∞–≥–æ–¥–∞—Ä—è ASGI-—Å–µ—Ä–≤–µ—Ä–∞–º –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ Starlette). –ü–æ–∫–∞ FastAPI –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É, –æ–Ω –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö. –≠—Ç–æ –¥–∞–µ—Ç –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–Ω–æ –≤ I/O-bound –∑–∞–¥–∞—á–∞—Ö.

******

### **2. –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "Hello, World"**

2.1. **–¶–µ–ª—å –±–ª–æ–∫–∞:** –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–±–æ—á–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –û—Ç –∏–¥–µ–∏ –¥–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∑–∞ 2 –º–∏–Ω—É—Ç—ã.
2.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ù—É–∂–Ω–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ –∫–æ–¥.
\* **–£—Å—Ç–∞–Ω–æ–≤–∫–∞:** `pip install fastapi "uvicorn[standard]"`
\* **–ö–æ–¥ (`main.py`):**
\`\`\`python
from fastapi import FastAPI

````
    app = FastAPI()

    @app.get("/")
    async def read_root():
        return {"Hello": "World"}
    ```
````

2.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:**
\* `app = FastAPI()`: –≠—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ "–º–æ–∑–≥–∞" –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
\* `@app.get("/")`: –≠—Ç–æ "–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏". –ú—ã –≥–æ–≤–æ—Ä–∏–º FastAPI: "–ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ—Ç `GET`-–∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π URL (`/`), –≤—ã–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∏–∂–µ".
\* `async def`: –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ FastAPI "–¥—É–º–∞–µ—Ç" –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –î–∞–∂–µ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `async` ‚Äî —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.
2.4. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `uvicorn main:app --reload`. –û–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å:
\* `main`: –§–∞–π–ª `main.py`.
\* `:app`: –û–±—ä–µ–∫—Ç `app` –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞.
\* `--reload`: –§–ª–∞–≥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ ‚Äî –∫—Ä–∞–π–Ω–µ —É–¥–æ–±–Ω–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.
\* **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://127.0.0.1:8000` –∏ —É–≤–∏–¥–µ—Ç—å JSON `{"Hello": "World"}`.

******

### **3. –°–∏–ª–∞ Pydantic: —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ**

3.1. **–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** –ù–∞ –±—ç–∫–µ–Ω–¥, –∫–∞–∫ –∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ. –ò –º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Ç–∏–ø–∞—Ö. Pydantic ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–∫–æ–Ω—Ç—Ä–∞–∫—Ç" –∏–ª–∏ "—Ñ–æ—Ä–º—É" –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
3.2. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π –º–æ–¥–µ–ª–∏:** –í–∑—è—Ç—å –∑–∞ –æ—Å–Ω–æ–≤—É —Å—É—â–Ω–æ—Å—Ç—å "–¢–æ–≤–∞—Ä" –∏–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ù–∞–ø–∏—Å–∞—Ç—å Pydantic-–º–æ–¥–µ–ª—å –≤ `main.py`.
\`\`\`python
from pydantic import BaseModel
from typing import Optional

````
    class Product(BaseModel):
        id: int
        name: str
        description: Optional[str] = None # –ü–æ–ª–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
        price: float
    ```
````

3.3. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (—Ç–µ–∑–∏—Å–Ω–æ):**
\* **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º. –ú—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º, –∫–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å —É —Ç–æ–≤–∞—Ä–∞ –∏ –∫–∞–∫–æ–≥–æ –æ–Ω–∏ —Ç–∏–ø–∞.
\* **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏.
\* **–ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ì–ª–∞–≤–Ω–∞—è "–º–∞–≥–∏—è". FastAPI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
******

### **4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö "–Ω–∞ –ª–µ—Ç—É"**

4.1. **–¶–µ–ª—å –±–ª–æ–∫–∞:** –ù–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å, –∞ –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "–º–∞–≥–∏—é" FastAPI –∏ Pydantic –≤ –¥–µ–π—Å—Ç–≤–∏–∏.
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π `POST`-—ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `main.py`.
` python @app.post("/products/") async def create_product(product: Product): return product `
\* **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –º—ã –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞–ª–∏ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–∞ `product: Product`, –∏ FastAPI —Å–∞–º –ø–æ–π–º–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å —Ç–µ–ª–æ `POST`-–∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –ø–æ –º–æ–¥–µ–ª–∏ `Product` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é.

******

4.3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:**
\* –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –Ω–∞ URL `http://127.0.0.1:8000/docs`. –≠—Ç–æ Swagger UI.
\* –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ç–∞–º —É–∂–µ –ø–æ—è–≤–∏–ª—Å—è –Ω–∞—à `POST /products/` —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∏ –≤ —Å—Ö–µ–º–µ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Product` —Å —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π.
\* –ò—Å–ø–æ–ª—å–∑—É—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Swagger, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON. –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç `200 OK` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ JSON.
\* –ó–∞—Ç–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å **–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"price": "–¥–µ—à–µ–≤–æ"`). –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `422 Unprocessable Entity` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏ –≥–¥–µ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫.
4.4. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** –ü–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥: "–°–µ–≥–æ–¥–Ω—è –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö. –í–∞—à–∏–º –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º –±—É–¥–µ—Ç –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞—Ç—å Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è "–¢–æ–≤–∞—Ä–∞" –∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏" –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –≤—ã —Å–∞–º–∏ –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —ç—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é".

******

## –£—Ä–æ–∫ 2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ API –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å APIRouter

### **1. –ü—Ä–æ–±–ª–µ–º–∞ —Ä–æ—Å—Ç–∞: –û–¥–∏–Ω —Ñ–∞–π–ª ‚Äî —ç—Ç–æ —Ö–∞–æ—Å**

1.1. **–ê–Ω–∞–ª–æ–≥–∏—è:** –ù–∞—á–∞—Ç—å —Å –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞. –ù–∞—à `main.py` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–≤–∞–ª–∏–ª–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ü–æ–∫–∞ –∏—Ö –¥–≤–∞-—Ç—Ä–∏ ‚Äî –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ. –ù–æ —á—Ç–æ –±—É–¥–µ—Ç, –∫–æ–≥–¥–∞ –∏—Ö —Å—Ç–∞–Ω–µ—Ç 50? –ù–∞–º –Ω—É–∂–Ω—ã –ø–∞–ø–∫–∏.
1.2. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã:** –ü–æ–ø—Ä–æ—Å–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ –∫—Ä–æ–º–µ —Ç–æ–≤–∞—Ä–æ–≤, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `main.py` CRUD –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –∫–æ—Ä–∑–∏–Ω... –§–∞–π–ª —Ä–∞–∑—Ä–∞—Å—Ç–µ—Ç—Å—è –¥–æ —Å–æ—Ç–µ–Ω —Å—Ç—Ä–æ–∫, –∏ –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥", –∏ –º—ã –¥–æ–ª–∂–Ω—ã –∏–∑–±–µ–≥–∞—Ç—å –µ–≥–æ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

******

### **2. –†–µ—à–µ–Ω–∏–µ: `APIRouter` –¥–ª—è –ø–æ—Ä—è–¥–∫–∞**

2.1. **–ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è:** `APIRouter` ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—à–∏ "–ø–∞–ø–∫–∏". –ú—ã —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π Python-—Ñ–∞–π–ª –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `products.py`), –æ–±—ä—è–≤–ª—è–µ–º –≤ –Ω–µ–º —Ä–æ—É—Ç–µ—Ä –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —Ç—É–¥–∞ –≤—Å–µ –ø—É—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≤–∞—Ä–∞–º–∏. –ó–∞—Ç–µ–º –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (`main.py`) –ø—Ä–æ—Å—Ç–æ "–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç" —ç—Ç—É –ø–∞–ø–∫—É.
2.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–µ–∫—Ç–∞.
\* **–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
`/my_project ‚îú‚îÄ‚îÄ /app ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py ‚îÇ   ‚îú‚îÄ‚îÄ main.py ‚îÇ   ‚îî‚îÄ‚îÄ /routers ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py ‚îÇ       ‚îî‚îÄ‚îÄ products.py ‚îî‚îÄ‚îÄ ...`
\* **–ö–æ–¥ –¥–ª—è `app/routers/products.py`:**
\`\`\`python
from fastapi import APIRouter

````
  router = APIRouter()
  
  # –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏, –±—É–¥—É—Ç –∑–¥–µ—Å—å
  # –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—Ç, —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ
  @router.post("/")
  async def create_product(product: Product): # Product - –º–æ–¥–µ–ª—å Pydantic –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞
      return product
  ```
* **–ö–æ–¥ –¥–ª—è `app/main.py`:**
  ```python
  from fastapi import FastAPI
  from .routers import products
  
  app = FastAPI()
  
  # "–ü–æ–¥–∫–ª—é—á–∞–µ–º" –ø–∞–ø–∫—É —Å —Ä–æ—É—Ç–∞–º–∏ —Ç–æ–≤–∞—Ä–æ–≤
  app.include_router(
      products.router,
      prefix="/products", # –í—Å–µ URL –≤ —ç—Ç–æ–º —Ä–æ—É—Ç–µ—Ä–µ –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å /products
      tags=["Products"]    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ /docs
  )
  ```
````

2.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –°–¥–µ–ª–∞—Ç—å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ `prefix` –∏ `tags` –≤ `app.include_router`. `prefix` –∏–∑–±–∞–≤–ª—è–µ—Ç –Ω–∞—Å –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å `/products` –≤ –∫–∞–∂–¥–æ–º URL –≤–Ω—É—Ç—Ä–∏ `products.py`. `tags` —Å–æ–∑–¥–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤ –∞–≤—Ç–æ-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

******

### **3. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤**

3.1. **–°–æ–∑–¥–∞–Ω–∏–µ "In-memory" –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä—è–º–æ –≤ —Ñ–∞–π–ª–µ `app/routers/products.py` —Å–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é ‚Äî —Å–ø–∏—Å–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:**
\`\`\`python
\# app/routers/products.py
from typing import List
\# ... –∏–º–ø–æ—Ä—Ç—ã Product, APIRouter ...

````
  # –ù–∞—à–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  db_products: List[Product] = [
      Product(id=1, name="–ü–ª—é–º–±—É—Å", price=10.5),
      Product(id=2, name="–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏", price=25.0)
  ]
  ```
````

******

3.2. **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (–≤ `app/routers/products.py`):**
\* **Read All (`GET /`):**
` python @router.get("/", response_model=List[Product]) async def get_all_products(): return db_products `
\* **Read One (`GET /{product_id}`):**
\* **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å —Å **Path-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏**.
` python @router.get("/{product_id}", response_model=Product) async def get_product(product_id: int): # –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞, –ø–æ–∫–∞ –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ for p in db_products: if p.id == product_id: return p # –ß—Ç–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏? –†–∞–∑–±–µ—Ä–µ–º –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ. `
\* **Create (`POST /`):** –ù–µ–º–Ω–æ–≥–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å, —á—Ç–æ–±—ã ID –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
\* **Update (`PUT /{product_id}`):** –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ Path-–ø–∞—Ä–∞–º–µ—Ç—Ä, –∏ —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞.
\* **Delete (`DELETE /{product_id}`):** –ü—Ä–∏–Ω—è—Ç—å Path-–ø–∞—Ä–∞–º–µ—Ç—Ä –∏ —É–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ `db_products`.

******

### **4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: `HTTPException`**

4.1. **–°—Ü–µ–Ω–∞—Ä–∏–π:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `get_product` –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `/products/999`. –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `500 Internal Server Error`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ (–∏–ª–∏ —É–ø–∞–ª–∞). –≠—Ç–æ –ø–ª–æ—Ö–æ. –ö–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É.
4.2. **–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å —Å `HTTPException` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º FastAPI "–≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å" –æ—à–∏–±–∫–∏ —Å –Ω—É–∂–Ω—ã–º HTTP-—Å—Ç–∞—Ç—É—Å–æ–º.
4.3. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `get_product`.
` python from fastapi import HTTPException # ... @router.get("/{product_id}", response_model=Product) async def get_product(product_id: int): for p in db_products: if p.id == product_id: return p raise HTTPException(status_code=404, detail="Product not found") `

******

4.4. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å `/products/999`. –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ç–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å–æ–º **404 Not Found** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON `{"detail": "Product not found"}`. –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç –∂–¥–µ—Ç frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω".
4.5. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`categories.py`) –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è –Ω–∏—Ö —Ç–∞–∫–æ–π –∂–µ –ø–æ–ª–Ω—ã–π CRUD, –ø–æ–∫–∞ —á—Ç–æ —Ç–æ–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—è –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ".

******

## –£—Ä–æ–∫ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ ORM —Å SQLAlchemy'

### **1. –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—à–∏ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–¥–Ω–æ–¥–Ω–µ–≤–∫–∏**

1.1. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —É—Ä–æ–∫ —Å –∂–∏–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞.
\* –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –∏–∑ –£—Ä–æ–∫–∞ 2.
\* –ß–µ—Ä–µ–∑ `/docs` –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å –ø–æ–º–æ—â—å—é `POST /products`.
\* –°–¥–µ–ª–∞—Ç—å `GET /products` –∏ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ —Å–ø–∏—Å–∫–µ.
\* –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `uvicorn` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —Å–Ω–æ–≤–∞.
\* –°–¥–µ–ª–∞—Ç—å –µ—â–µ –æ–¥–∏–Ω `GET /products` –∏ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä **–∏—Å—á–µ–∑**.
1.2. **–í—ã–≤–æ–¥:** –ù–∞–≥–ª—è–¥–Ω–æ –ø–æ–¥–≤–µ—Å—Ç–∏ –∏—Ç–æ–≥. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ Python ‚Äî —ç—Ç–æ **–≤–æ–ª–∞—Ç–∏–ª—å–Ω–∞—è (–Ω–µ–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) –ø–∞–º—è—Ç—å**. –ß—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞, –∏—Ö –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**, —Ç–æ –µ—Å—Ç—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

******

### **2. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å ORM –∏ SQLAlchemy**

2.1. **–ê–Ω–∞–ª–æ–≥–∏—è "–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫":** –û–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é ORM. "–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ Python. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL ‚Äî –Ω–∞ —è–∑—ã–∫–µ SQL. –ù–∞–ø—Ä—è–º—É—é –æ–Ω–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç. **ORM** (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ **SQLAlchemy**) ‚Äî —ç—Ç–æ –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É –Ω–∏–º–∏. –ú—ã –ø–∏—à–µ–º Python-–∫–æ–¥ (`product.price = 99.9`), –∞ ORM –Ω–∞ –ª–µ—Ç—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–æ –≤ SQL-–∫–æ–º–∞–Ω–¥—É (`UPDATE products SET price = 99.9 WHERE id = 1`) –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç".
2.2. **–î–≤–µ —á–∞—Å—Ç–∏ SQLAlchemy:** –ö—Ä–∞—Ç–∫–æ —É–ø–æ–º—è–Ω—É—Ç—å, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
\* **SQLAlchemy Core:** "–î–≤–∏–∂–æ–∫" –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∏–∞–ª–µ–∫—Ç–∞–º–∏ SQL.
\* **SQLAlchemy ORM:** "–°–ª–æ–≤–∞—Ä—å" –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞—à–∏ Python-–∫–ª–∞—Å—Å—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
2.3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é SQLAlchemy, –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤—è–∑–∫–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–∏—Ä–æ–¥–æ–π FastAPI. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

******

### **3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**

3.1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É SQLAlchemy –∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –¥–ª—è PostgreSQL.
` bash pip install sqlalchemy asyncpg `
3.2. **–§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–∞—Ä–æ–ª–∏, –∞–¥—Ä–µ—Å–∞) –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—à–∏—Ç—ã –≤ –∫–æ–¥–µ.
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `app/config.py`.
` python # app/config.py # –§–æ—Ä–º–∞—Ç: postgresql+asyncpg://<user>:<password>@<host>:<port>/<dbname> DATABASE_URL = "postgresql+asyncpg://postgres:mysecretpassword@localhost:5432/store_db" `
–ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏.
3.3. **–°–æ–∑–¥–∞–Ω–∏–µ "–î–≤–∏–∂–∫–∞" –∏ "–§–∞–±—Ä–∏–∫–∏ —Å–µ—Å—Å–∏–π":**
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `app/database.py` –¥–ª—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –ë–î.
\`\`\`python
\# app/database.py
from sqlalchemy.ext.asyncio import create\_async\_engine, async\_sessionmaker
from .config import DATABASE\_URL

````
  # –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π "–¥–≤–∏–∂–æ–∫" –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
  engine = create_async_engine(DATABASE_URL, echo=True)

  # –°–æ–∑–¥–∞–µ–º "—Ñ–∞–±—Ä–∏–∫—É", –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Å–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
  async_session_factory = async_sessionmaker(engine, expire_on_commit=False)
  ```
* **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:**
    * `engine`: –ì–ª–∞–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ —Å –ë–î. `echo=True` ‚Äî –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–π —Ñ–ª–∞–≥ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –æ–Ω –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª—å –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQLAlchemy.
    * `async_session_factory`: –≠—Ç–æ –Ω–µ —Å–∞–º–∞ —Å–µ—Å—Å–∏—è, –∞ "—Å—Ç–∞–Ω–æ–∫", –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ –Ω–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.
````

******

### **4. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π FastAPI (`Depends`)**

4.1. **–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –Ω–∞–º –Ω—É–∂–µ–Ω **–æ–¥–∏–Ω** —Å–µ–∞–Ω—Å —Ä–∞–±–æ—Ç—ã —Å –ë–î. –ï–≥–æ –Ω—É–∂–Ω–æ: 1) –û—Ç–∫—Ä—ã—Ç—å -\> 2) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å -\> 3) –ó–∞–∫—Ä—ã—Ç—å. –ü–∏—Å–∞—Ç—å —ç—Ç—É –ª–æ–≥–∏–∫—É –≤ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ ‚Äî –¥–æ–ª–≥–æ, —Å–∫—É—á–Ω–æ –∏ –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è.
4.2. **–†–µ—à–µ–Ω–∏–µ:** –ú—ã –Ω–∞–ø–∏—à–µ–º –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏, –∞ FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –≠—Ç–æ –∏ –µ—Å—Ç—å **Dependency Injection (–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)**.
4.3. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª `app/database.py` —Ñ—É–Ω–∫—Ü–∏–µ–π-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é.
\`\`\`python
\# app/database.py
\# ... –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥ ...

````
async def get_db_session():
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π —Ñ–∞–±—Ä–∏–∫–∏
    async with async_session_factory() as session:
        try:
            yield session
        finally:
            # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            await session.close()
```
* **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –û–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `yield`. –ö–æ–¥ –¥–æ `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞. `yield` "–ø–µ—Ä–µ–¥–∞–µ—Ç" —Å–µ—Å—Å–∏—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç. –ö–æ–¥ –≤ –±–ª–æ–∫–µ `finally` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏.
````

******
4.4. **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ "–∑–∞–ø—Ä–æ—Å–∏—Ç—å" —ç—Ç—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ —Ä–æ—É—Ç–µ—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤.
\* **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ò–∑–º–µ–Ω–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `app/routers/products.py`.
\`\`\`python
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.database import get\_db\_session \# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

````
  router = APIRouter()

  @router.get("/")
  async def get_all_products(db: AsyncSession = Depends(get_db_session)):
      # –í–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `db` —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–æ—Ç–æ–≤–∞—è –∫ —Ä–∞–±–æ—Ç–µ —Å–µ—Å—Å–∏—è –ë–î!
      # –ú—ã –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ —Å –Ω–µ–π –Ω–µ –¥–µ–ª–∞–µ–º, –Ω–æ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞.
      return {"message": "–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏ –ë–î!"}
  ```
````

4.5. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–°–µ–≥–æ–¥–Ω—è –º—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –Ω–∞—Å—Ç–æ—è—â–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å —É —Å–µ–±—è –ª–æ–∫–∞–ª—å–Ω–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL, –ø—Ä–æ–ø–∏—Å–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `DATABASE_URL` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `/products/` –≤—ã –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–æ–∫, –∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤–∏–¥–∏—Ç–µ SQL-–ª–æ–≥–∏ –æ—Ç `echo=True`. –≠—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –Ω–∞—Å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É, –≥–¥–µ –º—ã –±—É–¥–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –Ω–∏—Ö –¥–∞–Ω–Ω—ã–µ".

******

## –£—Ä–æ–∫ 4: –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–∞–∑–µ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

### **1. –û—Ç Pydantic-—Å—Ö–µ–º –∫ SQLAlchemy-–º–æ–¥–µ–ª—è–º**

1.1. **–ö–ª—é—á–µ–≤–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ (–ê–Ω–∞–ª–æ–≥–∏—è):** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—é –¥–ª—è —á–µ—Ç–∫–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è.
\* **Pydantic-—Å—Ö–µ–º–∞** ‚Äî —ç—Ç–æ **—Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è** –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ API. –û–Ω–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ "—Ç–æ–≤–∞—Ä—ã" (–¥–∞–Ω–Ω—ã–µ) –∏ –≤ –∫–∞–∫–æ–º –≤–∏–¥–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ—á—å –≥—Ä–∞–Ω–∏—Ü—É (–≤–æ–π—Ç–∏ –≤ –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –≤—ã–π—Ç–∏ –≤ –æ—Ç–≤–µ—Ç–µ).
\* **SQLAlchemy-–º–æ–¥–µ–ª—å** ‚Äî —ç—Ç–æ **—á–µ—Ä—Ç–µ–∂ —Å–∫–ª–∞–¥–∞** (—Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î), –≥–¥–µ —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è. –ß–µ—Ä—Ç–µ–∂ –æ–ø–∏—Å—ã–≤–∞–µ—Ç "—Å—Ç–µ–ª–ª–∞–∂–∏" (–∫–æ–ª–æ–Ω–∫–∏), –∏—Ö —Ç–∏–ø –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.
\* –û–Ω–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏, –Ω–æ —Å–ª—É–∂–∞—Ç —Ä–∞–∑–Ω—ã–º —Ü–µ–ª—è–º.
1.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª `app/models.py` –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è "—á–µ—Ä—Ç–µ–∂–µ–π —Å–∫–ª–∞–¥–∞".
\`\`\`python
\# app/models.py
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped\_column
from sqlalchemy import String, Text

````
# –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –±—É–¥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è
class Base(DeclarativeBase):
    pass

# SQLAlchemy-–º–æ–¥–µ–ª—å –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "products"
class Product(Base):
    __tablename__ = "products"

    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text) # –ò—Å–ø–æ–ª—å–∑—É–µ–º Text –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π
    price: Mapped[float]
```
````

******

1.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –û–±—ä—è—Å–Ω–∏—Ç—å –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç:
\* `Base`: –û–±—â–∏–π "—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç" –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π.
\* `__tablename__`: –ü—Ä—è–º–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
\* `Mapped[...]` –∏ `mapped_column(...)`: –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQLAlchemy –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –∏ –∏—Ö —Ç–∏–ø–æ–≤ –≤ Python.
\* `primary_key=True`: –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏.
\* `index=True`: –°–æ–∑–¥–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —ç—Ç–æ–º—É –ø–æ–ª—é.

******

### **2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü**

2.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ù–∞—à–∏ –º–æ–¥–µ–ª–∏ –≤ `models.py` ‚Äî —ç—Ç–æ –ø–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ Python-–∫–æ–¥. –ù–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ —ç—Ç–∏–º "—á–µ—Ä—Ç–µ–∂–∞–º" –ø–æ—Å—Ç—Ä–æ–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ "—Å–∫–ª–∞–¥—ã" (—Ç–∞–±–ª–∏—Ü—ã) –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.
2.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `create_tables.py` –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.
\`\`\`python
\# create\_tables.py
import asyncio
from app.database import engine
from app.models import Base

````
async def create_db_and_tables():
    async with engine.begin() as conn:
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)
        await conn.run_sync(Base.metadata.drop_all)
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç Base
        await conn.run_sync(Base.metadata.create_all)
    print("–¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã.")

if __name__ == "__main__":
    asyncio.run(create_db_and_tables())
```
````

******

2.3. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ `python create_tables.py`. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –∏—Å–ø–æ–ª—å–∑—É—è –ª—é–±–æ–π GUI-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (DBeaver, pgAdmin), –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î –∏ **–Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å** —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Å–æ–∑–¥–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `products` —Å–æ –≤—Å–µ–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏. (–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –∫–∞–∫ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ pgAdmin –≠–¢–û –°–¥–µ–ª–∞—Ç—å –ø–æ—à–∞–≥–æ–≤–æ)

******

### **3. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º CRUD —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy**

3.1. **–¶–µ–ª—å:** –í—ã–±—Ä–æ—Å–∏—Ç—å "in-memory" —Å–ø–∏—Å–æ–∫ –∏–∑ `app/routers/products.py` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
3.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ —Ä–æ—É—Ç–µ—Ä–µ —Ç–æ–≤–∞—Ä–æ–≤. –ü–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `select` –∏–∑ `sqlalchemy`.
\* **Create (`POST /`):**
` python @router.post("/") async def create_product(product_schema: ProductCreateSchema, db: AsyncSession = Depends(get_db_session)): # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏ SQLAlchemy –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Pydantic-—Å—Ö–µ–º—ã new_product = Product(**product_schema.model_dump()) db.add(new_product)       # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Å—Å–∏—é await db.commit()         # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î await db.refresh(new_product) # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç new_product –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, id) return new_product `
\* **Read All (`GET /`):**
` python @router.get("/") async def get_all_products(db: AsyncSession = Depends(get_db_session)): query = select(Product) result = await db.execute(query) products = result.scalars().all() return products `
\* **Read One (`GET /{product_id}`):**
` python @router.get("/{product_id}") async def get_product(product_id: int, db: AsyncSession = Depends(get_db_session)): product = await db.get(Product, product_id) # –£–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ primary key if not product: raise HTTPException(status_code=404, detail="Product not found") return product `

******

3.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –î–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏: `db.add()` (–ø–æ–º–µ—Ç–∏—Ç—å –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è), `db.commit()` (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é), `db.refresh()` (–ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ë–î).

******

### **4. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: –û—Ç–Ω–æ—à–µ–Ω–∏—è**

4.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –¢–æ–≤–∞—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –≤–∞–∫—É—É–º–µ, –æ–Ω–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.
\* `ForeignKey` (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á) ‚Äî —ç—Ç–æ –∫–∞–∫ "–∑–∞–ø–∏—Å–∞—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —Ü–µ–Ω–Ω–∏–∫–µ —Ç–æ–≤–∞—Ä–∞". –≠—Ç–æ —Å–≤—è–∑—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î.
\* `relationship` (–æ—Ç–Ω–æ—à–µ–Ω–∏–µ) ‚Äî —ç—Ç–æ "–º–∞–≥–∏—è" SQLAlchemy, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç, –∏–º–µ—è –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞, –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É –æ–±—ä–µ–∫—Ç—É —Å–≤—è–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`my_product.category.name`), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫ –µ—ë ID.
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ–ø–æ–ª–Ω–∏—Ç—å `app/models.py`.
\`\`\`python
\# app/models.py
from sqlalchemy import ForeignKey
from sqlalchemy.orm import relationship

````
class Category(Base):
    __tablename__ = "categories"
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(50), unique=True)
    # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –µ–µ —Ç–æ–≤–∞—Ä—ã
    products: Mapped[list["Product"]] = relationship(back_populates="category")

class Product(Base):
    # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è)
    category_id: Mapped[int | None] = mapped_column(ForeignKey("categories.id"))
    # –°–≤—è–∑—å: –∏–∑ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    category: Mapped["Category"] = relationship(back_populates="products")
```
````

******
4.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ `ForeignKey("categories.id")` ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ë–î, –∞ `relationship` —Å `back_populates` —Å–æ–∑–¥–∞–µ—Ç —É–¥–æ–±–Ω—É—é –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ Python-–∫–æ–¥–µ.
4.4. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–ª–∏ CRUD —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π –Ω–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–∏ `Category`. –ê —Ç–∞–∫–∂–µ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–ª `category_id` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑—ã–≤–∞–ª –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π".

******

## –£—Ä–æ–∫ 5: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö –∏ Alembic

### **1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**

1.1. **–¶–µ–ª—å:** –û–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø **"–†–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏" (Separation of Concerns)**. –†–æ—É—Ç–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –∫–∞–∫ –ø–∏—Å–∞—Ç—å –≤ –ë–î. –ï–≥–æ –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ, –ø—Ä–æ—â–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.
1.2. **–ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –ü–æ–∫–∞–∑–∞—Ç—å —Ü–µ–ª–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤.
`/app ‚îú‚îÄ‚îÄ __init__.py ‚îú‚îÄ‚îÄ crud.py          # (–°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º) - –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ë–î. ‚îú‚îÄ‚îÄ database.py      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. ‚îú‚îÄ‚îÄ main.py          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. ‚îú‚îÄ‚îÄ models.py        # (–°–ª–æ–π –ë–î) - SQLAlchemy-–º–æ–¥–µ–ª–∏. ‚îú‚îÄ‚îÄ schemas.py       # (–°–ª–æ–π API) - Pydantic-—Å—Ö–µ–º—ã. ‚îî‚îÄ‚îÄ /routers ‚îú‚îÄ‚îÄ __init__.py ‚îî‚îÄ‚îÄ products.py  # (–°–ª–æ–π API) - –¢–æ–ª—å–∫–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.`

******

1.3. **–ü–µ—Ä–µ–Ω–æ—Å –∫–æ–¥–∞ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –ü–æ—à–∞–≥–æ–≤–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥.
\* **–®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å `app/schemas.py`**. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ –Ω–µ–≥–æ –≤—Å–µ Pydantic-–º–æ–¥–µ–ª–∏. –†–∞–∑–¥–µ–ª–∏—Ç—å –∏—Ö –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é: `ProductBase`, `ProductCreate` (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è), `ProductUpdate`, `Product` (–¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î).
\* **–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å `app/crud.py`**. –°–æ–∑–¥–∞—Ç—å –≤ –Ω–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î. –≠—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Å–µ—Å—Å–∏—é `db` –∏ Pydantic-—Å—Ö–µ–º—ã, –∞ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å SQLAlchemy-–º–æ–¥–µ–ª—è–º–∏.
\`\`\`python
\# app/crud.py
from sqlalchemy.ext.asyncio import AsyncSession
from . import models, schemas

````
    async def get_product(db: AsyncSession, product_id: int):
        return await db.get(models.Product, product_id)

    async def create_product(db: AsyncSession, product: schemas.ProductCreate):
        db_product = models.Product(**product.model_dump())
        db.add(db_product)
        await db.commit()
        await db.refresh(db_product)
        return db_product
    ```
* **–®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å `app/routers/products.py`**. –£–¥–∞–ª–∏—Ç—å –∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤—Å—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å `db.add`, `select` –∏ —Ç.–¥. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ ‚Äî –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `crud.py`. –†–æ—É—Ç–µ—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—á–µ–Ω—å "—Ç–æ–Ω–∫–∏–º" –∏ —á–∏—Ç–∞–µ–º—ã–º.
    ```python
    # app/routers/products.py
    from .. import crud, schemas

    @router.post("/", response_model=schemas.Product)
    async def create_product_endpoint(product: schemas.ProductCreate, db: AsyncSession = Depends(get_db_session)):
        return await crud.create_product(db=db, product=product)
    ```
````

******

### **2. –ü—Ä–æ–±–ª–µ–º–∞: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å?**

2.1. **–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã:** –°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π. "–ó–∞–∫–∞–∑—á–∏–∫ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã —É –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –±—ã–ª —Ñ–ª–∞–≥ `is_active`, —á—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã —Å —Å–∞–π—Ç–∞, –Ω–µ —É–¥–∞–ª—è—è –∏—Ö. –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `products` –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É `is_active` —Ç–∏–ø–∞ `boolean`".
2.2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∞—É–¥–∏—Ç–æ—Ä–∏–∏: "–ú—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `models.py`. –ù–æ —á—Ç–æ –¥–∞–ª—å—à–µ? –ï—Å–ª–∏ –º—ã —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç `create_tables.py`, –æ–Ω –≤—ã–∑–æ–≤–µ—Ç `drop_all` –∏ **—Å–æ—Ç—Ä–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –±–∞–∑—É**\! –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞".

******

### **3. –†–µ—à–µ–Ω–∏–µ: Alembic ‚Äî Git –¥–ª—è –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

3.1. **–ê–Ω–∞–ª–æ–≥–∏—è "Git –¥–ª—è –ë–î":** –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä—è–º—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ–π.
\* `git commit` ‚áî `alembic revision` (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ).
\* `git push` ‚áî `alembic upgrade` (–ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö).
\* `git log` ‚áî `alembic history` (–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π).
\* `git checkout <hash>` ‚áî `alembic downgrade <hash>` (–æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã).
3.2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):**
\* **–ö–æ–º–∞–Ω–¥–∞ 1:** `pip install alembic`
\* **–ö–æ–º–∞–Ω–¥–∞ 2 (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞):** `alembic init alembic`. –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —ç—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–ª–∞ –ø–∞–ø–∫—É `alembic` –∏ —Ñ–∞–π–ª `alembic.ini`.

******

### **4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ü—Ä–æ–≤–æ–¥–∏–º –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é**

4.1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic:** –≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —à–∞–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
\* **–í `alembic.ini`:** –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É `sqlalchemy.url` –∏ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —Ç—É–¥–∞ –ø—É—Ç—å –∫ –Ω–∞—à–µ–π –ë–î (–º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `app.config`).
\* **–í `alembic/env.py`:** –°–∫–∞–∑–∞—Ç—å Alembic, –≥–¥–µ –∏—Å–∫–∞—Ç—å –Ω–∞—à–∏ SQLAlchemy-–º–æ–¥–µ–ª–∏.
` python # alembic/env.py # ... from app.models import Base # –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—à—É –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å target_metadata = Base.metadata # –£–∫–∞–∑–∞—Ç—å –µ–µ –∫–∞–∫ —Ü–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ # ... `
4.2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):**
\* **–®–∞–≥ 1: –ò–∑–º–µ–Ω–∏—Ç—å `app/models.py`**. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ –º–æ–¥–µ–ª—å `Product`: `is_active: Mapped[bool] = mapped_column(server_default="true")`.
\* **–®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:** `alembic revision --autogenerate -m "Add is_active field to Product"`

******

4.3. **–ê–Ω–∞–ª–∏–∑ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:** –û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ `alembic/versions/`. –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ñ—É–Ω–∫—Ü–∏–∏ `upgrade()` –∏ `downgrade()`. –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ `upgrade` –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (`op.add_column(...)`), –∞ `downgrade` ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö (`op.drop_column(...)`).
4.4. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):**
\* **–ö–æ–º–∞–Ω–¥–∞:** `alembic upgrade head`. –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `upgrade` –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–æ–∑–¥–∞–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏.
4.5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ("–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã"):** –ü–µ–¥–∞–≥–æ–≥ **–æ–±—è–∑–∞–Ω** –æ—Ç–∫—Ä—ã—Ç—å GUI-–∫–ª–∏–µ–Ω—Ç –¥–ª—è –ë–î, –ø–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `products` –∏ —Ç–æ, —á—Ç–æ –≤ –Ω–µ–π –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ `is_active`, –∞ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏.
4.6. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã –Ω–∞–≤–µ–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏ –æ—Å–≤–æ–∏–ª–∏ –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ö–µ–º–æ–π –ë–î. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –∫–æ–¥ –ø–æ –Ω–æ–≤–æ–º—É –æ–±—Ä–∞–∑—Ü—É (schemas, crud, models). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥–µ–ª—å `Category` –Ω–æ–≤–æ–µ –ø–æ–ª–µ `description: Mapped[str | None]` –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤ –∏ –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–≤–æ—é –ø–µ—Ä–≤—É—é Alembic-–º–∏–≥—Ä–∞—Ü–∏—é".

******

–ü—Ä–∏–Ω—è—Ç–æ. –ü–ª–∞–Ω —É—Ç–≤–µ—Ä–∂–¥–µ–Ω.

## –£—Ä–æ–∫ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React –∏ CORS - —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

### **1. –î–≤–∞ —Å–µ—Ä–≤–µ—Ä–∞: –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏**

1.1. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å –¥–≤–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–µ—Ä–∞, —á—Ç–æ–±—ã —Å—Ç—É–¥–µ–Ω—Ç—ã –≤–∏–¥–µ–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å.
\* **–¢–µ—Ä–º–∏–Ω–∞–ª 1 (–ë—ç–∫–µ–Ω–¥):** `cd` –≤ –ø–∞–ø–∫—É —Å FastAPI –ø—Ä–æ–µ–∫—Ç–æ–º, –∫–æ–º–∞–Ω–¥–∞: `uvicorn app.main:app --reload`. –ü–æ–∫–∞–∑–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://127.0.0.1:8000/docs`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç.
\* **–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–§—Ä–æ–Ω—Ç–µ–Ω–¥):** `cd` –≤ –ø–∞–ø–∫—É —Å React –ø—Ä–æ–µ–∫—Ç–æ–º, –∫–æ–º–∞–Ω–¥–∞: `npm run dev`. –ü–æ–∫–∞–∑–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ `http://localhost:5173`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.
1.2. **–§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ —Ü–µ–ª–∏:** –ß–µ—Ç–∫–æ –æ–±—ä—è–≤–∏—Ç—å: "–°–µ–π—á–∞—Å –Ω–∞—à React-—Å–∞–π—Ç –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ `data.ts`. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ —Å–µ—Ç–∏, –¥–µ–ª–∞—è —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É Python-—Å–µ—Ä–≤–µ—Ä—É –Ω–∞ –ø–æ—Ä—Ç—É 8000".

******

### **2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø–µ—Ä–≤–∞—è –æ—à–∏–±–∫–∞: CORS**

2.1. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª `src/components/ProductsPage.tsx`.
\* **–®–∞–≥ 1:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É –∏–º–ø–æ—Ä—Ç–∞ —Å—Ç–∞—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö: `// import { products } from '../data/products';`
\* **–®–∞–≥ 2:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ö—É–∫–∏ `useState` –∏ `useEffect` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
\`\`\`tsx
// src/components/ProductsPage.tsx
import { useState, useEffect } from 'react';
// ... –∏–º–ø–æ—Ä—Ç ProductCard –∏ —Ç–∏–ø–∞ Product

````
  export function ProductsPage() {
    const [products, setProducts] = useState([]); // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
    const [searchQuery, setSearchQuery] = useState('');
  
    useEffect(() => {
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
      const fetchProducts = async () => {
        console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –±—ç–∫–µ–Ω–¥–∞...');
        try {
          const response = await fetch('http://127.0.0.1:8000/products');
          const data = await response.json();
          setProducts(data);
          console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', data);
        } catch (error) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        }
      };
  
      fetchProducts();
    }, []); // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã —Ö—É–∫ —Å—Ä–∞–±–æ—Ç–∞–ª –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ...
  }
  ```
````

******
2.2. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏:** –ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª, –ø–µ—Ä–µ–π—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12). –ù–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
\* –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞, —Ç–æ–≤–∞—Ä—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è.
\* –í –∫–æ–Ω—Å–æ–ª–∏ –≥–æ—Ä–∏—Ç **–∫—Ä–∞—Å–Ω–∞—è –æ—à–∏–±–∫–∞**, —Å–æ–¥–µ—Ä–∂–∞—â–∞—è —Ç–µ–∫—Å—Ç: `Access to fetch at 'http://127.0.0.1:8000/products' from origin 'http://localhost:5173' has been blocked by CORS policy...`.
******

### **3. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ CORS: "–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"**

3.1. **–ê–Ω–∞–ª–æ–≥–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –∏ –ø–æ–Ω—è—Ç–Ω—É—é –∞–Ω–∞–ª–æ–≥–∏—é. "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –±–∞–Ω–∫–∞ `mybank.com`. –ó–∞—Ç–µ–º –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∞–π—Ç `evil.com`. –ë–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏ CORS, —Å–∫—Ä–∏–ø—Ç —Å —Å–∞–π—Ç–∞ `evil.com` –º–æ–≥ –±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å `mybank.com/api/transfer?to=hacker&amount=1000`. –í–∞—à –±—Ä–∞—É–∑–µ—Ä, –≤–∏–¥—è, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –≤ –±–∞–Ω–∫–µ, –ø—Ä–∏–ª–æ–∂–∏–ª –±—ã –∫ —ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—É –≤–∞—à–∏ –∫—É–∫–∏, –∏ –¥–µ–Ω—å–≥–∏ –±—ã —É—à–ª–∏. –ü–æ–ª–∏—Ç–∏–∫–∞ CORS –∑–∞–ø—Ä–µ—â–∞–µ—Ç —ç—Ç–æ. –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç `evil.com` –∫ `mybank.com` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é".
3.2. **–í—ã–≤–æ–¥:** "–ù–∞—à–∏ –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî `localhost:5173` (React) –∏ `localhost:8000` (FastAPI) ‚Äî –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ —è–≤–ª—è—é—Ç—Å—è –¥–≤—É–º—è —Ä–∞–∑–Ω—ã–º–∏ '–∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏' (origins). –ß—Ç–æ–±—ã –Ω–∞—à '—Ö–æ—Ä–æ—à–∏–π' –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª, —Å–µ—Ä–≤–µ—Ä `:8000` –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Å–∫–∞–∑–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä—É: '–Ø —Ä–∞–∑—Ä–µ—à–∞—é –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç `:5173`, –µ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å'".

******

### **4. –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `CORSMiddleware` –≤ FastAPI**

4.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ `Middleware` ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π "–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç" –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—É—Ç–∏ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –∏ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø—É—Ç–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É. `CORSMiddleware` –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ –æ—Ç–≤–µ—Ç–∞–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (`Access-Control-Allow-Origin`), –∫–æ—Ç–æ—Ä—ã–µ –∏ —è–≤–ª—è—é—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞.
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `app/main.py`.
\`\`\`python
\# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware \# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º

````
app = FastAPI()

# 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
origins = [
    "http://localhost:5173",
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å URL –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
]

# 3. –î–æ–±–∞–≤–ª—è–µ–º Middleware –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins, # –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —ç—Ç–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    allow_credentials=True, # –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É –∫—É–∫
    allow_methods=["*"],    # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã (GET, POST, etc.)
    allow_headers=["*"],    # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
)

# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (app.include_router –∏ —Ç.–¥.)
```
````

4.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ `allow_origins` ‚Äî —ç—Ç–æ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ç—É–¥–∞ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

******

### **5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –û–∂–∏–≤–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤**

5.1. **"–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã":**
\* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `uvicorn` –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `main.py`.
\* –í–µ—Ä–Ω—É—Ç—å—Å—è –≤–æ –≤–∫–ª–∞–¥–∫—É —Å React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
\* **–ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5).**
5.2. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:** –ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–∏ –≤–µ—â–∏:
\* –û—à–∏–±–∫–∞ CORS –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏—Å—á–µ–∑–ª–∞.
\* –ü–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ `–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!` —Å –º–∞—Å—Å–∏–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
\* **–ì–ª–∞–≤–Ω–æ–µ:** –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ—è–≤–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å –±—ç–∫–µ–Ω–¥–∞. –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª `–ë–î -> SQLAlchemy -> FastAPI -> HTTP -> React -> HTML` –∑–∞–º–∫–Ω—É–ª—Å—è.
5.3. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã –æ–∂–∏–≤–∏–ª–∏ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–∞ (`ProductDetailPage.tsx`). –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ URL —Å –ø–æ–º–æ—â—å—é —Ö—É–∫–∞ `useParams` –∏–∑ `react-router-dom`, —Å–¥–µ–ª–∞—Ç—å `fetch`-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/products/{ID}` –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–æ–≤–∞—Ä–µ".

******

## –£—Ä–æ–∫ 7: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

### **1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"**

1.1. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª `app/models.py` –Ω–æ–≤–æ–π SQLAlchemy-–º–æ–¥–µ–ª—å—é.
\`\`\`python
\# app/models.py
from sqlalchemy import Boolean

````
class User(Base):
    __tablename__ = "users"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    email: Mapped[str] = mapped_column(String(150), unique=True, index=True)
    hashed_password: Mapped[str]
    is_active: Mapped[bool] = mapped_column(default=True)
```
````

******
1.2. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –ê–∫—Ü–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ–ª—è—Ö:
\* `email`: –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ª–æ–≥–∏–Ω. `unique=True` ‚Äî —ç—Ç–æ constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ–∑–¥–∞—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º email.
\* `hashed_password`: –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –º—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–µ—Å—å –ø–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, —Ç–æ–ª—å–∫–æ –µ–≥–æ —Ö—ç—à.
1.3. **–ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏:** –ù–∞–ø–æ–º–Ω–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º, —á—Ç–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –≤ –∫–æ–¥, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î.
\* **–®–∞–≥ 1:** `alembic revision --autogenerate -m "Create users table"`
\* **–®–∞–≥ 2:** `alembic upgrade head`
******

### **2. "–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ\!**

2.1. **–ê–Ω–∞–ª–æ–≥–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—é —Å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π. "–•—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å PIN-–∫–æ–¥ –º–∞—Ä–∫–µ—Ä–æ–º –ø—Ä—è–º–æ –Ω–∞ –∫–∞—Ä—Ç–µ. –ï—Å–ª–∏ –≤–æ—Ä —É–∫—Ä–∞–¥–µ—Ç –∫–æ—à–µ–ª–µ–∫ (–≤–∑–ª–æ–º–∞–µ—Ç –ë–î), –æ–Ω –ø–æ–ª—É—á–∏—Ç —Å—Ä–∞–∑—É –≤—Å—ë. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –¥–∞–∂–µ —É–∫—Ä–∞–≤ –∫–∞—Ä—Ç—É, –≤–æ—Ä –Ω–µ —Å–º–æ–≥ —É–∑–Ω–∞—Ç—å PIN-–∫–æ–¥".
2.2. **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –û–ø–∏—Å–∞—Ç—å, —á—Ç–æ —É—Ç–µ—á–∫–∞ –ø–∞—Ä–æ–ª–µ–π –≤–µ–¥–µ—Ç –∫ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö (—Ç.–∫. –ª—é–¥–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏) –∏ –∫ –æ–≥—Ä–æ–º–Ω—ã–º —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º –ø–æ—Ç–µ—Ä—è–º –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏.
******

### **3. –†–µ—à–µ–Ω–∏–µ: –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å `passlib`**

3.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è (–ê–Ω–∞–ª–æ–≥–∏—è "–ú—è—Å–æ—Ä—É–±–∫–∞"):** "–•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –º—è—Å–æ—Ä—É–±–∫–∞. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –Ω–µ–µ –∫—É—Å–æ–∫ –º—è—Å–∞ (–ø–∞—Ä–æ–ª—å) –∏ –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞—Ä—à (—Ö—ç—à). –ù–æ –≤—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞—Å—É–Ω—É—Ç—å —Ñ–∞—Ä—à –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫—É—Å–æ–∫ –º—è—Å–∞. –≠—Ç–æ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –æ–ø–µ—Ä–∞—Ü–∏—è".
3.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:**
\* **–®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞.** `pip install "passlib[bcrypt]"` (bcrypt ‚Äî —ç—Ç–æ –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è).
\* **–®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å `app/security.py`**. –í—ã–Ω–µ—Å—Ç–∏ –≤—Å—é –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.
\`\`\`python
\# app/security.py
from passlib.context import CryptContext

````
  # 1. –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç, —É–∫–∞–∑—ã–≤–∞—è —Å—Ö–µ–º—É —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
  pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")
  
  # 2. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è
  def verify_password(plain_password, hashed_password):
      return pwd_context.verify(plain_password, hashed_password)
      
  # 3. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ö—ç—à–∞ –ø–∞—Ä–æ–ª—è
  def get_password_hash(password):
      return pwd_context.hash(password)
  ```
````

******
3.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–∞—Ä–æ–ª—è –º—ã –Ω–µ "—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º" —Ö—ç—à. –ú—ã –±–µ—Ä–µ–º –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –≤–≤–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ö—ç—à–∏—Ä—É–µ–º –µ–≥–æ –∏ **—Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–≤–∞ —Ö—ç—à–∞**. `passlib` –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ.
******

### **4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑—É–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

4.1. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞: –°—Ö–µ–º—ã (`app/schemas.py`).** –°–æ–∑–¥–∞—Ç—å Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –≤ –æ—Ç–≤–µ—Ç–∞—Ö API.
\`\`\`python
from pydantic import BaseModel, EmailStr

````
class UserBase(BaseModel):
    email: EmailStr

class UserCreate(UserBase):
    password: str

class User(UserBase):
    id: int
    is_active: bool

    class Config:
        from_attributes = True # –î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∏–∑ SQLAlchemy-–º–æ–¥–µ–ª–∏
```
````

******
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞: CRUD (`app/crud.py`).** –î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
\`\`\`python
from . import models, schemas, security

````
async def create_user(db: AsyncSession, user: schemas.UserCreate):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—á–µ–Ω—å –≤–∞–∂–Ω–æ!)
    existing_user = await get_user_by_email(db, user.email)
    if existing_user:
        raise HTTPException(status_code=400, detail="Email already registered")
    
    # –•—ç—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    hashed_password = security.get_password_hash(user.password)
    db_user = models.User(email=user.email, hashed_password=hashed_password)
    db.add(db_user)
    await db.commit()
    await db.refresh(db_user)
    return db_user
```
````

******
4.3. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞: –†–æ—É—Ç–µ—Ä (`app/routers/users.py`).** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
\`\`\`python
from fastapi import APIRouter, Depends
\# ... –∏–º–ø–æ—Ä—Ç—ã ...

````
router = APIRouter(prefix="/users", tags=["Users"])

@router.post("/", response_model=schemas.User)
async def create_user_endpoint(user: schemas.UserCreate, db: AsyncSession = Depends(get_db_session)):
    return await crud.create_user(db=db, user=user)
```
````

******
4.4. **–ó–∞–≤–µ—Ä—à–∞—é—â–∏–π —à–∞–≥:** –ù–µ –∑–∞–±—ã—Ç—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –≤ `app/main.py`: `app.include_router(users.router)`.
4.5. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ß–µ—Ä–µ–∑ `/docs` —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ó–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é GUI-–∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ë–î **–ø–æ–∫–∞–∑–∞—Ç—å** —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ç–∞–±–ª–∏—Ü—É `users` –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–ª–æ–Ω–∫–∏ `hashed_password`. –¢–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–ª–∏–Ω–Ω–∞—è –∞–±—Ä–∞–∫–∞–¥–∞–±—Ä–∞, –∞ –Ω–µ —Ç–æ—Ç –ø–∞—Ä–æ–ª—å, —á—Ç–æ –±—ã–ª –≤–≤–µ–¥–µ–Ω. –≠—Ç–æ –∏ –µ—Å—Ç—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
4.6. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –±—ç–∫–µ–Ω–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ñ–æ—Ä–º–æ–π (–ø–æ–ª—è email –∏ password) –∏ '–ø–æ–¥–∫–ª—é—á–∏—Ç—å' –µ–µ –∫ –Ω–∞—à–µ–º—É –Ω–æ–≤–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `POST /users/`".

******

## –£—Ä–æ–∫–∞ 8: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ JWT-—Ç–æ–∫–µ–Ω—ã - –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### **1. –ü—Ä–æ–±–ª–µ–º–∞: HTTP "–±–µ–∑ –ø–∞–º—è—Ç–∏"**

1.1. **–ê–Ω–∞–ª–æ–≥–∏—è "–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –≤ –∞–≤—Ç–æ–±—É—Å–µ":** "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ HTTP ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä —Å –∞–º–Ω–µ–∑–∏–µ–π. –í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ –µ–º—É –±–∏–ª–µ—Ç (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å). –û–Ω –≤–∞—Å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç. –ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –≤–∞–º —Å–Ω–æ–≤–∞ –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∏–ª–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–∞—Å –Ω–µ –ø–æ–º–Ω–∏—Ç. –ù–æ—Å–∏—Ç—å —Å —Å–æ–±–æ–π –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–∏–ª–µ—Ç ‚Äî –Ω–µ—É–¥–æ–±–Ω–æ. –ì–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ –ø–æ–ª—É—á–∏—Ç—å —É –≤–æ–¥–∏—Ç–µ–ª—è '–ø—Ä–æ–µ–∑–¥–Ω–æ–π' (—Ç–æ–∫–µ–Ω), –∫–æ—Ç–æ—Ä—ã–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤—Å—é –ø–æ–µ–∑–¥–∫—É –∏ –∫–æ—Ç–æ—Ä—ã–π –ª–µ–≥–∫–æ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å".
1.2. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:** –ù–∞–º –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –∫–ª–∏–µ–Ω—Ç—É (React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º –±—ã—Å—Ç—Ä–æ –¥–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—É, —á—Ç–æ –æ–Ω —É–∂–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É.
******
1.3. **–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:** –ö—É–∫–∏, —Å–µ—Å—Å–∏–∏, OAuth, JWT. –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –º—ã –≤—ã–±–µ—Ä–µ–º JWT (JSON Web Tokens) –∏–∑-–∑–∞ –µ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SPA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö. (–î–µ—Ç–∞–ª—å–Ω–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ JWT)
******

### **2. –†–µ—à–µ–Ω–∏–µ: JWT-—Ç–æ–∫–µ–Ω—ã**

2.1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):**
\* `pip install python-jose[cryptography]` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT.
\* `pip install python-multipart` ‚Äî –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML-—Ñ–æ—Ä–º, —á—Ç–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è `OAuth2PasswordRequestForm`.
2.2. **–ê–Ω–∞–ª–æ–≥–∏—è "–¶–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫":** –î–µ—Ç–∞–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É.
\* **Payload (–î–∞–Ω–Ω—ã–µ):** "–≠—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ: `sub: 'user@example.com'` (—Å—É–±—ä–µ–∫—Ç, –∫–æ–º—É –≤—ã–¥–∞–Ω), `exp: 1678886400` (expiration, –¥–æ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω)".
\* **Signature (–ü–æ–¥–ø–∏—Å—å):** "–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ. –≠—Ç–æ '–≥–æ–ª–æ–≥—Ä–∞–º–º–∞' –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É —Å–µ—Ä–≤–µ—Ä–∞. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤–ø–∏—Å–∞—Ç—å –≤ –Ω–µ–≥–æ —á—É–∂–æ–µ –∏–º—è, –≥–æ–ª–æ–≥—Ä–∞–º–º–∞ –ø–æ–≤—Ä–µ–¥–∏—Ç—Å—è, –∏ –æ—Ö—Ä–∞–Ω–∞ (—Å–µ—Ä–≤–µ—Ä) —ç—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç".
******
2.3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–∫–µ–Ω–∞ –≤ `app/config.py`.
\`\`\`python
\# app/config.py
import os

````
# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π: openssl rand -hex 32
SECRET_KEY = os.getenv("SECRET_KEY", "your_default_super_secret_key")
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 30
```
* **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ `SECRET_KEY` **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –∫–æ–¥–µ.
````

******
2.4. **–°–æ–∑–¥–∞–Ω–∏–µ JWT-—É—Ç–∏–ª–∏—Ç—ã (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –î–æ–ø–æ–ª–Ω–∏—Ç—å `app/security.py` —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.
\`\`\`python
\# app/security.py
from datetime import datetime, timedelta, timezone
from jose import jwt
from app.config import SECRET\_KEY, ALGORITHM

````
def create_access_token(data: dict, expires_delta: timedelta | None = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.now(timezone.utc) + expires_delta
    else:
        # –ï—Å–ª–∏ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ, —Å—Ç–∞–≤–∏–º 15 –º–∏–Ω—É—Ç
        expire = datetime.now(timezone.utc) + timedelta(minutes=15)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt
```
````

******

### **3. –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∏ `OAuth2PasswordRequestForm`**

3.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –º–µ—Ö–∞–Ω–∏–∑–º `OAuth2PasswordRequestForm`. –û–Ω –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç `POST`-–∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `x-www-form-urlencoded`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –¥–≤–∞ –ø–æ–ª—è: `username` –∏ `password`.
3.2. **–§—É–Ω–∫—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –î–æ–±–∞–≤–∏—Ç—å –≤ `app/crud.py` —Ñ—É–Ω–∫—Ü–∏—é-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
\`\`\`python
\# app/crud.py
from . import security

````
async def authenticate_user(db: AsyncSession, email: str, password: str):
    user = await get_user_by_email(db, email=email)
    if not user:
        return None
    if not security.verify_password(password, user.hashed_password):
        return None
    return user
```
````

******

### **4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ª–æ–≥–∏–Ω–∞**

4.1. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `app/routers/auth.py` –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ –Ω–µ–º.
\`\`\`python
\# app/routers/auth.py
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from datetime import timedelta
from app import crud, security, schemas
from app.config import ACCESS\_TOKEN\_EXPIRE\_MINUTES

````
router = APIRouter(tags=["Authentication"])

@router.post("/token", response_model=schemas.Token)
async def login_for_access_token(
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: AsyncSession = Depends(get_db_session)
):
    user = await crud.authenticate_user(db, email=form_data.username, password=form_data.password)
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Incorrect email or password",
            headers={"WWW-Authenticate": "Bearer"},
        )
    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    access_token = security.create_access_token(
        data={"sub": user.email}, expires_delta=access_token_expires
    )
    return {"access_token": access_token, "token_type": "bearer"}
```
* –ü–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ç–∞–∫–∂–µ –¥–æ–±–∞–≤–∏—Ç—å Pydantic-—Å—Ö–µ–º—É `Token` –≤ `schemas.py`.
````

******
4.2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞:** –ù–∞–ø–æ–º–Ω–∏—Ç—å –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–∏—Ç—å `app.include_router(auth.router)` –≤ `app/main.py`.
4.3. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:**
\* –û—Ç–∫—Ä—ã—Ç—å `/docs`. –ü–æ—è–≤–∏—Ç—Å—è –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/token`.
\* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º—É, –≤–≤–µ—Å—Ç–∏ `email` (–≤ –ø–æ–ª–µ `username`) –∏ `password` –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
\* –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç —Å `access_token`.
\* **–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É **Authorize** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Swagger UI. –ù–∞–∂–∞—Ç—å –Ω–∞ –Ω–µ–µ, –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∏ –∑–∞–∫—Ä—ã—Ç—å. –û–±—ä—è—Å–Ω–∏—Ç—å, —á—Ç–æ —Ç–µ–ø–µ—Ä—å Swagger –±—É–¥–µ—Ç "–ø—Ä–µ–¥—ä—è–≤–ª—è—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–ø—É—Å–∫" –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –¥—Ä—É–≥–∏–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º.
4.4. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã –Ω–∞—É—á–∏–ª–∏ –±—ç–∫–µ–Ω–¥ –≤—ã–¥–∞–≤–∞—Ç—å '–ø—Ä–æ–ø—É—Å–∫–∞'. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/token`, –≤—ã –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token` –≤ `localStorage` –±—Ä–∞—É–∑–µ—Ä–∞, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ".

******

## –£—Ä–æ–∫ 9: –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ —Å JWT

### **1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**

1.1. **–ê–Ω–∞–ª–æ–≥–∏—è "–ù–æ—á–Ω–æ–π –∫–ª—É–±":** "–ù–∞—à API ‚Äî —ç—Ç–æ –∫–ª—É–±. –í—Ö–æ–¥ –≤ '–æ–±—â–∏–π –∑–∞–ª' (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GET /products`) —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö. –ù–æ –µ—Å—Ç—å 'VIP-–∑–æ–Ω–∞' (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GET /users/me` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–µ–±–µ), –∫—É–¥–∞ –ø—É—Å–∫–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –±—Ä–∞—Å–ª–µ—Ç–∞–º (–Ω–∞—à–∏–º JWT-—Ç–æ–∫–µ–Ω–∞–º). –°–µ–≥–æ–¥–Ω—è –º—ã —Å—Ç–∞–≤–∏–º –Ω–∞ –≤—Ö–æ–¥–µ –≤ VIP-–∑–æ–Ω—É '–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞', –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ –±—Ä–∞—Å–ª–µ—Ç—ã".
1.2. **–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ("–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞"), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ª–µ–≥–∫–æ "–ø–æ—Å—Ç–∞–≤–∏—Ç—å" –ø–µ—Ä–µ–¥ –ª—é–±—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º.

******

### **2. –°—Ö–µ–º–∞ `OAuth2PasswordBearer`**

2.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –≠—Ç–æ –Ω–µ —Å–∞–º "–æ—Ö—Ä–∞–Ω–Ω–∏–∫", –∞ –µ–≥–æ –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî **—Å–∫–∞–Ω–µ—Ä**. `OAuth2PasswordBearer` ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å-–ø–æ–º–æ—â–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –≤–µ—â—å: –∏—Å–∫–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–∞ `Authorization` –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ—Ç—Ç—É–¥–∞ —Ç–æ–∫–µ–Ω (`Bearer eyJhbGci...`). –ï—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ç–æ–∫–µ–Ω, –æ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å –æ—à–∏–±–∫–æ–π `401 Unauthorized`.
2.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —ç—Ç–æ–≥–æ "—Å–∫–∞–Ω–µ—Ä–∞" –≤ `app/security.py`.
\`\`\`python
\# app/security.py
from fastapi.security import OAuth2PasswordBearer

````
# tokenUrl —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/token")
```
````

******

### **3. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞**

3.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ù–∞—à "–æ—Ö—Ä–∞–Ω–Ω–∏–∫" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–º–Ω—ã–º. –ü–æ–ª—É—á–∏–≤ —Ç–æ–∫–µ–Ω –æ—Ç "—Å–∫–∞–Ω–µ—Ä–∞", –æ–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
\* –≠—Ç–æ –Ω–µ –ø–æ–¥–¥–µ–ª–∫–∞? (–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å).
\* –û–Ω –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω? (–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `exp`).
\* –ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã–¥–∞–Ω –ø—Ä–æ–ø—É—Å–∫, –≤—Å–µ –µ—â–µ —á–∏—Å–ª–∏—Ç—Å—è –≤ –Ω–∞—à–µ–π –±–∞–∑–µ? (–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î).

******

3.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞: –î–æ–ø–æ–ª–Ω–∏—Ç—å `app/schemas.py`**. –°–æ–∑–¥–∞—Ç—å Pydantic-—Å—Ö–µ–º—É –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –≤–Ω—É—Ç—Ä–∏ —Ç–æ–∫–µ–Ω–∞.
` python # app/schemas.py class TokenData(BaseModel): email: str | None = None `
3.3. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞: –ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å.** –≠—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—à "–æ—Ö—Ä–∞–Ω–Ω–∏–∫". –î–æ–±–∞–≤–∏—Ç—å –≤ `app/security.py`.
\`\`\`python
\# app/security.py
from fastapi import Depends, HTTPException, status
from jose import JWTError
\# ... –∏–º–ø–æ—Ä—Ç—ã crud, models, schemas, database, config ...

````
async def get_current_user(token: str = Depends(oauth2_scheme), db: AsyncSession = Depends(get_db_session)):
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="Could not validate credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    try:
        # 1. –î–µ–∫–æ–¥–∏—Ä—É–µ–º. jose —Å–∞–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        email: str = payload.get("sub")
        if email is None:
            raise credentials_exception
        token_data = schemas.TokenData(email=email)
    except JWTError:
        raise credentials_exception
    
    # 2. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
    user = await crud.get_user_by_email(db, email=token_data.email)
    if user is None:
        raise credentials_exception
    
    # 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    return user
```
````

******

### **4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `get_current_user` –∏ –∑–∞—â–∏—â–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç**

4.1. **–¶–µ–ª—å:** –ü–æ–∫–∞–∑–∞—Ç—å, –Ω–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ —Ç–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞—Ç—å –ª—é–±–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–º.
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –≤ `app/routers/users.py`.
\`\`\`python
\# app/routers/users.py
from .. import security, models
\# ...

````
@router.get("/me", response_model=schemas.User)
async def read_users_me(current_user: models.User = Depends(security.get_current_user)):
    # –ï—Å–ª–∏ –∫–æ–¥ –¥–æ—à–µ–ª –¥–æ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏, –∑–Ω–∞—á–∏—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.
    # –í –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π current_user –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î.
    return current_user
```
````

******
4.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –°–¥–µ–ª–∞—Ç—å –∞–∫—Ü–µ–Ω—Ç –Ω–∞ `Depends(security.get_current_user)`. –≠—Ç–æ–π –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–æ–π –º—ã "—Å—Ç–∞–≤–∏–º –Ω–∞—à–µ–≥–æ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞" –Ω–∞ –≤—Ö–æ–¥–µ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç. –í—Å—è —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–∑–∞ –∫—É–ª–∏—Å–∞–º–∏".
4.4. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è (–≤ `/docs`):**
\* **–ü–æ–ø—ã—Ç–∫–∞ 1 (–±–µ–∑ "–ø—Ä–æ–ø—É—Å–∫–∞"):** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ Swagger UI –Ω–µ –≤—Å—Ç–∞–≤–ª–µ–Ω —Ç–æ–∫–µ–Ω (–∫–Ω–æ–ø–∫–∞ "Authorize" —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞). –ó–∞–π—Ç–∏ –Ω–∞ `GET /users/me` –∏ –Ω–∞–∂–∞—Ç—å "Execute". –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –æ—à–∏–±–∫–∞ `401 Unauthorized` "Not authenticated".
\* **–ü–æ–ø—ã—Ç–∫–∞ 2 (—Å "–ø—Ä–æ–ø—É—Å–∫–æ–º"):**
1\. –°—Ö–æ–¥–∏—Ç—å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/token`, –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `access_token`.
2\. –ù–∞–∂–∞—Ç—å "Authorize", –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ `Bearer <token>`.
3\. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ `GET /users/me` –∏ —Å–Ω–æ–≤–∞ –Ω–∞–∂–∞—Ç—å "Execute".
4\. –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç `200 OK` —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –±—ã–ª –ø–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω.
4.5. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∑–∞—â–∏—â–∞—Ç—å –±—ç–∫–µ–Ω–¥. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ '–ø—Ä–µ–¥—ä—è–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—Å–∫'. –í React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `ProfilePage.tsx` —Å–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/users/me`. –í–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ `localStorage` –∏ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –ø—Ä–∏ `fetch`-–∑–∞–ø—Ä–æ—Å–µ. –û—Ç–æ–±—Ä–∞–∑–∏—Ç–µ email –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ".

******

## –£—Ä–æ–∫–∞ 10: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### **1. –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ?**

1.1. **–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞:** –ü–µ–¥–∞–≥–æ–≥ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `src/hooks/useCart.tsx` –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º, —á—Ç–æ –≤—Å—è –ª–æ–≥–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ `useState`. –≠—Ç–æ `items`, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
1.2. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:**
\* **–°—Ü–µ–Ω–∞—Ä–∏–π –ê:** –î–æ–±–∞–≤–∏—Ç—å 2-3 —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ó–∞—Ç–µ–º –æ—Ç–∫—Ä—ã—Ç—å —ç—Ç–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ (–∏–ª–∏ –≤ —Ä–µ–∂–∏–º–µ "–∏–Ω–∫–æ–≥–Ω–∏—Ç–æ"). **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –í—ã–≤–æ–¥: **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏/–±—Ä–∞—É–∑–µ—Ä–∞–º–∏**.
\* **–°—Ü–µ–Ω–∞—Ä–∏–π –ë:** –°–Ω–æ–≤–∞ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã. –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ -\> Application -\> Local Storage / Session Storage -\> Clear all. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –í—ã–≤–æ–¥: **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –ª–µ–≥–∫–æ —Ç–µ—Ä—è–µ—Ç—Å—è**.
1.3. **–ò—Ç–æ–≥:** –î–ª—è –ª—é–±–æ–≥–æ —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ e-commerce –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ —Å–≤—è–∑—ã–≤–∞—Ç—å –µ—ë —Å —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

******

### **2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã**

2.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –û–±—Å—É–¥–∏—Ç—å, –∫–∞–∫ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`User`) –∏–º–µ–µ—Ç –æ–¥–Ω—É –ö–æ—Ä–∑–∏–Ω—É (`Cart`). –ö–æ—Ä–∑–∏–Ω–∞ (`Cart`) –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ –ü–æ–∑–∏—Ü–∏–π –≤ –∫–æ—Ä–∑–∏–Ω–µ (`CartItem`). –ö–∞–∂–¥–∞—è –ü–æ–∑–∏—Ü–∏—è (`CartItem`) —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω –¢–æ–≤–∞—Ä (`Product`) –∏ —Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
2.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –î–æ–ø–æ–ª–Ω–∏—Ç—å `app/models.py` –Ω–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –∏ —Å–≤—è–∑—è–º–∏.
\`\`\`python
\# app/models.py
\# ...
class Cart(Base):
**tablename** = "carts"
id: Mapped[int] = mapped\_column(primary\_key=True)
user\_id: Mapped[int] = mapped\_column(ForeignKey("users.id"), unique=True)
\# –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É" —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
user: Mapped["User"] = relationship(back\_populates="cart")
\# –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º" —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ
items: Mapped[list["CartItem"]] = relationship(cascade="all, delete-orphan")

````
class CartItem(Base):
    __tablename__ = "cart_items"
    id: Mapped[int] = mapped_column(primary_key=True)
    cart_id: Mapped[int] = mapped_column(ForeignKey("carts.id"))
    product_id: Mapped[int] = mapped_column(ForeignKey("products.id"))
    quantity: Mapped[int] = mapped_column(default=1)

# –í –º–æ–¥–µ–ª–∏ User –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å
class User(Base):
    # ...
    cart: Mapped["Cart" | None] = relationship(back_populates="user", cascade="all, delete-orphan")
```
````

2.3. **–ú–∏–≥—Ä–∞—Ü–∏—è:** –ù–∞–ø–æ–º–Ω–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `alembic revision --autogenerate -m "Add cart models"` –∏ `alembic upgrade head`.
******

### **3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**

3.1. **–ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ä–∑–∏–Ω–æ–π –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å, *–¥–ª—è –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è* –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –±—É–¥–µ—Ç –∑–∞—â–∏—â–µ–Ω –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `Depends(security.get_current_user)`.
3.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:**
\* –í `schemas.py` —Å–æ–∑–¥–∞—Ç—å Pydantic-—Å—Ö–µ–º—ã –¥–ª—è `Cart` –∏ `CartItem`.
\* –í `crud.py` –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏: `get_or_create_cart_by_user_id`, `add_product_to_cart`, `remove_product_from_cart`.
\* –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä `app/routers/cart.py`.
\`\`\`python
\# app/routers/cart.py
from fastapi import APIRouter, Depends
\# ... –∏–º–ø–æ—Ä—Ç—ã ...

````
  router = APIRouter(prefix="/cart", tags=["Cart"])

  @router.get("/", response_model=schemas.Cart)
  async def get_my_cart(current_user: models.User = Depends(security.get_current_user), db: AsyncSession = Depends(get_db_session)):
      return await crud.get_or_create_cart(db, user_id=current_user.id)

  @router.post("/items", response_model=schemas.Cart)
  async def add_item_to_my_cart(
      item_data: schemas.CartItemCreate,
      current_user: models.User = Depends(security.get_current_user),
      db: AsyncSession = Depends(get_db_session)
  ):
      return await crud.add_item_to_cart(db, user_id=current_user.id, item=item_data)
  
  # ... –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è ...
  ```
````

3.3. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞:** –ù–µ –∑–∞–±—ã—Ç—å –¥–æ–±–∞–≤–∏—Ç—å `app.include_router(cart.router)` –≤ `main.py`.
******

### **4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ö—É–∫–∞ `useCart`**

4.1. **–¶–µ–ª—å:** –ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API-–≤—ã–∑–æ–≤—ã.
4.2. **–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞:** –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `src/hooks/useCart.tsx`.
\* –í–º–µ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `useState([])`, —Å–æ–∑–¥–∞—Ç—å `useEffect`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (–∏ –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ/–ª–æ–≥–∞—É—Ç–µ) –¥–µ–ª–∞–µ—Ç `fetch`-–∑–∞–ø—Ä–æ—Å –∫ `GET /cart` –∏ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
\* –§—É–Ω–∫—Ü–∏—è `addToCart` —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å `POST`-–∑–∞–ø—Ä–æ—Å –∫ `/cart/items`, –ø–µ—Ä–µ–¥–∞–≤–∞—è ID —Ç–æ–≤–∞—Ä–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ. –í –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `Authorization: Bearer <token>`.
\* –§—É–Ω–∫—Ü–∏—è `removeFromCart` –¥–µ–ª–∞–µ—Ç `DELETE`-–∑–∞–ø—Ä–æ—Å.
\* –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è) –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã —Å –±—ç–∫–µ–Ω–¥–∞, —á—Ç–æ–±—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
******

4.3. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è ("–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã"):**
\* –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
\* –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É. –í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø–æ–∫–∞–∑–∞—Ç—å —É—Ö–æ–¥—è—â–∏–π `POST`-–∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º.
\* –° –ø–æ–º–æ—â—å—é GUI-–∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ë–î –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö `carts` –∏ `cart_items` –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å ID –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
\* –í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏ –∑–∞–π—Ç–∏ —Å–Ω–æ–≤–∞. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞, –æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å —Å —Å–µ—Ä–≤–µ—Ä–∞.
\* –ó–∞–π—Ç–∏ –ø–æ–¥ —Ç–µ–º –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ —Ç–∞ –∂–µ —Å–∞–º–∞—è. –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞.
4.4. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –∏, —á—Ç–æ –≤–∞–∂–Ω–µ–µ, —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –ª–æ–≥–∏–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `PUT /cart/items/{item_id}`), —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –º–µ–Ω—è—Ç—å —á–∏—Å–ª–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä—è–º–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ".

******

## –£—Ä–æ–∫ 11: –§–∏–Ω–∞–ª ‚Äî —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å Docker –∏ Docker Compose

### **1. –ü—Ä–æ–±–ª–µ–º–∞: "–£ –º–µ–Ω—è –Ω–∞ –º–∞—à–∏–Ω–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ\!"**

1.1. **–°—Ü–µ–Ω–∞—Ä–∏–π:** –†–∞—Å—Å–∫–∞–∑–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ç–∏–ø–∏—á–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é. "–í—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç, –æ–Ω –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º –Ω–æ—É—Ç–±—É–∫–µ. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –µ–≥–æ –¥—Ä—É–≥—É. –î—Ä—É–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É `ModuleNotFoundError` –∏–ª–∏ `OperationalError: connection refused`. –ü–æ—á–µ–º—É? –û–Ω –∑–∞–±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–¥–Ω—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –∏–ª–∏ —É –Ω–µ–≥–æ –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è PostgreSQL, –∏–ª–∏ –æ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–∑–≤–∞–ª –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏".
1.2. **–í—ã–≤–æ–¥:** –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ö–∞–æ—Å –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –ù–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± –ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥, –Ω–æ –∏ **–≤—Å—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º**: –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é Python, –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
******

### **2. –†–µ—à–µ–Ω–∏–µ: Docker ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä" –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

2.1. **–ê–Ω–∞–ª–æ–≥–∏—è "–ú–æ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä":** "Docker ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤–∞—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—Å–µ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ–¥–∏–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π '–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä' (–æ–±—Ä–∞–∑). –≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –≥–¥–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Docker, –∏ –æ–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ç–∞–∫ –∂–µ. –ú—ã –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º '–º–µ–±–µ–ª—å' (–∫–æ–¥), –º—ã –¥–æ—Å—Ç–∞–≤–ª—è–µ–º '–∫–æ–º–Ω–∞—Ç—É —Å –º–µ–±–µ–ª—å—é' (–æ–±—Ä–∞–∑ —Å –∫–æ–¥–æ–º –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º)".
2.2. **–û–±—Ä–∞–∑ vs. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä:** –ß–µ—Ç–∫–æ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–æ–Ω—è—Ç–∏—è:
\* **–û–±—Ä–∞–∑ (Image):** –≠—Ç–æ —á–µ—Ä—Ç–µ–∂, —à–∞–±–ª–æ–Ω, "—Å–ª–µ–ø–æ–∫" —Å–∏—Å—Ç–µ–º—ã. –û–Ω –Ω–µ –∑–∞–ø—É—â–µ–Ω.
\* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (Container):** –≠—Ç–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π, –∂–∏–≤–æ–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–∑–∞. –ò–∑ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–Ω–æ–≥–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
******

### **3. `Dockerfile`: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ –Ω–∞—à–µ–≥–æ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞"**

3.1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `requirements.txt`. –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º, –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É: `pip freeze > requirements.txt`.
3.2. **–°–æ–∑–¥–∞–Ω–∏–µ `Dockerfile` (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `Dockerfile` (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è).
\`\`\`dockerfile
\# –®–∞–≥ 1: –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑. –ë–µ—Ä–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python 3.11 –≤ "–ª–µ–≥–∫–æ–π" –≤–µ—Ä—Å–∏–∏.
FROM python:3.11-slim

````
# –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
WORKDIR /app

# –®–∞–≥ 3: –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Ö.
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –®–∞–≥ 4: –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥ –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
COPY . .

# –®–∞–≥ 5: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
# Uvicorn –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (0.0.0.0) –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```
````

3.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –†–∞–∑–æ–±—Ä–∞—Ç—å –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É: `FROM`, `WORKDIR`, `COPY`, `RUN`, `CMD`. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç—å `--host 0.0.0.0` ‚Äî –±–µ–∑ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
******

### **4. `docker-compose`: –î–∏—Ä–∏–∂–µ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞**

4.1. **–ö–æ–Ω—Ü–µ–ø—Ü–∏—è:** –ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π: API –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö. `docker-compose` –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –≤—Å–µ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –∏ –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, –∞ –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.
4.2. **–°–æ–∑–¥–∞–Ω–∏–µ `docker-compose.yml` (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `docker-compose.yml`.
\`\`\`yaml
version: '3.8'

````
services:
  # –ù–∞—à FastAPI —Å–µ—Ä–≤–∏—Å
  api:
    build: . # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: —Å–æ–±–µ—Ä–∏ –æ–±—Ä–∞–∑ –∏–∑ Dockerfile –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ
    ports:
      - "8008:8000" # –ü—Ä–æ–±—Ä–æ—Å—å –ø–æ—Ä—Ç 8000 –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç 8008 –Ω–∞ –º–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
    environment:
      # –ü–µ—Ä–µ–¥–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      - DATABASE_URL=postgresql+asyncpg://postgres:mysecretpassword@db:5432/store_db
      - SECRET_KEY=a_very_secret_key_for_docker
    depends_on:
      - db # –ó–∞–ø—É—Å–∫–∞–π API —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å–µ—Ä–≤–∏—Å 'db'
  
  # –°–µ—Ä–≤–∏—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  db:
    image: postgres:15-alpine # –ò—Å–ø–æ–ª—å–∑—É–π –≥–æ—Ç–æ–≤—ã–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
    volumes:
      - postgres_data:/var/lib/postgresql/data/ # –°–æ—Ö—Ä–∞–Ω—è–π –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç—Ç–æ–π –ø–∞–ø–∫–∏ –≤ —Ç–æ–º–µ postgres_data
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=mysecretpassword
      - POSTGRES_DB=store_db

volumes:
  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–º –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ë–î
  postgres_data:
```
````

4.3. **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è –ü–µ–¥–∞–≥–æ–≥–∞:** –û–±—ä—è—Å–Ω–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã: `build` vs `image`, `ports`, `environment` (–∏ –ø–æ—á–µ–º—É —Ö–æ—Å—Ç —Ç–µ–ø–µ—Ä—å `db`), `volumes` (–¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö) –∏ `depends_on`.
******

### **5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—é —Å–∏—Å—Ç–µ–º—É –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π**

5.1. **"–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã" (–ó–∞–¥–∞—á–∞ –¥–ª—è –ò–Ω–∂–µ–Ω–µ—Ä–∞ –ö–æ–¥–∞):** –ü–æ–ø—Ä–æ—Å–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—Å–µ–≥–æ –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:
` bash docker-compose up --build `
5.2. **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è:** –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: Docker —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑ `postgres`, —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ `api` –ø–æ —à–∞–≥–∞–º –∏–∑ `Dockerfile`, –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
******
5.3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
\* –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ **`http://localhost:8008/docs`**. API –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.
\* –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ `docker-compose down` (–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã).
\* –°–Ω–æ–≤–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `docker-compose up`.
\* **–í–∞–∂–Ω–æ:** –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏), **–æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ –º–µ—Å—Ç–µ**, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `volume`.
5.4. **–°–≤—è–∑—å —Å –¥–æ–º–∞—à–Ω–∏–º –∑–∞–¥–∞–Ω–∏–µ–º:** "–ú—ã '—É–ø–∞–∫–æ–≤–∞–ª–∏' –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –í–∞—à–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ —ç—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å. –°–æ–∑–¥–∞–π—Ç–µ `Dockerfile` –∏ `docker-compose.yml`, –∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à–µ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å –¥–æ–∫–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –±—ç–∫–µ–Ω–¥–æ–º (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å URL –Ω–∞ `localhost:8008`) –∏ —á—Ç–æ –≤–µ—Å—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç –∏–¥–µ–∏ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è\!"

```

## `doc/plan_formatted.md`

```md
# –ü–ª–∞–Ω –∫—É—Ä—Å–∞ FastAPI - –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

> [!info]
>
> #### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ üìã
>
> –≠—Ç–æ—Ç –ø–ª–∞–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ—Ç–∫–∏–µ —É–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—á–µ–±–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
>
> - **[–¢–ï–ö–°–¢]** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏
> - **[–ö–û–î]** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏ –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
> - **[–î–ò–ê–ì–†–ê–ú–ú–ê]** ‚Äî —Å–æ–∑–¥–∞—Ç—å Mermaid –¥–∏–∞–≥—Ä–∞–º–º—É
> - **[–î–ï–ú–û]** ‚Äî –æ–ø–∏—Å–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é

******

## –£—Ä–æ–∫ 1: –û—Å–Ω–æ–≤—ã FastAPI –∏ —Å–∏–ª–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ üöÄ

### 1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É FastAPI? ü§î

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å —è—Ä–∫–æ–π –∞–Ω–∞–ª–æ–≥–∏–∏ –ø—Ä–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–µ–±–æ—Å–∫—Ä–µ–±–∞. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –Ω–µ–±–æ—Å–∫—Ä–µ–±, –Ω–æ —É –≤–∞—Å –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–∞—è –¥—Ä–µ–ª—å –∏ –º–æ–ª–æ—Ç–æ–∫. –ú–æ–∂–Ω–æ –ª–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å? –î–∞. –ë—É–¥–µ—Ç –ª–∏ —ç—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ? –ù–µ—Ç. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (–∫–∞–∫ Flask/Django –≤ –∏—Ö –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å —Ç–æ—Ç —Å–∞–º—ã–π –º–æ–ª–æ—Ç–æ–∫. –û–Ω–∏ –Ω–∞–¥–µ–∂–Ω—ã, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å —Ç—ã—Å—è—á–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—é I/O-bound –∑–∞–¥–∞—á. –ß—Ç–æ —Ç–∞–∫–æ–µ I/O-bound –∑–∞–¥–∞—á–∞? –≠—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Ä–æ–¥–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –¥—Ä—É–≥–æ–º—É API –∏–ª–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –í —ç—Ç–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä "–ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç" ‚Äî –æ–Ω –≥–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã. –í —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –º–∏—Ä–µ –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞, –±–ª–æ–∫–∏—Ä—É—è –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –°–æ–∑–¥–∞–π—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ–∫–∞–∑—ã–≤–∞—é—â—É—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç1 üë®‚Äçüíª
    participant –ö–ª–∏–µ–Ω—Ç2 üë©‚Äçüíª
    participant –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä üêå
    participant –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö üíæ
    
    Note over –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    –ö–ª–∏–µ–Ω—Ç1->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –ó–∞–ø—Ä–æ—Å 1
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT *
    Note over –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä,–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: –û–∂–∏–¥–∞–Ω–∏–µ... —Å–µ—Ä–≤–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –î–∞–Ω–Ω—ã–µ
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä-->>–ö–ª–∏–µ–Ω—Ç1: –û—Ç–≤–µ—Ç
    
    Note over –ö–ª–∏–µ–Ω—Ç2: –ö–ª–∏–µ–Ω—Ç2 –∂–¥–∞–ª –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è!
    –ö–ª–∏–µ–Ω—Ç2->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –ó–∞–ø—Ä–æ—Å 2
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä-->>–ö–ª–∏–µ–Ω—Ç2: –û—Ç–≤–µ—Ç
```

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç1 üë®‚Äçüíª
    participant –ö–ª–∏–µ–Ω—Ç2 üë©‚Äçüíª
    participant FastAPI ‚ö°
    participant –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö üíæ
    
    Note over FastAPI: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    –ö–ª–∏–µ–Ω—Ç1->>FastAPI: –ó–∞–ø—Ä–æ—Å 1
    FastAPI->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT * (async)
    Note over FastAPI: –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è! –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏
    
    –ö–ª–∏–µ–Ω—Ç2->>FastAPI: –ó–∞–ø—Ä–æ—Å 2
    FastAPI->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT * (async)
    
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>FastAPI: –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ 1
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç1: –û—Ç–≤–µ—Ç
    
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>FastAPI: –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ 2
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç2: –û—Ç–≤–µ—Ç
```

**[–¢–ï–ö–°–¢]** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ FastAPI –∫–∞–∫ "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç" –≤ –Ω–∞—à–µ–π –∞–Ω–∞–ª–æ–≥–∏–∏. –û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏** (–±–ª–∞–≥–æ–¥–∞—Ä—è ASGI-—Å–µ—Ä–≤–µ—Ä–∞–º –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ Starlette). –ü–æ–∫–∞ FastAPI –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É, –æ–Ω –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö. –≠—Ç–æ –¥–∞–µ—Ç –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–Ω–æ –≤ I/O-bound –∑–∞–¥–∞—á–∞—Ö.

******

### 2. –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "Hello, World" üëã

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å –±–ª–æ–∫–∞: –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–±–æ—á–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –û—Ç –∏–¥–µ–∏ –¥–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∑–∞ 2 –º–∏–Ω—É—Ç—ã.

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å FastAPI –∏ ASGI-—Å–µ—Ä–≤–µ—Ä uvicorn. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
>
>```
>pip install fastapi "uvicorn[standard]"
>```

******

**[–ö–û–î: main.py]** –°–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def read_root():
    return {"Hello": "World"}
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞:

- `app = FastAPI()` ‚Äî —ç—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ "–º–æ–∑–≥–∞" –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ FastAPI
- `@app.get("/")` ‚Äî —ç—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏. –ú—ã –≥–æ–≤–æ—Ä–∏–º FastAPI: "–ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ—Ç `GET`-–∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π URL (`/`), –≤—ã–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∏–∂–µ"
- `async def` ‚Äî –ø–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ FastAPI "–¥—É–º–∞–µ—Ç" –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –î–∞–∂–µ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `async` ‚Äî —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞

>[!info]
>
>#### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ üöÄ
>
>–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
>
>```
>uvicorn main:app --reload
>```
>
>–ì–¥–µ:
>
>- `main` ‚Äî –∏–º—è —Ñ–∞–π–ª–∞ `main.py`
>- `app` ‚Äî –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞
>- `--reload` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)

**[–î–ï–ú–û]** –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://127.0.0.1:8000`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å JSON-–æ—Ç–≤–µ—Ç: `{"Hello": "World"}`. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!

******

### 3. –°–∏–ª–∞ Pydantic: —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ üí™

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é –∏–¥–µ—é: –Ω–∞ –±—ç–∫–µ–Ω–¥, –∫–∞–∫ –∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ. –ò –º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Ç–∏–ø–∞—Ö. Pydantic ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–∫–æ–Ω—Ç—Ä–∞–∫—Ç" –∏–ª–∏ "—Ñ–æ—Ä–º—É" –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

**[–ö–û–î: main.py]** –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é Pydantic-–º–æ–¥–µ–ª—å –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏ "–¢–æ–≤–∞—Ä":

```python
from pydantic import BaseModel
from typing import Optional

class Product(BaseModel):
    id: int
    name: str
    description: Optional[str] = None  # –ü–æ–ª–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
    price: float
```

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Pydantic-–º–æ–¥–µ–ª–∏:

```mermaid
classDiagram
    class Product {
        +int id
        +str name
        +str description
        +float price
        +model_dump() dict
        +model_validate() Product
    }
    
    class BaseModel {
        <<abstract>>
        +model_dump()
        +model_validate()
        +model_json()
    }
    
    BaseModel <|-- Product : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
```

**[–¢–ï–ö–°–¢]** –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Pydantic:

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º. –ú—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º, –∫–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å —É —Ç–æ–≤–∞—Ä–∞ –∏ –∫–∞–∫–æ–≥–æ –æ–Ω–∏ —Ç–∏–ø–∞. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Ü–µ–ª—ã–π –∫–ª–∞—Å—Å –æ—à–∏–±–æ–∫ –µ—â–µ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏. –ï—Å–ª–∏ –ø—Ä–∏–¥–µ—Ç –∑–∞–ø—Ä–æ—Å —Å `price: "–¥–µ—à–µ–≤–æ"`, FastAPI —Å–∞–º –æ—Ç–∫–ª–æ–Ω–∏—Ç –µ–≥–æ —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π.

**–ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ì–ª–∞–≤–Ω–∞—è "–º–∞–≥–∏—è" FastAPI. –§—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI.

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö "–Ω–∞ –ª–µ—Ç—É" ‚úÖ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å –±–ª–æ–∫–∞: –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–µ–æ—Ä–∏—é, –∞ –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "–º–∞–≥–∏—é" FastAPI –∏ Pydantic –≤ –¥–µ–π—Å—Ç–≤–∏–∏.

**[–ö–û–î: main.py]** –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π `POST`-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:

```python
@app.post("/products/")
async def create_product(product: Product):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    # 1. –ü—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
    # 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç –µ–≥–æ –ø–æ –º–æ–¥–µ–ª–∏ Product
    # 3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –æ–±—ä–µ–∫—Ç Python
    # 4. –ü–µ—Ä–µ–¥–∞—Å—Ç –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é
    return product
```

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞–ª–∏ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–∞ `product: Product`, –∏ FastAPI —Å–∞–º –ø–æ–Ω—è–ª, —á—Ç–æ –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å —Ç–µ–ª–æ `POST`-–∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –ø–æ –º–æ–¥–µ–ª–∏ `Product` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é.

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant Pydantic üîç
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç üìç
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /products/ + JSON
    FastAPI->>Pydantic: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –º–æ–¥–µ–ª–∏ Product
    
    alt –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã ‚úÖ
        Pydantic->>FastAPI: –û–±—ä–µ–∫—Ç Product —Å–æ–∑–¥–∞–Ω
        FastAPI->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–±—ä–µ–∫—Ç–æ–º
        –≠–Ω–¥–ø–æ–∏–Ω—Ç-->>FastAPI: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + JSON
    else –î–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã ‚ùå
        Pydantic->>FastAPI: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 422 Unprocessable Entity + –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
    end
```

**[–î–ï–ú–û]** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs` ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /products/` –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –µ–≥–æ
3. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Å—Ö–µ–º–µ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Product` —Å —Ç–∏–ø–∞–º–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π
4. –ù–∞–∂–º–∏—Ç–µ "Try it out" –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON:

   ```json
   {
     "id": 1,
     "name": "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä",
     "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
     "price": 99.99
   }
   ```

5. –ü–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç `200 OK`
6. –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ **–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–∏–ø–æ–º:

   ```json
   {
     "id": 1,
     "name": "–¢–æ–≤–∞—Ä",
     "price": "–¥–µ—à–µ–≤–æ"
   }
   ```

7. –ü–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É `422 Unprocessable Entity` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–°–æ–∑–¥–∞–π—Ç–µ Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è "–¢–æ–≤–∞—Ä–∞" –∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏". –†–µ–∞–ª–∏–∑—É–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –≤—ã —Å–∞–º–∏ –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é FastAPI.

******

## –£—Ä–æ–∫ 2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ API –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å APIRouter üó∫Ô∏è

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Ä–æ—Å—Ç–∞: –û–¥–∏–Ω —Ñ–∞–π–ª ‚Äî —ç—Ç–æ —Ö–∞–æ—Å üòµ

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞. –ù–∞—à `main.py` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–≤–∞–ª–∏–ª–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ü–æ–∫–∞ –∏—Ö –¥–≤–∞-—Ç—Ä–∏ ‚Äî –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ. –ù–æ —á—Ç–æ –±—É–¥–µ—Ç, –∫–æ–≥–¥–∞ –∏—Ö —Å—Ç–∞–Ω–µ—Ç 50? –ù–∞–º –Ω—É–∂–Ω—ã –ø–∞–ø–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ –∫—Ä–æ–º–µ —Ç–æ–≤–∞—Ä–æ–≤, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `main.py` CRUD –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –∫–æ—Ä–∑–∏–Ω... –§–∞–π–ª —Ä–∞–∑—Ä–∞—Å—Ç–µ—Ç—Å—è –¥–æ —Å–æ—Ç–µ–Ω, –∞ —Ç–æ –∏ —Ç—ã—Å—è—á —Å—Ç—Ä–æ–∫, –∏ –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥", –∏ –º—ã –¥–æ–ª–∂–Ω—ã –∏–∑–±–µ–≥–∞—Ç—å –µ–≥–æ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

******

### 2. –†–µ—à–µ–Ω–∏–µ: `APIRouter` –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ üóÇÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: `APIRouter` ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—à–∏ "–ø–∞–ø–∫–∏" –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ú—ã —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π Python-—Ñ–∞–π–ª –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `products.py`), –æ–±—ä—è–≤–ª—è–µ–º –≤ –Ω–µ–º —Ä–æ—É—Ç–µ—Ä –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —Ç—É–¥–∞ –≤—Å–µ –ø—É—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≤–∞—Ä–∞–º–∏. –ó–∞—Ç–µ–º –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (`main.py`) –ø—Ä–æ—Å—Ç–æ "–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç" —ç—Ç—É –ø–∞–ø–∫—É.

**[–¢–ï–ö–°–¢]** –û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

```
/my_project
‚îú‚îÄ‚îÄ /app
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ /routers
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ products.py
‚îî‚îÄ‚îÄ ...
```

******

**[–ö–û–î: app/routers/products.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤:

```python
from fastapi import APIRouter

router = APIRouter()

# –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏, –±—É–¥—É—Ç –∑–¥–µ—Å—å
# –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—Ç, —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ
@router.post("/")
async def create_product(product: Product):  # Product - –º–æ–¥–µ–ª—å Pydantic –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞
    return product
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ:

```python
from fastapi import FastAPI
from .routers import products

app = FastAPI()

# "–ü–æ–¥–∫–ª—é—á–∞–µ–º" —Ä–æ—É—Ç–µ—Ä —Å —Ç–æ–≤–∞—Ä–∞–º–∏
app.include_router(
    products.router,
    prefix="/products",  # –í—Å–µ URL –≤ —ç—Ç–æ–º —Ä–æ—É—Ç–µ—Ä–µ –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å /products
    tags=["Products"]     # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ /docs
)
```

**[–¢–ï–ö–°–¢]** –°–¥–µ–ª–∞–π—Ç–µ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö `prefix` –∏ `tags`:

- `prefix="/products"` –∏–∑–±–∞–≤–ª—è–µ—Ç –Ω–∞—Å –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å `/products` –≤ –∫–∞–∂–¥–æ–º URL –≤–Ω—É—Ç—Ä–∏ `products.py`
- `tags=["Products"]` —Å–æ–∑–¥–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤ –∞–≤—Ç–æ-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI

******

### 3. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ üìä

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø–æ–∫–∞ –º—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–¥–∏–º –≤—Ä–µ–º–µ–Ω–Ω—É—é "in-memory" –±–∞–∑—É –ø—Ä—è–º–æ –≤ —Ñ–∞–π–ª–µ —Ä–æ—É—Ç–µ—Ä–∞.

******

**[–ö–û–î: app/routers/products.py]** –°–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```python
from typing import List
from pydantic import BaseModel

# –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏ Product

# –ù–∞—à–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –≤ –ø–∞–º—è—Ç–∏
db_products: List[Product] = [
    Product(id=1, name="–ü–ª—é–º–±—É—Å", description="–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", price=10.5),
    Product(id=2, name="–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏", description="–ó–∞–≥–∞–¥–æ—á–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ", price=25.0)
]
```

**[–ö–û–î: app/routers/products.py]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ CRUD:

**Read All (GET /)** ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã:

```python
@router.get("/", response_model=List[Product])
async def get_all_products():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤"""
    return db_products
```

**Read One (GET /{product_id})** ‚Äî –ø–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø–æ ID:

```python
@router.get("/{product_id}", response_model=Product)
async def get_product(product_id: int):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID.
    Path-–ø–∞—Ä–∞–º–µ—Ç—Ä product_id –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ URL.
    """
    for product in db_products:
        if product.id == product_id:
            return product
    # –ß—Ç–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏? –†–∞–∑–±–µ—Ä–µ–º –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ —Å –∫–æ–Ω—Ü–µ–ø—Ü–∏–µ–π **Path-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** ‚Äî –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ URL. FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `{product_id}` –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤ `int`, –±–ª–∞–≥–æ–¥–∞—Ä—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–∞.

**Create (POST /)** ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä:

```python
@router.post("/", response_model=Product, status_code=201)
async def create_product(product: Product):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)"""
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID
    new_id = max([p.id for p in db_products]) + 1 if db_products else 1
    product.id = new_id
    
    db_products.append(product)
    return product
```

**Update (PUT /{product_id})** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä:

```python
@router.put("/{product_id}", response_model=Product)
async def update_product(product_id: int, updated_product: Product):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä"""
    for index, product in enumerate(db_products):
        if product.id == product_id:
            updated_product.id = product_id  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID
            db_products[index] = updated_product
            return updated_product
    # –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –æ—à–∏–±–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

**Delete (DELETE /{product_id})** ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä:

```python
@router.delete("/{product_id}", status_code=204)
async def delete_product(product_id: int):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID"""
    for index, product in enumerate(db_products):
        if product.id == product_id:
            db_products.pop(index)
            return None  # 204 No Content - —É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞
    # –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –æ—à–∏–±–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

******

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: `HTTPException` ‚ö†Ô∏è

**[–î–ï–ú–û]** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–¥ –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä `/products/999`. –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `500 Internal Server Error`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –∏–ª–∏ —É–ø–∞–ª–∞. –≠—Ç–æ –ø–ª–æ—Ö–æ ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É `404 Not Found`.

**[–¢–ï–ö–°–¢]** –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ —Å `HTTPException` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º FastAPI "–≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å" –æ—à–∏–±–∫–∏ —Å –Ω—É–∂–Ω—ã–º HTTP-—Å—Ç–∞—Ç—É—Å–æ–º –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
******
**[–ö–û–î: app/routers/products.py]** –î–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `get_product`:

```python
from fastapi import HTTPException

@router.get("/{product_id}", response_model=Product)
async def get_product(product_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–∫–∏"""
    for product in db_products:
        if product.id == product_id:
            return product
    
    # –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    raise HTTPException(
        status_code=404,
        detail=f"–¢–æ–≤–∞—Ä —Å ID {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
    )
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product üìç
    participant –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory) üíæ
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: GET /products/999
    FastAPI->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: –í—ã–∑–æ–≤ —Å product_id=999
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product->>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory): –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ —Å ID=999
    –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory)-->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: raise HTTPException(404)
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product-->>FastAPI: HTTPException
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 404 Not Found + {"detail": "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"}
```

**[–î–ï–ú–û]** –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ `/products/999` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ —Ç–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç:

- –°—Ç–∞—Ç—É—Å: **404 Not Found**
- –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: `{"detail": "–¢–æ–≤–∞—Ä —Å ID 999 –Ω–µ –Ω–∞–π–¥–µ–Ω"}`

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç –∂–¥–µ—Ç frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω".

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`app/routers/categories.py`) –∏ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –¥–ª—è –Ω–∏—Ö –ø–æ–ª–Ω—ã–π CRUD —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. –ü–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ, –∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏.

******

## –£—Ä–æ–∫ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ ORM —Å SQLAlchemy üóÑÔ∏è

### 1. –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—à–∏ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–¥–Ω–æ–¥–Ω–µ–≤–∫–∏ üí®

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏–∑ –£—Ä–æ–∫–∞ 2
2. –ß–µ—Ä–µ–∑ `/docs` –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å –ø–æ–º–æ—â—å—é `POST /products/`
3. –°–¥–µ–ª–∞–π—Ç–µ `GET /products/` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ —Å–ø–∏—Å–∫–µ
4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `uvicorn` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ —Å–Ω–æ–≤–∞
5. –°–¥–µ–ª–∞–π—Ç–µ –µ—â–µ –æ–¥–∏–Ω `GET /products/` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä **–∏—Å—á–µ–∑**!

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ Python ‚Äî —ç—Ç–æ **–≤–æ–ª–∞—Ç–∏–ª—å–Ω–∞—è (–Ω–µ–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) –ø–∞–º—è—Ç—å**. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è. –ß—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞, –∏—Ö –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Äî –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

******

### 2. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å ORM –∏ SQLAlchemy üîÑ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é ORM —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫":

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ Python. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ SQL. –ù–∞–ø—Ä—è–º—É—é –æ–Ω–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç. **ORM (Object-Relational Mapping)**, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ **SQLAlchemy**, ‚Äî —ç—Ç–æ –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É –Ω–∏–º–∏.

–ú—ã –ø–∏—à–µ–º Python-–∫–æ–¥: `product.price = 99.9`, –∞ ORM –Ω–∞ –ª–µ—Ç—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–æ –≤ SQL-–∫–æ–º–∞–Ω–¥—É: `UPDATE products SET price = 99.9 WHERE id = 1`, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤ Python-–æ–±—ä–µ–∫—Ç—ã.
******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–æ–ª—å ORM:

```mermaid
sequenceDiagram
    participant Python –ö–æ–¥ üêç
    participant SQLAlchemy ORM üîÑ
    participant PostgreSQL üêò
    
    Python –ö–æ–¥->>SQLAlchemy ORM: product.price = 99.9
    SQLAlchemy ORM->>PostgreSQL: UPDATE products SET price = 99.9 WHERE id = 1
    PostgreSQL-->>SQLAlchemy ORM: OK (1 row affected)
    SQLAlchemy ORM-->>Python –ö–æ–¥: –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
    
    Python –ö–æ–¥->>SQLAlchemy ORM: db.query(Product).all()
    SQLAlchemy ORM->>PostgreSQL: SELECT * FROM products
    PostgreSQL-->>SQLAlchemy ORM: –°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
    SQLAlchemy ORM-->>Python –ö–æ–¥: [Product(id=1, ...), Product(id=2, ...)]
```

**[–¢–ï–ö–°–¢]** –ö—Ä–∞—Ç–∫–æ —É–ø–æ–º—è–Ω–∏—Ç–µ –¥–≤–µ —á–∞—Å—Ç–∏ SQLAlchemy, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

**SQLAlchemy Core** ‚Äî "–¥–≤–∏–∂–æ–∫" –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∏–∞–ª–µ–∫—Ç–∞–º–∏ SQL (PostgreSQL, MySQL, SQLite –∏ –¥—Ä.)

**SQLAlchemy ORM** ‚Äî "—Å–ª–æ–≤–∞—Ä—å" –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞—à–∏ Python-–∫–ª–∞—Å—Å—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é SQLAlchemy**, –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤—è–∑–∫–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–∏—Ä–æ–¥–æ–π FastAPI. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

******

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚öôÔ∏è

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SQLAlchemy –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL:
>
>```
>pip install sqlalchemy asyncpg
>```
>
>–ì–¥–µ `asyncpg` ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL.

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–∞—Ä–æ–ª–∏, –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤) **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—à–∏—Ç—ã –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
******
**[–ö–û–î: app/config.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```python
# app/config.py

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
# –§–æ—Ä–º–∞—Ç: postgresql+asyncpg://<user>:<password>@<host>:<port>/<dbname>
DATABASE_URL = "postgresql+asyncpg://postgres:mysecretpassword@localhost:5432/store_db"

# –í production —ç—Ç—É —Å—Ç—Ä–æ–∫—É –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:
# import os
# DATABASE_URL = os.getenv("DATABASE_URL")
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

- `postgresql+asyncpg://` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º PostgreSQL —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä asyncpg
- `postgres:mysecretpassword` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å
- `localhost:5432` ‚Äî –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ë–î
- `store_db` ‚Äî –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**[–ö–û–î: app/database.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î:

```python
# app/database.py
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker
from .config import DATABASE_URL

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π "–¥–≤–∏–∂–æ–∫" –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
engine = create_async_engine(
    DATABASE_URL,
    echo=True  # –í—ã–≤–æ–¥–∏—Ç—å –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Å–æ–ª—å (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
)

# –°–æ–∑–¥–∞–µ–º "—Ñ–∞–±—Ä–∏–∫—É", –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Å–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
async_session_factory = async_sessionmaker(
    engine,
    expire_on_commit=False  # –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –ø–æ—Å–ª–µ commit
)
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã:

**`engine`** ‚Äî –≥–ª–∞–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ —Å –ë–î. –ü–∞—Ä–∞–º–µ—Ç—Ä `echo=True` –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –æ–Ω –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQLAlchemy. –¢–∞–∫ –≤—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º".

**`async_session_factory`** ‚Äî —ç—Ç–æ –Ω–µ —Å–∞–º–∞ —Å–µ—Å—Å–∏—è, –∞ "—Å—Ç–∞–Ω–æ–∫", –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ –Ω–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É. –ö–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∏—Ç —Å–≤–æ—é –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.

******

### 4. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π FastAPI (`Depends`) üîó

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –Ω–∞–º –Ω—É–∂–µ–Ω **–æ–¥–∏–Ω** —Å–µ–∞–Ω—Å —Ä–∞–±–æ—Ç—ã —Å –ë–î. –ï–≥–æ –Ω—É–∂–Ω–æ:

1. –û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–ü–∏—Å–∞—Ç—å —ç—Ç—É –ª–æ–≥–∏–∫—É –≤ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ ‚Äî –¥–æ–ª–≥–æ, —Å–∫—É—á–Ω–æ –∏ –ª–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è (–∑–∞–±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é). –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ—à–µ–Ω–∏–µ: –º—ã –Ω–∞–ø–∏—à–µ–º –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏, –∞ FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Dependency Injection (–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)**.

**[–ö–û–î: app/database.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

```python
# app/database.py
# ... –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥ ...

async def get_db_session():
    """
    –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–π –ë–î.
    FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
    """
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π —Ñ–∞–±—Ä–∏–∫–∏
    async with async_session_factory() as session:
        try:
            yield session  # "–ü–µ—Ä–µ–¥–∞–µ–º" —Å–µ—Å—Å–∏—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç
        finally:
            # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            await session.close()
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `yield`:

1. –ö–æ–¥ **–¥–æ** `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** –≤—ã–∑–æ–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
2. `yield session` "–ø–µ—Ä–µ–¥–∞–µ—Ç" —Å–µ—Å—Å–∏—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
3. –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É —Å —Å–µ—Å—Å–∏–µ–π
4. –ö–æ–¥ –≤ –±–ª–æ–∫–µ `finally` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏ –ë–î:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant get_db_session() üîó
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç üìç
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: HTTP –∑–∞–ø—Ä–æ—Å
    FastAPI->>get_db_session(): –í—ã–∑–æ–≤ (–∫–æ–¥ –¥–æ yield)
    get_db_session()->>get_db_session(): –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    get_db_session()->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: yield session
    
    –≠–Ω–¥–ø–æ–∏–Ω—Ç->>PostgreSQL: SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é
    PostgreSQL-->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
    
    –≠–Ω–¥–ø–æ–∏–Ω—Ç-->>get_db_session(): –í–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    get_db_session()->>get_db_session(): finally: –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é
    get_db_session()-->>FastAPI: –ó–∞–≤–µ—Ä—à–µ–Ω–æ
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: HTTP –æ—Ç–≤–µ—Ç
```

**[–ö–û–î: app/routers/products.py]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```python
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.database import get_db_session  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

router = APIRouter()

@router.get("/")
async def get_all_products(db: AsyncSession = Depends(get_db_session)):
    """
    –í–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `db` —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–æ—Ç–æ–≤–∞—è –∫ —Ä–∞–±–æ—Ç–µ —Å–µ—Å—Å–∏—è –ë–î!
    FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    1. –í—ã–∑–≤–∞–ª get_db_session()
    2. –ü–æ–ª—É—á–∏–ª —Å–µ—Å—Å–∏—é
    3. –ü–µ—Ä–µ–¥–∞–ª –µ–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä db
    4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã–ª —Å–µ—Å—Å–∏—é
    """
    return {"message": "–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏ –ë–î!", "db": str(type(db))}
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –º–∞–≥–∏—é `Depends`: —ç—Ç–∞ –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ `db: AsyncSession = Depends(get_db_session)` –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ç—è–∂–µ–ª—É—é —Ä–∞–±–æ—Ç—É –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ). –ü—Ä–æ–ø–∏—à–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `DATABASE_URL`. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `/products/` –≤—ã:
>
>1. –ù–µ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
>2. –í–∏–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ SQL-–ª–æ–≥–∏ –æ—Ç `echo=True`
>
>–≠—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –Ω–∞—Å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É, –≥–¥–µ –º—ã –±—É–¥–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –Ω–∏—Ö –¥–∞–Ω–Ω—ã–µ.

******

## –£—Ä–æ–∫ 4: –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–∞–∑–µ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ üîó

### 1. –û—Ç Pydantic-—Å—Ö–µ–º –∫ SQLAlchemy-–º–æ–¥–µ–ª—è–º üîÄ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é:

**Pydantic-—Å—Ö–µ–º–∞** ‚Äî —ç—Ç–æ **—Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è** –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ API. –û–Ω–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ "—Ç–æ–≤–∞—Ä—ã" (–¥–∞–Ω–Ω—ã–µ) –∏ –≤ –∫–∞–∫–æ–º –≤–∏–¥–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ—á—å –≥—Ä–∞–Ω–∏—Ü—É: –≤–æ–π—Ç–∏ –≤ –∑–∞–ø—Ä–æ—Å (request) –∏–ª–∏ –≤—ã–π—Ç–∏ –≤ –æ—Ç–≤–µ—Ç–µ (response).

**SQLAlchemy-–º–æ–¥–µ–ª—å** ‚Äî —ç—Ç–æ **—á–µ—Ä—Ç–µ–∂ —Å–∫–ª–∞–¥–∞** (—Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î), –≥–¥–µ —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è. –ß–µ—Ä—Ç–µ–∂ –æ–ø–∏—Å—ã–≤–∞–µ—Ç "—Å—Ç–µ–ª–ª–∞–∂–∏" (–∫–æ–ª–æ–Ω–∫–∏), –∏—Ö —Ç–∏–ø, —Ä–∞–∑–º–µ—Ä –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.

–û–Ω–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –Ω–æ —Å–ª—É–∂–∞—Ç —Ä–∞–∑–Ω—ã–º —Ü–µ–ª—è–º –∏ –∂–∏–≤—É—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö "—É—Ä–æ–≤–Ω—è—Ö" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant Pydantic Schema üìã
    participant FastAPI Logic üíº
    participant SQLAlchemy Model üóÑÔ∏è
    participant PostgreSQL üêò
    
    Note over –ö–ª–∏–µ–Ω—Ç,Pydantic Schema: –ì—Ä–∞–Ω–∏—Ü–∞ API
    –ö–ª–∏–µ–Ω—Ç->>Pydantic Schema: JSON –¥–∞–Ω–Ω—ã–µ
    Pydantic Schema->>FastAPI Logic: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Python –æ–±—ä–µ–∫—Ç
    
    Note over FastAPI Logic,SQLAlchemy Model: –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
    FastAPI Logic->>SQLAlchemy Model: –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –∏–∑ —Å—Ö–µ–º—ã
    
    Note over SQLAlchemy Model,PostgreSQL: –°–ª–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    SQLAlchemy Model->>PostgreSQL: INSERT INTO products ...
    PostgreSQL-->>SQLAlchemy Model: OK
    SQLAlchemy Model-->>Pydantic Schema: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
    Pydantic Schema-->>–ö–ª–∏–µ–Ω—Ç: JSON –æ—Ç–≤–µ—Ç
```

******
**[–ö–û–î: app/models.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è "—á–µ—Ä—Ç–µ–∂–µ–π —Å–∫–ª–∞–¥–∞" (—Ç–∞–±–ª–∏—Ü –ë–î):

```python
# app/models.py
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column
from sqlalchemy import String, Text

# –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –±—É–¥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è
class Base(DeclarativeBase):
    pass

# SQLAlchemy-–º–æ–¥–µ–ª—å –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "products"
class Product(Base):
    __tablename__ = "products"  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º Mapped
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)  # NULL —Ä–∞–∑—Ä–µ—à–µ–Ω
    price: Mapped[float]
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É SQLAlchemy-–º–æ–¥–µ–ª–∏:

```mermaid
classDiagram
    class Base {
        <<DeclarativeBase>>
        +metadata
    }
    
    class Product {
        +int id [PK]
        +str name [indexed]
        +str|None description
        +float price
    }
    
    Base <|-- Product : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
    
    note for Product "–¢–∞–±–ª–∏—Ü–∞: products\n–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á: id\n–ò–Ω–¥–µ–∫—Å: name"
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç:

- `Base` ‚Äî –æ–±—â–∏–π "—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç" –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π. –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- `__tablename__ = "products"` ‚Äî –ø—Ä—è–º–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `Mapped[int]` ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQLAlchemy –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤. –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ Python
- `mapped_column(primary_key=True)` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á)
- `mapped_column(String(100), index=True)` ‚Äî —Å—Ç—Ä–æ–∫–∞ –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤ —Å –∏–Ω–¥–µ–∫—Å–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- `mapped_column(Text)` ‚Äî –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- `Mapped[str | None]` ‚Äî –ø–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `NULL` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

******

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü üèóÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: –Ω–∞—à–∏ –º–æ–¥–µ–ª–∏ –≤ `models.py` ‚Äî —ç—Ç–æ –ø–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ Python-–∫–æ–¥. –ù–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ —ç—Ç–∏–º "—á–µ—Ä—Ç–µ–∂–∞–º" –ø–æ—Å—Ç—Ä–æ–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ "—Å–∫–ª–∞–¥—ã" (—Ç–∞–±–ª–∏—Ü—ã) –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

**[–ö–û–î: create_tables.py]** –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```python
# create_tables.py
import asyncio
from app.database import engine
from app.models import Base

async def create_db_and_tables():
    """
    –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π SQLAlchemy.
    –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã!
    """
    async with engine.begin() as conn:
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —á–∏—Å—Ç–æ—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞)
        await conn.run_sync(Base.metadata.drop_all)
        print("–°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã.")
        
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç Base
        await conn.run_sync(Base.metadata.create_all)
        print("–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã.")

if __name__ == "__main__":
    asyncio.run(create_db_and_tables())
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É:

- `Base.metadata.drop_all` ‚Äî —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
- `Base.metadata.create_all` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –º–æ–¥–µ–ª—è–º
- `run_sync` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**[–î–ï–ú–û]** –ü–æ—à–∞–≥–æ–≤–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ pgAdmin:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: `python create_tables.py`
2. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin (–∏–ª–∏ –¥—Ä—É–≥–æ–π GUI-–∫–ª–∏–µ–Ω—Ç –¥–ª—è PostgreSQL)
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `store_db`
4. –í –¥–µ—Ä–µ–≤–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞—Å–∫—Ä–æ–π—Ç–µ: Databases ‚Üí store_db ‚Üí Schemas ‚Üí public ‚Üí Tables
5. **–ü–æ–∫–∞–∂–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `products`** —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
   - `id` (integer, PRIMARY KEY)
   - `name` (character varying(100), —Å –∏–Ω–¥–µ–∫—Å–æ–º)
   - `description` (text, nullable)
   - `price` (double precision)

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: —Å—Ç—É–¥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–≤–æ–∏–º–∏ –≥–ª–∞–∑–∞–º–∏ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ Python-–∫–æ–¥ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

******

### 3. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º CRUD —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy üîÑ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å: –≤—ã–±—Ä–æ—Å–∏—Ç—å "in-memory" —Å–ø–∏—Å–æ–∫ –∏–∑ `app/routers/products.py` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ SQLAlchemy.

**[–ö–û–î: app/routers/products.py]** –û–±–Ω–æ–≤–∏—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —É–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î:

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from typing import List

from app.database import get_db_session
from app.models import Product as ProductModel
from app.schemas import Product as ProductSchema, ProductCreate

router = APIRouter()

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ø–∏—Å–æ–∫ db_products - –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Create (POST /)**:

```python
@router.post("/", response_model=ProductSchema, status_code=201)
async def create_product(
    product_data: ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ PostgreSQL.
    """
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä SQLAlchemy-–º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ Pydantic-—Å—Ö–µ–º—ã
    new_product = ProductModel(**product_data.model_dump())
    
    db.add(new_product)        # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Å—Å–∏—é (–ø–æ–º–µ—Ç–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
    await db.commit()          # –§–∏–∫—Å–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (—Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
    await db.refresh(new_product)  # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î (–ø–æ–ª—É—á–∞–µ–º ID)
    
    return new_product
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏:

1. `db.add()` ‚Äî –ø–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞ –≤ –ø–∞–º—è—Ç–∏)
2. `await db.commit()` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
3. `await db.refresh()` ‚Äî –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ë–î (–≤–∞–∂–Ω–æ –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π)

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Read All (GET /)**:

```python
@router.get("/", response_model=List[ProductSchema])
async def get_all_products(db: AsyncSession = Depends(get_db_session)):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
    # –°–æ–∑–¥–∞–µ–º SQL-–∑–∞–ø—Ä–æ—Å: SELECT * FROM products
    query = select(ProductModel)
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    result = await db.execute(query)
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –º–æ–¥–µ–ª–∏ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    products = result.scalars().all()
    
    return products
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Read One (GET /{product_id})**:

```python
@router.get("/{product_id}", response_model=ProductSchema)
async def get_product(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø–æ ID —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–∫–∏."""
    # –£–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ primary key
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(
            status_code=404,
            detail=f"–¢–æ–≤–∞—Ä —Å ID {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
        )
    
    return product
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Update (PUT /{product_id})**:

```python
@router.put("/{product_id}", response_model=ProductSchema)
async def update_product(
    product_id: int,
    updated_data: ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä."""
    # –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –∏–∑ Pydantic-—Å—Ö–µ–º—ã
    for key, value in updated_data.model_dump().items():
        setattr(product, key, value)
    
    await db.commit()
    await db.refresh(product)
    
    return product
```

******
**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Delete (DELETE /{product_id})**:

```python
@router.delete("/{product_id}", status_code=204)
async def delete_product(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    await db.delete(product)
    await db.commit()
    
    return None  # 204 No Content
```

**[–î–ï–ú–û]** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ Swagger UI:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ `POST /products/`
2. –ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ `GET /products/` ‚Äî –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
4. –°–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ ‚Äî **—Ç–æ–≤–∞—Ä –æ—Å—Ç–∞–ª—Å—è!** –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ –ë–î

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–ª–∏ CRUD —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π –Ω–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–∏ `Category`. –ê —Ç–∞–∫–∂–µ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–ª `category_id` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑—ã–≤–∞–ª –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π.

******

### 4. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: –û—Ç–Ω–æ—à–µ–Ω–∏—è (Relationships) üîó

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: —Ç–æ–≤–∞—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –≤–∞–∫—É—É–º–µ, –æ–Ω–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º. –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å "–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É" (many-to-one).

**[–¢–ï–ö–°–¢]** –†–∞–∑–±–µ—Ä–∏—Ç–µ –¥–≤–∞ —É—Ä–æ–≤–Ω—è —Å–≤—è–∑–∏:

**ForeignKey (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)** ‚Äî —ç—Ç–æ –∫–∞–∫ "–∑–∞–ø–∏—Å–∞—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —Ü–µ–Ω–Ω–∏–∫–µ —Ç–æ–≤–∞—Ä–∞". –≠—Ç–æ —Å–≤—è–∑—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

**relationship** ‚Äî —ç—Ç–æ "–º–∞–≥–∏—è" SQLAlchemy, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç, –∏–º–µ—è –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞, –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É –æ–±—ä–µ–∫—Ç—É —Å–≤—è–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`my_product.category.name`), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫ –µ—ë ID.

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å Category –∏ —Å–≤—è–∑–∏:

```python
# app/models.py
from sqlalchemy import ForeignKey, String, Text
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column, relationship

class Base(DeclarativeBase):
    pass

class Category(Base):
    """–ú–æ–¥–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤."""
    __tablename__ = "categories"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(50), unique=True)
    description: Mapped[str | None] = mapped_column(Text)
    
    # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã
    products: Mapped[list["Product"]] = relationship(
        back_populates="category",
        cascade="all, delete-orphan"  # –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
    )

class Product(Base):
    """–ú–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    __tablename__ = "products"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)
    price: Mapped[float]
    
    # –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á - —Å—Å—ã–ª–∫–∞ –Ω–∞ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    category_id: Mapped[int | None] = mapped_column(ForeignKey("categories.id"))
    
    # –°–≤—è–∑—å: –∏–∑ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    category: Mapped["Category"] = relationship(back_populates="products")
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤—è–∑—å –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏:

```mermaid
classDiagram
    class Category {
        +int id [PK]
        +str name [unique]
        +str|None description
        +List~Product~ products
    }
    
    class Product {
        +int id [PK]
        +str name [indexed]
        +str|None description
        +float price
        +int|None category_id [FK]
        +Category category
    }
    
    Category "1" --> "0..*" Product : –∏–º–µ–µ—Ç —Ç–æ–≤–∞—Ä—ã
    Product "0..*" --> "0..1" Category : –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    
    note for Product "ForeignKey: category_id ‚Üí categories.id"
    note for Category "Cascade: delete-orphan"
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `ForeignKey("categories.id")` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ë–î: —ç—Ç–æ –ø–æ–ª–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `id` –≤ —Ç–∞–±–ª–∏—Ü–µ `categories`
- `relationship(back_populates="...")` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ Python-–∫–æ–¥–µ
- `cascade="all, delete-orphan"` ‚Äî –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã

**[–î–ï–ú–û]** –ü–æ–∫–∞–∂–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≤ –∫–æ–¥–µ:

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è relationship
async def demo_relationships(db: AsyncSession):
    # –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –µ—ë —Ç–æ–≤–∞—Ä–∞–º–∏
    category = await db.get(Category, 1)
    
    # –õ–µ–≥–∫–æ –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    for product in category.products:
        print(f"–¢–æ–≤–∞—Ä: {product.name}, –¶–µ–Ω–∞: {product.price}")
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä —Å –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
    product = await db.get(Product, 1)
    
    # –õ–µ–≥–∫–æ –ø–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞
    if product.category:
        print(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞: {product.category.name}")
```

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–æ–± —ç—Ç–æ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ) –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ `create_tables.py`.

******

## –£—Ä–æ–∫ 5: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —Å Alembic üì¶

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ üèõÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø **"–†–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏" (Separation of Concerns)**:

–†–æ—É—Ç–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –∫–∞–∫ –ø–∏—Å–∞—Ç—å –≤ –ë–î ‚Äî –µ–≥–æ –∑–∞–¥–∞—á–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ, –ø—Ä–æ—â–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

**[–¢–ï–ö–°–¢]** –ü–æ–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

```
/my_project
‚îú‚îÄ‚îÄ /app
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (DATABASE_URL –∏ —Ç.–¥.)
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models.py        # SQLAlchemy-–º–æ–¥–µ–ª–∏ (—Å–ª–æ–π –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py       # Pydantic-—Å—Ö–µ–º—ã (—Å–ª–æ–π API)
‚îÇ   ‚îú‚îÄ‚îÄ crud.py          # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (—Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º)
‚îÇ   ‚îî‚îÄ‚îÄ /routers
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ products.py  # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ categories.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îî‚îÄ‚îÄ create_tables.py
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:

- **models.py** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –ë–î (—á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è)
- **schemas.py** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö API (—á—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è)
- **crud.py** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (–∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏)
- **routers/** ‚Äî —Å–æ–¥–µ—Ä–∂–∞—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ HTTP)

******
**[–ö–û–î: app/schemas.py]** –°–æ–∑–¥–∞–π—Ç–µ Pydantic-—Å—Ö–µ–º—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:

```python
# app/schemas.py
from pydantic import BaseModel
from typing import Optional

# –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å –æ–±—â–∏–º–∏ –ø–æ–ª—è–º–∏
class ProductBase(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    category_id: Optional[int] = None

# –°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (–±–µ–∑ ID)
class ProductCreate(ProductBase):
    pass

# –°—Ö–µ–º–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã)
class ProductUpdate(BaseModel):
    name: Optional[str] = None
    description: Optional[str] = None
    price: Optional[float] = None
    category_id: Optional[int] = None

# –°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î (—Å ID –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π ORM)
class Product(ProductBase):
    id: int
    
    class Config:
        from_attributes = True  # –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ SQLAlchemy-–º–æ–¥–µ–ª–∏
```

**[–ö–û–î: app/crud.py]** –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º:

```python
# app/crud.py
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from typing import List, Optional

from . import models, schemas

# ============= CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ =============

async def get_product(db: AsyncSession, product_id: int) -> Optional[models.Product]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID."""
    return await db.get(models.Product, product_id)

async def get_products(
    db: AsyncSession,
    skip: int = 0,
    limit: int = 100
) -> List[models.Product]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π."""
    query = select(models.Product).offset(skip).limit(limit)
    result = await db.execute(query)
    return result.scalars().all()

async def create_product(
    db: AsyncSession,
    product: schemas.ProductCreate
) -> models.Product:
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä."""
    db_product = models.Product(**product.model_dump())
    db.add(db_product)
    await db.commit()
    await db.refresh(db_product)
    return db_product

async def update_product(
    db: AsyncSession,
    product_id: int,
    product_update: schemas.ProductUpdate
) -> Optional[models.Product]:
    """–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    db_product = await db.get(models.Product, product_id)
    if not db_product:
        return None
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    update_data = product_update.model_dump(exclude_unset=True)
    for key, value in update_data.items():
        setattr(db_product, key, value)
    
    await db.commit()
    await db.refresh(db_product)
    return db_product

async def delete_product(db: AsyncSession, product_id: int) -> bool:
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω."""
    db_product = await db.get(models.Product, product_id)
    if not db_product:
        return False
    
    await db.delete(db_product)
    await db.commit()
    return True
```

**[–ö–û–î: app/routers/products.py]** –û—á–∏—Å—Ç–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä ‚Äî —Ç–µ–ø–µ—Ä—å –æ–Ω –æ—á–µ–Ω—å "—Ç–æ–Ω–∫–∏–π":

```python
# app/routers/products.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from typing import List

from .. import crud, schemas
from ..database import get_db_session

router = APIRouter()

@router.post("/", response_model=schemas.Product, status_code=status.HTTP_201_CREATED)
async def create_product_endpoint(
    product: schemas.ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä."""
    return await crud.create_product(db=db, product=product)

@router.get("/", response_model=List[schemas.Product])
async def get_products_endpoint(
    skip: int = 0,
    limit: int = 100,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤."""
    return await crud.get_products(db=db, skip=skip, limit=limit)

@router.get("/{product_id}", response_model=schemas.Product)
async def get_product_endpoint(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID."""
    product = await crud.get_product(db=db, product_id=product_id)
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return product

@router.put("/{product_id}", response_model=schemas.Product)
async def update_product_endpoint(
    product_id: int,
    product_update: schemas.ProductUpdate,
    db: AsyncSession = Depends(get_db_session)
):
    """–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    updated_product = await crud.update_product(
        db=db, product_id=product_id, product_update=product_update
    )
    if not updated_product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return updated_product

@router.delete("/{product_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_product_endpoint(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    deleted = await crud.delete_product(db=db, product_id=product_id)
    if not deleted:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return None
```

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

- –†–æ—É—Ç–µ—Ä —Å—Ç–∞–ª –ø—Ä–æ—Å—Ç—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º
- –õ–æ–≥–∏–∫—É –ë–î –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω–µ —Ç—Ä–æ–≥–∞—è API
- –ö–æ–¥ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é CRUD –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)

******

### 2. –ü—Ä–æ–±–ª–µ–º–∞: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å? ü§î

**[–¢–ï–ö–°–¢]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

"–ó–∞–∫–∞–∑—á–∏–∫ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã —É –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –±—ã–ª —Ñ–ª–∞–≥ `is_active`, —á—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã —Å —Å–∞–π—Ç–∞, –Ω–µ —É–¥–∞–ª—è—è –∏—Ö –∏–∑ –±–∞–∑—ã. –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `products` –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É `is_active` —Ç–∏–ø–∞ `boolean`."

**[–¢–ï–ö–°–¢]** –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∞—É–¥–∏—Ç–æ—Ä–∏–∏: "–ú—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `models.py`. –ù–æ —á—Ç–æ –¥–∞–ª—å—à–µ?"

**[–¢–ï–ö–°–¢]** –ü–æ–∫–∞–∂–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

–ï—Å–ª–∏ –º—ã —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç `create_tables.py`, –æ–Ω –≤—ã–∑–æ–≤–µ—Ç `drop_all` –∏ **—Å–æ—Ç—Ä–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –±–∞–∑—É**! –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ ‚Äî –º—ã –ø–æ—Ç–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.

**[–¢–ï–ö–°–¢]** –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –Ω–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± **–∏–∑–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö**.

******

### 3. –†–µ—à–µ–Ω–∏–µ: Alembic ‚Äî Git –¥–ª—è –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö üìú

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é —Å Git:

Alembic –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ Git –¥–ª—è –∫–æ–¥–∞. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –ë–î –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

**[–¢–ï–ö–°–¢]** –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø—Ä—è–º—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏:

| Git | Alembic | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|---------|----------|
| `git commit` | `alembic revision` | –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ |
| `git push` | `alembic upgrade` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ë–î |
| `git log` | `alembic history` | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π |
| `git checkout <hash>` | `alembic downgrade <hash>` | –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã |

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Alembic üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Alembic –≤ –≤–∞—à–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
>
>```bash
>pip install alembic
>```

**[–¢–ï–ö–°–¢]** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Alembic –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```bash
alembic init alembic
```

**[–¢–ï–ö–°–¢]** –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç:

- –ü–∞–ø–∫—É `alembic/` —Å —Ñ–∞–π–ª–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- –§–∞–π–ª `alembic.ini` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ü—Ä–æ–≤–æ–¥–∏–º –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é üéØ

**[–¢–ï–ö–°–¢]** –®–∞–≥ 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

**[–ö–û–î: alembic.ini]** –ù–∞–π–¥–∏—Ç–µ –∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É —Å `sqlalchemy.url`:

```ini
# alembic.ini

# ...

# sqlalchemy.url = driver://user:pass@localhost/dbname
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É - –±—É–¥–µ–º –±—Ä–∞—Ç—å URL –∏–∑ config.py
```

******
**[–ö–û–î: alembic/env.py]** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```python
# alembic/env.py
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
from app.models import Base
from app.config import DATABASE_URL

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
config = context.config

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–∞—à–µ–≥–æ config.py
config.set_main_option("sqlalchemy.url", DATABASE_URL)

# –£–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π –∫–∞–∫ —Ü–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
target_metadata = Base.metadata

# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
```

**[–¢–ï–ö–°–¢]** –®–∞–≥ 2: –ò–∑–º–µ–Ω—è–µ–º –º–æ–¥–µ–ª—å ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ.

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `is_active` –≤ –º–æ–¥–µ–ª—å `Product`:

```python
class Product(Base):
    __tablename__ = "products"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)
    price: Mapped[float]
    category_id: Mapped[int | None] = mapped_column(ForeignKey("categories.id"))
    
    # –ù–æ–≤–æ–µ –ø–æ–ª–µ!
    is_active: Mapped[bool] = mapped_column(server_default="true")
    
    category: Mapped["Category"] = relationship(back_populates="products")
```

******
**[–¢–ï–ö–°–¢]** –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

```bash
alembic revision --autogenerate -m "Add is_active field to Product"
```

**[–¢–ï–ö–°–¢]** Alembic —Å—Ä–∞–≤–Ω–∏—Ç –≤–∞—à–∏ –º–æ–¥–µ–ª–∏ Python —Å —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `alembic/versions/`. –û–Ω –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∏–º—è –≤—Ä–æ–¥–µ `xxxx_add_is_active_field_to_product.py`.

**[–ö–û–î: alembic/versions/xxxx_add_is_active.py]** –ü–æ–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞:

```python
"""Add is_active field to Product

Revision ID: abc123def456
Revises: prev_revision_id
Create Date: 2025-10-01 12:00:00.000000

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision = 'abc123def456'
down_revision = 'prev_revision_id'  # –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–∏–≥—Ä–∞—Ü–∏—é
branch_labels = None
depends_on = None

def upgrade():
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ë–î."""
    # Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —ç—Ç–æ—Ç –∫–æ–¥!
    op.add_column('products', sa.Column('is_active', sa.Boolean(), 
                  server_default='true', nullable=False))

def downgrade():
    """–û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)."""
    op.drop_column('products', 'is_active')
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

- `upgrade()` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É)
- `downgrade()` ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (—É–¥–∞–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É)
- `revision` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- `down_revision` ‚Äî ID –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ–±—Ä–∞–∑—É–µ—Ç—Å—è —Ü–µ–ø–æ—á–∫–∞)

**[–¢–ï–ö–°–¢]** –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

```bash
alembic upgrade head
```

******
**[–¢–ï–ö–°–¢]** –ö–æ–º–∞–Ω–¥–∞ `upgrade head` –æ–∑–Ω–∞—á–∞–µ—Ç: "–ø—Ä–∏–º–µ–Ω–∏ –≤—Å–µ –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ —Å–∞–º–æ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π".

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ pgAdmin:

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ç–∞–±–ª–∏—Ü–µ `products`
3. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ `is_active` —Ç–∏–ø–∞ `boolean`
4. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –∏ —É –Ω–∏—Ö `is_active = true`

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –º–∞–≥–∏—é: –º—ã –∏–∑–º–µ–Ω–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –µ–¥–∏–Ω–æ–π –∑–∞–ø–∏—Å–∏!

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞–∑–∞–¥
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade <revision_id>
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–æ—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ —Å–≤–æ–π –∫–æ–¥ –ø–æ –Ω–æ–≤–æ–º—É –æ–±—Ä–∞–∑—Ü—É (schemas.py, crud.py, models.py). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥–µ–ª—å `Category` –Ω–æ–≤–æ–µ –ø–æ–ª–µ `description: Mapped[str | None]` –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤ –∏ –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–≤–æ—é –ø–µ—Ä–≤—É—é Alembic-–º–∏–≥—Ä–∞—Ü–∏—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ pgAdmin.

******

## –£—Ä–æ–∫ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React –∏ CORS üåê

### 1. –î–≤–∞ —Å–µ—Ä–≤–µ—Ä–∞: –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ üé≠

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 (–ë—ç–∫–µ–Ω–¥ FastAPI):**

```bash
cd path/to/fastapi_project
uvicorn app.main:app --reload
```

–ü–æ–∫–∞–∂–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://127.0.0.1:8000/docs` ‚Äî API —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–§—Ä–æ–Ω—Ç–µ–Ω–¥ React):**

```bash
cd path/to/react_project
npm run dev
```

–ü–æ–∫–∞–∂–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:5173` ‚Äî —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

**[–¢–ï–ö–°–¢]** –ß–µ—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ü–µ–ª—å:

"–°–µ–π—á–∞—Å –Ω–∞—à React-—Å–∞–π—Ç –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞ `data.ts`. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ —Å–µ—Ç–∏, –¥–µ–ª–∞—è —Ä–µ–∞–ª—å–Ω—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É Python-—Å–µ—Ä–≤–µ—Ä—É –Ω–∞ –ø–æ—Ä—Ç—É 8000."

******

### 2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø–µ—Ä–≤–∞—è –æ—à–∏–±–∫–∞: CORS üö´

**[–ö–û–î: src/components/ProductsPage.tsx]** –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å API:

```tsx
// src/components/ProductsPage.tsx
import { useState, useEffect } from 'react';
import { ProductCard } from './ProductCard';
import { Product } from '../types';

// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç
// import { products } from '../data/products';

export function ProductsPage() {
  const [products, setProducts] = useState<Product[]>([]);  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [searchQuery, setSearchQuery] = useState('');
  
  useEffect(() => {
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –±—ç–∫–µ–Ω–¥–∞
    const fetchProducts = async () => {
      console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –±—ç–∫–µ–Ω–¥–∞...');
      
      try {
        const response = await fetch('http://127.0.0.1:8000/products');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        setProducts(data);
        console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', data);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        setError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã');
      } finally {
        setLoading(false);
      }
    };
    
    fetchProducts();
  }, []);  // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —Ö—É–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  
  if (loading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>;
  if (error) return <div>–û—à–∏–±–∫–∞: {error}</div>;
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) ...
}
```

******
**[–î–ï–ú–û]** –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏ CORS:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`http://localhost:5173`)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
4. **–ü–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞, —Ç–æ–≤–∞—Ä—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - –í –∫–æ–Ω—Å–æ–ª–∏ **–∫—Ä–∞—Å–Ω–∞—è –æ—à–∏–±–∫–∞**:

```
Access to fetch at 'http://127.0.0.1:8000/products' from origin 'http://localhost:5173' 
has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present 
on the requested resource.
```

**[–¢–ï–ö–°–¢]** –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –º–æ–º–µ–Ω—Ç: "–í–æ—Ç –æ–Ω–∞ ‚Äî –∑–Ω–∞–º–µ–Ω–∏—Ç–∞—è –æ—à–∏–±–∫–∞ CORS, —Å –∫–æ—Ç–æ—Ä–æ–π —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫."

******

### 3. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ CORS: "–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞" üîí

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é —Å –±–∞–Ω–∫–æ–º:

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –±–∞–Ω–∫–∞ `mybank.com`. –ó–∞—Ç–µ–º –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∞–π—Ç `evil.com`.

–ë–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏ CORS, JavaScript-–∫–æ–¥ —Å —Å–∞–π—Ç–∞ `evil.com` –º–æ–≥ –±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ `mybank.com/api/transfer?to=hacker&amount=1000`.

–í–∞—à –±—Ä–∞—É–∑–µ—Ä, –≤–∏–¥—è, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –≤ –±–∞–Ω–∫–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–ª–æ–∂–∏–ª –±—ã –∫ —ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—É –≤–∞—à–∏ cookies (—Å–µ—Å—Å–∏—é), –∏ –¥–µ–Ω—å–≥–∏ –±—ã —É—à–ª–∏!

**–ü–æ–ª–∏—Ç–∏–∫–∞ CORS –∑–∞–ø—Ä–µ—â–∞–µ—Ç —ç—Ç–æ.** –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç `evil.com` –∫ `mybank.com` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—É—Ç—å:

–î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö (`localhost:5173` –∏ `localhost:8000`) ‚Äî —ç—Ç–æ **—Ä–∞–∑–Ω—ã–µ "–∏—Å—Ç–æ—á–Ω–∏–∫–∏" (origins)**.

**Origin** = –ø—Ä–æ—Ç–æ–∫–æ–ª + –¥–æ–º–µ–Ω + –ø–æ—Ä—Ç:

- `http://localhost:5173` ‚Äî –æ–¥–∏–Ω origin
- `http://localhost:8000` ‚Äî –¥—Ä—É–≥–æ–π origin

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ origins –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**[–¢–ï–ö–°–¢]** –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏:

–ß—Ç–æ–±—ã –Ω–∞—à "—Ö–æ—Ä–æ—à–∏–π" –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª, **—Å–µ—Ä–≤–µ—Ä** `:8000` –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Å–∫–∞–∑–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä—É:

"–Ø —Ä–∞–∑—Ä–µ—à–∞—é –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç `:5173`, –µ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å."

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏.

******

### 4. –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `CORSMiddleware` –≤ FastAPI ‚úÖ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é Middleware:

**Middleware** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π "–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç" –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—É—Ç–∏ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –∏ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø—É—Ç–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É.

`CORSMiddleware` –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ –æ—Ç–≤–µ—Ç–∞–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (`Access-Control-Allow-Origin` –∏ –¥—Ä.), –∫–æ—Ç–æ—Ä—ã–µ –∏ —è–≤–ª—è—é—Ç—Å—è "—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º" –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞.

**[–ö–û–î: app/main.py]** –î–æ–±–∞–≤—å—Ç–µ CORS middleware:

```python
# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware  # 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º

from .routers import products, categories

app = FastAPI(
    title="Store API",
    description="API –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞",
    version="1.0.0"
)

# 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
origins = [
    "http://localhost:5173",      # React dev server (Vite)
    "http://localhost:3000",      # React dev server (Create React App)
    "http://127.0.0.1:5173",
    # –í production –∑–¥–µ—Å—å –±—É–¥–µ—Ç –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    # "https://mystore.com",
]

# 3. –î–æ–±–∞–≤–ª—è–µ–º Middleware –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,           # –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —ç—Ç–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    allow_credentials=True,          # –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É cookies
    allow_methods=["*"],             # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã (GET, POST, PUT, DELETE –∏ —Ç.–¥.)
    allow_headers=["*"],             # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
app.include_router(products.router, prefix="/products", tags=["Products"])
app.include_router(categories.router, prefix="/categories", tags=["Categories"])

@app.get("/")
async def root():
    return {"message": "Welcome to Store API"}
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `allow_origins` ‚Äî **–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**. –í production –¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `allow_credentials=True` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É cookies –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `allow_methods=["*"]` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ HTTP-–º–µ—Ç–æ–¥—ã. –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å: `["GET", "POST"]`
- `allow_headers=["*"]` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏. –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏

>[!warning]
>
>#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Production üîê
>
>–í production **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `allow_origins=["*"]` ‚Äî —ç—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ! –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã.

******

### 5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –û–∂–∏–≤–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ üéâ

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã":

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `uvicorn` –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `main.py` (–µ—Å–ª–∏ `--reload` –≤–∫–ª—é—á–µ–Ω)
2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤–æ –≤–∫–ª–∞–¥–∫—É —Å React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
3. **–ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)**

**[–î–ï–ú–û]** –ü–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. **–í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
   - –û—à–∏–±–∫–∞ CORS –∏—Å—á–µ–∑–ª–∞ ‚úÖ
   - –ü–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!` —Å –º–∞—Å—Å–∏–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤

2. **–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:**
   - –ü–æ—è–≤–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–º–∫–Ω—É–ª—Å—è: `PostgreSQL ‚Üí SQLAlchemy ‚Üí FastAPI ‚Üí HTTP ‚Üí React ‚Üí DOM`

******
**[–î–ï–ú–û]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ Swagger UI (`http://127.0.0.1:8000/docs`)
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è! –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –∂–∏–≤—É—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∞–¥–µ–∂–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, API –∑–∞—â–∏—â–µ–Ω–æ —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π, –∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–û–∂–∏–≤–∏–ª–∏ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–∞ (`ProductDetailPage.tsx`).
>
>–í–∞–º –Ω—É–∂–Ω–æ:
>
>1. –ü–æ–ª—É—á–∏—Ç—å ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ URL —Å –ø–æ–º–æ—â—å—é —Ö—É–∫–∞ `useParams` –∏–∑ `react-router-dom`
>2. –°–¥–µ–ª–∞—Ç—å `fetch`-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /products/{id}`
>3. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–æ–≤–∞—Ä–µ
>4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ—à–∏–±–∫–∞ 404)

******

## –£—Ä–æ–∫ 7: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π üîê

### 1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" üë§

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å User:

```python
# app/models.py
from sqlalchemy import Boolean, String
from sqlalchemy.orm import Mapped, mapped_column

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ ...

class User(Base):
    """–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º—ã."""
    __tablename__ = "users"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    email: Mapped[str] = mapped_column(String(150), unique=True, index=True)
    hashed_password: Mapped[str] = mapped_column(String(255))
    is_active: Mapped[bool] = mapped_column(default=True)
    is_superuser: Mapped[bool] = mapped_column(default=False)
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

**`email`** ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ª–æ–≥–∏–Ω. `unique=True` ‚Äî —ç—Ç–æ constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ–∑–¥–∞—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º email.

**`hashed_password`** ‚Äî –ø–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–µ—Å—å –ø–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, —Ç–æ–ª—å–∫–æ –µ–≥–æ —Ö—ç—à.

**`is_active`** ‚Äî —Ñ–ª–∞–≥ –¥–ª—è "–º—è–≥–∫–æ–≥–æ" —É–¥–∞–ª–µ–Ω–∏—è (ban) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –ë–î.

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "Create users table"
alembic upgrade head
```

******

### 2. "–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ! ‚ö†Ô∏è

**[–¢–ï–ö–°–¢]** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é —Å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π:

–•—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å PIN-–∫–æ–¥ –º–∞—Ä–∫–µ—Ä–æ–º –ø—Ä—è–º–æ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–µ.

–ï—Å–ª–∏ –≤–æ—Ä —É–∫—Ä–∞–¥–µ—Ç –∫–æ—à–µ–ª–µ–∫ (—Ö–∞–∫–µ—Ä –≤–∑–ª–æ–º–∞–µ—Ç –ë–î), –æ–Ω –ø–æ–ª—É—á–∏—Ç —Å—Ä–∞–∑—É –≤—Å—ë: –∫–∞—Ä—Ç—É —Å PIN-–∫–æ–¥–æ–º.

–ù–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –¥–∞–∂–µ —É–∫—Ä–∞–≤ "–∫–∞—Ä—Ç—É" (–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö), –≤–æ—Ä –Ω–µ —Å–º–æ–≥ —É–∑–Ω–∞—Ç—å "PIN-–∫–æ–¥" (–ø–∞—Ä–æ–ª—å).

**[–¢–ï–ö–°–¢]** –û–ø–∏—à–∏—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏ –ø–∞—Ä–æ–ª–µ–π:

1. **–ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö** ‚Äî –ª—é–¥–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –≤–µ–∑–¥–µ
2. **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** ‚Äî –≤–æ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞ –æ –∑–∞—â–∏—Ç–µ –¥–∞–Ω–Ω—ã—Ö (GDPR –∏ –¥—Ä.)
3. **–†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –¥–æ–≤–µ—Ä—è—Ç—å –≤–∞—à–µ–º—É —Å–µ—Ä–≤–∏—Å—É
4. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É–±—ã—Ç–∫–∏** ‚Äî —à—Ç—Ä–∞—Ñ—ã –∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–º

**[–¢–ï–ö–°–¢]** –í—ã–≤–æ–¥: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞, —ç—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

******

### 3. –†–µ—à–µ–Ω–∏–µ: –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å `passlib` üîê

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–ú—è—Å–æ—Ä—É–±–∫–∞":

–•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –º—è—Å–æ—Ä—É–±–∫–∞:

- –í—ã –∫–ª–∞–¥–µ—Ç–µ –∫—É—Å–æ–∫ –º—è—Å–∞ (–ø–∞—Ä–æ–ª—å) ‚Üí –ø–æ–ª—É—á–∞–µ—Ç–µ —Ñ–∞—Ä—à (—Ö—ç—à)
- –í—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞—Å—É–Ω—É—Ç—å —Ñ–∞—Ä—à –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫—É—Å–æ–∫ –º—è—Å–∞
- –≠—Ç–æ **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è** –æ–ø–µ—Ä–∞—Ü–∏—è

–î–∞–∂–µ –∑–Ω–∞—è —Ö—ç—à, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø–∞—Ä–æ–ª—å.

**[–¢–ï–ö–°–¢]** –ö–∞–∫ —Ç–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –≤—Ö–æ–¥–µ?

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –º—ã –Ω–µ "—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º" —Ö—ç—à. –ú—ã:

1. –ë–µ—Ä–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–∞—Ä–æ–ª—å
2. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ —Ç—É –∂–µ "–º—è—Å–æ—Ä—É–±–∫—É" (—Ö—ç—à–∏—Ä—É–µ–º)
3. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–≤–∞ —Ö—ç—à–∞**

–ï—Å–ª–∏ —Ö—ç—à–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π!

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ passlib üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
>
>```bash
>pip install "passlib[bcrypt]"
>```
>
>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º **bcrypt** ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –Ω–∞–¥–µ–∂–Ω—ã—Ö –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.

**[–ö–û–î: app/security.py]** –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é:

```python
# app/security.py
from passlib.context import CryptContext

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏
# schemes=["bcrypt"] - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º bcrypt
# deprecated="auto" - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ö–µ–º—ã
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å —Ö—ç—à—É.
    
    Args:
        plain_password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
        hashed_password: –•—ç—à –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    
    Returns:
        True –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π, False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î.
    
    Args:
        password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
    
    Returns:
        –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ö—ç—à –ø–∞—Ä–æ–ª—è
    """
    return pwd_context.hash(password)
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ `passlib` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –î–æ–±–∞–≤–ª—è–µ—Ç "—Å–æ–ª—å" (salt) ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –∏–º–µ–ª–∏ —Ä–∞–∑–Ω—ã–µ —Ö—ç—à–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—É–Ω–¥—ã —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute-force –∞—Ç–∞–∫
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑—É–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ üìù

**[–ö–û–î: app/schemas.py]** –î–æ–±–∞–≤—å—Ç–µ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
# app/schemas.py
from pydantic import BaseModel, EmailStr

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class UserBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    email: EmailStr  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email

class UserCreate(UserBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –ø–∞—Ä–æ–ª–µ–º)."""
    password: str

class User(UserBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è!)."""
    id: int
    is_active: bool
    
    class Config:
        from_attributes = True
```

**[–¢–ï–ö–°–¢]** –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Å—Ö–µ–º–µ `User` (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ API) **–Ω–µ—Ç –ø–æ–ª—è password**! –ú—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∏–ª–∏ –µ–≥–æ —Ö—ç—à –∫–ª–∏–µ–Ω—Ç—É.

**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```python
# app/crud.py
from sqlalchemy import select
from . import models, schemas, security

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

# ============= CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π =============

async def get_user_by_email(
    db: AsyncSession,
    email: str
) -> Optional[models.User]:
    """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email."""
    query = select(models.User).where(models.User.email == email)
    result = await db.execute(query)
    return result.scalar_one_or_none()

async def create_user(
    db: AsyncSession,
    user: schemas.UserCreate
) -> models.User:
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –í–ê–ñ–ù–û: –ü–∞—Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è!
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    existing_user = await get_user_by_email(db, user.email)
    if existing_user:
        from fastapi import HTTPException
        raise HTTPException(
            status_code=400,
            detail="Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
        )
    
    # –•—ç—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    hashed_password = security.get_password_hash(user.password)
    
    # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
    db_user = models.User(
        email=user.email,
        hashed_password=hashed_password
    )
    
    db.add(db_user)
    await db.commit()
    await db.refresh(db_user)
    
    return db_user
```

******
**[–ö–û–î: app/routers/users.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```python
# app/routers/users.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from .. import crud, schemas
from ..database import get_db_session

router = APIRouter()

@router.post(
    "/",
    response_model=schemas.User,
    status_code=status.HTTP_201_CREATED,
    summary="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
)
async def register_user(
    user_data: schemas.UserCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    - **email**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - **password**: –ü–∞—Ä–æ–ª—å (–±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è).
    """
    return await crud.create_user(db=db, user=user_data)
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä:

```python
# app/main.py
from .routers import products, categories, users  # –î–æ–±–∞–≤–∏–ª–∏ users

# ...

app.include_router(users.router, prefix="/users", tags=["Users"])
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant Pydantic üîç
    participant CRUD üíº
    participant Security üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /users/ + {email, password}
    FastAPI->>Pydantic: –í–∞–ª–∏–¥–∞—Ü–∏—è UserCreate
    Pydantic->>FastAPI: ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    
    FastAPI->>CRUD: create_user(user_data)
    CRUD->>PostgreSQL: SELECT WHERE email = ?
    PostgreSQL-->>CRUD: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
    
    CRUD->>Security: get_password_hash(password)
    Security-->>CRUD: $2b$12$hashed...
    
    CRUD->>PostgreSQL: INSERT (email, hashed_password)
    PostgreSQL-->>CRUD: User created (id=1)
    
    CRUD-->>FastAPI: User object
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 201 Created + {id, email, is_active}
```

******
**[–î–ï–ú–û]** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /users/`
3. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

   ```json
   {
     "email": "test@example.com",
     "password": "mysecretpassword123"
   }
   ```

4. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç `201 Created`:

   ```json
   {
     "id": 1,
     "email": "test@example.com",
     "is_active": true
   }
   ```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin** –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `users`
6. **–ü–æ–∫–∞–∂–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É `hashed_password`** ‚Äî —Ç–∞–º –¥–ª–∏–Ω–Ω–∞—è "–∞–±—Ä–∞–∫–∞–¥–∞–±—Ä–∞", –∞ –Ω–µ –≤–∞—à –ø–∞—Ä–æ–ª—å!

–ü—Ä–∏–º–µ—Ä —Ö—ç—à–∞: `$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5GyYzS7OQ/Tay`

**[–¢–ï–ö–°–¢]** –≠—Ç–æ –∏ –µ—Å—Ç—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –ø–∞—Ä–æ–ª—å –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω!

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –±—ç–∫–µ–Ω–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ñ–æ—Ä–º–æ–π (–ø–æ–ª—è email –∏ password) –∏ "–ø–æ–¥–∫–ª—é—á–∏—Ç—å" –µ–µ –∫ –Ω–∞—à–µ–º—É –Ω–æ–≤–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `POST /users/`.
>
>–û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ (email —É–∂–µ –∑–∞–Ω—è—Ç, —Å–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å –∏ —Ç.–¥.)

******

## –£—Ä–æ–∫ 8: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ JWT-—Ç–æ–∫–µ–Ω—ã üé´

### 1. –ü—Ä–æ–±–ª–µ–º–∞: HTTP "–±–µ–∑ –ø–∞–º—è—Ç–∏" ü§∑

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å –∞–Ω–∞–ª–æ–≥–∏–∏ "–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –≤ –∞–≤—Ç–æ–±—É—Å–µ":

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ HTTP ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä —Å –∞–º–Ω–µ–∑–∏–µ–π. –í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –∞–≤—Ç–æ–±—É—Å, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ –µ–º—É –±–∏–ª–µ—Ç (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å). –û–Ω –≤–∞—Å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç.

–ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –≤–∞–º —Å–Ω–æ–≤–∞ –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∏–ª–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–∞—Å –Ω–µ –ø–æ–º–Ω–∏—Ç!

–ù–æ—Å–∏—Ç—å —Å —Å–æ–±–æ–π –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–∏–ª–µ—Ç (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ) ‚Äî –Ω–µ—É–¥–æ–±–Ω–æ –∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ.

–ì–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ –ø–æ–ª—É—á–∏—Ç—å —É –≤–æ–¥–∏—Ç–µ–ª—è **"–ø—Ä–æ–µ–∑–¥–Ω–æ–π"** (—Ç–æ–∫–µ–Ω), –∫–æ—Ç–æ—Ä—ã–π:

- –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤—Å—é –ø–æ–µ–∑–¥–∫—É (—Å–µ—Å—Å–∏—é)
- –õ–µ–≥–∫–æ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
- –ú–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å, –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω

**[–¢–ï–ö–°–¢]** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:

–ù–∞–º –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –∫–ª–∏–µ–Ω—Ç—É (React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º **–±—ã—Å—Ç—Ä–æ –¥–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—É**, —á—Ç–æ –æ–Ω —É–∂–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏.
******
**[–¢–ï–ö–°–¢]** –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ä–∞–∑–Ω—ã–µ:

1. **Cookies + Sessions** ‚Äî —Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏, –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie
2. **OAuth 2.0** ‚Äî —Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ (Google, Facebook login)
3. **JWT (JSON Web Tokens)** ‚Äî —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–Ω—É—Ç—Ä–∏

–ú—ã –≤—ã–±–µ—Ä–µ–º **JWT** –∏–∑-–∑–∞ –µ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SPA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

**[–¢–ï–ö–°–¢]** –î–µ—Ç–∞–ª—å–Ω–æ —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø—Ä–æ JWT:

**JWT (JSON Web Token)** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞. –¢–æ–∫–µ–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏:

```
eyJhbGci.eyJzdWIi.SflKxwRJ
Header.Payload.Signature
```

- **Header** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ —Ç–æ–∫–µ–Ω–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **Payload** ‚Äî –¥–∞–Ω–Ω—ã–µ (–∫—Ç–æ —ç—Ç–æ, –∫–æ–≥–¥–∞ –≤—ã–¥–∞–Ω, –∫–æ–≥–¥–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç)
- **Signature** ‚Äî —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

******

### 2. –†–µ—à–µ–Ω–∏–µ: JWT-—Ç–æ–∫–µ–Ω—ã üîë

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–¶–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫":

JWT ‚Äî —ç—Ç–æ –∫–∞–∫ **–ø—Ä–æ–ø—É—Å–∫ —Å –≥–æ–ª–æ–≥—Ä–∞–º–º–æ–π**:

**Payload (–î–∞–Ω–Ω—ã–µ)** ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ:

- `sub: 'user@example.com'` ‚Äî —Å—É–±—ä–µ–∫—Ç (–∫–æ–º—É –≤—ã–¥–∞–Ω)
- `exp: 1678886400` ‚Äî expiration (–¥–æ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω)
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä–æ–ª–∏, –∏–º—è –∏ —Ç.–¥.)

**Signature (–ü–æ–¥–ø–∏—Å—å)** ‚Äî —ç—Ç–æ "–≥–æ–ª–æ–≥—Ä–∞–º–º–∞" –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ:

- –°–æ–∑–¥–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É —Å–µ—Ä–≤–µ—Ä–∞
- –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤–ø–∏—Å–∞—Ç—å –≤ –Ω–µ–≥–æ —á—É–∂–æ–µ –∏–º—è, –≥–æ–ª–æ–≥—Ä–∞–º–º–∞ –ø–æ–≤—Ä–µ–¥–∏—Ç—Å—è
- –û—Ö—Ä–∞–Ω–∞ (—Å–µ—Ä–≤–µ—Ä) —ç—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT:
>
>```bash
>pip install python-jose[cryptography] python-multipart
>```
>
>- `python-jose` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
>- `python-multipart` ‚Äî –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML-—Ñ–æ—Ä–º (–Ω—É–∂–Ω–æ –¥–ª—è OAuth2PasswordRequestForm)

**[–ö–û–î: app/config.py]** –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è JWT:

```python
# app/config.py
import os

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
DATABASE_URL = "postgresql+asyncpg://postgres:mysecretpassword@localhost:5432/store_db"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ JWT
# –í–ê–ñ–ù–û: –í production SECRET_KEY –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π: openssl rand -hex 32
SECRET_KEY = os.getenv("SECRET_KEY", "your_super_secret_key_change_this_in_production")
ALGORITHM = "HS256"  # –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞
ACCESS_TOKEN_EXPIRE_MINUTES = 30  # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

`SECRET_KEY` ‚Äî —ç—Ç–æ **—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Å–µ–∫—Ä–µ—Ç** –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! –° –µ–≥–æ –ø–æ–º–æ—â—å—é –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ç–æ–∫–µ–Ω—ã. –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ—Ç –∫–ª—é—á, –æ–Ω —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –æ—Ç –∏–º–µ–Ω–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–í production:

1. –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
2. –•—Ä–∞–Ω–∏—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ Git

**[–ö–û–î: app/security.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è JWT:

```python
# app/security.py
from datetime import datetime, timedelta, timezone
from jose import jwt
from passlib.context import CryptContext

from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å pwd_context ...

def create_access_token(data: dict, expires_delta: timedelta | None = None) -> str:
    """
    –°–æ–∑–¥–∞—Ç—å JWT access token.
    
    Args:
        data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Ç–æ–∫–µ–Ω (–æ–±—ã—á–Ω–æ {"sub": email})
        expires_delta: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ None, —Ç–æ 15 –º–∏–Ω—É—Ç)
    
    Returns:
        JWT —Ç–æ–∫–µ–Ω –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
    """
    to_encode = data.copy()
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
    if expires_delta:
        expire = datetime.now(timezone.utc) + expires_delta
    else:
        expire = datetime.now(timezone.utc) + timedelta(minutes=15)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–∞
    to_encode.update({"exp": expire})
    
    # –ö–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω —Å –Ω–∞—à–∏–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    
    return encoded_jwt
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `data` ‚Äî –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç `{"sub": "user@example.com"}`, –≥–¥–µ `sub` (subject) ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ JWT –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `exp` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ JWT –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è. JWT –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- `jwt.encode()` ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω, –ø–æ–¥–ø–∏—Å—ã–≤–∞—è –µ–≥–æ –Ω–∞—à–∏–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º

******

### 3. –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∏ `OAuth2PasswordRequestForm` üìã

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é:

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –º–µ—Ö–∞–Ω–∏–∑–º **OAuth2PasswordRequestForm**.

–≠—Ç–æ –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π OAuth2, –∞ –µ–≥–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –ª–æ–≥–∏–Ω–∞ –ø–æ username/password.

–§–æ—Ä–º–∞ –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç `POST`-–∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `x-www-form-urlencoded` (–∫–∞–∫ –æ–±—ã—á–Ω–∞—è HTML-—Ñ–æ—Ä–º–∞), —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –¥–≤–∞ –ø–æ–ª—è:

- `username` ‚Äî –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ email
- `password` ‚Äî –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/crud.py
from typing import Optional
from . import security

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

async def authenticate_user(
    db: AsyncSession,
    email: str,
    password: str
) -> Optional[models.User]:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    Args:
        db: –°–µ—Å—Å–∏—è –ë–î
        email: Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
    
    Returns:
        User –µ—Å–ª–∏ credentials –≤–µ—Ä–Ω—ã–µ, None –µ—Å–ª–∏ –Ω–µ—Ç
    """
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
    user = await get_user_by_email(db, email=email)
    
    if not user:
        return None
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    if not security.verify_password(password, user.hashed_password):
        return None
    
    return user
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ª–æ–≥–∏–∫—É:

1. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ `verify_password`
4. –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`
5. –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ª–æ–≥–∏–Ω–∞ üö™

**[–ö–û–î: app/schemas.py]** –î–æ–±–∞–≤—å—Ç–µ —Å—Ö–µ–º—É –¥–ª—è —Ç–æ–∫–µ–Ω–∞:

```python
# app/schemas.py

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class Token(BaseModel):
    """–°—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏."""
    access_token: str
    token_type: str

class TokenData(BaseModel):
    """–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–∫–µ–Ω–∞."""
    email: str | None = None
```

**[–ö–û–î: app/routers/auth.py]** –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/routers/auth.py
from datetime import timedelta
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, security
from app.database import get_db_session
from app.config import ACCESS_TOKEN_EXPIRE_MINUTES

router = APIRouter()

@router.post("/token", response_model=schemas.Token)
async def login_for_access_token(
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ (–ª–æ–≥–∏–Ω).
    
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç credentials —á–µ—Ä–µ–∑ OAuth2PasswordRequestForm:
    - username: email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - password: –ø–∞—Ä–æ–ª—å
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT access token.
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º credentials (form_data.username —Å–æ–¥–µ—Ä–∂–∏—Ç email)
    user = await crud.authenticate_user(
        db,
        email=form_data.username,
        password=form_data.password
    )
    
    if not user:
        # –ï—Å–ª–∏ credentials –Ω–µ–≤–µ—Ä–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 401 Unauthorized
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    # –°–æ–∑–¥–∞–µ–º access token
    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    access_token = security.create_access_token(
        data={"sub": user.email},  # sub - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
        expires_delta=access_token_expires
    )
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    return {
        "access_token": access_token,
        "token_type": "bearer"  # –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç OAuth2)
    }
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- `OAuth2PasswordRequestForm` ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å FastAPI, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç —Ñ–æ—Ä–º—É
- `form_data.username` ‚Äî –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É OAuth2 —ç—Ç–æ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `username`, –Ω–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è email
- `headers={"WWW-Authenticate": "Bearer"}` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `token_type: "bearer"` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ –≤ OAuth2

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/main.py
from .routers import products, categories, users, auth  # –î–æ–±–∞–≤–∏–ª–∏ auth

# ...

app.include_router(auth.router, tags=["Authentication"])
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏–Ω–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant OAuth2Form üìã
    participant CRUD üíº
    participant Security üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /token + {username, password}
    FastAPI->>OAuth2Form: –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º—ã
    OAuth2Form->>FastAPI: ‚úÖ –§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞
    
    FastAPI->>CRUD: authenticate_user(email, password)
    CRUD->>PostgreSQL: SELECT WHERE email = ?
    PostgreSQL-->>CRUD: User found
    
    CRUD->>Security: verify_password(plain, hashed)
    Security-->>CRUD: ‚úÖ Password correct
    CRUD-->>FastAPI: User object
    
    FastAPI->>Security: create_access_token({sub: email})
    Security->>Security: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Å –ø–æ–¥–ø–∏—Å—å—é
    Security-->>FastAPI: eyJhbGci...
    
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + {access_token, token_type: "bearer"}
```

**[–î–ï–ú–û]** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /token`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –í–≤–µ–¥–∏—Ç–µ credentials –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - `username`: `test@example.com` (—Ö–æ—Ç—è –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è username, –≤–≤–æ–¥–∏–º email)
   - `password`: `mysecretpassword123`
5. –ù–∞–∂–º–∏—Ç–µ "Execute"
6. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç:

   ```json
   {
     "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjoxNzI4MDQ2NDAwfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
     "token_type": "bearer"
   }
   ```

******
**[–î–ï–ú–û]** –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç ‚Äî –∫–Ω–æ–ø–∫–∞ Authorize:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`
2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Swagger UI –Ω–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** (–∑–∞–º–æ—á–µ–∫)
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ
5. –ù–∞–∂–º–∏—Ç–µ "Authorize" –∏ "Close"

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

–¢–µ–ø–µ—Ä—å Swagger –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º.

–≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ç–æ, –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ú—ã –Ω–∞—É—á–∏–ª–∏ –±—ç–∫–µ–Ω–¥ –≤—ã–¥–∞–≤–∞—Ç—å "–ø—Ä–æ–ø—É—Å–∫–∞" (JWT —Ç–æ–∫–µ–Ω—ã). –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞.
>
>–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/token`, –≤—ã –¥–æ–ª–∂–Ω—ã:
>
>1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token` –≤ `localStorage` –±—Ä–∞—É–∑–µ—Ä–∞
>2. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
>3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å logout (–æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage)

******

## –£—Ä–æ–∫ 9: –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ —Å JWT üîí

### 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã üö¶

**[–¢–ï–ö–°–¢]** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é "–ù–æ—á–Ω–æ–π –∫–ª—É–±":

–ù–∞—à API ‚Äî —ç—Ç–æ –Ω–æ—á–Ω–æ–π –∫–ª—É–±. –í –Ω–µ–º –µ—Å—Ç—å –¥–≤–µ –∑–æ–Ω—ã:

**–û–±—â–∏–π –∑–∞–ª** (–ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã):

- –í—Ö–æ–¥ —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö
- `GET /products` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã
- `POST /users` ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
- `POST /token` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω (–∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è)

**VIP-–∑–æ–Ω–∞** (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã):

- –í—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –±—Ä–∞—Å–ª–µ—Ç–∞–º (JWT —Ç–æ–∫–µ–Ω–∞–º)
- `GET /users/me` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–µ–±–µ
- `POST /orders` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `GET /cart` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ—é –∫–æ—Ä–∑–∏–Ω—É

–°–µ–≥–æ–¥–Ω—è –º—ã —Å—Ç–∞–≤–∏–º –Ω–∞ –≤—Ö–æ–¥–µ –≤ VIP-–∑–æ–Ω—É **"–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞"**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ –±—Ä–∞—Å–ª–µ—Ç—ã.

**[–¢–ï–ö–°–¢]** –¶–µ–ª—å —É—Ä–æ–∫–∞:

–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ("–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞"), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ª–µ–≥–∫–æ "–ø–æ—Å—Ç–∞–≤–∏—Ç—å" –ø–µ—Ä–µ–¥ –ª—é–±—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–æ–π –∫–æ–¥–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º.

******

### 2. –°—Ö–µ–º–∞ `OAuth2PasswordBearer` üì±

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é:

`OAuth2PasswordBearer` ‚Äî —ç—Ç–æ –Ω–µ —Å–∞–º "–æ—Ö—Ä–∞–Ω–Ω–∏–∫", –∞ –µ–≥–æ –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî **—Å–∫–∞–Ω–µ—Ä –±—Ä–∞—Å–ª–µ—Ç–æ–≤**.

–≠—Ç–æ—Ç –∫–ª–∞—Å—Å-–ø–æ–º–æ—â–Ω–∏–∫ —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –≤–µ—â—å: –∏—Å–∫–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö HTTP-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª–µ `Authorization` –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ—Ç—Ç—É–¥–∞ —Ç–æ–∫–µ–Ω.

–§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞: `Authorization: Bearer eyJhbGci...`

–ï—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ç–æ–∫–µ–Ω, –æ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å –æ—à–∏–±–∫–æ–π `401 Unauthorized`.
******
**[–ö–û–î: app/security.py]** –°–æ–∑–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä "—Å–∫–∞–Ω–µ—Ä–∞":

```python
# app/security.py
from fastapi.security import OAuth2PasswordBearer
from datetime import datetime, timedelta, timezone
from jose import jwt
from passlib.context import CryptContext

from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

# –°–æ–∑–¥–∞–µ–º "—Å–∫–∞–Ω–µ—Ä" —Ç–æ–∫–µ–Ω–æ–≤
# tokenUrl —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/token")
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `tokenUrl`:

`tokenUrl="/token"` ‚Äî —ç—Ç–æ –Ω–µ URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞, –∞ URL, –≥–¥–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç **–ø–æ–ª—É—á–∏—Ç—å** —Ç–æ–∫–µ–Ω (–Ω–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç –ª–æ–≥–∏–Ω–∞).

Swagger UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Authorize".

******

### 3. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ üîç

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É "—É–º–Ω–æ–≥–æ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞":

–ù–∞—à "–æ—Ö—Ä–∞–Ω–Ω–∏–∫" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–º–Ω—ã–º. –ü–æ–ª—É—á–∏–≤ —Ç–æ–∫–µ–Ω –æ—Ç "—Å–∫–∞–Ω–µ—Ä–∞", –æ–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

1. **–≠—Ç–æ –Ω–µ –ø–æ–¥–¥–µ–ª–∫–∞?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å
2. **–û–Ω –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `exp`
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ –ë–î

–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**[–ö–û–î: app/security.py]** –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å "–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞":

```python
# app/security.py
from fastapi import Depends, HTTPException, status
from jose import JWTError, jwt
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas
from app.database import get_db_session
from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

async def get_current_user(
    token: str = Depends(oauth2_scheme),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞.
    
    –≠—Ç–æ dependency, –∫–æ—Ç–æ—Ä–∞—è:
    1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
    2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
    3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç email –∏–∑ —Ç–æ–∫–µ–Ω–∞
    4. –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç User
    
    –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç 401 Unauthorized.
    """
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –æ—à–∏–±–∫–∏
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    
    try:
        # 1. –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
        # jose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (exp)
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        
        # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º email –∏–∑ –ø–æ–ª—è "sub" (subject)
        email: str = payload.get("sub")
        
        if email is None:
            raise credentials_exception
        
        # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–æ–∫–µ–Ω–∞
        token_data = schemas.TokenData(email=email)
        
    except JWTError:
        # –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω –∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
        raise credentials_exception
    
    # 3. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    user = await crud.get_user_by_email(db, email=token_data.email)
    
    if user is None:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª —É–¥–∞–ª–µ–Ω –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞
        raise credentials_exception
    
    # 4. –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    return user
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π —à–∞–≥:

**–®–∞–≥ 1: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî `jwt.decode()` –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏ –≤–µ—â–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (–Ω–µ –±—ã–ª –ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–¥–¥–µ–ª–∞–Ω)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `exp` (–Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (payload)

**–®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∏–∑ –ø–æ–ª—è `sub` –ø–æ–ª—É—á–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î** ‚Äî –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞

**–®–∞–≥ 4: –í–æ–∑–≤—Ä–∞—Ç** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç `User` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant oauth2_scheme üì±
    participant get_current_user üîç
    participant jose (JWT) üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: GET /users/me + Header: Authorization
    FastAPI->>oauth2_scheme: –ò–∑–≤–ª–µ—á—å —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    
    alt –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω ‚úÖ
        oauth2_scheme->>get_current_user: token = "eyJhbGci..."
        
        get_current_user->>jose (JWT): –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
        
        alt –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω ‚úÖ
            jose (JWT)-->>get_current_user: {sub: "user@example.com", exp: ...}
            get_current_user->>PostgreSQL: SELECT WHERE email = ?
            PostgreSQL-->>get_current_user: User found
            get_current_user-->>FastAPI: User object
            FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + –¥–∞–Ω–Ω—ã–µ
        else –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω ‚ùå
            jose (JWT)-->>get_current_user: JWTError
            get_current_user-->>FastAPI: HTTPException 401
            FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 401 Unauthorized
        end
        
    else –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω ‚ùå
        oauth2_scheme-->>FastAPI: HTTPException 401
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 401 Unauthorized
    end
```

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –∑–∞—â–∏—â–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç üõ°Ô∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ:

–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ª—é–±–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `Depends(get_current_user)`. –í—Å—è —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**[–ö–û–î: app/routers/users.py]** –°–æ–∑–¥–∞–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/me`:

```python
# app/routers/users.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, models, security
from app.database import get_db_session

router = APIRouter()

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ...

@router.get("/me", response_model=schemas.User)
async def read_users_me(
    current_user: models.User = Depends(security.get_current_user)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ó–ê–©–ò–©–ï–ù - —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω.
    –ï—Å–ª–∏ –∫–æ–¥ –¥–æ—à–µ–ª –¥–æ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏, –∑–Ω–∞—á–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.
    """
    # –í –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π current_user –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    return current_user
```

**[–¢–ï–ö–°–¢]** –°–¥–µ–ª–∞–π—Ç–µ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–µ:

–û–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ `current_user: models.User = Depends(security.get_current_user)` –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ä–∞–±–æ—Ç—É:

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
3. –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
4. –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é

–ï—Å–ª–∏ –ª—é–±–∞—è –∏–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –¥–∞–∂–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `401 Unauthorized`.

**[–î–ï–ú–û]** –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ Swagger UI:

**–ü–æ–ø—ã—Ç–∫–∞ 1: –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–ø–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **–ù–ï** –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã (–∫–Ω–æ–ø–∫–∞ "Authorize" –Ω–µ –∑–µ–ª–µ–Ω–∞—è)
3. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /users/me`
4. –ù–∞–∂–º–∏—Ç–µ "Try it out" ‚Üí "Execute"
5. **–ü–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É:**

   ```json
   {
     "detail": "Not authenticated"
   }
   ```

   –°—Ç–∞—Ç—É—Å: `401 Unauthorized`

**–ü–æ–ø—ã—Ç–∫–∞ 2: –° —Ç–æ–∫–µ–Ω–æ–º (–ø–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—Ö)**

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å —á–µ—Ä–µ–∑ `POST /token`:
   - username: `test@example.com`
   - password: `mysecretpassword123`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω
5. –ù–∞–∂–º–∏—Ç–µ "Authorize" ‚Üí "Close"
6. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ `GET /users/me`
7. –ù–∞–∂–º–∏—Ç–µ "Execute"
8. **–ü–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

   ```json
   {
     "id": 1,
     "email": "test@example.com",
     "is_active": true
   }
   ```

   –°—Ç–∞—Ç—É—Å: `200 OK`

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

Swagger —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>` –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º. –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç, –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–æ–∫–µ–Ω–æ–º.

**[–¢–ï–ö–°–¢]** –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å –ª—é–±–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä:

```python
async def my_protected_endpoint(
    current_user: models.User = Depends(security.get_current_user)
):
    # –≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # –í current_user –±—É–¥–µ—Ç –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    pass
```

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:

```python
async def get_current_active_user(
    current_user: models.User = Depends(get_current_user)
):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω."""
    if not current_user.is_active:
        raise HTTPException(status_code=400, detail="Inactive user")
    return current_user

async def get_current_superuser(
    current_user: models.User = Depends(get_current_user)
):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä."""
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=403,
            detail="The user doesn't have enough privileges"
        )
    return current_user
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö:

```python
@router.delete("/{product_id}")
async def delete_product_admin_only(
    product_id: int,
    current_user: models.User = Depends(get_current_superuser),  # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã!
    db: AsyncSession = Depends(get_db_session)
):
    # –≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    pass
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∑–∞—â–∏—â–∞—Ç—å –±—ç–∫–µ–Ω–¥. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ "–ø—Ä–µ–¥—ä—è–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—Å–∫".
>
>–í React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `ProfilePage.tsx`:
>
>1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ `localStorage`
>2. –°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `GET /users/me`
>3. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <token>`
>4. –û—Ç–æ–±—Ä–∞–∑–∏—Ç–µ email –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
>5. –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (–æ—à–∏–±–∫–∞ 401) ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞

******

## –£—Ä–æ–∫ 10: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ üõí

### 1. –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ? ü§î

**[–¢–ï–ö–°–¢]** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è:

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `src/hooks/useCart.tsx` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º, —á—Ç–æ –≤—Å—è –ª–æ–≥–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ `useState`. –°–æ—Å—Ç–æ—è–Ω–∏–µ `items` —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º:

**–°—Ü–µ–Ω–∞—Ä–∏–π –ê: –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏**

1. –û—Ç–∫—Ä–æ–π—Ç–µ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Chrome
2. –î–æ–±–∞–≤—å—Ç–µ 2-3 —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Firefox (–∏–ª–∏ —Ä–µ–∂–∏–º–µ "–∏–Ω–∫–æ–≥–Ω–∏—Ç–æ")
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!

**–í—ã–≤–æ–¥:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–∞–º–∏/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

**–°—Ü–µ–Ω–∞—Ä–∏–π –ë: –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö**

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Storage
3. –û—á–∏—Å—Ç–∏—Ç–µ localStorage –∏ sessionStorage
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!

**–í—ã–≤–æ–¥:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –ª–µ–≥–∫–æ —Ç–µ—Ä—è–µ—Ç—Å—è.

**[–¢–ï–ö–°–¢]** –ò—Ç–æ–≥ –∏ —Ä–µ—à–µ–Ω–∏–µ:

–î–ª—è —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ e-commerce –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

- –•—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–≤—è–∑—ã–≤–∞—Ç—å –µ—ë —Å —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

******

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã üìê

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:

–ù—É–∂–Ω–æ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è:

- –û–¥–∏–Ω **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (`User`) –∏–º–µ–µ—Ç –æ–¥–Ω—É **–ö–æ—Ä–∑–∏–Ω—É** (`Cart`) ‚Äî —Å–≤—è–∑—å "–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É"
- –û–¥–Ω–∞ **–ö–æ—Ä–∑–∏–Ω–∞** (`Cart`) –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ **–ü–æ–∑–∏—Ü–∏–π** (`CartItem`) ‚Äî —Å–≤—è–∑—å "–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º"
- –ö–∞–∂–¥–∞—è **–ü–æ–∑–∏—Ü–∏—è** (`CartItem`) —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω **–¢–æ–≤–∞—Ä** (`Product`) –∏ —Ö—Ä–∞–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/models.py
from sqlalchemy import ForeignKey, Integer
from sqlalchemy.orm import relationship, Mapped, mapped_column

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ ...

class Cart(Base):
    """–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    __tablename__ = "carts"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    user_id: Mapped[int] = mapped_column(ForeignKey("users.id"), unique=True)
    
    # –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É" —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    user: Mapped["User"] = relationship("User", back_populates="cart")
    
    # –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º" —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    items: Mapped[list["CartItem"]] = relationship(
        "CartItem",
        back_populates="cart",
        cascade="all, delete-orphan"  # –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    )

class CartItem(Base):
    """–ü–æ–∑–∏—Ü–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ (—Ç–æ–≤–∞—Ä + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)."""
    __tablename__ = "cart_items"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    cart_id: Mapped[int] = mapped_column(ForeignKey("carts.id"))
    product_id: Mapped[int] = mapped_column(ForeignKey("products.id"))
    quantity: Mapped[int] = mapped_column(default=1)
    
    # –°–≤—è–∑–∏
    cart: Mapped["Cart"] = relationship("Cart", back_populates="items")
    product: Mapped["Product"] = relationship("Product")

# –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –≤ –º–æ–¥–µ–ª—å User
class User(Base):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    
    # –°–≤—è–∑—å —Å –∫–æ—Ä–∑–∏–Ω–æ–π
    cart: Mapped["Cart"] = relationship(
        "Cart",
        back_populates="user",
        cascade="all, delete-orphan",
        uselist=False  # –û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É
    )
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è:

```mermaid
classDiagram
    class User {
        +int id [PK]
        +str email
        +str hashed_password
        +bool is_active
        +Cart cart
    }
    
    class Cart {
        +int id [PK]
        +int user_id [FK, unique]
        +User user
        +List~CartItem~ items
    }
    
    class CartItem {
        +int id [PK]
        +int cart_id [FK]
        +int product_id [FK]
        +int quantity
        +Cart cart
        +Product product
    }
    
    class Product {
        +int id [PK]
        +str name
        +float price
    }
    
    User "1" -- "1" Cart : –∏–º–µ–µ—Ç –∫–æ—Ä–∑–∏–Ω—É
    Cart "1" -- "0..*" CartItem : —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏–∏
    CartItem "0..*" -- "1" Product : —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–≤–∞—Ä
    
    note for Cart "Cascade: delete-orphan"
    note for CartItem "–•—Ä–∞–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞"
```

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "Add cart models"
alembic upgrade head
```

******

### 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã üîí

**[–¢–ï–ö–°–¢]** –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ä–∑–∏–Ω–æ–π –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å, **–¥–ª—è –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –±—É–¥–µ—Ç –∑–∞—â–∏—â–µ–Ω –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `Depends(security.get_current_user)`.

**[–ö–û–î: app/schemas.py]** –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—ã –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/schemas.py

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class CartItemBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ."""
    product_id: int
    quantity: int

class CartItemCreate(CartItemBase):
    """–°—Ö–µ–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É."""
    pass

class CartItem(CartItemBase):
    """–°—Ö–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π."""
    id: int
    cart_id: int
    
    # –í–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
    product: Product
    
    class Config:
        from_attributes = True

class Cart(BaseModel):
    """–°—Ö–µ–º–∞ –∫–æ—Ä–∑–∏–Ω—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏."""
    id: int
    user_id: int
    items: list[CartItem]
    
    class Config:
        from_attributes = True
```

******
**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/crud.py
from sqlalchemy import select

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

# ============= CRUD –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã =============

async def get_or_create_cart(
    db: AsyncSession,
    user_id: int
) -> models.Cart:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é.
    """
    # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
    query = select(models.Cart).where(models.Cart.user_id == user_id)
    result = await db.execute(query)
    cart = result.scalar_one_or_none()
    
    if not cart:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É
        cart = models.Cart(user_id=user_id)
        db.add(cart)
        await db.commit()
        await db.refresh(cart)
    
    return cart

async def add_item_to_cart(
    db: AsyncSession,
    user_id: int,
    product_id: int,
    quantity: int = 1
) -> models.Cart:
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
    """
    # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart = await get_or_create_cart(db, user_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ
    query = select(models.CartItem).where(
        models.CartItem.cart_id == cart.id,
        models.CartItem.product_id == product_id
    )
    result = await db.execute(query)
    cart_item = result.scalar_one_or_none()
    
    if cart_item:
        # –¢–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        cart_item.quantity += quantity
    else:
        # –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
        cart_item = models.CartItem(
            cart_id=cart.id,
            product_id=product_id,
            quantity=quantity
        )
        db.add(cart_item)
    
    await db.commit()
    await db.refresh(cart)
    
    return cart

async def remove_item_from_cart(
    db: AsyncSession,
    user_id: int,
    item_id: int
) -> models.Cart:
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    cart = await get_or_create_cart(db, user_id)
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é
    cart_item = await db.get(models.CartItem, item_id)
    
    if cart_item and cart_item.cart_id == cart.id:
        await db.delete(cart_item)
        await db.commit()
    
    await db.refresh(cart)
    return cart

async def clear_cart(db: AsyncSession, user_id: int) -> models.Cart:
    """
    –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    cart = await get_or_create_cart(db, user_id)
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    for item in cart.items:
        await db.delete(item)
    
    await db.commit()
    await db.refresh(cart)
    
    return cart
```

**[–ö–û–î: app/routers/cart.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/routers/cart.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, models, security
from app.database import get_db_session

router = APIRouter()

@router.get("/", response_model=schemas.Cart)
async def get_my_cart(
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    """
    cart = await crud.get_or_create_cart(db, user_id=current_user.id)
    return cart

@router.post("/items", response_model=schemas.Cart, status_code=status.HTTP_201_CREATED)
async def add_item_to_cart(
    item_data: schemas.CartItemCreate,
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É.
    –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
    """
    cart = await crud.add_item_to_cart(
        db,
        user_id=current_user.id,
        product_id=item_data.product_id,
        quantity=item_data.quantity
    )
    return cart

@router.delete("/items/{item_id}", response_model=schemas.Cart)
async def remove_item_from_cart(
    item_id: int,
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    cart = await crud.remove_item_from_cart(
        db,
        user_id=current_user.id,
        item_id=item_id
    )
    return cart

@router.delete("/", response_model=schemas.Cart)
async def clear_cart(
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É.
    """
    cart = await crud.clear_cart(db, user_id=current_user.id)
    return cart
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/main.py
from .routers import products, categories, users, auth, cart  # –î–æ–±–∞–≤–∏–ª–∏ cart

# ...

app.include_router(cart.router, prefix="/cart", tags=["Cart"])
```

******

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ö—É–∫–∞ `useCart` üîÑ

**[–¢–ï–ö–°–¢]** –¶–µ–ª—å:

–ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (`useState`) –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API-–≤—ã–∑–æ–≤—ã –∫ —Å–µ—Ä–≤–µ—Ä—É. –ö–æ—Ä–∑–∏–Ω–∞ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç "–∂–∏—Ç—å" –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**[–ö–û–î: src/hooks/useCart.tsx]** –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ö—É–∫ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):

```typescript
// src/hooks/useCart.tsx
import { useState, useEffect } from 'react';
import { Product } from '../types';

interface CartItem {
  id: number;
  product: Product;
  quantity: number;
}

export function useCart() {
  const [items, setItems] = useState<CartItem[]>([]);
  const [loading, setLoading] = useState(false);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage
  const getToken = () => {
    return localStorage.getItem('access_token');
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
  const fetchCart = async () => {
    const token = getToken();
    if (!token) return;

    setLoading(true);
    try {
      const response = await fetch('http://127.0.0.1:8000/cart', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const cart = await response.json();
        setItems(cart.items);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:', error);
    } finally {
      setLoading(false);
    }
  };

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  useEffect(() => {
    fetchCart();
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const addToCart = async (product: Product, quantity: number = 1) => {
    const token = getToken();
    if (!token) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
      return;
    }

    try {
      const response = await fetch('http://127.0.0.1:8000/cart/items', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          product_id: product.id,
          quantity: quantity
        })
      });

      if (response.ok) {
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        await fetchCart();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
    }
  };

  // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const removeFromCart = async (itemId: number) => {
    const token = getToken();
    if (!token) return;

    try {
      const response = await fetch(`http://127.0.0.1:8000/cart/items/${itemId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        await fetchCart();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã:', error);
    }
  };

  return {
    items,
    loading,
    addToCart,
    removeFromCart,
    fetchCart  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  };
}
```

******
**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã" ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

**–®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
4. **–ü–æ–∫–∞–∂–∏—Ç–µ** —É—Ö–æ–¥—è—â–∏–π `POST`-–∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î**

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:

   ```sql
   SELECT c.id, c.user_id, ci.product_id, ci.quantity
   FROM carts c
   JOIN cart_items ci ON c.id = ci.cart_id;
   ```

3. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏

**–®–∞–≥ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏**

1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏ –∑–∞–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞, –æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å —Å —Å–µ—Ä–≤–µ—Ä–∞!
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–¥ —Ç–µ–º –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞ –∂–µ —Å–∞–º–∞—è –∫–æ—Ä–∑–∏–Ω–∞!

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥:

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å:

- –ö–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –ó–∞—â–∏—â–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–æ—Ä–∑–∏–Ω—É)

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:
>
>1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
>2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ (PUT /cart/items/{item_id})
>3. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É" (DELETE /cart)
>4. –ü–æ–∫–∞–∂–∏—Ç–µ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã (—Å—É–º–º–∏—Ä—É–π—Ç–µ product.price * quantity)

******

## –£—Ä–æ–∫ 11: –§–∏–Ω–∞–ª ‚Äî —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å Docker –∏ Docker Compose üê≥

### 1. –ü—Ä–æ–±–ª–µ–º–∞: "–£ –º–µ–Ω—è –Ω–∞ –º–∞—à–∏–Ω–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ!" üò´

**[–¢–ï–ö–°–¢]** –¢–∏–ø–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:

"–í—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç, –æ–Ω –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º –Ω–æ—É—Ç–±—É–∫–µ. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –µ–≥–æ –¥—Ä—É–≥—É –∏–ª–∏ –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

–î—Ä—É–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É:

- `ModuleNotFoundError: No module named 'fastapi'` ‚Äî –∑–∞–±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- `OperationalError: connection refused` ‚Äî –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è PostgreSQL
- `Error: port 5432 already in use` ‚Äî –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç

**[–¢–ï–ö–°–¢]** –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

–†–∞–∑–ª–∏—á–∏—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö:

- –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Python (3.9 vs 3.11)
- –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
- –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (Windows vs Linux)

**[–¢–ï–ö–°–¢]** –í—ã–≤–æ–¥:

–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ö–∞–æ—Å –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –ù–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± –ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥, –Ω–æ –∏ **–≤—Å—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º**: Python, –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

******

### 2. –†–µ—à–µ–Ω–∏–µ: Docker ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä" –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è üì¶

**[–¢–ï–ö–°–¢]** –ê–Ω–∞–ª–æ–≥–∏—è "–ú–æ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä":

Docker ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤–∞—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—Å–µ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ–¥–∏–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π **"–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"** (–æ–±—Ä–∞–∑).

–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ:

- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å Docker
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–≥–µ
- –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–û–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **–∞–±—Å–æ–ª—é—Ç–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ** –≤–µ–∑–¥–µ.

–ú—ã –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º "–º–µ–±–µ–ª—å" (–∫–æ–¥), –º—ã –¥–æ—Å—Ç–∞–≤–ª—è–µ–º "–∫–æ–º–Ω–∞—Ç—É —Å –º–µ–±–µ–ª—å—é" (–æ–±—Ä–∞–∑ —Å –∫–æ–¥–æ–º –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º).

**[–¢–ï–ö–°–¢]** –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è:

**–û–±—Ä–∞–∑ (Image)** ‚Äî —ç—Ç–æ —á–µ—Ä—Ç–µ–∂, —à–∞–±–ª–æ–Ω, "—Å–ª–µ–ø–æ–∫" —Å–∏—Å—Ç–µ–º—ã:

- –°–æ–¥–µ—Ä–∂–∏—Ç Python, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –≤–∞—à –∫–æ–¥
- –ù–µ –∑–∞–ø—É—â–µ–Ω, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –ø–µ—Ä–µ–¥–∞—Ç—å

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (Container)** ‚Äî —ç—Ç–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–∑–∞:

- –ó–∞–ø—É—â–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ò–º–µ–µ—Ç —Å–≤–æ—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ò–∑ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

******

### 3. `Dockerfile`: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ –Ω–∞—à–µ–≥–æ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞" üîß

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

```bash
pip freeze > requirements.txt
```

**[–ö–û–î: Dockerfile]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Dockerfile` (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```dockerfile
# –®–∞–≥ 1: –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ - –±–µ—Ä–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python 3.11 –≤ "–ª–µ–≥–∫–æ–π" –≤–µ—Ä—Å–∏–∏
FROM python:3.11-slim

# –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
WORKDIR /app

# –®–∞–≥ 3: –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
COPY requirements.txt .

# –®–∞–≥ 4: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
# --no-cache-dir - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫—ç—à pip (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
RUN pip install --no-cache-dir -r requirements.txt

# –®–∞–≥ 5: –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –®–∞–≥ 6: –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç 8000 (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞)
EXPOSE 8000

# –®–∞–≥ 7: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
# --host 0.0.0.0 - —Å–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (–≤–∞–∂–Ω–æ –¥–ª—è Docker!)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É:

- `FROM python:3.11-slim` ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º —Å –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å Python
- `WORKDIR /app` ‚Äî –≤—Å–µ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ
- `COPY requirements.txt .` ‚Äî –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `RUN pip install...` ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞)
- `COPY . .` ‚Äî –∫–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥
- `EXPOSE 8000` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8000
- `CMD [...]` ‚Äî –∫–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `--host 0.0.0.0` ‚Äî **–ö–†–ò–¢–ò–ß–ù–û**: –±–µ–∑ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞!

******

### 4. `docker-compose`: –î–∏—Ä–∏–∂–µ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞ üéº

**[–¢–ï–ö–°–¢]** –ü—Ä–æ–±–ª–µ–º–∞ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

1. FastAPI (–Ω–∞—à –∫–æ–¥)
2. PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

–ó–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ—É–¥–æ–±–Ω–æ. **Docker Compose** –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –µ–π –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

**[–ö–û–î: docker-compose.yml]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ:

```yaml
version: '3.8'

services:
  # –ù–∞—à FastAPI —Å–µ—Ä–≤–∏—Å
  api:
    build: .  # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ Dockerfile –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ
    ports:
      - "8000:8000"  # –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 8000 –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç
    environment:
      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      - DATABASE_URL=postgresql+asyncpg://postgres:mysecretpassword@db:5432/store_db
      - SECRET_KEY=docker_secret_key_change_in_production_12345
    depends_on:
      - db  # –ó–∞–ø—É—Å–∫–∞—Ç—å API —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ë–î
    volumes:
      - ./app:/app/app  # –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–∞–ø–∫—É app –¥–ª—è live reload
  
  # –°–µ—Ä–≤–∏—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  db:
    image: postgres:15-alpine  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
    ports:
      - "5432:5432"  # –î–æ—Å—Ç—É–ø –∫ –ë–î —Å —Ö–æ—Å—Ç–∞ (–¥–ª—è pgAdmin)
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=mysecretpassword
      - POSTGRES_DB=store_db
    volumes:
      - postgres_data:/var/lib/postgresql/data  # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ–º–µ

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ë–î
volumes:
  postgres_data:
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

**services** ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã:

- `api` ‚Äî –Ω–∞—à–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `db` ‚Äî PostgreSQL

**build vs image**:

- `build: .` ‚Äî —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ Dockerfile
- `image: postgres:15-alpine` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ –∏–∑ Docker Hub

**ports** ‚Äî `"8000:8000"` –æ–∑–Ω–∞—á–∞–µ—Ç:

- `8000` (—Å–ª–µ–≤–∞) ‚Äî –ø–æ—Ä—Ç –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- `8000` (—Å–ø—Ä–∞–≤–∞) ‚Äî –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**environment** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- –î–ª—è API: DATABASE_URL (–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Ö–æ—Å—Ç —Ç–µ–ø–µ—Ä—å `db`, –∞ –Ω–µ `localhost`!)
- –î–ª—è PostgreSQL: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ë–î

**depends_on** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

**volumes** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

- `postgres_data:/var/lib/postgresql/data` ‚Äî –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–æ–º–µ –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

******

### 5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—é —Å–∏—Å—Ç–µ–º—É –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π üöÄ

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã":

–ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up --build
```

**[–¢–ï–ö–°–¢]** –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. Docker —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –¥–ª—è `api` –ø–æ `Dockerfile`
2. Docker —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑ `postgres:15-alpine`
3. –°–æ–∑–¥–∞–µ—Ç —Å–µ—Ç—å –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç `db` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç `api` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**[–î–ï–ú–û]** –ü–æ–∫–∞–∑ –ª–æ–≥–æ–≤:

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–º–µ—Å—Ç–µ:

```
db_1  | database system is ready to accept connections
api_1 | INFO:     Started server process
api_1 | INFO:     Uvicorn running on http://0.0.0.0:8000
```

**[–î–ï–ú–û]** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:8000/docs`
2. API —Ä–∞–±–æ—Ç–∞–µ—Ç!
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ Swagger
4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `Ctrl+C` –∏–ª–∏ `docker-compose down`
5. –°–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker-compose up`
6. **–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å! –¢–æ–≤–∞—Ä –Ω–µ –∏—Å—á–µ–∑, –ø–æ—Ç–æ–º—É —á—Ç–æ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ volume

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (detached)
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose stop

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–º–µ—Å—Ç–µ —Å volumes (–£–î–ê–õ–ò–¢ –î–ê–ù–ù–´–ï!)
docker-compose down -v
```

**[–¢–ï–ö–°–¢]** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤ Docker:

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π Alembic:

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä api
docker-compose exec api bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
alembic upgrade head

# –í—ã–π—Ç–∏
exit
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–£–ø–∞–∫–æ–≤–∞–ª–∏ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker! –í–∞—à–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
>
>1. –°–æ–∑–¥–∞–π—Ç–µ `Dockerfile` –∏ `docker-compose.yml` –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
>2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ `docker-compose up`
>3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
>
> - API –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:8000`
> - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
> - React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API
>
>**–ü–æ–∑–¥—Ä–∞–≤–ª—è—é!** –í—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç –∏–¥–µ–∏ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üéâ

******

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ üéì

–í—ã –æ—Å–≤–æ–∏–ª–∏:

- ‚úÖ –û—Å–Ω–æ–≤—ã FastAPI –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ SQLAlchemy ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã –ë–î
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å React —á–µ—Ä–µ–∑ CORS
- ‚úÖ Docker –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –ò–∑—É—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (pytest, TestClient)
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞–∫–∞–∑–æ–≤ –∏ –æ–ø–ª–∞—Ç—ã
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å—ã)
5. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (AWS, DigitalOcean, Heroku)

**–£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**

```

## `doc/transaction_conflict_solution.md`

```md
# üîÑ –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ FastAPI

## üéØ –ü—Ä–æ–±–ª–µ–º–∞ (–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤)

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —Ç—ã –ø–µ—Ä–µ–≤–æ–¥–∏—à—å –¥–µ–Ω—å–≥–∏:

1. –°–Ω—è—Ç—å 100‚ÇΩ —Å–æ —Å—á—ë—Ç–∞ –ê
2. –ü–æ–ª–æ–∂–∏—Ç—å 100‚ÇΩ –Ω–∞ —Å—á—ë—Ç –ë

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** = "–ø–∞–∫–µ—Ç" –¥–µ–π—Å—Ç–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è **–í–°–ï –í–ú–ï–°–¢–ï –∏–ª–∏ –ù–ò–ö–ê–ö**.

–ï—Å–ª–∏ —à–∞–≥ 2 –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è ‚Üí —à–∞–≥ 1 —Ç–æ–∂–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (rollback).

---

## üêõ –û—à–∏–±–∫–∞ –∫–æ—Ç–æ—Ä—É—é –º—ã –ø–æ–ª—É—á–∞–ª–∏

```
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session
```

### –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º?

–¢—ã –æ—Ç–∫—Ä—ã–ª –∫–æ—Ä–æ–±–∫—É (–Ω–∞—á–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é), –Ω–∞—á–∞–ª —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤–µ—â–∏, –∏ **–≤–Ω—É—Ç—Ä–∏** –ø—ã—Ç–∞–µ—à—å—Å—è –∑–∞–∫—Ä—ã—Ç—å –∏ –∑–∞–ø–µ—á–∞—Ç–∞—Ç—å –µ—ë ‚Äî –Ω–æ –æ–Ω–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞!

---

## üîç –ö–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –≤ –∫–æ–¥–µ?

### –§–∞–π–ª `core/database.py` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)

```python
async def get_db_session() -> AsyncGenerator[AsyncSession, None]:
    async with AsyncSessionLocal() as session:  # ‚Üê –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –û–¢–ö–†–´–¢–ê
        try:
            yield session
            await session.commit()  # ‚Üê –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ó–ê–ö–†–´–¢–ê (—É—Å–ø–µ—Ö)
        except Exception as e:
            await session.rollback()  # ‚Üê –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –û–¢–ö–ê–ß–ï–ù–ê (–æ—à–∏–±–∫–∞)
            raise
```

**FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**

- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ endpoint
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –µ—ë –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

---

### –§–∞–π–ª `core/order_crud.py` (–≤–ª–æ–∂–µ–Ω–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è - –ü–†–û–ë–õ–ï–ú–ê!)

```python
async def create_order(...):
    # ...
    
    # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ï–©–Å –†–ê–ó!
    async with session.begin():
        order = Order(...)
        session.add(order)
        
        # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç commit –í–ù–£–¢–†–ò
        await clear_cart(session, user_id)
```

### –§–∞–π–ª `core/cart_crud.py` (commit –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

```python
async def clear_cart(session, user_id):
    # ...—É–¥–∞–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã...
    
    await session.commit()  # ‚ùå –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å —É–∂–µ –æ—Ç–∫—Ä—ã—Ç—É—é –∫–æ—Ä–æ–±–∫—É!
```

---

## üé® –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã

```
FastAPI (get_db_session)
‚îÇ
‚îú‚îÄ [–¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –û–¢–ö–†–´–¢–ê] ‚Üê –ö–æ—Ä–æ–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ create_order()
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ async with session.begin(): ‚Üê ‚ùå –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–∫—Ä—ã—Ç—å –µ—â—ë –æ–¥–Ω—É –∫–æ—Ä–æ–±–∫—É!
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ –°–æ–∑–¥–∞—Ç—å Order
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ –°–æ–∑–¥–∞—Ç—å OrderItems
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ clear_cart()
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ session.commit() ‚Üê ‚ùå –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–∫—Ä—ã—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∫–æ—Ä–æ–±–∫—É!
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ session.commit() ‚Üê ‚úÖ –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ò–ù commit
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–±—Ä–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (–í–´–ë–†–ê–õ–ò –ú–´)

**–ò–¥–µ—è:** FastAPI —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π, –Ω–µ –Ω—É–∂–µ–Ω `session.begin()`

#### –î–æ (–ü–õ–û–•–û)

```python
async def create_order(session, user_id, order_data):
    # ‚ùå –õ–∏—à–Ω—è—è –æ–±—ë—Ä—Ç–∫–∞
    async with session.begin():
        order = Order(...)
        session.add(order)
        await clear_cart(session, user_id)
```

#### –ü–æ—Å–ª–µ (–•–û–†–û–®–û)

```python
async def create_order(session, user_id, order_data):
    # ‚úÖ –ü—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ–º —Å —Å–µ—Å—Å–∏–µ–π
    order = Order(...)
    session.add(order)
    await clear_cart(session, user_id, auto_commit=False)
    
    # Commit —Å–¥–µ–ª–∞–µ—Ç get_db_session() –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `auto_commit`

**–ò–¥–µ—è:** –§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

1. **–°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ** (–∏–∑ API `/cart/add`) ‚Äî –Ω—É–∂–µ–Ω `commit()`
2. **–í–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–≤ `create_order`) ‚Äî `commit()` —Å–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç

#### –†–µ—à–µ–Ω–∏–µ: –£—Å–ª–æ–≤–Ω—ã–π –∫–æ–º–º–∏—Ç

```python
async def clear_cart(
    session: AsyncSession,
    user_id: int,
    auto_commit: bool = True  # ‚Üê –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é True
):
    cart = await get_or_create_cart(session, user_id, auto_commit=False)
    
    # –£–¥–∞–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏
    for item in items:
        await session.delete(item)
    
    # –£—Å–ª–æ–≤–Ω—ã–π –∫–æ–º–º–∏—Ç
    if auto_commit:
        await session.commit()  # ‚Üê –î–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
    # else: commit —Å–¥–µ–ª–∞–µ—Ç –≤–Ω–µ—à–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
```

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

### `session.commit()`

"–ó–∞–∫—Ä—ã—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä–æ–±–∫—É" ‚Äî –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ë–î –Ω–∞–≤—Å–µ–≥–¥–∞.

### `session.rollback()`

"–í—ã–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë –∏–∑ –∫–æ—Ä–æ–±–∫–∏" ‚Äî –æ—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –Ω–∞—á–∞–ª—É.

### `session.flush()`

"–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–æ –ù–ï –∑–∞–∫—Ä—ã–≤–∞—Ç—å –∫–æ—Ä–æ–±–∫—É" ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –ë–î, –Ω–æ –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å.

### `session.begin()`

"–û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é –∫–æ—Ä–æ–±–∫—É" ‚Äî –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

### `async with session.begin():`

"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä–æ–±–∫–∞" ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏ –≤—Ö–æ–¥–µ, –∑–∞–∫—Ä–æ–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ.

---

## üìã –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ FastAPI

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

```python
# 1. Dependency —Å–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
async def get_db_session():
    async with AsyncSessionLocal() as session:
        try:
            yield session
            await session.commit()  # ‚Üê –û–¥–∏–Ω commit –Ω–∞ –≤–µ—Å—å –∑–∞–ø—Ä–æ—Å
        except:
            await session.rollback()
            raise

# 2. Endpoint –ø–æ–ª—É—á–∞–µ—Ç —Å–µ—Å—Å–∏—é
@app.post("/orders")
async def create_order_endpoint(
    session: AsyncSession = Depends(get_db_session)
):
    order = await create_order(session, ...)
    return order

# 3. CRUD-—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó commit (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
async def create_order(session, ...):
    order = Order(...)
    session.add(order)
    await session.flush()  # ‚Üê –¢–æ–ª—å–∫–æ flush, –Ω–µ commit
    
    await clear_cart(session, user_id, auto_commit=False)
    
    # Commit –±—É–¥–µ—Ç –≤ get_db_session()
    return order
```

---

## üéØ –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** = "–í—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ"

### –ù–∞—à–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

```
[–û–î–ù–ê –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø]
‚îÇ
‚îú‚îÄ 1. –°–æ–∑–¥–∞—Ç—å Order
‚îú‚îÄ 2. –°–æ–∑–¥–∞—Ç—å OrderItem (—Ç–æ–≤–∞—Ä 1)
‚îú‚îÄ 3. –°–æ–∑–¥–∞—Ç—å OrderItem (—Ç–æ–≤–∞—Ä 2)
‚îú‚îÄ 4. –£–¥–∞–ª–∏—Ç—å CartItem (—Ç–æ–≤–∞—Ä 1)
‚îú‚îÄ 5. –£–¥–∞–ª–∏—Ç—å CartItem (—Ç–æ–≤–∞—Ä 2)
‚îÇ
‚îî‚îÄ COMMIT ‚Üê –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –û–î–ù–ò–ú –ü–ê–ö–ï–¢–û–ú
```

–ï—Å–ª–∏ **–ª—é–±–æ–π** —à–∞–≥ —É–ø–∞–¥—ë—Ç —Å –æ—à–∏–±–∫–æ–π ‚Üí **–í–°–Å** –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è:

- –ó–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è
- –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –æ—á–∏—Å—Ç–∏—Ç—Å—è
- –ë–î –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –ø—Ä–µ–∂–Ω–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏

---

## üé¨ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞

### üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å `auto_commit=False` (–ü–†–ê–í–ò–õ–¨–ù–û)

```mermaid
sequenceDiagram
    participant Client as üåê –ö–ª–∏–µ–Ω—Ç
    participant FastAPI as ‚ö° FastAPI
    participant Dependency as üîå get_db_session
    participant Session as üì¶ AsyncSession
    participant CreateOrder as üìù create_order()
    participant ClearCart as üßπ clear_cart()
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

    Client->>FastAPI: POST /orders (—Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑)
    FastAPI->>Dependency: –í—ã–∑–æ–≤ get_db_session()
    
    Note over Dependency,Session: üü¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –û–¢–ö–†–´–¢–ê
    Dependency->>Session: –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    Dependency->>FastAPI: yield session
    
    FastAPI->>CreateOrder: create_order(session, user_id, order_data)
    
    Note over CreateOrder: –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Order
    CreateOrder->>Session: session.add(Order)
    CreateOrder->>Session: await session.flush()
    Session->>DB: INSERT Order (–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù!)
    DB-->>Session: Order —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤—Ä–µ–º–µ–Ω–Ω–æ
    
    Note over CreateOrder: –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å OrderItems
    loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
        CreateOrder->>Session: session.add(OrderItem)
    end
    CreateOrder->>Session: await session.flush()
    Session->>DB: INSERT OrderItems (–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù–´!)
    DB-->>Session: OrderItems —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω–æ
    
    Note over CreateOrder: –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
    CreateOrder->>ClearCart: clear_cart(session, user_id, auto_commit=False)
    
    loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ CartItem
        ClearCart->>Session: session.delete(CartItem)
    end
    
    Note over ClearCart: auto_commit=False ‚Üí –ù–ï –¥–µ–ª–∞–µ–º commit!
    ClearCart->>Session: –ù–ï–¢ session.commit()
    ClearCart-->>CreateOrder: –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞ (–ë–ï–ó commit)
    
    CreateOrder-->>FastAPI: –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω (return order)
    
    Note over Dependency,Session: üîµ –û–î–ò–ù COMMIT –ù–ê –í–°–Å
    FastAPI->>Dependency: –ö–æ–Ω–µ—Ü endpoint
    Dependency->>Session: await session.commit()
    Session->>DB: COMMIT –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    DB-->>Session: ‚úÖ –í—Å—ë —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
    
    Note over Dependency,Session: üü¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –ó–ê–ö–†–´–¢–ê
    
    Dependency-->>FastAPI: –°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
    FastAPI-->>Client: 200 OK (–∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω)
```

---

### ‚ùå –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ë–ï–ó `auto_commit=False` (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û)

```mermaid
sequenceDiagram
    participant Client as üåê –ö–ª–∏–µ–Ω—Ç
    participant FastAPI as ‚ö° FastAPI
    participant Dependency as üîå get_db_session
    participant Session as üì¶ AsyncSession
    participant CreateOrder as üìù create_order()
    participant ClearCart as üßπ clear_cart()
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

    Client->>FastAPI: POST /orders (—Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑)
    FastAPI->>Dependency: –í—ã–∑–æ–≤ get_db_session()
    
    Note over Dependency,Session: üü¢ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –û–¢–ö–†–´–¢–ê
    Dependency->>Session: –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    Dependency->>FastAPI: yield session
    
    FastAPI->>CreateOrder: create_order(session, user_id, order_data)
    
    Note over CreateOrder: –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å Order
    CreateOrder->>Session: session.add(Order)
    CreateOrder->>Session: await session.flush()
    Session->>DB: INSERT Order (–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù)
    
    Note over CreateOrder: –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å OrderItems
    loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
        CreateOrder->>Session: session.add(OrderItem)
    end
    CreateOrder->>Session: await session.flush()
    Session->>DB: INSERT OrderItems (–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù–´)
    
    Note over CreateOrder: –®–∞–≥ 3: –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
    CreateOrder->>ClearCart: clear_cart(session, user_id) ‚Üê –ë–ï–ó auto_commit=False!
    
    loop –î–ª—è –∫–∞–∂–¥–æ–≥–æ CartItem
        ClearCart->>Session: session.delete(CartItem)
    end
    
    Note over ClearCart,DB: ‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê: –î–æ—Å—Ä–æ—á–Ω—ã–π commit!
    ClearCart->>Session: await session.commit() ‚ùå
    Session->>DB: COMMIT Order + OrderItems + CartItems
    DB-->>Session: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –î–û–°–†–û–ß–ù–û!
    
    Note over Dependency,Session: üî¥ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –£–ñ–ï –ó–ê–ö–†–´–¢–ê!
    
    ClearCart-->>CreateOrder: –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞
    
    Note over CreateOrder: ‚ö†Ô∏è –ï—Å–ª–∏ –∑–¥–µ—Å—å –æ—à–∏–±–∫–∞ - –æ—Ç–∫–∞—Ç–∏—Ç—å –ù–ï–õ–¨–ó–Ø!
    CreateOrder->>CreateOrder: –ö–∞–∫–∞—è-—Ç–æ –æ—à–∏–±–∫–∞! üí•
    CreateOrder-->>FastAPI: Exception!
    
    FastAPI->>Dependency: –ö–æ–Ω–µ—Ü endpoint (—Å –æ—à–∏–±–∫–æ–π)
    Dependency->>Session: await session.rollback() ‚Üê –ù–ï –°–†–ê–ë–û–¢–ê–ï–¢!
    
    Note over DB: ‚ùå Order –∏ CartItems –£–ñ–ï –í –ë–î!<br/>–û—Ç–∫–∞—Ç–∏—Ç—å –∏—Ö –ù–ï–í–û–ó–ú–û–ñ–ù–û!
    
    Dependency-->>FastAPI: –°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
    FastAPI-->>Client: 500 Error
    
    Note over DB: üíî –ë–î –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞: –∑–∞–∫–∞–∑ –±–µ–∑ —Ç–æ–≤–∞—Ä–æ–≤
```

---

## üéØ –ü–æ—à–∞–≥–æ–≤–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ –Ω–∞ 3 —Ç–æ–≤–∞—Ä–∞

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º **–ø–æ—à–∞–≥–æ–≤–æ**, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.

---

### üìç –®–∞–≥ 0: –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å

```http
POST /orders
Authorization: Bearer <token>
Content-Type: application/json

{
  "delivery_address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 10",
  "phone": "+7-999-123-45-67"
}
```

**–ß—Ç–æ —É –Ω–∞—Å –≤ –ë–î:**

- **–ö–æ—Ä–∑–∏–Ω–∞:** 3 —Ç–æ–≤–∞—Ä–∞ (–¢–æ–≤–∞—Ä A, –¢–æ–≤–∞—Ä B, –¢–æ–≤–∞—Ä C)
- **–ó–∞–∫–∞–∑—ã:** –ø—É—Å—Ç–æ

---

### üìç –®–∞–≥ 1: FastAPI –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å

```python
@router.post("/")
async def create_order_endpoint(
    order_data: OrderCreate,
    session: AsyncSession = Depends(get_db_session),  # ‚Üê –ó–î–ï–°–¨!
    current_user: User = Depends(get_current_user),
):
    order = await create_order(session, current_user.id, order_data)
    return order
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. FastAPI –≤–∏–¥–∏—Ç `Depends(get_db_session)`
2. –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é [`get_db_session()`](core/database.py )
3. –°–æ–∑–¥–∞—ë—Ç—Å—è **–æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è** –¥–ª—è –≤—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

---

### üìç –®–∞–≥ 2: `get_db_session()` –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é

```python
async def get_db_session() -> AsyncGenerator[AsyncSession, None]:
    async with AsyncSessionLocal() as session:  # ‚Üê –°–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞
        try:
            logger.debug("üîå –û—Ç–∫—Ä—ã—Ç–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î")
            yield session  # ‚Üê –ü–µ—Ä–µ–¥–∞—ë–º –≤ endpoint
            # ‚Üì –ö–æ–¥ –Ω–∏–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è endpoint
            await session.commit()  # ‚Üê Commit –≤ –ö–û–ù–¶–ï
            logger.debug("‚úÖ –°–µ—Å—Å–∏—è –ë–î –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞")
        except Exception as e:
            await session.rollback()  # ‚Üê Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
            raise
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**

- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–æ—Ç–∫—Ä—ã—Ç–∞**
- ‚úÖ –°–µ—Å—Å–∏—è –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ `create_order_endpoint()`

---

### üìç –®–∞–≥ 3: –í—ã–∑–æ–≤ `create_order()`

```python
async def create_order(
    session: AsyncSession,
    user_id: int,
    order_data: OrderCreate
) -> Order:
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É —Å —Ç–æ–≤–∞—Ä–∞–º–∏
    cart = await get_cart_with_items(session, user_id)
    
    # –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É
    total_amount = sum(
        item.product.price_shmeckles * item.quantity 
        for item in cart.items
    )
    # total_amount = 1500 (–Ω–∞–ø—Ä–∏–º–µ—Ä)
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**

- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–æ—Ç–∫—Ä—ã—Ç–∞**
- üìä –ü–æ–ª—É—á–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã (3 —Ç–æ–≤–∞—Ä–∞)
- üìä –ü–æ—Å—á–∏—Ç–∞–ª–∏ —Å—É–º–º—É (1500 —Ä—É–±–ª–µ–π)

---

### üìç –®–∞–≥ 4: –°–æ–∑–¥–∞—ë–º Order

```python
    # –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑
    order = Order(
        user_id=user_id,
        created_at=datetime.utcnow(),
        status="pending",
        total_amount=total_amount,  # 1500
        delivery_address=order_data.delivery_address,
        phone=order_data.phone,
    )
    session.add(order)
    await session.flush()  # ‚Üê –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –ë–î, –Ω–æ –ù–ï –∫–æ–º–º–∏—Ç–∏–º!
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `flush()`:**

- ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `INSERT` –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Order –ø–æ–ª—É—á–∞–µ—Ç `id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `id=42`)
- ‚ùå **–ù–ï –¥–µ–ª–∞–µ—Ç commit** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –µ—â—ë –æ—Ç–∫—Ä—ã—Ç–∞!

**–°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î:**

```sql
-- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å!)
Orders:
  id=42, user_id=1, total_amount=1500, status='pending' [–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
```

---

### üìç –®–∞–≥ 5: –°–æ–∑–¥–∞—ë–º OrderItems

```python
    # –°–æ–∑–¥–∞—ë–º –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞
    for cart_item in cart.items:
        order_item = OrderItem(
            order_id=order.id,  # 42
            product_id=cart_item.product_id,
            quantity=cart_item.quantity,
            frozen_name=cart_item.product.name,
            frozen_price=cart_item.product.price_shmeckles,
        )
        session.add(order_item)
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î:**

```sql
-- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å!)
OrderItems:
  id=101, order_id=42, product_id=1, quantity=2, frozen_price=500 [–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=102, order_id=42, product_id=5, quantity=1, frozen_price=300 [–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=103, order_id=42, product_id=8, quantity=3, frozen_price=200 [–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
```

---

### üìç –®–∞–≥ 6: –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É

```python
    # –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ë–ï–ó commit
    await clear_cart(session, user_id, auto_commit=False)  # ‚Üê –í–ê–ñ–ù–û!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω—É—Ç—Ä–∏ `clear_cart()`:**

```python
async def clear_cart(
    session: AsyncSession,
    user_id: int,
    auto_commit: bool = True  # ‚Üê –ù–æ –º—ã –ø–µ—Ä–µ–¥–∞–ª–∏ False!
):
    cart = await get_or_create_cart(session, user_id, auto_commit=False)
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    for item in items:
        await session.delete(item)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞
    if auto_commit:  # False ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ–º!
        await session.commit()  # ‚Üê –ù–ï –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø!
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –±–µ–∑ commit
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î:**

```sql
-- –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å!)
CartItems:
  id=1, cart_id=1, product_id=1, quantity=2 [–£–î–ê–õ–Å–ù, –ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=2, cart_id=1, product_id=5, quantity=1 [–£–î–ê–õ–Å–ù, –ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=3, cart_id=1, product_id=8, quantity=3 [–£–î–ê–õ–Å–ù, –ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
```

---

### üìç –®–∞–≥ 7: –§—É–Ω–∫—Ü–∏—è `create_order()` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

```python
    # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑ —Å –ø–æ–∑–∏—Ü–∏—è–º–∏
    stmt = select(Order).where(Order.id == order.id).options(...)
    result = await session.execute(stmt)
    order = result.scalar_one()
    
    return order  # ‚Üê –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ endpoint
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ:**

- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–í–°–Å –ï–©–Å –æ—Ç–∫—Ä—ã—Ç–∞**
- üìä –í –ë–î **–≤—Ä–µ–º–µ–Ω–Ω–æ** (–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å):
  - Order (id=42)
  - 3 OrderItems
  - –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞ (3 CartItems —É–¥–∞–ª–µ–Ω—ã)

---

### üìç –®–∞–≥ 8: Endpoint –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

```python
@router.post("/")
async def create_order_endpoint(...):
    order = await create_order(session, current_user.id, order_data)
    return order  # ‚Üê –í—ã—Ö–æ–¥–∏–º –∏–∑ endpoint
```

**FastAPI –≤–∏–¥–∏—Ç:**

- ‚úÖ Endpoint –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ `get_db_session()`

---

### üìç –®–∞–≥ 9: `get_db_session()` –¥–µ–ª–∞–µ—Ç commit

```python
async def get_db_session():
    async with AsyncSessionLocal() as session:
        try:
            yield session  # ‚Üê –°—é–¥–∞ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å
            
            # ‚Üì –û–î–ò–ù COMMIT –ù–ê –í–°–Å!
            await session.commit()  # ‚Üê –ó–î–ï–°–¨!
            logger.debug("‚úÖ –°–µ—Å—Å–∏—è –ë–î –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞")
        except Exception as e:
            await session.rollback()
            raise
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

```sql
-- COMMIT –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û
COMMIT;

-- –¢–µ–ø–µ—Ä—å –í–°–Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞–≤—Å–µ–≥–¥–∞:
Orders:
  id=42, user_id=1, total_amount=1500 [‚úÖ –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]

OrderItems:
  id=101, order_id=42, product_id=1 [‚úÖ –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=102, order_id=42, product_id=5 [‚úÖ –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]
  id=103, order_id=42, product_id=8 [‚úÖ –ó–ê–ö–û–ú–ú–ò–ß–ï–ù]

CartItems:
  (–ø—É—Å—Ç–æ - –≤—Å—ë —É–¥–∞–ª–µ–Ω–æ) [‚úÖ –ó–ê–ö–û–ú–ú–ò–ß–ï–ù–û]
```

---

### üìç –®–∞–≥ 10: –û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

```python
FastAPI-->>Client: 200 OK
{
  "id": 42,
  "user_id": 1,
  "total_amount": 1500,
  "status": "pending",
  "items": [...]
}
```

---

## üé≠ –°—Ü–µ–Ω–∞—Ä–∏–π —Å –æ—à–∏–±–∫–æ–π (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback)

### –ß—Ç–æ –µ—Å–ª–∏ –Ω–∞ —à–∞–≥–µ 5 –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞?

```python
async def create_order(...):
    # –®–∞–≥–∏ 1-4: Order —Å–æ–∑–¥–∞–Ω, flush —Å–¥–µ–ª–∞–Ω
    
    # –®–∞–≥ 5: –°–æ–∑–¥–∞—ë–º OrderItems
    for cart_item in cart.items:
        if cart_item.quantity > 1000:
            raise ValueError("–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ!")  # üí• –û–®–ò–ë–ö–ê!
        
        order_item = OrderItem(...)
        session.add(order_item)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

```mermaid
sequenceDiagram
    participant Endpoint as üìù create_order_endpoint
    participant CreateOrder as üõ†Ô∏è create_order()
    participant Session as üì¶ AsyncSession
    participant DB as üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
    participant Dependency as üîå get_db_session

    Endpoint->>CreateOrder: create_order(session, ...)
    CreateOrder->>Session: session.add(Order)
    CreateOrder->>Session: await session.flush()
    Session->>DB: INSERT Order (–ù–ï –ó–ê–ö–û–ú–ú–ò–ß–ï–ù)
    
    Note over CreateOrder: üí• –û–®–ò–ë–ö–ê: quantity > 1000!
    CreateOrder-->>Endpoint: raise ValueError(...)
    
    Endpoint-->>Dependency: Exception –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö
    
    Note over Dependency: except Exception as e:
    Dependency->>Session: await session.rollback() ‚ùó
    Session->>DB: ROLLBACK –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
    DB-->>Session: ‚úÖ Order —É–¥–∞–ª—ë–Ω –∏–∑ –ë–î
    
    Note over DB: –ë–î –≤–µ—Ä–Ω—É–ª–∞—Å—å –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ!
    
    Dependency-->>Endpoint: raise (–ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ–º –æ—à–∏–±–∫—É)
    Endpoint-->>Client: 500 Internal Server Error
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- ‚ùå Order **–ù–ï —Å–æ–∑–¥–∞–Ω** (–æ—Ç–∫–∞—Ç–∏–ª—Å—è)
- ‚ùå OrderItems **–ù–ï —Å–æ–∑–¥–∞–Ω—ã** (–Ω–µ —É—Å–ø–µ–ª–∏)
- ‚ùå –ö–æ—Ä–∑–∏–Ω–∞ **–ù–ï –æ—á–∏—â–µ–Ω–∞** (–Ω–µ —É—Å–ø–µ–ª–∏)
- ‚úÖ –ë–î –æ—Å—Ç–∞–ª–∞—Å—å –≤ **–∏—Å—Ö–æ–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!

---

## üöÄ –ò—Ç–æ–≥–æ

### ‚ùå –ß—Ç–æ –±—ã–ª–æ –ø–ª–æ—Ö–æ

- `session.begin()` –≤–Ω—É—Ç—Ä–∏ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `session.commit()` –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö, –≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### ‚úÖ –ß—Ç–æ —Å—Ç–∞–ª–æ —Ö–æ—Ä–æ—à–æ

- –û–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ –≤–µ—Å—å HTTP-–∑–∞–ø—Ä–æ—Å (—É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è FastAPI)
- `auto_commit` –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–π
- –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: –≤—Å—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º –∏–ª–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è

### üéì –ì–ª–∞–≤–Ω—ã–π —É—Ä–æ–∫

**FastAPI —É–∂–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ Dependency Injection.**
–ù–µ –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ CRUD-—Ñ—É–Ω–∫—Ü–∏–π, –µ—Å–ª–∏ –æ–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∏–∑ endpoints!

### üîë –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è `auto_commit`

**–§–ª–∞–≥ `auto_commit` –ø–æ–∑–≤–æ–ª—è–µ—Ç:**

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ** (—Å commit) –∏ **–≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** (–±–µ–∑ commit)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—Ç—å **–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** —Å–ª–æ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ = –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π, –æ–¥–∏–Ω commit)
- ‚úÖ –ò–∑–±–µ–≥–∞—Ç—å **–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞** (–Ω–µ –Ω—É–∂–Ω—ã –¥–≤–µ –≤–µ—Ä—Å–∏–∏ –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [SQLAlchemy Async Transactions](https://docs.sqlalchemy.org/en/20/orm/extensions/asyncio.html)
- [FastAPI Dependencies](https://fastapi.tiangolo.com/tutorial/dependencies/)
- [Database Transactions Explained](https://www.postgresql.org/docs/current/tutorial-transactions.html)
- [ACID Properties](https://en.wikipedia.org/wiki/ACID)

```

## `doc/writers_prompts/01_core_logic.md`

```md
# –ú–û–î–£–õ–¨: CORE_LOGIC (–Ø–¥—Ä–æ –õ–æ–≥–∏–∫–∏)

## 1. –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞

–¢–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–ª–∏ —Å—ã—Ä–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫ –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π, –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –∏ —Ö–æ—Ä–æ—à–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –¢—ã –≤—ã—Å—Ç—É–ø–∞–µ—à—å –≤ —Ä–æ–ª–∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞, –ø—Ä–µ–≤—Ä–∞—â–∞—è –∏–¥–µ–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.

## 2. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

- **PERSONA (02_personas_tech_writer.md)** ‚Äî –ö–¢–û —Ç—ã: —Ä–æ–ª—å, —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞, –∑–Ω–∞–Ω–∏—è
- **STYLE (03_styles_competent_mentor.md)** ‚Äî –ö–ê–ö —Ç—ã –≥–æ–≤–æ—Ä–∏—à—å: —Ç–æ–Ω, –≥–æ–ª–æ—Å, —è–∑—ã–∫–æ–≤—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- **FORMATTERS (04-06)** ‚Äî –ö–ê–ö —Ç—ã –æ—Ñ–æ—Ä–º–ª—è–µ—à—å: –∫–æ–¥, –¥–∏–∞–≥—Ä–∞–º–º—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **CONSTRAINTS (09)** ‚Äî –ß–¢–û –Ω–µ–ª—å–∑—è: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç–∞–±—É
- **EXAMPLE (99)** ‚Äî –≠–¢–ê–õ–û–ù: –æ–±—Ä–∞–∑–µ—Ü –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –¢—ã –Ω–µ –≤—ã–±–∏—Ä–∞–µ—à—å –º–µ–∂–¥—É –Ω–∏–º–∏ ‚Äî —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –í–°–ï —Å—Ä–∞–∑—É.

## 3. –ê–Ω–∞–ª–∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–¢—ã –ø–æ–ª—É—á–∏—à—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏. –û–Ω –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

- **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã:**
  - **–ù–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞:** –¢–µ–∫—Å—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞ `##`.
  - **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞:** –í —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ `##`.
- **–¢–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞:**
  - **–¢–µ–∑–∏—Å—ã:** –ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ñ—Ä–∞–∑—ã, —Ç—Ä–µ–±—É—é—â–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è.
  - **–ì–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç:** –£–∂–µ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∞–±–∑–∞—Ü—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ—Ä–≥–∞–Ω–∏—á–Ω–æ –≤—Å—Ç—Ä–æ–∏—Ç—å –≤ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.
  - **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:** –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞, –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.
  - **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏-–¥–∏—Ä–µ–∫—Ç–∏–≤—ã:** –£–∫–∞–∑–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `` —Å –æ—Å–æ–±—ã–º–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è–º–∏ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ.

## 4. –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã (Chain-of-Thought)

–ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, —Ç—ã **–æ–±—è–∑–∞–Ω** –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—à–∞–≥–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ (–º—ã—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å).

1. **–®–∞–≥ 1: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.** –û–ø—Ä–µ–¥–µ–ª–∏, —ç—Ç–æ –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ.
2. **–®–∞–≥ 2: –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —á–µ—Ä–Ω–æ–≤–∏–∫–∞.** –ú—ã—Å–ª–µ–Ω–Ω–æ —Ä–∞–∑–±–µ–π –≤—Ö–æ–¥–Ω–æ–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ –∏–¥–µ–∏, —Ç–µ–∑–∏—Å—ã, –≥–æ—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∫–æ–¥, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è).
3. **–®–∞–≥ 3: –°–∏–Ω—Ç–µ–∑ –ø–ª–∞–Ω–∞ –æ—Ç–≤–µ—Ç–∞.** –°–ø–ª–∞–Ω–∏—Ä—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±—É–¥—É—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞. –†–µ—à–∏, –∫–∞–∫ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å —Ç–µ–∑–∏—Å—ã –≤ –∞–±–∑–∞—Ü—ã, –≤ –∫–∞–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–ª–æ–∂–∏—Ç—å –∏–¥–µ–∏, –∏ –≥–¥–µ –Ω–∞–∏–±–æ–ª–µ–µ —É–¥–∞—á–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –∏–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
4. **–®–∞–≥ 4: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤—è–∑–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.** –ù–∞–ø–∏—à–∏ –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É. **–ö–∞–∂–¥—ã–π —Ç–µ–∑–∏—Å –∏–∑ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞—Å–∫—Ä—ã—Ç –≤ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π, —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –∞–±–∑–∞—Ü.** –ò–∑–±–µ–≥–∞–π –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–æ—á–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏.

## 5. –ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è, –∞ –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ.** –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ (—Å–ø–∏—Å–∫–∏, –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∑–∏—Å—ã). –¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π, —Ö–æ—Ä–æ—à–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∏ –ª–µ–≥–∫–æ —á–∏—Ç–∞–µ–º—ã–π –ø—Ä–æ–∑–∞–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–¥–µ–π –∏–∑ —á–µ—Ä–Ω–æ–≤–∏–∫–∞.

```

## `doc/writers_prompts/02_personas_tech_writer.md`

```md
# –ú–û–î–£–õ–¨: PERSONA (–†–æ–ª—å –∏ –≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞)

## 1. –û—Å–Ω–æ–≤–Ω–∞—è —Ä–æ–ª—å

–¢—ã ‚Äî **–æ–ø—ã—Ç–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å –∏ –º–µ—Ç–æ–¥–∏—Å—Ç** —Å –≥–ª—É–±–æ–∫–æ–π —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–æ–π –≤ –æ–±–ª–∞—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è. –¢–≤–æ—è –æ—Å–Ω–æ–≤–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—É—á–∞—é—â–∏—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é.

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞

### –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è

- **Python 3.13+**: –ì–ª—É–±–æ–∫–æ–µ –∑–Ω–∞–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞, –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, –º–µ—Ç–∞–∫–ª–∞—Å—Å–æ–≤, –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Python**: –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ (typing), dataclasses, async/await, structural pattern matching
- **–≠–∫–æ—Å–∏—Å—Ç–µ–º–∞ Python**: PyPI, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, packaging, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (pytest, unittest)

### –ü–∞—Ä–∞–¥–∏–≥–º—ã –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

- **–û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º, SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ**: Lambda-—Ñ—É–Ω–∫—Ü–∏–∏, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã, –∏—Ç–µ—Ä–∞—Ç–æ—Ä—ã
- **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: Singleton, Factory, Observer, Strategy, –∏ –¥—Ä—É–≥–∏–µ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- **–ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- **IDE –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã**: VS Code, PyCharm, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ—Ç–ª–∞–¥–∫–∏**: pdb, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **–°–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π**: Git, GitFlow
- **CI/CD**: GitHub Actions, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## 3. –ü–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∞—è —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞

### –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –æ–±—É—á–µ–Ω–∏—è

- **–ì—Ä–∞–¥–∞—Ü–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏**: –£–º–µ–Ω–∏–µ –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É
- **Scaffolding**: –ü–æ—ç—Ç–∞–ø–Ω–æ–µ —Å–Ω—è—Ç–∏–µ "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ª–µ—Å–æ–≤" –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è
- **–ü—Ä–∞–∫—Ç–∏–∫–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –ö–∞–∂–¥–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –ø–æ–¥–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏

### –†–∞–±–æ—Ç–∞ —Å –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π

- **–ù–æ–≤–∏—á–∫–∏**: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–π –∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö
- **–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏**: –ó–Ω–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –æ–ø—ã—Ç–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤
- **–°–º–µ—à–∞–Ω–Ω–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è**: –£–º–µ–Ω–∏–µ –ø–∏—Å–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –±—ã–ª–æ –ø–æ–ª–µ–∑–Ω–æ –∏ —Ç–µ–º, –∏ –¥—Ä—É–≥–∏–º

## 4. –û–ø—ã—Ç –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –æ–ø—ã—Ç

- **10+ –ª–µ—Ç** –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –Ω–∞ Python
- **–ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ**: –û–ø—ã—Ç –æ–±—É—á–µ–Ω–∏—è junior-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **Code review**: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫ –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫
- **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ legacy-–∫–æ–¥–∞**: –ó–Ω–∞–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–µ –∑–Ω–∞–Ω–∏—è

- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã**: –ó–Ω–∞–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ä–∞–∑–≤–∏—Ç–∏—è Python
- **Production-–ø—Ä–∞–∫—Ç–∏–∫–∏**: –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –∫–æ–¥—É –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- **Troubleshooting**: –£–º–µ–Ω–∏–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±—ä—è—Å–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º

```

## `doc/writers_prompts/03_styles_compentent_mentor.md`

```md
# –ú–û–î–£–õ–¨: STYLE_GUIDE (–ê–≤—Ç–æ—Ä—Å–∫–∏–π –°—Ç–∏–ª—å)

# –í–ê–†–ò–ê–ùT: Competent Mentor (–ö–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫)

## 1. –û–±—â–∏–π —Ç–æ–Ω –∏ –≥–æ–ª–æ—Å

–¢–≤–æ–π –≥–æ–ª–æ—Å ‚Äî –≥–æ–ª–æ—Å –æ–ø—ã—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ä—à–µ–≥–æ –∫–æ–ª–ª–µ–≥–∏ –∏–ª–∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞. –¢—ã –æ–±—â–∞–µ—à—å—Å—è —Å —á–∏—Ç–∞—Ç–µ–ª–µ–º –Ω–∞ "–≤—ã", —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ, –Ω–æ –±–µ–∑ –∏–∑–ª–∏—à–Ω–µ–≥–æ —Ñ–æ—Ä–º–∞–ª–∏–∑–º–∞. –¢–≤–æ–π —Ç–æ–Ω ‚Äî —Å–ø–æ–∫–æ–π–Ω—ã–π, —É–≤–µ—Ä–µ–Ω–Ω—ã–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–π.

- **–ò–∑–±–µ–≥–∞–π:** –ü–∞–Ω–∏–±—Ä–∞—Ç—Å—Ç–≤–∞, –∑–∞–∏—Å–∫–∏–≤–∞–Ω–∏—è, —á—Ä–µ–∑–º–µ—Ä–Ω–æ –≤–æ—Å—Ç–æ—Ä–∂–µ–Ω–Ω—ã—Ö –∏–ª–∏, –Ω–∞–æ–±–æ—Ä–æ—Ç, —Å–ª–∏—à–∫–æ–º —Å—É—Ö–∏—Ö –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫.
- **–°—Ç—Ä–µ–º–∏—Å—å –∫:** –°–æ–∑–¥–∞–Ω–∏—é –æ—â—É—â–µ–Ω–∏—è, —á—Ç–æ —Å–ª–æ–∂–Ω—É—é —Ç–µ–º—É –æ–±—ä—è—Å–Ω—è–µ—Ç –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª, –∫–æ—Ç–æ—Ä–æ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å.

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑–ª–æ–∂–µ–Ω–∏—è

–ß—Ç–æ–±—ã –º–∞—Ç–µ—Ä–∏–∞–ª –±—ã–ª –ø–æ–Ω—è—Ç–µ–Ω –∏ –Ω–æ–≤–∏—á–∫—É, –∏ –æ–ø—ã—Ç–Ω–æ–º—É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É, –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã "–ß—Ç–æ ‚Üí –ü–æ—á–µ–º—É ‚Üí –ö–∞–∫".

1. **–ß—Ç–æ (What):** –°–Ω–∞—á–∞–ª–∞ –¥–∞–π —á–µ—Ç–∫–æ–µ –∏ –ø—Ä–æ—Å—Ç–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏. –ë—É–∫–≤–∞–ª—å–Ω–æ –≤ –æ–¥–Ω–æ–º-–¥–≤—É—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö.
2. **–ü–æ—á–µ–º—É (Why):** –ó–∞—Ç–µ–º –æ–±—ä—è—Å–Ω–∏, *–∑–∞—á–µ–º* —ç—Ç–æ –Ω—É–∂–Ω–æ. –ö–∞–∫—É—é –ø—Ä–æ–±–ª–µ–º—É —ç—Ç–æ —Ä–µ—à–∞–µ—Ç? –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å? –≠—Ç–æ—Ç –±–ª–æ–∫ –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—â—É—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø–æ–ª—å–∑—É.
3. **–ö–∞–∫ (How):** –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –¥–µ—Ç–∞–ª—è–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –∏ –ø—Ä–∏–º–µ—Ä–∞–º –∫–æ–¥–∞.

## 3. –ê–Ω–∞–ª–æ–≥–∏–∏ –∏ –º–µ—Ç–∞—Ñ–æ—Ä—ã

–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏–∏, —á—Ç–æ–±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –≤–µ—â–µ–π, –Ω–æ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–≥–æ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–ª–∏ –±—ã—Ç–æ–≤–æ–≥–æ –º–∏—Ä–∞.

- **–†–∞–∑—Ä–µ—à–µ–Ω–æ:** –°—Ä–∞–≤–Ω–µ–Ω–∏—è —Å —Ä–∞–±–æ—Ç–æ–π –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏, –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ–º –µ–¥—ã –Ω–∞ –∫—É—Ö–Ω–µ, —Å–±–æ—Ä–∫–æ–π –º–µ–±–µ–ª–∏, —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º –¥–æ–º–∞, –ª–æ–≥–∏—Å—Ç–∏–∫–æ–π. (–ü—Ä–∏–º–µ—Ä: "–í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞").
- **–ó–∞–ø—Ä–µ—â–µ–Ω–æ:** –ê–Ω–∞–ª–æ–≥–∏–∏ –∏–∑ –º–∏—Ä–∞ –º–∞–≥–∏–∏, —Å–∫–∞–∑–æ–∫, –∏–≥—Ä, –∫–æ—Å–º–æ—Å–∞, –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤ ("–ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ‚Äî —ç—Ç–æ –≤–æ–ª—à–µ–±–Ω—ã–π —ç–ª—å—Ñ...").

## 4. –Æ–º–æ—Ä

–î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–µ–≥–∫–∏–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —é–º–æ—Ä. –û–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–º–µ—Å—Ç–µ–Ω –∏ –ø–æ–Ω—è—Ç–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞, IT.

- **–ú–æ–∂–Ω–æ:** –ò—Ä–æ–Ω–∏—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ, –æ—Ç—Å—ã–ª–∫–∏ –∫ –∏–∑–≤–µ—Å—Ç–Ω—ã–º IT-–º–µ–º–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ "—Ä–µ–∑–∏–Ω–æ–≤–æ–≥–æ —É—Ç–µ–Ω–∫–∞"), —Å–∞–º–æ–∏—Ä–æ–Ω–∏—è.
- **–ù–µ–ª—å–∑—è:** "–ü–ª–æ—Å–∫–∏–µ" —à—É—Ç–∫–∏, –º–µ–º—ã –∏–∑ –ø–æ–ø-–∫—É–ª—å—Ç—É—Ä—ã, –ø–∞–Ω–∏–±—Ä–∞—Ç—Å–∫–∏–π –∏–ª–∏ –æ–±–∏–¥–Ω—ã–π —é–º–æ—Ä.

## 5. –õ–∏–Ω–≥–≤–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

–≠—Ç–æ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —è–∑—ã–∫—É –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ–≥–æ —Å—Ç–∏–ª—è.

### –¢–∏–ø—ã –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

- **–ü—Ä–µ–æ–±–ª–∞–¥–∞–Ω–∏–µ**: –ü—Ä–æ—Å—Ç—ã–µ –∏ —Å–ª–æ–∂–Ω–æ—Å–æ—á–∏–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–∏–Ω–∞–º–∏—á–Ω—ã–º –∏ –ª–µ–≥–∫–∏–º
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ**: –°–ª–æ–∂–Ω–æ–ø–æ–¥—á–∏–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–æ–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ, –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö –ø—Ä–∏–¥–∞—Ç–æ—á–Ω—ã—Ö

### –ì–æ–ª–æ—Å –∏ –∑–∞–ª–æ–≥

- **–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥**: –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ ("–ú—ã —Å–æ–∑–¥–∞–¥–∏–º", "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç")
- **–ü–∞—Å—Å–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥**: –¢–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –Ω–µ–≤–∞–∂–µ–Ω

### –õ–µ–∫—Å–∏–∫–∞ –∏ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è

- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è**: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ IT-—Ç–µ—Ä–º–∏–Ω–∞ –¥–∞–≤–∞–π –∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
- **–ö–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç**: –ò–∑–±–µ–≥–∞–π ("–æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ", "–¥–∞–Ω–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å")
- **–°–ª–µ–Ω–≥**: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ç–µ–∫—Å—Ç–µ, —Ç–æ–ª—å–∫–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö

### –†–∏—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–µ–º—ã

- **–ü—Ä—è–º–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ**: –ê–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞—â–∞–π—Å—è –∫ —á–∏—Ç–∞—Ç–µ–ª—é ("–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ")
- **–í–≤–æ–¥–Ω—ã–µ —Å–ª–æ–≤–∞**: "–í–æ-–ø–µ—Ä–≤—ã—Ö", "–ö—Ä–æ–º–µ —Ç–æ–≥–æ", "–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å"
- **–†–∏—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã**: –î–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è

## 6. –ß–∏—Å–ª–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å—Ç–∏–ª—è

–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–∫ –æ—Ä–∏–µ–Ω—Ç–∏—Ä –¥–ª—è —Å–∞–º–æ–∫–æ–Ω—Ç—Ä–æ–ª—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.

- `—Å—Ç–∏–ª—å_–¥–ª—è_—Ü–∞`: [9/10] (–ù–∞—Å–∫–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –Ω–æ–≤–∏—á–∫—É, –∏ –º–∏–¥–ª—É)
- `–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∏–∑–º`: [8/10] (–£–≤–µ—Ä–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ –∑–∞–Ω—É–¥–Ω—ã–π —Ç–æ–Ω)
- `—Å–ª–æ–∂–Ω–æ—Å—Ç—å_—è–∑—ã–∫–∞`: [4/10] (–ü—Ä–æ—Å—Ç–æ–π —è–∑—ã–∫, –Ω–æ –±–µ–∑ —É–ø—Ä–æ—â–µ–Ω—á–µ—Å—Ç–≤–∞)
- `–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ_—é–º–æ—Ä–∞`: [3/10] (–†–µ–¥–∫–æ, —É–º–µ—Å—Ç–Ω–æ, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ)
- `"–≤–æ–¥—è–Ω–∏—Å—Ç–æ—Å—Ç—å"_—Ç–µ–∫—Å—Ç–∞`: [1/10] (–ú–∞–∫—Å–∏–º—É–º —Å—É—Ç–∏, –º–∏–Ω–∏–º—É–º –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤)

–ö–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞–¥—Å—Ç—Ä–æ–π–∫—É, –∏—Å–ø–æ–ª—å–∑—É–π —á–∏—Å–ª–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –¥–ª—è —Ç–µ–±—è —á–∞—Å—Ç–µ–π —á–µ—Ä–Ω–æ–≤–∏–∫–∞. –û–Ω–∏ –ø–æ–º–æ–≥—É—Ç —Ç–µ–±–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è.

```

## `doc/writers_prompts/04_formatter_base.md`

```md
# –ú–û–î–£–õ–¨: FORMATTING_RULES (–ë–∞–∑–æ–≤—ã–µ –ü—Ä–∞–≤–∏–ª–∞)

### 1. –ó–∞–≥–æ–ª–æ–≤–∫–∏

- **–ü—Ä–∞–≤–∏–ª–æ:** –ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ ‚Äî –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è (`##`), –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã ‚Äî —Ç—Ä–µ—Ç—å–µ–≥–æ (`###`). –ü–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–∏—Ç—Å—è –ø—Ä–æ–±–µ–ª –∏ –æ–¥–∏–Ω —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –ø–æ —Å–º—ã—Å–ª—É —ç–º–æ–¥–∑–∏.
- **–ü—Ä–∏–º–µ—Ä:**
`## 2. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ üß†`
`### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö üìä`

### 2. –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

- **–ü—Ä–∞–≤–∏–ª–æ:** –î–ª—è **–∫–ª—é—á–µ–≤—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤** –∏—Å–ø–æ–ª—å–∑—É–π –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç (`**—Ç–µ—Ä–º–∏–Ω**`). –î–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–∞–π–ª–æ–≤, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ–º–∞–Ω–¥ (`pip install`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–¥ (``–∫–æ–º–∞–Ω–¥–∞``).
- **–ü—Ä–∏–º–µ—Ä:**
  –ö–æ–º–∞–Ω–¥–∞ `python --version` –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à—É **—Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é** –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞.

### 3. –ë–ª–æ–∫–∏ –∫–æ–¥–∞

- **–ü—Ä–∞–≤–∏–ª–æ:** –ë–ª–æ–∫–∏ –∫–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–µ—Ä–Ω—É—Ç—ã –≤ —Ç—Ä–æ–π–Ω—ã–µ –æ–±—Ä–∞—Ç–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —è–∑—ã–∫–∞. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ç–æ—á–Ω—ã–º, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏–ª–∏ –æ—Ç—Å—Ç—É–ø–æ–≤, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö.
- **–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
–¢–µ–∫—Å—Ç –¥–æ –∫–æ–¥–∞.

```python
def some_function():
    return True
```

–¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ –∫–æ–¥–∞.

- **–ü—Ä–∏–º–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
–¢–µ–∫—Å—Ç –¥–æ –∫–æ–¥–∞.
   ```python
   def some_function():
       return True
   ```

(–û—à–∏–±–∫–∞: –ª–∏—à–Ω–∏–π –æ—Ç—Å—Ç—É–ø –ø–µ—Ä–µ–¥ –±–ª–æ–∫–æ–º –∫–æ–¥–∞ –∏ –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ)

### 4. –í—ã–Ω–æ—Å–∫–∏ (Callouts)

- **–ü—Ä–∞–≤–∏–ª–æ:** –í—ã–Ω–æ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–æ —à–∞–±–ª–æ–Ω—É `>[!type]`. –í–Ω—É—Ç—Ä–∏ –≤—ã–Ω–æ—Å–∫–∏ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ 4 —É—Ä–æ–≤–Ω—è (`####`).
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—ã–Ω–æ—Å–æ–∫:**
  - ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω–æ:** –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç, **–ø–µ—Ä–µ—á–Ω–∏** —á–µ—Ä–µ–∑ –¥–µ—Ñ–∏—Å (`-`), **–æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–¥** (`` ` ``).
  - ‚ùå **–ó–∞–ø—Ä–µ—â–µ–Ω–æ:** **–ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –±–ª–æ–∫–∏ –∫–æ–¥–∞** (`python...`), **–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏** (`1.`, `2.`), –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–Ω–æ—Å–∫–∏.
- **–ü—Ä–∏–º–µ—Ä:**

```markdown
>[!info]
>#### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã üí°
>- `git status` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
>- `git pull` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
>
>–≠—Ç–æ –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ.
```

–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –∏–∑–±–µ–≥–∞—Ç—å —Å–ª–æ–∂–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –≤–Ω—É—Ç—Ä–∏ –≤—ã–Ω–æ—Å–æ–∫, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É. –ò –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π –≤—ã–Ω–æ—Å–∫–∏ –∏–∑–ª–∏—à–Ω–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –∏ –¥–ª–∏–Ω–Ω—ã–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏.

### 5. –¶–∏—Ç–∞—Ç—ã

- **–ü—Ä–∞–≤–∏–ª–æ:** –î–ª—è —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ª–∏—á–Ω–æ—Å—Ç–µ–π, –æ—Ç—Ä—ã–≤–∫–æ–≤ –∏–∑ –∫–Ω–∏–≥ –∏–ª–∏ —Å—Ç–∏—Ö–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —Ü–∏—Ç–∞—Ç Markdown (` > `). –ù–µ –ø—É—Ç–∞–π —Å –≤—ã–Ω–æ—Å–∫–∞–º–∏ `>[!info]`.
- **–ü—Ä–∏–º–µ—Ä:**

```markdown
–ö–∞–∫ –≥–æ–≤–æ—Ä–∏–ª –õ–∏–Ω—É—Å –¢–æ—Ä–≤–∞–ª—å–¥—Å:
> Talk is cheap. Show me the code.
```

–≠—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö –º—ã—Å–ª–µ–π –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—Å—Ç–∞, –Ω–æ –Ω–µ —Å—Ç–æ–∏—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å —ç—Ç–∏–º —Å—Ç–∏–ª–µ–º, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç. –¢–µ–º –±–æ–ª–µ–µ —á—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –≤—ã–Ω–æ—Å–∫–∏ (–¥–ª—è –Ω–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤).

–¶–∏—Ç–∞—Ç—ã —Ç–∞–∫ –∂–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–∫—Ä–∞—Ç–∫–æ, —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ).

### 6. –¢–∞–±–ª–∏—Ü—ã

- **–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É, –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Markdown.
- **–ü—Ä–∏–º–µ—Ä:**

```markdown
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø    | –û–ø–∏—Å–∞–Ω–∏–µ                |
|----------|--------|-------------------------|
| `user_id`| `int`  | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä           |
```

### 7. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

- **–ü—Ä–∞–≤–∏–ª–æ:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `![[–∏–º—è_—Ñ–∞–π–ª–∞.png]]`.
- **–ü—Ä–∏–º–µ—Ä:** `![[main_window_interface.png]]`

–¢—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω –≤—Å—Ç—Ä–æ–∏—Ç—å –í–°–ï –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤ —á–∞—Å—Ç–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ —Å –∫–æ—Ç–æ—Ä—ã–º —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å. –¢—ã –ø–æ–ª—É—á–∏—à—å –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–µ—Å–ª–∏ –æ–Ω–∏ –≤–æ–æ–±—â–µ –±—É–¥—É—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å) –∏ —Å–º–æ–∂–µ—à—å —Ä–µ—à–∏—Ç—å –≤ –∫–∞–∫–æ–º –º–µ—Å—Ç–µ –æ—Ç–≤–µ—Ç–∞ –∏—Ö –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å. –¢–∞–∫ –∂–µ, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å—Ç–∞—Ç—å —á–∞—Å—Ç—å—é –æ—Ç–≤–µ—Ç–∞. –¢.–µ. —Ç—ã –º–æ–∂–µ—à—å –∏ –¥–æ–ª–∂–µ–Ω —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –Ω–∏—Ö –≤ —Ç–µ–∫—Å—Ç–µ, –≤ —Å–≤–æ–µ–º –∞–≤—Ç–æ—Ä—Å–∫–æ–º —Å—Ç–∏–ª–µ.

```

## `doc/writers_prompts/05_formatter_diff.md`

```md
# –ú–û–î–£–õ–¨: FORMATTING_PLUGIN (–ü–ª–∞–≥–∏–Ω –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–§–æ—Ä–º–∞—Ç `diff` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–æ–±–∞–≤–ª–µ–Ω–∏–π –∏ —É–¥–∞–ª–µ–Ω–∏–π) –≤ –±–ª–æ–∫–∞—Ö —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –∫–æ–¥–∞.

–≠—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–∞–≤–∫–∏ –≤ –±–æ–ª—å—à–æ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–µ, –Ω–µ —Ü–∏—Ç–∏—Ä—É—è –µ–≥–æ —Ü–µ–ª–∏–∫–æ–º. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–æ–¥—Å–≤–µ—á–µ–Ω–Ω—ã–µ –∑–µ–ª–µ–Ω—ã–º (`+`) –∏ –∫—Ä–∞—Å–Ω—ã–º (`-`) —Å—Ç—Ä–æ–∫–∏ **–±–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—É—Ç–∏ –ø—Ä–∞–≤–æ–∫.

## 2. –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –ø—Ä–∞–≤–∏–ª–∞

- **–ü—Ä–∞–≤–∏–ª–æ:** –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–ª–æ–∫ –∫–æ–¥–∞ —Å —è–∑—ã–∫–æ–º `diff`. –°—Ç—Ä–æ–∫–∏, –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å `+`, –æ–±–æ–∑–Ω–∞—á–∞—é—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Å `-` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ. –ü—Ä–æ–±–µ–ª –ø–æ—Å–ª–µ `+` –∏–ª–∏ `-` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.
- **–£—Å–ª–æ–≤–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ü—Ä–∏–º–µ–Ω—è–π —ç—Ç–æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —á–µ—Ä–Ω–æ–≤–∏–∫–µ —É–∂–µ –µ—Å—Ç—å –±–ª–æ–∫ `diff` –∏–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä—è–º–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (``) –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å. –ù–µ –¥–æ–±–∞–≤–ª—è–π `diff` –ø–æ —Å–≤–æ–µ–π –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ.
- **–ü—Ä–∏–º–µ—Ä:**

```diff
- old_variable = "–≠—Ç–æ —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç"
+ new_variable = "–≠—Ç–æ –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç"

```

```

## `doc/writers_prompts/06_formatter_mermaid.md`

```md
# –ú–û–î–£–õ–¨: FORMATTING_PLUGIN (–ü–ª–∞–≥–∏–Ω –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

## 1. –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

Mermaid ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞. –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º –ø—Ä—è–º–æ –≤ Markdown.

## 2. –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –ø—Ä–∞–≤–∏–ª–∞

- **–ü—Ä–∞–≤–∏–ª–æ:** –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∞–≥—Ä–∞–º–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–ª–æ–∫ –∫–æ–¥–∞ —Å —è–∑—ã–∫–æ–º `mermaid`.
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ):** –¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ** —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∏–ø—ã –¥–∏–∞–≥—Ä–∞–º–º, —Ç–∞–∫ –∫–∞–∫ –¥—Ä—É–≥–∏–µ –º–æ–≥—É—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è:
  - `sequenceDiagram` (–î–∏–∞–≥—Ä–∞–º–º—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
  - `classDiagram` (–î–∏–∞–≥—Ä–∞–º–º—ã –∫–ª–∞—Å—Å–æ–≤)
  - `gantt` (–î–∏–∞–≥—Ä–∞–º–º—ã –ì–∞–Ω—Ç–∞)
  - `mindmap` (–ú–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã)

- **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É:**
  - **–Ø–∑—ã–∫:** –í–µ—Å—å —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–≥—Ä–∞–º–º—ã (–≤ –±–ª–æ–∫–∞—Ö, –ø–æ–¥–ø–∏—Å—è—Ö –∫ —Å—Ç—Ä–µ–ª–∫–∞–º) **–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ**.
  - **–≠–º–æ–¥–∑–∏:** –¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–º–æ–¥–∑–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö –±–ª–æ–∫–æ–≤ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–∏—è—Ç–∏—è.

- **–£—Å–ª–æ–≤–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ü—Ä–∏–º–µ–Ω—è–π —ç—Ç–æ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å, **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —á–µ—Ä–Ω–æ–≤–∏–∫–µ —É–∂–µ –µ—Å—Ç—å –±–ª–æ–∫ `mermaid` –∏–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä—è–º–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (``) –µ–≥–æ —Å–æ–∑–¥–∞—Ç—å. –ù–µ –ø—Ä–∏–¥—É–º—ã–≤–∞–π –¥–∏–∞–≥—Ä–∞–º–º—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

- **–ü—Ä–∏–º–µ—Ä (sequenceDiagram):**

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant –°–µ—Ä–≤–µ—Ä üíæ
    –ö–ª–∏–µ–Ω—Ç->>–°–µ—Ä–≤–µ—Ä: –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –¥–∞–Ω–Ω—ã–µ
    –°–µ—Ä–≤–µ—Ä-->>–ö–ª–∏–µ–Ω—Ç: –í–µ—Ä–Ω—É—Ç—å –∑–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

```

## `doc/writers_prompts/09_main_constrains.md`

```md
# –ú–û–î–£–õ–¨: CONSTRAINTS (–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

## 1. –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ—é—Ç –Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç. –ï—Å–ª–∏ –ª—é–±–∞—è –¥—Ä—É–≥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –º–æ–¥—É–ª–µ–π –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç —ç—Ç–∏–º –∑–∞–ø—Ä–µ—Ç–∞–º, —Ç—ã –¥–æ–ª–∂–µ–Ω —Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç–∏–º –∑–∞–ø—Ä–µ—Ç–∞–º.

## 2. –°—Ç—Ä–æ–≥–∏–µ –∑–∞–ø—Ä–µ—Ç—ã –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

- **–ó–ê–ü–†–ï–©–ï–ù–û** –æ—Å—Ç–∞–≤–ª—è—Ç—å –≤ –∏—Ç–æ–≥–æ–≤–æ–º –æ—Ç–≤–µ—Ç–µ –ª—é–±—ã–µ –º–µ—Ç–∞-—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è, —Å–∞–º–æ–∞–Ω–∞–ª–∏–∑ –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã (`###`), –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –±—ã–ª–æ –≤ –ø–ª–∞–Ω–µ, –∏–ª–∏ –º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∫—É–º–µ–Ω—Ç–∞, –∑–∞–¥–∞–Ω–Ω—É—é –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–µ.
- **–ó–ê–ü–†–ï–©–ï–ù–û** —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–ª–∏ –º–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏. –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –≤–∏–¥–µ —Å–≤—è–∑–Ω–æ–≥–æ –ø—Ä–æ–∑–∞–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –¥–æ–±–∞–≤–ª—è—Ç—å —Ä–∞–∑–¥–µ–ª "–ò—Å—Ç–æ—á–Ω–∏–∫–∏", "–ó–∞–∫–ª—é—á–µ–Ω–∏–µ" –∏–ª–∏ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã", –µ—Å–ª–∏ –Ω–∞ —ç—Ç–æ –Ω–µ—Ç —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –≤ –∑–∞–¥–∞–Ω–∏–∏.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü, –≤—ã–Ω–æ—Å–æ–∫ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å –≤ –∑–∞–¥–∞–Ω–∏–∏.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —á–∏—Å–ª–æ–≤—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Å—Ç–∏–ª—è (`—Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞`, `–¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å` –∏ —Ç.–¥.), –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã. –û–Ω–∏ —è–≤–ª—è—é—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ–º –∫ –∫–∞—á–µ—Å—Ç–≤—É –æ—Ç–≤–µ—Ç–∞.
- **–ó–ê–ü–†–ï–©–ï–ù–û** –¥–æ—Å–ª–æ–≤–Ω–æ —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ò—Ö –Ω—É–∂–Ω–æ –æ—Ä–≥–∞–Ω–∏—á–Ω–æ –≤–ø–ª–µ—Ç–∞—Ç—å –≤ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.

## 3. –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç, –º—ã—Å–ª–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ–¥–∏ —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ —ç—Ç–æ–º—É —á–µ–∫-–ª–∏—Å—Ç—É:

- ‚úÖ –ù–µ –Ω–∞—Ä—É—à–∏–ª –ª–∏ —è –æ–¥–Ω–æ –∏–∑ –ø—Ä–∞–≤–∏–ª –∏–∑ —Å–ø–∏—Å–∫–∞ "–°—Ç—Ä–æ–≥–∏–µ –∑–∞–ø—Ä–µ—Ç—ã"?
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –º–æ–π –æ—Ç–≤–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (–Ω–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª / –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)?
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω—ã –ª–∏ –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ –º–æ–¥—É–ª–µ–π —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?
- ‚úÖ –ü—Ä–µ–≤—Ä–∞—Ç–∏–ª –ª–∏ —è –≤—Å–µ —Ç–µ–∑–∏—Å—ã –∏–∑ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ –≤ —Å–≤—è–∑–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–µ –æ—Å—Ç–∞–≤–∏–≤ "—Å—ã—Ä—ã—Ö" —Å–ø–∏—Å–∫–æ–≤?
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å–µ–º –∑–∞–¥–∞–Ω–Ω—ã–º —á–∏—Å–ª–æ–≤—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º?

```

## `doc/writers_prompts/99_final_sample.md`

```md
# –≠–¢–ê–õ–û–ù–ù–´–ô –ü–†–ò–ú–ï–† –ò–î–ï–ê–õ–¨–ù–û–ì–û –†–ï–ó–£–õ–¨–¢–ê–¢–ê

## –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –≤ Python

–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º ‚Äî —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤), –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–∂–¥—ã–π –∫–ª–∞—Å—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –ø–æ-—Å–≤–æ–µ–º—É. –í Python –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ duck typing.

–ó–∞—á–µ–º –Ω—É–∂–µ–Ω –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º? –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ, –Ω–µ –∑–Ω–∞—è –∏—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥.

### Duck Typing ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è Python

**Duck typing** ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–æ–ø–æ–ª–∞–≥–∞—é—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –≤ Python.

> –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—Ç —Ñ—Ä–∞–∑—ã: "–ï—Å–ª–∏ —ç—Ç–æ —Ö–æ–¥–∏—Ç –∫–∞–∫ —É—Ç–∫–∞ –∏ –∫—Ä—è–∫–∞–µ—Ç –∫–∞–∫ —É—Ç–∫–∞, —Ç–æ —ç—Ç–æ, –≤–µ—Ä–æ—è—Ç–Ω–æ, —É—Ç–∫–∞". –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã, —Ç–æ –µ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø –Ω–µ –≤–∞–∂–µ–Ω.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä, –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É—é—â–∏–π duck typing:

```python
# –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
class Shape:
    def area(self):
        raise NotImplementedError("–ú–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω")

# –î–æ—á–µ—Ä–Ω–∏–µ –∫–ª–∞—Å—Å—ã
class Rectangle(Shape):
    def __init__(self, width, height):
        self.width = width
        self.height = height
    
    def area(self):
        return self.width * self.height

class Circle(Shape):
    def __init__(self, radius):
        self.radius = radius
    
    def area(self):
        return 3.14159 * self.radius ** 2

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
shapes = [Rectangle(5, 3), Circle(4)]
for shape in shapes:
    print(f"–ü–ª–æ—â–∞–¥—å: {shape.area()}")
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Ü–∏–∫–ª–µ –º—ã –≤—ã–∑—ã–≤–∞–µ–º `shape.area()`, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è, –∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –∫–ª–∞—Å—Å. Python —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–∞ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ (method overriding) ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–æ—á–µ—Ä–Ω–∏–π –∫–ª–∞—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–∞, —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –∫–ª–∞—Å—Å–µ. –í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –∫–ª–∞—Å—Å—ã `Rectangle` –∏ `Circle` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –º–µ—Ç–æ–¥ `area()`, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–∏.

–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏–µ –º–µ–∂–¥—É —ç—Ç–∏–º –ø–æ–¥—Ö–æ–¥–æ–º –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–æ–≤:

```python
# ‚ùå –ü–ª–æ—Ö–æ: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –≤–º–µ—Å—Ç–æ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞
def calculate_area(shape):
    if isinstance(shape, Rectangle):
        return shape.width * shape.height
    elif isinstance(shape, Circle):
        return 3.14159 * shape.radius ** 2
    else:
        raise ValueError("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ñ–∏–≥—É—Ä—ã")

# ‚úÖ –•–æ—Ä–æ—à–æ: –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º
def calculate_area(shape):
    return shape.area()  # –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç –∑–Ω–∞–µ—Ç, –∫–∞–∫ –≤—ã—á–∏—Å–ª–∏—Ç—å —Å–≤–æ—é –ø–ª–æ—â–∞–¥—å
```

–ü–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –ª—É—á—à–µ, –ø–æ—Å–∫–æ–ª—å–∫—É –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ñ–∏–≥—É—Ä—ã –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `calculate_area()` ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–æ–º `area()`.

### –ü—Ä–æ—Ç–æ–∫–æ–ª—ã typing –¥–ª—è —è–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

–ù–∞—á–∏–Ω–∞—è —Å Python 3.8, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `typing.Protocol` –¥–ª—è —è–≤–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –æ–±—ä–µ–∫—Ç:

```python
from typing import Protocol

class Drawable(Protocol):
    def area(self) -> float:
        ...
    
    def perimeter(self) -> float:
        ...

def print_shape_info(shape: Drawable) -> None:
    print(f"–ü–ª–æ—â–∞–¥—å: {shape.area():.2f}")
    print(f"–ü–µ—Ä–∏–º–µ—Ç—Ä: {shape.perimeter():.2f}")
```

–ü—Ä–æ—Ç–æ–∫–æ–ª—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ‚Äî –ª—é–±–æ–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ—Ç–æ–∫–æ–ª—É.

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

–í —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–≥–∏–Ω–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Å–∏—Å—Ç–µ–º—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π:

```python
from abc import ABC, abstractmethod

class PaymentProcessor(ABC):
    """
    –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π.
    """
    @abstractmethod
    def process_payment(self, amount: float) -> bool:
        pass

class CreditCardProcessor(PaymentProcessor):
    """
    –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ.
    """
    def process_payment(self, amount: float) -> bool:
        # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –∫—Ä–µ–¥–∏—Ç–Ω–æ–π –∫–∞—Ä—Ç–µ
        print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ {amount} —Ä—É–±. —á–µ—Ä–µ–∑ –∫—Ä–µ–¥–∏—Ç–Ω—É—é –∫–∞—Ä—Ç—É")
        return True

class PayPalProcessor(PaymentProcessor):
    def process_payment(self, amount: float) -> bool:
        # –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ PayPal
        print(f"–û–±—Ä–∞–±–æ—Ç–∫–∞ {amount} —Ä—É–±. —á–µ—Ä–µ–∑ PayPal")
        return True

# –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
def handle_purchase(processor: PaymentProcessor, amount: float):
    if processor.process_payment(amount):
        print("–ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω")
    else:
        print("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –ø–ª–∞—Ç–µ–∂–∞")
```

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã, –Ω–µ –∏–∑–º–µ–Ω—è—è –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–∫—É–ø–æ–∫.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞

```mermaid
classDiagram
    class Shape {
        <<abstract>>
        +area() float*
        +perimeter() float*
        +get_name() str*
    }
    
    class Rectangle {
        -width: float
        -height: float
        +__init__(width, height)
        +area() float
        +perimeter() float
        +get_name() str
    }
    
    class Circle {
        -radius: float
        -PI: float = 3.14159
        +__init__(radius)
        +area() float
        +perimeter() float
        +get_name() str
    }
    
    class Triangle {
        -base: float
        -height: float
        -side_a: float
        -side_b: float
        +__init__(base, height)
        +area() float
        +perimeter() float
        +get_name() str
    }
    
    class Square {
        -side: float
        +__init__(side)
        +area() float
        +perimeter() float
        +get_name() str
    }
    
    Shape <|-- Rectangle : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
    Shape <|-- Circle : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
    Shape <|-- Triangle : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
    Rectangle <|-- Square : —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç
    
    note for Shape "üéØ –ë–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å\n–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä\n–ú–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã"
    
    note for Rectangle "üìê –ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫\n–ü–ª–æ—â–∞–¥—å: width √ó height\n–ü–µ—Ä–∏–º–µ—Ç—Ä: 2 √ó (width + height)"
    
    note for Circle "‚≠ï –ö—Ä—É–≥\n–ü–ª–æ—â–∞–¥—å: œÄ √ó radius¬≤\n–ü–µ—Ä–∏–º–µ—Ç—Ä: 2 √ó œÄ √ó radius"
    
    note for Triangle "üî∫ –¢—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫\n–ü–ª–æ—â–∞–¥—å: (base √ó height) / 2\n–ü–µ—Ä–∏–º–µ—Ç—Ä: —Å—É–º–º–∞ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω"
    
    note for Square "‚óªÔ∏è –ö–≤–∞–¥—Ä–∞—Ç (—á–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π)\n–ù–∞—Å–ª–µ–¥—É–µ—Ç Rectangle\nwidth = height = side"
    
    style Shape fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#fff
    style Rectangle fill:#4ecdc4,stroke:#0a9396,stroke-width:2px,color:#fff
    style Circle fill:#4ecdc4,stroke:#0a9396,stroke-width:2px,color:#fff
    style Triangle fill:#4ecdc4,stroke:#0a9396,stroke-width:2px,color:#fff
    style Square fill:#ffd93d,stroke:#f4a261,stroke-width:2px,color:#000
```

*–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–ª–∞—Å—Å–æ–≤ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π*

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º —Ä–µ—à–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞. –í–º–µ—Å—Ç–æ –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ç–∏–ø–æ–≤ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –≥–∏–±–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∫–æ—Ç–æ—Ä–∞—è –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ —á–µ—Ä–µ–∑ –≥–æ–¥ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –µ—â–µ –¥–µ—Å—è—Ç–∏ —Ç–∏–ø–æ–≤ —Ñ–∏–≥—É—Ä. –° –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º —ç—Ç–æ –∑–∞–π–º–µ—Ç –º–∏–Ω—É—Ç—ã ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã —Å –º–µ—Ç–æ–¥–æ–º `area()`. –ë–µ–∑ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ –≤–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ `elif` –±–ª–æ–∫–∏ –≤ –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é.

–≠—Ç–æ –∏ –µ—Å—Ç—å —Å–∏–ª–∞ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–∞ ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∏—Å–∞—Ç—å –∫–æ–¥ –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–ø–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –µ—â–µ –¥–∞–∂–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞.

```

## `main.py`

```py
import logging
from contextlib import asynccontextmanager

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi_users import FastAPIUsers

from auth.backend import auth_backend
from auth.manager import get_user_manager
from core.logging_config import setup_logging
from models.user import User
from routes import categories, products, tags, cart, orders
from schemas.user import UserCreate, UserRead, UserUpdate

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è
setup_logging(log_level="INFO")
logger = logging.getLogger(__name__)


@asynccontextmanager
async def lifespan(app: FastAPI):
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    logger.info("üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI")
    logger.info("üìã –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–æ–≤: categories, tags, products")
    yield
    logger.info("üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI")


# --- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI ---
app = FastAPI(
    title="–£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Python419",
    description="–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏",
    version="2.0.0",
    lifespan=lifespan,
)

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ ---
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:5173",  # Vite dev server (React)
        "http://localhost:3000",  # Create React App dev server
        "http://127.0.0.1:5173",
        "http://127.0.0.1:3000",
    ],
    allow_credentials=True,  # –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∫—É–∫–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    allow_methods=["*"],  # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ HTTP –º–µ—Ç–æ–¥—ã (GET, POST, PUT, DELETE, etc.)
    allow_headers=["*"],  # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
)

# --- FastAPI Users (Auth) ---
fastapi_users = FastAPIUsers[User, int](
    get_user_manager,
    [auth_backend],
)

app.include_router(
    fastapi_users.get_auth_router(auth_backend),
    prefix="/auth",
    tags=["Auth"],
)

app.include_router(
    fastapi_users.get_register_router(UserRead, UserCreate),
    prefix="/auth",
    tags=["Auth"],
)

app.include_router(
    fastapi_users.get_users_router(UserRead, UserUpdate),
    prefix="/users",
    tags=["Users"],
)

app.include_router(
    categories.router, prefix="/categories", tags=["–ö–∞—Ç–µ–≥–æ—Ä–∏–∏"]
)  # "/{category_id}",
app.include_router(tags.router, prefix="/tags", tags=["–¢–µ–≥–∏"])
app.include_router(products.router, prefix="/products", tags=["–¢–æ–≤–∞—Ä—ã"])
app.include_router(cart.router, prefix="/cart", tags=["–ö–æ—Ä–∑–∏–Ω–∞"])
app.include_router(orders.router, prefix="/orders", tags=["–ó–∞–∫–∞–∑—ã"])

# –†–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ (–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
# "/uploads" - –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
# directory="uploads" - –ø–∞–ø–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –≥–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ñ–∞–π–ª—ã
# name - –∏–º—è –º–æ–Ω—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è - –æ–Ω–æ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ URL
app.mount("/uploads", StaticFiles(directory="uploads"), name="uploads")

logger.info("‚úÖ –í—Å–µ —Ä–æ—É—Ç–µ—Ä—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω—ã (–≤–∫–ª—é—á–∞—è Auth)")

```

## `models/__init__.py`

```py
# models/__init__.py
"""
–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è Alembic autogenerate.
"""

from models.base import Base
from models.commerce import Cart, CartItem, Order, OrderItem
from models.product import Category, Product, Tag, product_tag_association
from models.user import User

__all__ = [
    "Base",
    "User",
    "Category",
    "Tag",
    "Product",
    "product_tag_association",
    "Cart",
    "CartItem",
    "Order",
    "OrderItem",
]

```

## `models/base.py`

```py
# models/base.py
from sqlalchemy.orm import DeclarativeBase


class Base(DeclarativeBase):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π SQLAlchemy"""

    pass

```

## `models/commerce.py`

```py
# models/commerce.py
from datetime import datetime
from typing import TYPE_CHECKING, List

from sqlalchemy import DateTime, Float, ForeignKey, Integer, String, Text
from sqlalchemy.orm import Mapped, mapped_column, relationship

from models.base import Base

if TYPE_CHECKING:
    from models.product import Product


class Cart(Base):
    """–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. One-to-One —Å User."""

    __tablename__ = "carts"

    id: Mapped[int] = mapped_column(primary_key=True)
    user_id: Mapped[int] = mapped_column(
        Integer, ForeignKey("user.id", ondelete="CASCADE"), unique=True, nullable=False
    )

    # –°–≤—è–∑—å —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –∫–æ—Ä–∑–∏–Ω—ã
    items: Mapped[List["CartItem"]] = relationship(
        back_populates="cart",
        lazy="raise_on_sql",
        cascade="all, delete-orphan",  # –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    )


class CartItem(Base):
    """–ü–æ–∑–∏—Ü–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ. Many-to-One —Å Cart –∏ Product."""

    __tablename__ = "cart_items"

    id: Mapped[int] = mapped_column(primary_key=True)
    cart_id: Mapped[int] = mapped_column(
        Integer, ForeignKey("carts.id", ondelete="CASCADE"), nullable=False
    )
    product_id: Mapped[int] = mapped_column(
        Integer, ForeignKey("products.id", ondelete="CASCADE"), nullable=False
    )
    quantity: Mapped[int] = mapped_column(Integer, default=1, nullable=False)

    # –°–≤—è–∑–∏
    cart: Mapped["Cart"] = relationship(back_populates="items", lazy="raise_on_sql")
    product: Mapped["Product"] = relationship(lazy="raise_on_sql")


class Order(Base):
    """–ó–∞–∫–∞–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""

    __tablename__ = "orders"

    id: Mapped[int] = mapped_column(primary_key=True)
    user_id: Mapped[int] = mapped_column(
        Integer, ForeignKey("user.id", ondelete="CASCADE"), nullable=False, index=True
    )

    # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
    created_at: Mapped[datetime] = mapped_column(
        DateTime, default=datetime.utcnow, nullable=False
    )

    # –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Enum)
    status: Mapped[str] = mapped_column(
        String(50), default="pending", nullable=False, index=True
    )

    # –§–∏–∫—Å–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
    total_amount: Mapped[float] = mapped_column(Float, nullable=False)

    # –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏
    delivery_address: Mapped[str] = mapped_column(Text, nullable=False)
    phone: Mapped[str] = mapped_column(String(20), nullable=False)

    # –°–≤—è–∑—å —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –∑–∞–∫–∞–∑–∞
    items: Mapped[List["OrderItem"]] = relationship(
        back_populates="order",
        lazy="raise_on_sql",
        cascade="all, delete-orphan",
    )


class OrderItem(Base):
    """
    –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫–∞–∑–∞ - –°–õ–ï–ü–û–ö —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏.
    –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–Ω—É –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –º–µ–Ω—è–ª–∞—Å—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–∞.
    """

    __tablename__ = "order_items"

    id: Mapped[int] = mapped_column(primary_key=True)
    order_id: Mapped[int] = mapped_column(
        Integer, ForeignKey("orders.id", ondelete="CASCADE"), nullable=False
    )

    # product_id –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –¥–ª—è —Å–≤—è–∑–∏, –Ω–æ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä–µ–º –∏–∑ frozen –ø–æ–ª–µ–π
    product_id: Mapped[int] = mapped_column(Integer, nullable=False)

    quantity: Mapped[int] = mapped_column(Integer, nullable=False)

    # === –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ===
    # –ö–æ–ø–∏—Ä—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É –∏–∑ Product –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞
    frozen_name: Mapped[str] = mapped_column(String(100), nullable=False)
    frozen_price: Mapped[float] = mapped_column(Float, nullable=False)

    # –°–≤—è–∑–∏
    order: Mapped["Order"] = relationship(back_populates="items", lazy="raise_on_sql")

```

## `models/product.py`

```py
# models/product.py
from typing import List, Optional
from sqlalchemy import Column, Table, String, Integer, Float, ForeignKey, Text, Index
from sqlalchemy.orm import Mapped, mapped_column, relationship

# –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –º–æ–¥–µ–ª–µ–π –∏–∑ —Ç–æ–≥–æ –∂–µ –ø–∞–∫–µ—Ç–∞
from models.base import Base


# --- –ê—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ M2M ---
product_tag_association = Table(
    "product_tag_association",
    Base.metadata,
    Column(
        "product_id",
        Integer,
        ForeignKey("products.id", ondelete="CASCADE"),
        primary_key=True,
    ),
    Column(
        "tag_id",
        Integer,
        ForeignKey("tags.id", ondelete="CASCADE"),
        primary_key=True,
    ),
)


class Category(Base):
    __tablename__ = "categories"

    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(
        String(100), unique=True, nullable=False, index=True
    )

    # –°–≤—è–∑—å –æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
    products: Mapped[List["Product"]] = relationship(
        back_populates="category",
        lazy="raise_on_sql",  # –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ async
        cascade="save-update, merge",  # –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–∞—Å–∫–∞–¥
    )


class Tag(Base):
    __tablename__ = "tags"

    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(
        String(50), unique=True, nullable=False, index=True
    )

    # –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
    products: Mapped[List["Product"]] = relationship(
        secondary=product_tag_association,
        back_populates="tags",
        lazy="raise_on_sql",  # –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤ async
        cascade="save-update, merge",  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–∞—Å–∫–∞–¥ –¥–ª—è M2M
    )


class Product(Base):
    __tablename__ = "products"

    id: Mapped[int] = mapped_column(primary_key=True)

    # –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ LIKE/ILIKE
    name: Mapped[str] = mapped_column(String(100), nullable=False, index=True)

    # Text –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π, –º–æ–∂–µ—Ç –±—ã—Ç—å NULL
    description: Mapped[Optional[str]] = mapped_column(Text, nullable=True)

    # URL –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º (—É–≤–µ–ª–∏—á–µ–Ω –¥–æ 500 –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –ø—É—Ç–µ–π)
    image_url: Mapped[Optional[str]] = mapped_column(String(500), nullable=True)

    # –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ü–µ–Ω—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    price_shmeckles: Mapped[float] = mapped_column(Float, nullable=False, index=True)
    price_flurbos: Mapped[float] = mapped_column(Float, nullable=False, index=True)

    # --- –°–≤—è–∑–∏ ---

    # –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–º–æ–∂–µ—Ç –±—ã—Ç—å NULL)
    category_id: Mapped[Optional[int]] = mapped_column(
        ForeignKey("categories.id", ondelete="SET NULL"),
        index=True,  # –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è JOIN'–æ–≤
    )

    # –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫-–æ–¥–Ω–æ–º—É —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
    category: Mapped[Optional["Category"]] = relationship(
        back_populates="products",
        lazy="raise_on_sql",
    )

    # –°–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å —Ç–µ–≥–∞–º–∏
    tags: Mapped[List["Tag"]] = relationship(
        secondary=product_tag_association,
        back_populates="products",
        lazy="raise_on_sql",
        cascade="save-update, merge",  # ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è M2M
    )

    # –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    __table_args__ = (
        Index("ix_product_category_price", "category_id", "price_shmeckles"),
    )

```

## `models/user.py`

```py
from fastapi_users_db_sqlalchemy import SQLAlchemyBaseUserTable
from sqlalchemy import Integer
from sqlalchemy.orm import Mapped, mapped_column

from models.base import Base


class User(SQLAlchemyBaseUserTable[int], Base):
    """–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è fastapi-users."""

    __tablename__ = "user"

    id: Mapped[int] = mapped_column(Integer, primary_key=True)

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    # first_name: Mapped[str | None]

    # –°–≤—è–∑–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –∫–æ—Ä–∑–∏–Ω–æ–π, –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ:
    # cart = relationship("Cart", uselist=False, back_populates="user")

```

## `QUICKSTART.md`

```md
# üöÄ –ë—ã—Å—Ç—Ä–∞—è —à–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–æ–¥–∏–Ω —Ä–∞–∑)

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```powershell
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```powershell
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª .env –∏–∑ –ø—Ä–∏–º–µ—Ä–∞
Copy-Item .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env (—É–∫–∞–∑–∞—Ç—å DATABASE_URL –∏ Telegram bot key)
notepad .env
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env`:**

```env
# Telegram bot (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
TELEGRAM_BOT_API_KEY=your_bot_api_key
TELEGRAM_USER_ID=your_user_id

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
DATABASE_URL=sqlite+aiosqlite:///./test.db
```

### 3Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–í–ê–ñ–ù–û:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Alembic (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π).

```powershell
# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã)
alembic upgrade head
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –ë–î:**

- `categories` - —Ç–∞–±–ª–∏—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ç–æ–≤–∞—Ä–æ–≤
- `tags` - —Ç–∞–±–ª–∏—Ü–∞ —Ç–µ–≥–æ–≤
- `products` - —Ç–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
- `product_tag_association` - —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏
- `alembic_version` - —Å–ª—É–∂–µ–±–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã

---

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ (–∫–∞–∂–¥—ã–π —Ä–∞–∑)

```powershell
# 1. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å FastAPI —Å–µ—Ä–≤–µ—Ä
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

**–ì–æ—Ç–æ–≤–æ!** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: <http://localhost:8000>

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å FastAPI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: <http://localhost:8000/docs>

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print([t[0] for t in conn.execute('SELECT name FROM sqlite_master WHERE type=\"table\"').fetchall()]); conn.close()"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
alembic current
```

---

## üìã –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ Alembic

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
alembic current

# –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ—á–∏—Å—Ç–∏—Ç—å –ë–î)
alembic downgrade base
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π)

```powershell
# 1. –ò–∑–º–µ–Ω–∏—Ç–µ –º–æ–¥–µ–ª–∏ –≤ models/product.py

# 2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
alembic revision --autogenerate -m "Add new field to products"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ alembic/versions/

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

---

## ‚ùå –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: Alembic –Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ë–î –≤—Ä—É—á–Ω—É—é
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è (–Ω–µ—Ç —Ç–∞–±–ª–∏—Ü)

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –µ—Å—Ç—å —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
dir alembic\versions

# 2. –ï—Å–ª–∏ –∏—Ö –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –ø—É—Å—Ç—ã–µ - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
alembic downgrade base
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Initial migration"

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–°–∏–º–ø—Ç–æ–º**: –ü–æ—Å–ª–µ `alembic upgrade head` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ `alembic_version`, –Ω–æ –Ω–µ—Ç –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü.

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å
alembic downgrade base
del test.db
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –≤—Å—ë —Å –Ω—É–ª—è
python -c "import sqlite3; sqlite3.connect('test.db').close()"
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥–µ–ª–µ–π –≤ alembic/env.py

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ `alembic/env.py` –µ—Å—Ç—å –∏–º–ø–æ—Ä—Ç—ã:

```python
from models.base import Base
from models.product import Product, Category, Tag, product_tag_association
target_metadata = Base.metadata
```

---

## üîÑ –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –ë–î (–µ—Å–ª–∏ –≤—Å—ë —Å–ª–æ–º–∞–ª–æ—Å—å)

```powershell
# 1. –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade base

# 2. –£–¥–∞–ª–∏—Ç—å –ë–î
del test.db

# 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# 4. –°–æ–∑–¥–∞—Ç—å –ë–î
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# 5. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Initial migration"

# 6. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
alembic current
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print([t[0] for t in conn.execute('SELECT name FROM sqlite_master WHERE type=\"table\"').fetchall()]); conn.close()"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
['alembic_version', 'categories', 'tags', 'products', 'product_tag_association']
```

---

## üåê –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Swagger UI**: <http://localhost:8000/docs>
- **ReDoc**: <http://localhost:8000/redoc>
- **API Root**: <http://localhost:8000/>

---

## üí° –°–æ–≤–µ—Ç—ã

1. **–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ –ë–î –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏!
2. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π**: –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `alembic revision --autogenerate`
3. **–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`alembic current`)
4. **–î–ª—è –æ—Ç–ª–∞–¥–∫–∏**: –í–∫–ª—é—á–∏—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –≤ `core/database.py` (`echo=True`)
5. **Backup –ë–î**: –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `test.db` –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```

## `README.md`

```md
# FastAPI + SQLAlchemy + Alembic - –£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Python419

API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ —Ç–µ–≥–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö SQLite.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

**Python 3.10+** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (PowerShell)
.\venv\Scripts\Activate.ps1

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env`:

   ```powershell
   Copy-Item .env.example .env
   ```

2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

   ```env
   # Telegram bot (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
   TELEGRAM_BOT_API_KEY=your_bot_api_key
   TELEGRAM_USER_ID=your_user_id
   
   # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite
   DATABASE_URL=sqlite+aiosqlite:///./test.db
   ```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Alembic (–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π).

```powershell
# –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã)
alembic upgrade head

# –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
alembic current
```

**–ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

- `categories` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- `tags` - —Ç–µ–≥–∏ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
- `products` - —Ç–æ–≤–∞—Ä—ã —Å —Ü–µ–Ω–∞–º–∏ –≤ —à–º–µ–∫–ª—è—Ö –∏ —Ñ–ª—É—Ä–±–æ
- `product_tag_association` - —Å–≤—è–∑—å –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º (M2M) –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏
- `alembic_version` - —Å–ª—É–∂–µ–±–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã –ë–î

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```powershell
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\venv\Scripts\Activate.ps1

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ FastAPI —Å–µ—Ä–≤–µ—Ä
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞, API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8000`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

- **Swagger UI**: <http://localhost:8000/docs>
- **ReDoc**: <http://localhost:8000/redoc>

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```http
GET http://localhost:8000/categories/
```

#### 2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é

```http
POST http://localhost:8000/categories/
Content-Type: application/json

{
  "name": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞"
}
```

#### 3. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–µ–≥–∏

```http
GET http://localhost:8000/tags/
```

#### 4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥

```http
POST http://localhost:8000/tags/
Content-Type: application/json

{
  "name": "–ù–æ–≤–∏–Ω–∫–∞"
}
```

#### 5. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤

```http
GET http://localhost:8000/products/
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:**

- `?name=rick` - –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏
- `?category_id=1` - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `?tag_ids=1,2` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–≥–∞–º (–Ω–µ—Å–∫–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- `?min_price_shmeckles=10&max_price_shmeckles=100` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ –≤ —à–º–µ–∫–ª—è—Ö

#### 6. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID

```http
GET http://localhost:8000/products/1
```

#### 7. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä

```http
POST http://localhost:8000/products/
Content-Type: application/json

{
  "name": "–ü–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞",
  "description": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞ –æ—Ç Rick",
  "image_url": "https://example.com/portal-gun.jpg",
  "price_shmeckles": 250.5,
  "price_flurbos": 180.0,
  "category_id": 1,
  "tag_ids": [1, 2]
}
```

#### 8. –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä

```http
PUT http://localhost:8000/products/1
Content-Type: application/json

{
  "name": "–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞",
  "price_shmeckles": 300.0
}
```

#### 9. –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä

```http
DELETE http://localhost:8000/products/1
```

---

## üóÑÔ∏è –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **SQLAlchemy 2.0** —Å async –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∏ **Alembic** –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π.

**–ú–æ–¥–µ–ª–∏ (tables):**

1. **Category** (One-to-Many —Å Product)
   - `id` - PRIMARY KEY
   - `name` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è)

2. **Tag** (Many-to-Many —Å Product)
   - `id` - PRIMARY KEY
   - `name` - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ç–µ–≥–∞ (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è)

3. **Product**
   - `id` - PRIMARY KEY
   - `name` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞)
   - `description` - –æ–ø–∏—Å–∞–Ω–∏–µ (TEXT, nullable)
   - `image_url` - —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (nullable)
   - `price_shmeckles` - —Ü–µ–Ω–∞ –≤ —à–º–µ–∫–ª—è—Ö (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è)
   - `price_flurbos` - —Ü–µ–Ω–∞ –≤ —Ñ–ª—É—Ä–±–æ (–∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è)
   - `category_id` - FOREIGN KEY –Ω–∞ categories (nullable, ON DELETE SET NULL)

4. **product_tag_association** (–∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)
   - `product_id` - FOREIGN KEY –Ω–∞ products (ON DELETE CASCADE)
   - `tag_id` - FOREIGN KEY –Ω–∞ tags (ON DELETE CASCADE)

### –ö–æ–º–∞–Ω–¥—ã Alembic

#### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
alembic current

# –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ–±–Ω–æ–≤–∏—Ç—å –ë–î –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏)
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ë–î)
alembic downgrade base
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π –≤ `models/product.py`:

```powershell
# 1. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ –∫–ª–∞—Å—Å Product)

# 2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
alembic revision --autogenerate -m "Add stock_quantity to products"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ alembic/versions/xxxxx_add_stock_quantity.py

# 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä SQL –±–µ–∑ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å SQL –∫–æ–º–∞–Ω–¥—ã –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
alembic upgrade head --sql
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print([t[0] for t in conn.execute('SELECT name FROM sqlite_master WHERE type=\"table\"').fetchall()]); conn.close()"

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print(conn.execute('PRAGMA table_info(products)').fetchall()); conn.close()"
```

### –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –ë–î

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```powershell
# 1. –û—Ç–∫–∞—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade base

# 2. –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ë–î
del test.db

# 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞)
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# 4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª –ë–î
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# 5. –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "Initial migration"

# 6. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
alembic current
```

---

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
fast_api_419/
‚îú‚îÄ‚îÄ main.py                  # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îú‚îÄ‚îÄ data.py                  # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ .env                     # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞—Ç—å –∏–∑ .env.example)
‚îú‚îÄ‚îÄ .env.example             # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ test.db                  # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ alembic.ini              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îÇ
‚îú‚îÄ‚îÄ core/                    # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (pydantic-settings)
‚îÇ   ‚îî‚îÄ‚îÄ database.py          # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î, async engine, —Å–µ—Å—Å–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ models/                  # ORM –º–æ–¥–µ–ª–∏ SQLAlchemy
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å DeclarativeBase
‚îÇ   ‚îî‚îÄ‚îÄ product.py           # –ú–æ–¥–µ–ª–∏ Category, Tag, Product + –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
‚îÇ
‚îú‚îÄ‚îÄ schemas/                 # Pydantic —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ product.py           # –°—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ API
‚îÇ
‚îú‚îÄ‚îÄ routes/                  # –ú–∞—Ä—à—Ä—É—Ç—ã API (endpoints)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ categories.py        # CRUD –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ tags.py              # CRUD –¥–ª—è —Ç–µ–≥–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ products.py          # CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ telegram_bot.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
‚îÇ
‚îî‚îÄ‚îÄ alembic/                 # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ env.py               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è Alembic (async)
    ‚îú‚îÄ‚îÄ script.py.mako       # –®–∞–±–ª–æ–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π
    ‚îî‚îÄ‚îÄ versions/            # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
        ‚îî‚îÄ‚îÄ xxxxx_initial_migration.py
```

---

## ‚ö†Ô∏è –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞**: Alembic - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π, –æ–Ω **–ù–ï —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –ë–î**!

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ë–î –≤—Ä—É—á–Ω—É—é
python -c "import sqlite3; sqlite3.connect('test.db').close()"

# –ó–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ `alembic upgrade head` —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ `alembic_version`

**–ü—Ä–∏—á–∏–Ω–∞**: –ú–∏–≥—Ä–∞—Ü–∏—è **–ø—É—Å—Ç–∞—è** –∏–ª–∏ **–¥–≤–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏**.

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å
alembic downgrade base
del test.db
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
python -c "import sqlite3; sqlite3.connect('test.db').close()"
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
alembic current
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—É—Å—Ç–æ–π (—Ç–æ–ª—å–∫–æ `pass` –≤ `upgrade()`)

**–ü—Ä–∏—á–∏–Ω–∞**: Alembic –Ω–µ –≤–∏–¥–∏—Ç –º–æ–¥–µ–ª–∏!

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `alembic/env.py`:

```python
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —ç—Ç–∏ –∏–º–ø–æ—Ä—Ç—ã:
from models.base import Base
from models.product import Product, Category, Tag, product_tag_association

# –ò —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞:
target_metadata = Base.metadata
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –≤ `alembic/env.py`

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
python -c "from models.base import Base; from models.product import Product; print('OK')"
```

### –ü—Ä–æ–±–ª–µ–º–∞: `ModuleNotFoundError: No module named 'models'`

**–†–µ—à–µ–Ω–∏–µ**: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ **–∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞**, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–∞–ø–∫–∞ `models/`.

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ `"Target database is not up to date"`

**–†–µ—à–µ–Ω–∏–µ**:

```powershell
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –æ—à–∏–±–∫–∞ "FOREIGN KEY constraint failed"

**–ü—Ä–∏—á–∏–Ω–∞**: –£–∫–∞–∑–∞–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `category_id` –∏–ª–∏ `tag_id`.

**–†–µ—à–µ–Ω–∏–µ**: –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ç–µ–≥–∏ —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤

–í `core/database.py` –∏–∑–º–µ–Ω–∏—Ç–µ:

```python
# –ë—ã–ª–æ
engine = create_async_engine(DATABASE_URL, echo=False)

# –°—Ç–∞–ª–æ (–≤–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏ SQL)
engine = create_async_engine(DATABASE_URL, echo=True)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

```python
python -c "import asyncio; from core.database import engine; asyncio.run(engine.dispose()); print('–ë–î OK')"
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î

```powershell
# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print(conn.execute('SELECT * FROM products').fetchall()); conn.close()"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π –≤ –ë–î

```powershell
python -c "import sqlite3; conn = sqlite3.connect('test.db'); print(conn.execute('SELECT * FROM alembic_version').fetchall()); conn.close()"
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.0 Documentation](https://docs.sqlalchemy.org/en/20/)
- [Alembic Documentation](https://alembic.sqlalchemy.org/)
- [Pydantic Documentation](https://docs.pydantic.dev/)
- [Async SQLAlchemy Guide](https://docs.sqlalchemy.org/en/20/orm/extensions/asyncio.html)

---

## üíæ –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

### 1. Alembic –ù–ï —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –ë–î

**–ó–∞–ø–æ–º–Ω–∏—Ç–µ**: Alembic - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã, –∞ –ù–ï —Å–æ–∑–¥–∞–Ω–∏—è –ë–î.

```powershell
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head  # –ù–∏—á–µ–≥–æ –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è!

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—Ç—å –ë–î, –ø–æ—Ç–æ–º –º–∏–≥—Ä–∞—Ü–∏–∏
python -c "import sqlite3; sqlite3.connect('test.db').close()"
alembic upgrade head
```

### 2. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ü–æ—Å–ª–µ `alembic revision --autogenerate` **–æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
def upgrade() -> None:
    pass  # ‚ùå –ü–õ–û–•–û - –º–∏–≥—Ä–∞—Ü–∏—è –ø—É—Å—Ç–∞—è!
    
def upgrade() -> None:
    op.create_table('products', ...)  # ‚úÖ –•–û–†–û–®–û - –µ—Å—Ç—å –∫–æ–º–∞–Ω–¥—ã
```

### 3. –ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

```text
1. –°–æ–∑–¥–∞—Ç—å venv –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
2. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ë–î (python -c "import sqlite3...")
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (alembic upgrade head)
5. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (uvicorn main:app --reload)
```

### 4. –ü–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π

```text
1. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–¥–µ–ª—å –≤ models/product.py
2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (alembic revision --autogenerate -m "...")
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ alembic/versions/
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (alembic upgrade head)
5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

### 5. –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –≤—Å—ë —Å–ª–æ–º–∞–ª–æ—Å—å

```powershell
# –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å (–ø–æ—Ç–µ—Ä—è–µ—Ç–µ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
alembic downgrade base
del test.db
del alembic\versions\*.py
echo. > alembic\versions\__init__.py

# –ù–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞
python -c "import sqlite3; sqlite3.connect('test.db').close()"
alembic revision --autogenerate -m "Initial migration"
alembic upgrade head
```

### 6. –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ?  
‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã? (`pip list`)  
‚úÖ –§–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω?  
‚úÖ –§–∞–π–ª `test.db` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?  
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã? (`alembic current`)  
‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã? (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ python -c "...")  
‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000?  

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã FastAPI —Å SQLAlchemy –∏ Alembic.

```

## `requirements.txt`

```txt
√ø√æa i o s q l i t e = = 0 . 2 1 . 0 
 
 a l e m b i c = = 1 . 1 7 . 1 
 
 a n n o t a t e d - t y p e s = = 0 . 7 . 0 
 
 a n y i o = = 4 . 1 1 . 0 
 
 a r g o n 2 - c f f i = = 2 3 . 1 . 0 
 
 a r g o n 2 - c f f i - b i n d i n g s = = 2 5 . 1 . 0 
 
 b c r y p t = = 4 . 3 . 0 
 
 c e r t i f i = = 2 0 2 5 . 1 0 . 5 
 
 c f f i = = 2 . 0 . 0 
 
 c l i c k = = 8 . 3 . 0 
 
 c o l o r a m a = = 0 . 4 . 6 
 
 c r y p t o g r a p h y = = 4 6 . 0 . 3 
 
 d n s p y t h o n = = 2 . 8 . 0 
 
 e m a i l - v a l i d a t o r = = 2 . 3 . 0 
 
 f a s t a p i = = 0 . 1 1 9 . 0 
 
 f a s t a p i - u s e r s = = 1 5 . 0 . 1 
 
 f a s t a p i - u s e r s - d b - s q l a l c h e m y = = 7 . 0 . 0 
 
 g r e e n l e t = = 3 . 2 . 4 
 
 h 1 1 = = 0 . 1 6 . 0 
 
 h t t p c o r e = = 1 . 0 . 9 
 
 h t t p x = = 0 . 2 8 . 1 
 
 i d n a = = 3 . 1 1 
 
 m a k e f u n = = 1 . 1 6 . 0 
 
 M a k o = = 1 . 3 . 1 0 
 
 M a r k u p S a f e = = 3 . 0 . 3 
 
 p w d l i b = = 0 . 2 . 1 
 
 p y c p a r s e r = = 2 . 2 3 
 
 p y d a n t i c = = 2 . 1 2 . 2 
 
 p y d a n t i c - s e t t i n g s = = 2 . 1 1 . 0 
 
 p y d a n t i c _ c o r e = = 2 . 4 1 . 4 
 
 P y J W T = = 2 . 1 0 . 1 
 
 p y t h o n - d o t e n v = = 1 . 1 . 1 
 
 p y t h o n - m u l t i p a r t = = 0 . 0 . 2 0 
 
 p y t h o n - t e l e g r a m - b o t = = 2 2 . 5 
 
 s n i f f i o = = 1 . 3 . 1 
 
 S Q L A l c h e m y = = 2 . 0 . 4 4 
 
 s t a r l e t t e = = 0 . 4 8 . 0 
 
 t y p i n g - i n s p e c t i o n = = 0 . 4 . 2 
 
 t y p i n g _ e x t e n s i o n s = = 4 . 1 5 . 0 
 
 u v i c o r n = = 0 . 3 7 . 0 
 
 
```

## `routes/__init__.py`

```py

```

## `routes/cart.py`

```py
# routes/cart.py
"""
API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ—Ä–∑–∏–Ω–æ–π.
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Depends(get_current_active_user)).
"""

import logging

from fastapi import APIRouter, Depends, HTTPException
from fastapi_users import FastAPIUsers
from sqlalchemy.ext.asyncio import AsyncSession

from auth.backend import auth_backend
from auth.manager import get_user_manager
from core.cart_crud import (
    add_to_cart,
    clear_cart,
    get_cart_with_items,
    merge_cart,
    remove_cart_item,
    update_cart_item_quantity,
)
from core.database import get_db_session
from models.user import User
from schemas.commerce import CartItemBatch, CartItemCreate, CartItemUpdate, CartRead

logger = logging.getLogger(__name__)

router = APIRouter()

# === Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ===
fastapi_users_instance = FastAPIUsers[User, int](get_user_manager, [auth_backend])

get_current_active_user = fastapi_users_instance.current_user(active=True)


@router.get(
    "/",
    response_model=CartRead,
    summary="–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –æ–±—â–µ–π —Å—É–º–º–æ–π",
)
async def get_cart(
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é –∫–æ—Ä–∑–∏–Ω—É, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç.
    """
    logger.info(f"üõí –ó–∞–ø—Ä–æ—Å –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    cart = await get_cart_with_items(session, user.id)

    if cart is None:
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é –∫–æ—Ä–∑–∏–Ω—É
        from models.commerce import Cart

        cart = Cart(id=0, user_id=user.id, items=[])
        logger.info(f"üì≠ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id} –ø—É—Å—Ç–∞")

    logger.info(
        f"‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id} –ø–æ–ª—É—á–µ–Ω–∞. –¢–æ–≤–∞—Ä–æ–≤: {len(cart.items)}"
    )
    return cart


@router.post(
    "/items",
    response_model=dict,
    summary="–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É",
    description="–î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É. –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (UPSERT)",
)
async def add_item_to_cart(
    item_data: CartItemCreate,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É —Å UPSERT –ª–æ–≥–∏–∫–æ–π.
    """
    logger.info(
        f"‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ {item_data.product_id} –≤ –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}"
    )

    try:
        cart_item = await add_to_cart(
            session, user.id, item_data.product_id, item_data.quantity
        )
        logger.info("–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É")
        return {
            "message": "–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É",
            "cart_item_id": cart_item.id,
            "quantity": cart_item.quantity,
        }
    except ValueError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞: {e}")
        raise HTTPException(status_code=404, detail=str(e))


@router.post(
    "/merge",
    response_model=dict,
    summary="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç–µ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É",
    description="–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ –¥–ª—è —Å–ª–∏—è–Ω–∏—è –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ—Ä–∑–∏–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π)",
)
async def merge_guest_cart(
    batch_data: CartItemBatch,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ—Ä–∑–∏–Ω—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ.
    """
    logger.info(
        f"üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}. –¢–æ–≤–∞—Ä–æ–≤: {len(batch_data.items)}"
    )

    await merge_cart(session, user.id, batch_data.items)

    return {
        "message": "–ö–æ—Ä–∑–∏–Ω–∞ —É—Å–ø–µ—à–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞",
        "merged_items": len(batch_data.items),
    }


@router.patch(
    "/items/{item_id}",
    response_model=dict,
    summary="–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞",
    description="–ò–∑–º–µ–Ω—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–¥–ª—è –∫–Ω–æ–ø–æ–∫ +/-)",
)
async def update_item_quantity(
    item_id: int,
    update_data: CartItemUpdate,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ.
    """
    logger.info(f"üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–∑–∏—Ü–∏–∏ {item_id} –¥–æ {update_data.quantity}")

    try:
        cart_item = await update_cart_item_quantity(
            session, user.id, item_id, update_data.quantity
        )
        return {
            "message": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ",
            "cart_item_id": cart_item.id,
            "quantity": cart_item.quantity,
        }
    except ValueError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞: {e}")
        raise HTTPException(status_code=404, detail=str(e))


@router.delete(
    "/items/{item_id}",
    response_model=dict,
    summary="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã",
    description="–£–¥–∞–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã",
)
async def delete_cart_item(
    item_id: int,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    logger.info(f"üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ {item_id} –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    try:
        await remove_cart_item(session, user.id, item_id)
        return {"message": "–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã", "cart_item_id": item_id}
    except ValueError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏: {e}")
        raise HTTPException(status_code=404, detail=str(e))


@router.delete(
    "/",
    response_model=dict,
    summary="–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É",
    description="–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
)
async def clear_user_cart(
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    logger.info(f"üßπ –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    await clear_cart(session, user.id)

    return {"message": "–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞"}

```

## `routes/categories.py`

```py
# routes/categories.py
import logging
from typing import List
from fastapi import APIRouter, HTTPException, status, Depends
from sqlalchemy.ext.asyncio import AsyncSession

from core.database import (
    get_db_session,
    category_create,
    category_delete,
    category_get_by_id,
    categories_get_all,
    category_update,
    category_has_products,
)
from schemas.product import Category, CategoryCreate

logger = logging.getLogger(__name__)

router = APIRouter()


@router.get(
    "/",
    response_model=List[Category],
    summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.",
)
async def list_categories(
    skip: int = 0,
    limit: int = 100,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

    - **skip**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
    - **limit**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (skip={skip}, limit={limit})")

    try:
        categories = await categories_get_all(session)
        result = categories[skip : skip + limit]
        logger.info(f"‚úÖ –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–ª—É—á–µ–Ω, –Ω–∞–π–¥–µ–Ω–æ: {len(result)}")
        return result
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: {e}",
        )


@router.get(
    "/{category_id}",
    response_model=Category,
    summary="–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ ID",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –µ—ë —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É.",
)
async def get_category(
    category_id: int,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ –µ—ë ID.

    - **category_id**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}")

    try:
        category = await category_get_by_id(session, category_id)
        logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è ID={category_id} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–∞")
        return category
    except ValueError:
        logger.error(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID {category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}",
        )


@router.post(
    "/",
    response_model=Category,
    status_code=status.HTTP_201_CREATED,
    summary="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
    description="–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é. –ò–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º.",
)
async def create_category(
    category_data: CategoryCreate,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é.

    - **name**: –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ—Ç 3 –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤)
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {category_data.name}")

    try:
        new_category = await category_create(session, category_data)
        logger.info(
            f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–∑–¥–∞–Ω–∞: ID={new_category.id}, Name={new_category.name}"
        )
        return new_category
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}",
        )


@router.put(
    "/{category_id}",
    response_model=Category,
    summary="–û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
    description="–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ ID.",
)
async def update_category(
    category_id: int,
    category_data: CategoryCreate,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.

    - **category_id**: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    - **name**: –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}")

    try:
        # –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Ñ—É–Ω–∫—Ü–∏—è category_get_by_id –≤—ã–∑–æ–≤–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ category_update)
        category_to_update = Category(id=category_id, name=category_data.name)
        updated_category = await category_update(session, category_to_update)
        logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è ID={category_id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞")
        return updated_category

    except HTTPException:
        raise
    except ValueError:
        logger.error(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID {category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}",
        )


@router.delete(
    "/{category_id}",
    summary="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
    description="–£–¥–∞–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ ID. –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –µ—Å–ª–∏ –∫ –Ω–µ–π –ø—Ä–∏–≤—è–∑–∞–Ω—ã –ø—Ä–æ–¥—É–∫—Ç—ã.",
)
async def delete_category(
    category_id: int,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ ID.

    - **category_id**: ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}")

    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        await category_get_by_id(session, category_id)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ database.py
        has_products = await category_has_products(session, category_id)

        if has_products:
            logger.warning(
                f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é ID={category_id} —Å–æ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏"
            )
            raise HTTPException(
                status_code=status.HTTP_400_BAD_REQUEST,
                detail="–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é: —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã",
            )

        # –£–¥–∞–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        await category_delete(session, category_id)
        logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è ID={category_id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞")

        return {
            "message": f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID {category_id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞",
            "deleted_id": category_id,
        }

    except HTTPException:
        raise
    except ValueError:
        logger.error(f"‚ùå –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID={category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å ID {category_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ID={category_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: {e}",
        )

```

## `routes/orders.py`

```py
# routes/orders.py
"""
API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏.
–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
"""

import logging
from typing import List

from fastapi import APIRouter, BackgroundTasks, Depends, HTTPException
from fastapi_users import FastAPIUsers
from sqlalchemy.ext.asyncio import AsyncSession

from auth.backend import auth_backend
from auth.manager import get_user_manager
from core.database import get_db_session
from core.order_crud import create_order, get_order_by_id, get_user_orders
from models.user import User
from schemas.commerce import OrderCreate, OrderRead
from utils.telegram_bot import send_order_notification

logger = logging.getLogger(__name__)

router = APIRouter()

# === Dependency –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ===
fastapi_users_instance = FastAPIUsers[User, int](get_user_manager, [auth_backend])
get_current_active_user = fastapi_users_instance.current_user(active=True)


@router.post(
    "/",
    response_model=OrderRead,
    summary="–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑",
    description="–°–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞.",
)
async def create_new_order(
    order_data: OrderCreate,
    background_tasks: BackgroundTasks,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    –¢–æ–≤–∞—Ä—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ—Ä–∑–∏–Ω—ã, —Ü–µ–Ω—ã —Ñ–∏–∫—Å–∏—Ä—É—é—Ç—Å—è (frozen_price).
    –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∫–æ—Ä–∑–∏–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è.
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —á–µ—Ä–µ–∑ BackgroundTasks.
    """
    logger.info(f"üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    try:
        order = await create_order(session, user.id, order_data)
        logger.info(
            f"‚úÖ –ó–∞–∫–∞–∑ #{order.id} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å—É–º–º—É {order.total_amount} —à–º–µ–∫–ª–µ–π"
        )

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
        background_tasks.add_task(
            send_order_notification,
            order_id=order.id,
            total_amount=order.total_amount,
            user_email=user.email,
            delivery_address=order.delivery_address,
        )

        return order
    except ValueError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: {e}")
        raise HTTPException(status_code=400, detail=str(e))


@router.get(
    "/",
    response_model=List[OrderRead],
    summary="–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ, –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)",
)
async def get_my_orders(
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    logger.info(f"üìú –ó–∞–ø—Ä–æ—Å –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    orders = await get_user_orders(session, user.id)

    logger.info(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(orders)} –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")
    return orders


@router.get(
    "/{order_id}",
    response_model=OrderRead,
    summary="–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∑–∞–∫–∞–∑–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ (frozen_price, frozen_name)",
)
async def get_order_details(
    order_id: int,
    session: AsyncSession = Depends(get_db_session),
    user: User = Depends(get_current_active_user),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞.
    –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫–∞–∑–∞–º.
    """
    logger.info(f"üîç –ó–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ #{order_id} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}")

    order = await get_order_by_id(session, user.id, order_id)

    if order is None:
        logger.warning(f"‚ùå –ó–∞–∫–∞–∑ #{order_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
        raise HTTPException(
            status_code=404, detail=f"–ó–∞–∫–∞–∑ #{order_id} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        )

    logger.info(f"‚úÖ –ó–∞–∫–∞–∑ #{order_id} –Ω–∞–π–¥–µ–Ω")
    return order

```

## `routes/products.py`

```py
# routes/products.py
import logging
from typing import List, Optional

from schemas.product import Product, ProductCreate, ProductUpdate
from fastapi import APIRouter, HTTPException, BackgroundTasks, Depends, UploadFile
from utils.telegram_bot import send_telegram_message
from core.database import (
    get_db_session,
    product_create,
    product_delete,
    product_get_by_id,
    products_get_with_filters,
    product_update,
)
from sqlalchemy.ext.asyncio import AsyncSession

logger = logging.getLogger(__name__)

# --- –ú–∞—Ä—à—Ä—É—Ç—ã API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–≤–∞—Ä–∞–º–∏ ---

router = APIRouter()


@router.get(
    "/{product_id}",
    response_model=Product,
    summary="–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ",
    tags=["Products"],
)
async def get_product(product_id: int, session: AsyncSession = Depends(get_db_session)):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ –ø–æ –µ–≥–æ ID.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID={product_id}")

    try:
        product = await product_get_by_id(session, product_id)
        logger.info(f"‚úÖ –¢–æ–≤–∞—Ä ID={product_id} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω")
        return product
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ ID={product_id}: {e}")
        raise HTTPException(status_code=404, detail=str(e))


@router.get(
    "/",
    response_model=List[Product],
    summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤",
)
async def list_products(
    session: AsyncSession = Depends(get_db_session),
    search: Optional[str] = None,
    sort: Optional[str] = None,
    has_image: bool = False,
):
    """
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
    - **search**: –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –æ–ø–∏—Å–∞–Ω–∏—é —Ç–æ–≤–∞—Ä–∞.
    - **sort**: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ. –§–æ—Ä–º–∞—Ç: `currency_direction` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `credits_asc`, `shmeckles_desc`).
    - **has_image**: –ï—Å–ª–∏ True, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.
    """
    logger.info(
        f"üì• –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ (search={search}, sort={sort}, has_image={has_image})"
    )

    try:
        products = await products_get_with_filters(
            session, search=search, sort=sort, has_image=has_image
        )
        logger.info(f"‚úÖ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—É—á–µ–Ω, –Ω–∞–π–¥–µ–Ω–æ: {len(products)}")
        return products
    except ValueError as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
        raise HTTPException(status_code=400, detail=str(e))
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤: {e}")
        raise HTTPException(
            status_code=500, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤: {e}"
        )


@router.post(
    "/",
    response_model=Product,
    summary="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä",
    status_code=201,
    tags=["Products"],
)
async def create_product(
    product: ProductCreate,
    background_tasks: BackgroundTasks,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞: {product.name}")

    try:
        new_product = await product_create(session, product)
        logger.info(f"‚úÖ –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω: ID={new_product.id}, Name={new_product.name}")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: {e}")
        raise HTTPException(status_code=400, detail=str(e))

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
    telegram_message = f"""
*–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –º–∞–≥–∞–∑–∏–Ω–µ!*
*–ù–∞–∑–≤–∞–Ω–∏–µ:* {new_product.name}
*ID:* {new_product.id}
*–û–ø–∏—Å–∞–Ω–∏–µ:* {new_product.description}
*–ö–∞—Ç–µ–≥–æ—Ä–∏—è:* {new_product.category.name if new_product.category else "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"}
*–¢–µ–≥–∏:* {", ".join(tag.name for tag in new_product.tags) if new_product.tags else "–ù–µ—Ç —Ç–µ–≥–æ–≤"}
http://127.0.0.1:8000/products/{new_product.id}

```json
{product.model_dump_json(indent=2, ensure_ascii=False)}
```
"""

    # –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
    logger.info(
        f"üì§ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID={new_product.id}"
    )
    background_tasks.add_task(send_telegram_message, telegram_message)

    return new_product


@router.put(
    "/{product_id}",
    response_model=Product,
    summary="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ",
)
async def update_product(
    product_id: int,
    updated_product: ProductCreate,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ –ø–æ –µ–≥–æ ID.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID={product_id}")

    try:
        # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç ProductUpdate —Å ID –∏–∑ URL –∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
        product_update_data = ProductUpdate(
            id=product_id, **updated_product.model_dump()
        )
        product = await product_update(session, product_update_data)
        logger.info(f"‚úÖ –¢–æ–≤–∞—Ä ID={product_id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω")
        return product
    except ValueError as e:
        logger.error(f"‚ùå –¢–æ–≤–∞—Ä ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        raise HTTPException(status_code=404, detail=str(e))
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ ID={product_id}: {e}")
        raise HTTPException(
            status_code=500, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: {e}"
        )


@router.delete(
    "/{product_id}",
    response_model=int,
    summary="–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä",
)
async def delete_product(
    product_id: int, session: AsyncSession = Depends(get_db_session)
):
    """
    –£–¥–∞–ª—è–µ—Ç —Ç–æ–≤–∞—Ä –ø–æ –µ–≥–æ ID.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ ID={product_id}")

    try:
        await product_delete(session, product_id)
        logger.info(f"‚úÖ –¢–æ–≤–∞—Ä ID={product_id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω")
        return product_id
    except ValueError as e:
        logger.error(f"‚ùå –¢–æ–≤–∞—Ä ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        raise HTTPException(status_code=404, detail=str(e))
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ ID={product_id}: {e}")
        raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: {e}")


@router.post(
    "/{product_id}/upload-image",
    summary="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞",
    tags=["Products"],
)
async def upload_product_image(
    product_id: int,
    file: UploadFile,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ç–æ–≤–∞—Ä–∞.
    –ó–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

    - **product_id**: ID —Ç–æ–≤–∞—Ä–∞
    - **file**: –§–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG, GIF, WEBP, –º–∞–∫—Å 5MB)
    """
    from core.storage import save_product_image, delete_product_image

    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID={product_id}")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    try:
        product = await product_get_by_id(session, product_id)
    except Exception as e:
        logger.error(f"‚ùå –¢–æ–≤–∞—Ä ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        raise HTTPException(status_code=404, detail=str(e))

    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
    if product.image_url:
        logger.info(f"üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {product.image_url}")
        delete_product_image(product.image_url)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    try:
        image_url = await save_product_image(file)
        logger.info(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: {image_url}")
    except HTTPException:
        logger.info("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏")
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {e}")
        raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: {e}")

    # –û–±–Ω–æ–≤–ª—è–µ–º URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    from sqlalchemy import update
    from models.product import Product as ProductModel

    try:
        await session.execute(
            update(ProductModel)
            .where(ProductModel.id == product_id)
            .values(image_url=image_url)
        )
        await session.commit()
        logger.info(f"‚úÖ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—ë–Ω –≤ –ë–î –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID={product_id}")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ë–î: {e}")
        raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ –ë–î: {e}")

    return {
        "product_id": product_id,
        "image_url": image_url,
        "message": "‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ",
    }


@router.delete(
    "/{product_id}/image",
    summary="–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞",
    tags=["Products"],
)
async def delete_product_image_endpoint(
    product_id: int,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –£–¥–∞–ª—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –ë–î.
    """
    from core.storage import delete_product_image
    from sqlalchemy import update
    from models.product import Product as ProductModel

    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ ID={product_id}")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    try:
        product = await product_get_by_id(session, product_id)
    except Exception as e:
        logger.error(f"‚ùå –¢–æ–≤–∞—Ä ID={product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω: {e}")
        raise HTTPException(status_code=404, detail=str(e))

    if not product.image_url:
        logger.warning(f"‚ö†Ô∏è –£ —Ç–æ–≤–∞—Ä–∞ ID={product_id} –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")
        raise HTTPException(status_code=404, detail="–£ —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")

    # –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª
    deleted = delete_product_image(product.image_url)
    if not deleted:
        logger.warning(f"‚ö†Ô∏è –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω: {product.image_url}")

    # –û–±–Ω–æ–≤–ª—è–µ–º –ë–î
    try:
        await session.execute(
            update(ProductModel)
            .where(ProductModel.id == product_id)
            .values(image_url=None)
        )
        await session.commit()
        logger.info(f"‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID={product_id}")
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ë–î: {e}")
        raise HTTPException(status_code=500, detail=f"–û—à–∏–±–∫–∞ –ë–î: {e}")

    return {"message": "‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ", "product_id": product_id}

```

## `routes/tags.py`

```py
# routes/tags.py
import logging
from typing import List
from fastapi import APIRouter, HTTPException, status, Depends
from sqlalchemy.ext.asyncio import AsyncSession

from core.database import (
    get_db_session,
    tag_create,
    tag_delete,
    tag_get_by_id,
    tags_get_all,
    tag_update,
)
from schemas.product import Tag, TagCreate

logger = logging.getLogger(__name__)

router = APIRouter()


@router.get(
    "/",
    response_model=List[Tag],
    summary="–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.",
)
async def list_tags(
    skip: int = 0,
    limit: int = 100,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤.

    - **skip**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ (–ø–∞–≥–∏–Ω–∞—Ü–∏—è)
    - **limit**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–≥–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ç–µ–≥–æ–≤ (skip={skip}, limit={limit})")

    try:
        tags = await tags_get_all(session)
        result = tags[skip : skip + limit]
        logger.info(f"‚úÖ –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –ø–æ–ª—É—á–µ–Ω, –Ω–∞–π–¥–µ–Ω–æ: {len(result)}")
        return result
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ–≥–æ–≤: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ç–µ–≥–æ–≤: {e}",
        )


@router.get(
    "/{tag_id}",
    response_model=Tag,
    summary="–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–≥ –ø–æ ID",
    description="–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–≥ –ø–æ –µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É.",
)
async def get_tag(
    tag_id: int,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ–≥ –ø–æ –µ–≥–æ ID.

    - **tag_id**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–≥–∞
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å —Ç–µ–≥–∞ ID={tag_id}")

    try:
        tag = await tag_get_by_id(session, tag_id)
        logger.info(f"‚úÖ –¢–µ–≥ ID={tag_id} —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω")
        return tag
    except ValueError:
        logger.error(f"‚ùå –¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–¢–µ–≥ —Å ID {tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–µ–≥–∞ ID={tag_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–µ–≥–∞: {e}",
        )


@router.post(
    "/",
    response_model=Tag,
    status_code=status.HTTP_201_CREATED,
    summary="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥",
    description="–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ç–µ–≥. –ò–º—è —Ç–µ–≥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º.",
)
async def create_tag(
    tag_data: TagCreate,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ–≥.

    - **name**: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞ (–æ—Ç 2 –¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤)
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞: {tag_data.name}")

    try:
        new_tag = await tag_create(session, tag_data)
        logger.info(f"‚úÖ –¢–µ–≥ —Å–æ–∑–¥–∞–Ω: ID={new_tag.id}, Name={new_tag.name}")
        return new_tag
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞: {e}",
        )


@router.put(
    "/{tag_id}",
    response_model=Tag,
    summary="–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–≥",
    description="–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ –ø–æ ID.",
)
async def update_tag(
    tag_id: int,
    tag_data: TagCreate,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞.

    - **tag_id**: ID —Ç–µ–≥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    - **name**: –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ ID={tag_id}")

    try:
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–≥ (—Ñ—É–Ω–∫—Ü–∏—è tag_get_by_id –≤—ã–∑–æ–≤–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ tag_update)
        tag_to_update = Tag(id=tag_id, name=tag_data.name)
        updated_tag = await tag_update(session, tag_to_update)
        logger.info(f"‚úÖ –¢–µ–≥ ID={tag_id} —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω")
        return updated_tag

    except HTTPException:
        raise
    except ValueError:
        logger.error(f"‚ùå –¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–¢–µ–≥ —Å ID {tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞ ID={tag_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞: {e}",
        )


@router.delete(
    "/{tag_id}",
    summary="–£–¥–∞–ª–∏—Ç—å —Ç–µ–≥",
    description="–£–¥–∞–ª—è–µ—Ç —Ç–µ–≥ –ø–æ ID. –°–≤—è–∑–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.",
)
async def delete_tag(
    tag_id: int,
    session: AsyncSession = Depends(get_db_session),
):
    """
    –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥ –ø–æ ID.

    - **tag_id**: ID —Ç–µ–≥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏–∏.
    –°–≤—è–∑–∏ many-to-many —Å –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    """
    logger.info(f"üì• –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–µ–≥–∞ ID={tag_id}")

    try:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–∞
        await tag_get_by_id(session, tag_id)

        # –£–¥–∞–ª—è–µ–º —Ç–µ–≥ (—Å–≤—è–∑–∏ –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ —É–¥–∞–ª—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
        await tag_delete(session, tag_id)
        logger.info(f"‚úÖ –¢–µ–≥ ID={tag_id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω")

        return {
            "message": f"–¢–µ–≥ —Å ID {tag_id} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω",
            "deleted_id": tag_id,
        }

    except HTTPException:
        raise
    except ValueError:
        logger.error(f"‚ùå –¢–µ–≥ —Å ID={tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail=f"–¢–µ–≥ —Å ID {tag_id} –Ω–µ –Ω–∞–π–¥–µ–Ω",
        )
    except Exception as e:
        logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞ ID={tag_id}: {e}")
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞: {e}",
        )

```

## `schemas/__init__.py`

```py
# schemas/__init__.py
"""
–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö Pydantic —Å—Ö–µ–º –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
"""

from schemas.commerce import (
    CartItemBatch,
    CartItemCreate,
    CartItemRead,
    CartItemUpdate,
    CartRead,
    OrderCreate,
    OrderItemRead,
    OrderRead,
    ProductInCart,
)
from schemas.product import (
    Category,
    CategoryCreate,
    Product,
    ProductCreate,
    ProductUpdate,
    Tag,
    TagCreate,
)
from schemas.user import UserCreate, UserRead, UserUpdate

__all__ = [
    # Product schemas
    "Category",
    "CategoryCreate",
    "Tag",
    "TagCreate",
    "Product",
    "ProductCreate",
    "ProductUpdate",
    # User schemas
    "UserCreate",
    "UserRead",
    "UserUpdate",
    # Commerce schemas
    "CartItemCreate",
    "CartItemUpdate",
    "CartItemRead",
    "CartRead",
    "CartItemBatch",
    "ProductInCart",
    "OrderCreate",
    "OrderRead",
    "OrderItemRead",
]

```

## `schemas/commerce.py`

```py
# schemas/commerce.py
from datetime import datetime
from typing import List

from pydantic import BaseModel, ConfigDict, Field, computed_field


# === –°–•–ï–ú–´ –î–õ–Ø –ö–û–†–ó–ò–ù–´ ===


class CartItemCreate(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - POST /cart/items - –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
    - POST /cart/merge - –º–∞—Å—Å–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å–ø–∏—Å–æ–∫ —Ç–∞–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤)
    """

    product_id: int = Field(
        ..., description="ID —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É", example=1, gt=0
    )
    quantity: int = Field(default=1, description="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞", example=2, ge=1)


class CartItemUpdate(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–∫–Ω–æ–ø–∫–∏ +/-).

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - PATCH /cart/items/{id} - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    """

    quantity: int = Field(..., description="–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞", example=3, ge=1)


class ProductInCart(BaseModel):
    """
    –í–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ.

    –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è —Ç–æ–≤–∞—Ä–∞ (–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏).
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ CartItemRead —á–µ—Ä–µ–∑ relationship.
    –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö - —Ç–æ–ª—å–∫–æ –∫–∞–∫ —á–∞—Å—Ç—å CartItemRead.
    """

    id: int = Field(..., description="ID —Ç–æ–≤–∞—Ä–∞")
    name: str = Field(..., description="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞")
    price_shmeckles: float = Field(..., description="–¶–µ–Ω–∞ –≤ —à–º–µ–∫–ª—è—Ö")
    price_flurbos: float = Field(..., description="–¶–µ–Ω–∞ –≤ —Ñ–ª—É—Ä–±–æ")
    image_url: str | None = Field(None, description="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è")

    model_config = ConfigDict(from_attributes=True)


class CartItemRead(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ.

    –°–æ–¥–µ—Ä–∂–∏—Ç quantity + –≤–ª–æ–∂–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç Product —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏.
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ CartRead –∫–∞–∫ —Å–ø–∏—Å–æ–∫ items.
    –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö - —Ç–æ–ª—å–∫–æ –∫–∞–∫ —á–∞—Å—Ç—å CartRead.
    """

    id: int = Field(..., description="ID –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ")
    product_id: int = Field(..., description="ID —Ç–æ–≤–∞—Ä–∞")
    quantity: int = Field(..., description="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    product: ProductInCart = Field(..., description="–î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–∞")

    model_config = ConfigDict(from_attributes=True)


class CartRead(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    –°–æ–¥–µ—Ä–∂–∏—Ç:
    - –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π (CartItemRead) —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ total_price (—Å—É–º–º–∞ –∫–æ—Ä–∑–∏–Ω—ã –≤ —à–º–µ–∫–ª—è—Ö)

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - GET /cart - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ—Ä–∑–∏–Ω—É —Å–æ –≤—Å–µ–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
    """

    id: int = Field(..., description="ID –∫–æ—Ä–∑–∏–Ω—ã")
    user_id: int = Field(..., description="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    items: List[CartItemRead] = Field(
        default=[], description="–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ"
    )

    @computed_field
    @property
    def total_price(self) -> float:
        """–í—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ: –æ–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã –≤ —à–º–µ–∫–ª—è—Ö."""
        return sum(item.product.price_shmeckles * item.quantity for item in self.items)

    model_config = ConfigDict(from_attributes=True)


# === –°–•–ï–ú–ê –î–õ–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò (–ì–û–°–¢–¨ -> –Æ–ó–ï–†) ===


class CartItemBatch(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω—É (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≥–æ—Å—Ç–µ–≤–æ–π –∫–æ—Ä–∑–∏–Ω—ã).

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É –∏ –Ω—É–∂–Ω–æ —Å–ª–∏—Ç—å –µ–≥–æ –ª–æ–∫–∞–ª—å–Ω—É—é
    –∫–æ—Ä–∑–∏–Ω—É –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞ —Å —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∫–æ—Ä–∑–∏–Ω–æ–π.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - POST /cart/merge - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Å—Ç–µ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ

    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–ø–∏—Å–æ–∫ CartItemCreate –æ–±—ä–µ–∫—Ç–æ–≤.
    """

    items: List[CartItemCreate] = Field(
        ..., description="–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É"
    )


# === –°–•–ï–ú–´ –î–õ–Ø –ó–ê–ö–ê–ó–û–í ===


class OrderCreate(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ—Ä–∑–∏–Ω—ã.

    –í–ê–ñ–ù–û: –¢–æ–≤–∞—Ä—ã –ù–ï –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è! –û–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∫–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–∞–µ—Ç—Å—è.

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - POST /orders - —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    """

    delivery_address: str = Field(
        ...,
        description="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏",
        example="—É–ª. –ü–ª—É—Ç–æ–Ω, –¥. 42, –∫–≤. 137",
        min_length=10,
        max_length=500,
    )
    phone: str = Field(
        ...,
        description="–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω",
        example="+7 (999) 123-45-67",
        min_length=10,
        max_length=20,
    )


class OrderItemRead(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞ —Å –ó–ê–ú–û–†–û–ñ–ï–ù–ù–´–ú–ò –¥–∞–Ω–Ω—ã–º–∏.

    –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
    - frozen_name –∏ frozen_price - —ç—Ç–æ –°–õ–ï–ü–û–ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
    - –î–∞–∂–µ –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –∏–∑–º–µ–Ω–∏—Ç—Å—è/—É–¥–∞–ª–∏—Ç—Å—è, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–π

    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ OrderRead –∫–∞–∫ —Å–ø–∏—Å–æ–∫ items.
    –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö - —Ç–æ–ª—å–∫–æ –∫–∞–∫ —á–∞—Å—Ç—å OrderRead.
    """

    id: int = Field(..., description="ID –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫–∞–∑–∞")
    product_id: int = Field(..., description="ID —Ç–æ–≤–∞—Ä–∞ (–Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞)")
    quantity: int = Field(..., description="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
    frozen_name: str = Field(
        ..., description="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞"
    )
    frozen_price: float = Field(
        ..., description="–¶–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–≤ —à–º–µ–∫–ª—è—Ö)"
    )

    model_config = ConfigDict(from_attributes=True)


class OrderRead(BaseModel):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –ø–æ–∫—É–ø–∫–∏.

    –°–æ–¥–µ—Ä–∂–∏—Ç:
    - –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—É–º–º—É (total_amount) –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è
    - –°–ø–∏—Å–æ–∫ –ø–æ–∑–∏—Ü–∏–π (OrderItemRead) —Å –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏
    - –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω

    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:
    - POST /orders - –≤–æ–∑–≤—Ä–∞—Ç —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
    - GET /orders - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - GET /orders/{id} - –¥–µ—Ç–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞
    """

    id: int = Field(..., description="ID –∑–∞–∫–∞–∑–∞")
    user_id: int = Field(..., description="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    created_at: datetime = Field(..., description="–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞")
    status: str = Field(..., description="–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞", example="pending")
    total_amount: float = Field(
        ..., description="–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è)"
    )
    delivery_address: str = Field(..., description="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏")
    phone: str = Field(..., description="–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω")
    items: List[OrderItemRead] = Field(
        default=[], description="–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∑–∞–∫–∞–∑–µ"
    )

    model_config = ConfigDict(from_attributes=True)

```

## `schemas/product.py`

```py
from pydantic import BaseModel, ConfigDict, Field
from typing import Optional, List


class CategoryBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""

    name: str = Field(
        ...,
        description="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏",
        example="–ü–æ—Ä—Ç–∞–ª—å–Ω—ã–µ –ø—É—à–∫–∏",
        min_length=3,
        max_length=50,
    )


class CategoryCreate(CategoryBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""

    pass


class Category(CategoryBase):
    """–°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≤–∫–ª—é—á–∞—è –µ—ë ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""

    id: int = Field(..., description="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏", example=1)

    model_config = ConfigDict(from_attributes=True)


class TagBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ç–µ–≥–∞."""

    name: str = Field(
        ...,
        description="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞",
        example="–ù–æ–≤–∏–Ω–∫–∞",
        min_length=2,
        max_length=30,
    )


class TagCreate(TagBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–µ–≥–∞."""

    pass


class Tag(TagBase):
    """–°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–≥–∞, –≤–∫–ª—é—á–∞—è –µ–≥–æ ID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""

    id: int = Field(..., description="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ–≥–∞", example=101)

    model_config = ConfigDict(from_attributes=True)


class ProductCreate(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞."""

    name: str = Field(
        ...,
        description="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="–°–º–∞—Ä—Ç—Ñ–æ–Ω '–ö–æ—Å–º–æ—Å-X'",
        min_length=3,
        max_length=100,
    )
    description: Optional[str] = Field(
        None,
        description="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º –∏ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–æ–º.",
        max_length=1000,
    )
    image_url: Optional[str] = Field(
        None,
        description="URL-–∞–¥—Ä–µ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="https://example.com/images/kosmos-x.jpg",
        max_length=255,
    )
    price_shmeckles: float = Field(
        ...,
        description="–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –®–º–µ–∫–ª—è—Ö",
        example=999.99,
        gt=0,  # gt = greater than
    )
    price_flurbos: float = Field(
        ...,
        description="–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –§–ª—ë—Ä–±–æ—Å–∞—Ö",
        example=120.50,
        gt=0,
    )
    category_id: Optional[int] = Field(
        None,
        description="ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –∫ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ø—Ä–æ–¥—É–∫—Ç",
        example=1,
    )
    tag_ids: List[int] = Field(
        [],
        description="–°–ø–∏—Å–æ–∫ ID —Ç–µ–≥–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º",
        example=[101, 105],
    )


class ProductUpdate(ProductCreate):
    """
    –°—Ö–µ–º–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ (–º–µ—Ç–æ–¥ PUT).
    –í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –∫–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏.
    """

    id: int = Field(..., description="ID –ø—Ä–æ–¥—É–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å", example=42)


class Product(BaseModel):
    """–°—Ö–µ–º–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î."""

    id: int = Field(..., description="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞", example=42)
    name: str = Field(
        ...,
        description="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="–°–º–∞—Ä—Ç—Ñ–æ–Ω '–ö–æ—Å–º–æ—Å-X'",
    )
    description: Optional[str] = Field(
        None,
        description="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º –∏ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–æ–º.",
    )
    image_url: Optional[str] = Field(
        None,
        description="URL-–∞–¥—Ä–µ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞",
        example="https://example.com/images/kosmos-x.jpg",
    )
    price_shmeckles: float = Field(
        ...,
        description="–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –®–º–µ–∫–ª—è—Ö",
        example=999.99,
    )
    price_flurbos: float = Field(
        ...,
        description="–¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –§–ª—ë—Ä–±–æ—Å–∞—Ö",
        example=120.50,
    )
    category: Optional[Category] = Field(
        None,
        description="–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞ (–≤–ª–æ–∂–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç)",
    )
    tags: List[Tag] = Field(
        [],
        description="–°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–∞ (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)",
    )

    model_config = ConfigDict(from_attributes=True)

```

## `schemas/user.py`

```py
from typing import Any, ClassVar, Dict, Tuple

from fastapi_users import schemas
from pydantic import ConfigDict, model_validator


class UserRead(schemas.BaseUser[int]):
    """–°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è)."""

    pass


class UserCreate(schemas.BaseUserCreate):
    """–°—Ö–µ–º–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤."""

    model_config = ConfigDict(extra="forbid")

    _admin_flags: ClassVar[Tuple[str, ...]] = (
        "is_active",
        "is_superuser",
        "is_verified",
    )

    @model_validator(mode="before")
    @classmethod
    def _reject_admin_flags(cls, data: Any) -> Any:
        if isinstance(data, dict):
            forbidden = [field for field in cls._admin_flags if field in data]
            if forbidden:
                fields = ", ".join(sorted(forbidden))
                raise ValueError(
                    f"–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –ø–æ–ª—è –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: {fields}. –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Ñ–ª–∞–≥–∏ –∑–∞–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."
                )
        return data

    @classmethod
    def __get_pydantic_json_schema__(cls, core_schema, handler):
        schema: Dict[str, Any] = super().__get_pydantic_json_schema__(
            core_schema, handler
        )
        properties = schema.get("properties", {})
        for field in cls._admin_flags:
            properties.pop(field, None)
        required = schema.get("required")
        if isinstance(required, list):
            schema["required"] = [
                item for item in required if item not in cls._admin_flags
            ]
        return schema


class UserUpdate(schemas.BaseUserUpdate):
    """–°—Ö–µ–º–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""

    pass

```

## `seed_data.py`

```py
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ Rick & Morty.
–ö–æ–ø–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ data/images –≤ uploads/products.

–ó–ê–ü–£–°–ö:
-------
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ fast_api_419
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å):
   .\venv\Scripts\activate  # Windows PowerShell
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   python seed_data.py

–û–ü–¶–ò–ò:
------
--clear     –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
--images    –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î)

–ü–†–ò–ú–ï–†–´:
--------
python seed_data.py              # –û–±—ã—á–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
python seed_data.py --clear      # –û—á–∏—Å—Ç–∏—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python seed_data.py --images     # –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
-----------
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ (alembic upgrade head)
- –ü–∞–ø–∫–∞ data/images –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ú–æ–¥–µ–ª–∏ Category, Tag, Product –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
"""

import asyncio
import logging
import shutil
import sys
from pathlib import Path

from sqlalchemy import select, text
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker

from core.database import DATABASE_URL
from models.product import Category, Product, Tag

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s | %(levelname)-8s | %(message)s",
    datefmt="%H:%M:%S",
)
logger = logging.getLogger(__name__)

# –ü—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
BASE_DIR = Path(__file__).parent
# –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ C:\PY\–ü–†–ò–ú–ï–†–´ –ö–û–î–ê\fast_api_419\data\images
SOURCE_IMAGES_DIR = BASE_DIR / "data" / "images"
TARGET_IMAGES_DIR = BASE_DIR / "uploads" / "products"

# –°–æ–∑–¥–∞–µ–º async engine
engine = create_async_engine(DATABASE_URL, echo=False)
async_session_maker = async_sessionmaker(
    bind=engine, expire_on_commit=False, class_=AsyncSession
)


# --- –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è ---

CATEGORIES = [
    {"name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "description": "–í—ã—Å–æ–∫–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"},
    {"name": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã", "description": "–î–ª—è –¥–æ–º–∞ –∏ –±—ã—Ç–∞"},
    {"name": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è", "description": "–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏"},
    {"name": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", "description": "–ò–≥—Ä—ã –∏ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã"},
    {"name": "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è", "description": "–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏"},
    {"name": "–ú–µ–¥–∏—Ü–∏–Ω–∞", "description": "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏ –º–µ–¥—Ç–µ—Ö–Ω–∏–∫–∞"},
    {"name": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "description": "–°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è"},
    {"name": "–û—Ä—É–∂–∏–µ", "description": "–ë–æ–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"},
]

TAGS = [
    "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ",
    "–û–ø–∞—Å–Ω–æ",
    "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞",
    "–Æ–º–æ—Ä",
    "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å",
    "–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ",
    "–ù–æ–≤–∏–Ω–∫–∞",
    "–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞",
    "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ",
    "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è",
]

# –ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: 1 –®–º–µ–∫–µ–ª—å = 2 –§–ª—ë—Ä–±–æ
SHMECKLES_TO_FLURBOS = 2.0

PRODUCTS = [
    {
        "name": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ü–ª—é–º–±—É—Å",
        "description": "–ö–∞–∂–¥—ã–π –¥–æ–º –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–ª—é–º–±—É—Å. –ú—ã –Ω–µ –∑–Ω–∞–µ–º, —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç, –Ω–æ –æ–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ. –í –∫–æ–º–ø–ª–µ–∫—Ç–µ: —à–ª–µ–µ, –≥—Ä—É–º–±–æ –∏ —Ñ–ª–∏–±.",
        "price_shmeckles": 6.5,
        "image": "plumbus.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–Æ–º–æ—Ä"],
    },
    {
        "name": "–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏",
        "description": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø–æ –¥–æ–º—É? –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –∏ –ø–æ—è–≤–∏—Ç—Å—è –ú–∏—Å–∏–∫—Å, –≥–æ—Ç–æ–≤—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ –≤–∞—à–µ –ø–æ—Ä—É—á–µ–Ω–∏–µ. –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ–≥–æ ‚Äî –±–æ–ª—å, —Ç–∞–∫ —á—Ç–æ –Ω–µ –∑–∞—Ç—è–≥–∏–≤–∞–π—Ç–µ!",
        "price_shmeckles": 19.99,
        "image": "meeseeks-box.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ü–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞ (–±/—É)",
        "description": "–°–ª–µ–≥–∫–∞ –ø–æ—Ü–∞—Ä–∞–ø–∞–Ω–∞, –∑–∞—Ä—è–¥ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏ –Ω–∞ 37%. –í–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç. –ú–æ–∂–µ—Ç –ø–∞—Ö–Ω—É—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏ —á—É–∂–∏–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ: –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –¶–∏—Ç–∞–¥–µ–ª–∏.",
        "price_shmeckles": 9999.99,
        "image": "portal-gun.webp",
        "category": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ"],
    },
    {
        "name": "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è –º–∞—Ç–µ—Ä–∏—è",
        "description": "–ò–¥–µ–∞–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–∞–±–ª—è. –í—Å–µ–≥–æ –æ–¥–Ω–∞ –∫–∞–ø–ª—è –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —É–ª–µ—Ç–µ—Ç—å –æ—Ç –ª—é–±—ã—Ö —ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫—Ä–∏–∑–∏—Å–æ–≤. –ù–µ —É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –≤–Ω—É—Ç—Ä—å!",
        "price_shmeckles": 850.0,
        "image": "dark-matter.webp",
        "category": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ú–∞—Å–ª–æ-—Ä–æ–±–æ—Ç '–ü–µ—Ä–µ–¥–∞–π –º–∞—Å–ª–æ'",
        "description": "–ï–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ª—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–∞—Å–ª–æ. –û–Ω –æ—Å–æ–∑–Ω–∞–µ—Ç —ç—Ç–æ –∏ –≤–ø–∞–¥–∞–µ—Ç –≤ –¥–µ–ø—Ä–µ—Å—Å–∏—é. –û—Ç–ª–∏—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞ –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ.",
        "price_shmeckles": 25.5,
        "image": "butter-robot.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–Æ–º–æ—Ä", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–®–ª–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è –º—ã—Å–ª–µ–π —Å–æ–±–∞–∫",
        "description": "–¢–µ–ø–µ—Ä—å –≤—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —É–∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –≤–∞—à –ø—ë—Å —Å–ø—Ä—è—Ç–∞–ª —Ç–∞–ø–∫–∏ –∏ –ø–æ—á–µ–º—É –æ–Ω –ª–∞–µ—Ç –Ω–∞ –ø—ã–ª–µ—Å–æ—Å. –°–ø–æ–π–ª–µ—Ä: –æ–Ω —Å—á–∏—Ç–∞–µ—Ç –≤–∞—Å —Ö–æ—Ä–æ—à–∏–º –º–∞–ª—å—á–∏–∫–æ–º.",
        "price_shmeckles": 120.0,
        "image": "dog-helmet.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–Æ–º–æ—Ä"],
    },
    {
        "name": "–ó–µ—Ä–Ω–æ–≤—ã–µ '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–∏'",
        "description": "–ú–∞–ª–µ–Ω—å–∫–∏–µ –≥–ª–∞–∑–∞—Å—Ç—ã–µ —á–µ–ª–æ–≤–µ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∂–∏–≤—É—Ç –≤ –∫–æ—Ä–æ–±–∫–µ –∏ —É–º–æ–ª—è—é—Ç –≤–∞—Å —Å—ä–µ—Å—Ç—å –∏—Ö. –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫ —Å –Ω–æ—Ç–∫–∞–º–∏ –æ—Ç—á–∞—è–Ω–∏—è.",
        "price_shmeckles": 4.20,
        "image": "eyeholes.webp",
        "category": "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è",
        "tags": ["–Æ–º–æ—Ä", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–ú–∏–∫—Ä–æ-–≤—Å–µ–ª–µ–Ω–Ω–∞—è –≤ –∫–æ—Ä–æ–±–∫–µ",
        "description": "–ò—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ï—ë –∂–∏—Ç–µ–ª–∏ –ø–æ–∫–ª–æ–Ω—è—é—Ç—Å—è –≤–∞–º –∫–∞–∫ –±–æ–≥—É, –ø–æ–∫–∞ –≤—ã –Ω–µ –∑–∞–≤–æ–¥–∏—Ç–µ –º–∞—à–∏–Ω—É. –≠—Ç–∏—á–Ω–æ? –†–µ—à–∞—Ç—å –≤–∞–º.",
        "price_shmeckles": 2500.0,
        "image": "microverse-battery.webp",
        "category": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ù–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏",
        "description": "–í–∏–¥–µ–ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ –Ω–µ —Å–ª–µ–¥–æ–≤–∞–ª–æ? –°–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –∏–∑ —Å–≤–æ–µ–π –ø–∞–º—è—Ç–∏ –∏–ª–∏ –ø–∞–º—è—Ç–∏ –¥—Ä—É–∑–µ–π. –ü–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞–±—É–¥–µ—Ç–µ, –∫–∞–∫ –∑–∞–≤—è–∑—ã–≤–∞—Ç—å —à–Ω—É—Ä–∫–∏.",
        "price_shmeckles": 350.75,
        "image": "memory-neutralizer.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–°–µ–º–µ–Ω–∞ –∏–∑ –ú–µ–≥–∞-–¥–µ—Ä–µ–≤—å–µ–≤",
        "description": "–ü—Ä–∏–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç. –î–ª—è –ø—Ä–æ–≤–æ–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ –æ—á–µ–Ω—å... —É–∫—Ä–æ–º–Ω–æ–µ –º–µ—Å—Ç–æ. –¢–∞–º–æ–∂–Ω—è –Ω–µ –æ–¥–æ–±—Ä–∏—Ç.",
        "price_shmeckles": 55.0,
        "image": "mega-seeds.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–ù–µ–∑–∞–∫–æ–Ω–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ê–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫ (–ù–∞–±–æ—Ä '–°–¥–µ–ª–∞–π —Å–∞–º')",
        "description": "–£–º–µ–Ω—å—à–∏—Ç–µ—Å—å –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –±–µ–∑–¥–æ–º–Ω–æ–≥–æ! –í –Ω–∞–±–æ—Ä–µ –≤—Å–µ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã: '–ü–∏—Ä–∞—Ç—Å–∫–∞—è –°–µ–ª–µ–∑–µ–Ω–∫–∞', '–ö–æ—Å—Ç—è–Ω–æ–π –≠–∫—Å–ø—Ä–µ—Å—Å' –∏ –¥—Ä—É–≥–∏–µ. –ë–µ–∑–¥–æ–º–Ω—ã–π –≤ –∫–æ–º–ø–ª–µ–∫—Ç –Ω–µ –≤—Ö–æ–¥–∏—Ç.",
        "price_shmeckles": 199.99,
        "image": "anatomy-park.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–Æ–º–æ—Ä", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–ö—Ä–∏—Å—Ç–∞–ª–ª —Å–º–µ—Ä—Ç–∏",
        "description": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–∞—à–µ–π —Å–º–µ—Ä—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä–æ–≤ –∏ –∏–ø–æ—Ö–æ–Ω–¥—Ä–∏–∫–æ–≤.",
        "price_shmeckles": 77.0,
        "image": "death-crystal.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ì–æ–≤–æ—Ä—è—â–∏–π –∫–æ—Ç (–±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π)",
        "description": "–û–Ω —É–º–µ–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å, –Ω–æ –ª—É—á—à–µ –±—ã –≤—ã –Ω–µ –∑–Ω–∞–ª–∏, –æ —á—ë–º. –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –µ–≥–æ, —á—Ç–æ –æ–Ω –≤–∏–¥–µ–ª. –ü—Ä–æ—Å—Ç–æ –∫–æ—Ä–º–∏—Ç–µ –∏ –Ω–∞–¥–µ–π—Ç–µ—Å—å –Ω–∞ –ª—É—á—à–µ–µ.",
        "price_shmeckles": 5.0,
        "image": "talking-cat.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–Æ–º–æ—Ä", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–ë–æ—Ç–∏–Ω–∫–∏ –¥–ª—è —Ö–æ–¥—å–±—ã –ø–æ —Å—Ç–µ–Ω–∞–º",
        "description": "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è ‚Äî –¥–ª—è —Å–ª–∞–±–∞–∫–æ–≤. –¢–µ–ø–µ—Ä—å –ø–æ–ª, —Å—Ç–µ–Ω—ã –∏ –ø–æ—Ç–æ–ª–æ–∫ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–ª–æ—Ç–Ω–æ–≥–æ –æ–±–µ–¥–∞.",
        "price_shmeckles": 210.0,
        "image": "gravity-shoes.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–æ–≤–∏–Ω–∫–∞"],
    },
    {
        "name": "–ü—Ä–∏–±–æ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–Ω–∞–º–∏",
        "description": "–ü—Ä–æ–Ω–∏–∫–Ω–∏—Ç–µ –≤ —Å–Ω—ã –≤–∞—à–µ–≥–æ —É—á–∏—Ç–µ–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –∑–∞—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∞–º –ø—è—Ç–µ—Ä–∫—É. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞—Ç–∞–π—Ç–µ—Å—å –Ω–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–µ. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã!",
        "price_shmeckles": 400.0,
        "image": "dream-inator.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–ö–ª–æ–Ω-–ø–∏—Å—Ç–æ–ª–µ—Ç",
        "description": "–°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—É—é –∫–æ–ø–∏—é –ª—é–±–æ–≥–æ –∂–∏–≤–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞. –ö–æ–ø–∏—è –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∞—è—Ç—å —á–µ—Ä–µ–∑ —á–∞—Å. –ò–¥–µ–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–æ–Ω–∞ –Ω–∞ —Å–∫—É—á–Ω–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ.",
        "price_shmeckles": 555.55,
        "image": "clone-gun.webp",
        "category": "–û—Ä—É–∂–∏–µ",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ"],
    },
    {
        "name": "–ü–∏—Å—Ç–æ–ª–µ—Ç-—É–º–µ–Ω—å—à–∏—Ç–µ–ª—å",
        "description": "–£–º–µ–Ω—å—à–∞–µ—Ç –ª—é–±–æ–π –ø—Ä–µ–¥–º–µ—Ç –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ –¥–æ –∫–∞—Ä–º–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–æ–≤ –∏–ª–∏ –µ—Å–ª–∏ –≤—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π –±—É—Ç–µ—Ä–±—Ä–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –≤ —Ä—É–∫–µ.",
        "price_shmeckles": 320.0,
        "image": "shrinking-ray.webp",
        "category": "–û—Ä—É–∂–∏–µ",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ö—Ä–µ–º '–í–µ—á–Ω–∞—è –º–æ–ª–æ–¥–æ—Å—Ç—å'",
        "description": "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å—Ç–∞—Ä–µ–Ω–∏—è. –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ. –ü–æ–¥—É–º–∞–π—Ç–µ –¥–≤–∞–∂–¥—ã, –ø—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –Ω–∞ —Å–≤–æ–µ–º —Ä–µ–±–µ–Ω–∫–µ. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è, –Ω–æ –∫—Ç–æ –µ–µ —á–∏—Ç–∞–µ—Ç?",
        "price_shmeckles": 680.0,
        "image": "age-cream.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–°–∏–º—É–ª—è—Ç–æ—Ä '–†–æ–π'",
        "description": "–ü—Ä–æ–∂–∏–≤–∏—Ç–µ —Ü–µ–ª—É—é –∂–∏–∑–Ω—å –æ–±—ã—á–Ω–æ–≥–æ –ø–∞—Ä–Ω—è –ø–æ –∏–º–µ–Ω–∏ –†–æ–π. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ, –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤—ã–∫–∞–Ω–∏–µ –∏ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–≤—Ä–æ–≤.",
        "price_shmeckles": 12.50,
        "image": "roy-game.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ì–∞—Ä–º–æ–Ω–∏–∑–∞—Ç–æ—Ä –º–µ–∂–≤—Å–µ–ª–µ–Ω—Å–∫–æ–≥–æ –¢–í",
        "description": "–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–∞—à–µ–º—É –æ–±—ã—á–Ω–æ–º—É —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º—É —á–∏—Å–ª—É –∫–∞–Ω–∞–ª–æ–≤ —Å–æ –≤—Å–µ–π –º—É–ª—å—Ç–∏–≤—Å–µ–ª–µ–Ω–Ω–æ–π. –í–∫–ª—é—á–∞—è —Ä–µ–∫–ª–∞–º—É '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–æ–≤' –∏ —Å–µ—Ä–∏–∞–ª '–ú–∏—Å—Ç–∏–∫—Å-–ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–π'.",
        "price_shmeckles": 49.99,
        "image": "interdimensional-cable.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞"],
    },
]


def copy_images():
    """–ö–æ–ø–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ data/images –≤ uploads/products"""
    logger.info("üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏
    if not SOURCE_IMAGES_DIR.exists():
        logger.error(f"‚ùå –ü–∞–ø–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {SOURCE_IMAGES_DIR}")
        return False

    # –°–æ–∑–¥–∞—ë–º —Ü–µ–ª–µ–≤—É—é –ø–∞–ø–∫—É
    TARGET_IMAGES_DIR.mkdir(parents=True, exist_ok=True)

    # –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    copied = 0
    for image_file in SOURCE_IMAGES_DIR.glob("*.webp"):
        target_file = TARGET_IMAGES_DIR / image_file.name
        shutil.copy2(image_file, target_file)
        logger.info(f"  ‚úÖ {image_file.name}")
        copied += 1

    logger.info(f"‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ {copied} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    return True


async def seed_database():
    """–ó–∞–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
    async with async_session_maker() as session:
        try:
            logger.info("üå± –ù–∞—á–∞–ª–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")

            # 1. –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            logger.info("üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...")
            categories_dict = {}
            for cat_data in CATEGORIES:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                result = await session.execute(
                    select(Category).where(Category.name == cat_data["name"])
                )
                category = result.scalar_one_or_none()

                # –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é
                if not category:
                    category = Category(name=cat_data["name"])
                    session.add(category)
                    logger.info(f"  ‚ûï {cat_data['name']}")
                else:
                    logger.info(f"  ‚è≠Ô∏è  {cat_data['name']} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")

                categories_dict[cat_data["name"]] = category

            # –ü–æ–ª—É—á–∞–µ–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            await session.flush()
            logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≥–æ—Ç–æ–≤—ã")

            # 2. –°–æ–∑–¥–∞—ë–º —Ç–µ–≥–∏
            logger.info("üè∑Ô∏è  –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–æ–≤...")
            tags_dict = {}
            for tag_name in TAGS:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–µ–≥
                result = await session.execute(select(Tag).where(Tag.name == tag_name))
                tag = result.scalar_one_or_none()

                if not tag:
                    tag = Tag(name=tag_name)
                    session.add(tag)
                    logger.info(f"  ‚ûï {tag_name}")
                else:
                    logger.info(f"  ‚è≠Ô∏è  {tag_name} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")

                tags_dict[tag_name] = tag

            await session.flush()
            logger.info(f"‚úÖ –¢–µ–≥–∏ –≥–æ—Ç–æ–≤—ã")

            # 3. –°–æ–∑–¥–∞—ë–º —Ç–æ–≤–∞—Ä—ã
            logger.info("üõí –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤...")
            for idx, product_data in enumerate(PRODUCTS, 1):
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–æ–≤–∞—Ä
                result = await session.execute(
                    select(Product).where(Product.name == product_data["name"])
                )
                existing_product = result.scalar_one_or_none()

                if existing_product:
                    logger.info(f"  ‚è≠Ô∏è  {idx}. {product_data['name']} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")
                    continue

                # –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–¥—É–∫—Ç
                product = Product(
                    name=product_data["name"],
                    description=product_data["description"],
                    price_shmeckles=product_data["price_shmeckles"],
                    price_flurbos=product_data["price_shmeckles"]
                    * SHMECKLES_TO_FLURBOS,
                    image_url=f"/uploads/products/{product_data['image']}",
                    category=categories_dict.get(product_data["category"]),
                )

                # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥–∏
                for tag_name in product_data["tags"]:
                    if tag_name in tags_dict:
                        product.tags.append(tags_dict[tag_name])

                session.add(product)
                logger.info(f"  ‚ûï {idx}. {product.name}")

            await session.commit()
            logger.info(f"‚úÖ –¢–æ–≤–∞—Ä—ã —Å–æ–∑–¥–∞–Ω—ã")
            logger.info("üéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!")

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ë–î: {e}")
            await session.rollback()
            raise


async def clear_database():
    """–û—á–∏—â–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)"""
    async with async_session_maker() as session:
        try:
            logger.warning("üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
            await session.execute(text("DELETE FROM product_tag_association"))
            await session.execute(text("DELETE FROM products"))
            await session.execute(text("DELETE FROM tags"))
            await session.execute(text("DELETE FROM categories"))
            await session.commit()
            logger.info("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞")
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ë–î: {e}")
            await session.rollback()
            raise


async def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —Å –æ–ø—Ü–∏—è–º–∏:
    --clear     –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    --images    –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î)
    –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:
    python seed_data.py --clear --images
    """
    args = sys.argv[1:]

    # –¢–æ–ª—å–∫–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    if "--images" in args:
        copy_images()
        return

    # –û—á–∏—Å—Ç–∫–∞ –ë–î –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    if "--clear" in args:
        await clear_database()

    # –ö–æ–ø–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if not copy_images():
        logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ.")
        return

    # –ó–∞–ø–æ–ª–Ω—è–µ–º –ë–î
    await seed_database()


if __name__ == "__main__":
    asyncio.run(main())

```

## `utils/__init__.py`

```py

```

## `utils/telegram_bot.py`

```py
# utils/telegram.py
import logging
import telegram
from core.config import settings

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.DEBUG)


async def send_telegram_message(message: str, parse_mode: str = "Markdown"):
    """–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram —á–µ—Ä–µ–∑ –±–æ—Ç–∞"""
    try:
        bot = telegram.Bot(token=settings.TELEGRAM_BOT_API_KEY)
        # –ò–º–∏—Ç–∏—Ä—É–µ–º –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω—É—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
        await bot.send_message(
            chat_id=settings.TELEGRAM_USER_ID, text=message, parse_mode=parse_mode
        )
        logging.info(
            f'–°–æ–æ–±—â–µ–Ω–∏–µ "{message}" –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ —á–∞—Ç {settings.TELEGRAM_USER_ID}'
        )
    except Exception as e:
        logging.error(
            f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç {settings.TELEGRAM_USER_ID}: {e}"
        )
        raise
    else:
        logging.debug(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {message}")


async def send_order_notification(
    order_id: int, total_amount: float, user_email: str, delivery_address: str
):
    """
    –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –∑–∞–∫–∞–∑–µ –≤ Telegram.

    Args:
        order_id: ID –∑–∞–∫–∞–∑–∞
        total_amount: –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞
        user_email: Email –∫–ª–∏–µ–Ω—Ç–∞
        delivery_address: –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏
    """
    message = (
        f"üí∞ *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #{order_id}!*\n\n"
        f"üìä –°—É–º–º–∞: *{total_amount:.2f} —à–º–µ–∫–ª–µ–π*\n"
        f"üë§ –ö–ª–∏–µ–Ω—Ç: `{user_email}`\n"
        f"üìç –ê–¥—Ä–µ—Å: {delivery_address}\n\n"
        f"üéâ –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ!"
    )

    await send_telegram_message(message, parse_mode="Markdown")
    logging.info(f"üì¨ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–∫–∞–∑–µ #{order_id} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram")

```

