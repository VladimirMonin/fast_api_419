# üìö –ó–∞–Ω—è—Ç–∏–µ ‚Ññ1: Jinja2 + HTMX (–ß–∞—Å—Ç—å 2)

## –ö–æ–º–º–∏—Ç—ã 2-3: –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∏ –∂–∏–≤–æ–π –ø–æ–∏—Å–∫

---

## üéØ –ö–æ–º–º–∏—Ç 2: –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ù–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ –º—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –Ω–∞—à—É —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤. –í–º–µ—Å—Ç–æ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ "–ü—Ä–∏–≤–µ—Ç –º–∏—Ä" –º—ã –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö –≤ –≤–∏–¥–µ –∫–∞—Ä—Ç–æ—á–µ–∫.

---

## üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–æ—É—Ç–µ—Ä–µ

–û—Ç–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª `routes/pages.py` –∏ –¥–æ—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ.

### –§–∞–π–ª: `routes/pages.py` (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π)

```python
from fastapi import APIRouter, Request, Depends
from fastapi.templating import Jinja2Templates
from pathlib import Path
from sqlalchemy.ext.asyncio import AsyncSession

from core.database import get_db_session, products_get_with_filters

BASE_DIR = Path(__file__).resolve().parent.parent
templates = Jinja2Templates(directory=str(BASE_DIR / "templates"))

router = APIRouter()

@router.get("/", include_in_schema=False)
async def index(
    request: Request, 
    session: AsyncSession = Depends(get_db_session)
):
    """–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤"""
    # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    products = await products_get_with_filters(session)
    
    return templates.TemplateResponse(
        "index.html",
        {
            "request": request,
            "products": products,
        }
    )
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

#### 1. –ù–æ–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã

```python
from sqlalchemy.ext.asyncio import AsyncSession
from core.database import get_db_session, products_get_with_filters
```

**AsyncSession** ‚Äî —ç—Ç–æ —Ç–∏–ø –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ SQLAlchemy. –°–µ—Å—Å–∏—è ‚Äî —ç—Ç–æ "—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ" —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–µ –º—ã –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã.

**get_db_session** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (dependency) FastAPI. –û–Ω–∞ —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –µ—ë –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.

**products_get_with_filters** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ –Ω–∞—à–µ–≥–æ CRUD, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∞ –º–æ–∂–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã.

#### 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏

```python
session: AsyncSession = Depends(get_db_session)
```

**`Depends(get_db_session)`** ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å FastAPI: "–ü–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–π —Å–µ—Å—Å–∏—é –ë–î –∏ –ø–µ—Ä–µ–¥–∞–π –µ—ë —Å—é–¥–∞".

–°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã:

```
–ó–∞–ø—Ä–æ—Å –ø—Ä–∏—à—ë–ª
    ‚Üì
FastAPI –≤–∏–¥–∏—Ç Depends(get_db_session)
    ‚Üì
–í—ã–∑—ã–≤–∞–µ—Ç get_db_session() ‚Üí —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é
    ‚Üì
–ü–µ—Ä–µ–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä session
    ‚Üì
–§—É–Ω–∫—Ü–∏—è index() –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
    ‚Üì
FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é
```

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

```python
products = await products_get_with_filters(session)
```

**await** ‚Äî –∂–¥—ë–º, –ø–æ–∫–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å—Ö–æ–¥–∏—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—É—á–∏—Ç —Ç–æ–≤–∞—Ä—ã. –≠—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî –ø–æ–∫–∞ –æ–Ω–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

**products** ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ Product (pydantic-—Å—Ö–µ–º—ã). –ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:

- `id` ‚Äî –Ω–æ–º–µ—Ä —Ç–æ–≤–∞—Ä–∞
- `name` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ
- `description` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ
- `price_credits` ‚Äî —Ü–µ–Ω–∞ –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö
- `price_shmeckles` ‚Äî —Ü–µ–Ω–∞ –≤ —à–º–µ–∫–ª—è—Ö
- `image_url` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
- `category` ‚Äî –æ–±—ä–µ–∫—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `tags` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤

#### 4. –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —à–∞–±–ª–æ–Ω

```python
return templates.TemplateResponse(
    "index.html",
    {
        "request": request,
        "products": products,  # ‚Üê –ü–µ—Ä–µ–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
    }
)
```

–¢–µ–ø–µ—Ä—å –≤ —à–∞–±–ª–æ–Ω–µ `index.html` –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `products`, —Å –∫–æ—Ç–æ—Ä–æ–π –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å.

---

## üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ index.html

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥–µ–ª—ã–≤–∞–µ–º `index.html`, —á—Ç–æ–±—ã –æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–ª —Ç–æ–≤–∞—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

### –§–∞–π–ª: `templates/index.html` (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π)

```html
{% extends "base.html" %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ - Python419 Shop{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-3">üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
        <p class="text-muted">–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products|length }}</p>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4" id="product-grid">
    {% for product in products %}
    <div class="col">
        <div class="card h-100 shadow-sm">
            {% if product.image_url %}
            <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}" style="height: 200px; object-fit: cover;">
            {% else %}
            <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                <span class="text-white fs-1">üì¶</span>
            </div>
            {% endif %}
            
            <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ product.name }}</h5>
                <p class="card-text text-muted small flex-grow-1">
                    {{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
                </p>
                
                <div class="mt-auto">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="badge bg-primary">{{ product.price_credits }} ‚ÇΩ</span>
                        {% if product.price_shmeckles %}
                        <span class="badge bg-success">{{ product.price_shmeckles }} Sh</span>
                        {% endif %}
                    </div>
                    
                    <button class="btn btn-sm btn-outline-primary w-100">
                        üõí –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
            <p class="mb-0">–í –∫–∞—Ç–∞–ª–æ–≥–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
```

### –†–∞–∑–±–æ—Ä —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Jinja2

#### 1. –§–∏–ª—å—Ç—Ä length

```html
{{ products|length }}
```

**–§–∏–ª—å—Ç—Ä** ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –°–∏–º–≤–æ–ª `|` (pipe) –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä.

`products|length` ‚Äî —ç—Ç–æ –∫–∞–∫ `len(products)` –≤ Python. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤.

#### 2. –¶–∏–∫–ª for

```html
{% for product in products %}
    <!-- –ö–æ–¥ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
{% else %}
    <!-- –ß—Ç–æ –ø–æ–∫–∞–∑–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç -->
{% endfor %}
```

–≠—Ç–æ —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≤—Ç–æ—Ä—è–µ—Ç HTML –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ `products`.

**`{% else %}`** ‚Äî —ç—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å Jinja2. –ë–ª–æ–∫ `else` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, **–µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç–æ–π** (–Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞).

–°—Ö–µ–º–∞:

```
products = [—Ç–æ–≤–∞—Ä1, —Ç–æ–≤–∞—Ä2, —Ç–æ–≤–∞—Ä3]
    ‚Üì
{% for product in products %}
    ‚Üê –ü–µ—Ä–≤–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è: product = —Ç–æ–≤–∞—Ä1
    ‚Üê –í—Ç–æ—Ä–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è: product = —Ç–æ–≤–∞—Ä2
    ‚Üê –¢—Ä–µ—Ç—å—è –∏—Ç–µ—Ä–∞—Ü–∏—è: product = —Ç–æ–≤–∞—Ä3
{% endfor %}

products = []  (–ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫)
    ‚Üì
{% for product in products %}
    (–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è)
{% else %}
    ‚Üê –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è "—Ç–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
{% endfor %}
```

#### 3. –£—Å–ª–æ–≤–∏–µ if

```html
{% if product.image_url %}
    <img src="{{ product.image_url }}" ...>
{% else %}
    <div>üì¶</div>
{% endif %}
```

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ —É—Å–ª–æ–≤–∏–µ: –µ—Å–ª–∏ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º `<img>`, –∏–Ω–∞—á–µ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É (emoji üì¶).

#### 4. –°—Ä–µ–∑—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã

```html
{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
```

**`[:100]`** ‚Äî —ç—Ç–æ —Å—Ä–µ–∑, –∫–∞–∫ –≤ Python. –ë–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ 100 —Å–∏–º–≤–æ–ª–æ–≤ –æ–ø–∏—Å–∞–Ω–∏—è.

**`|length > 100`** ‚Äî –µ—Å–ª–∏ –¥–ª–∏–Ω–∞ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ–ª—å—à–µ 100 —Å–∏–º–≤–æ–ª–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º `...` –≤ –∫–æ–Ω—Ü–µ.

#### 5. Bootstrap Grid

```html
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4">
```

–≠—Ç–æ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ Bootstrap:

- **`row-cols-1`** ‚Äî –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (—Ç–µ–ª–µ—Ñ–æ–Ω) ‚Äî 1 –∫–∞—Ä—Ç–æ—á–∫–∞ –≤ —Ä—è–¥
- **`row-cols-md-2`** ‚Äî –Ω–∞ —Å—Ä–µ–¥–Ω–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (–ø–ª–∞–Ω—à–µ—Ç) ‚Äî 2 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥
- **`row-cols-lg-3`** ‚Äî –Ω–∞ –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö (–Ω–æ—É—Ç–±—É–∫) ‚Äî 3 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥
- **`row-cols-xl-4`** ‚Äî –Ω–∞ –æ–≥—Ä–æ–º–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö (–º–æ–Ω–∏—Ç–æ—Ä) ‚Äî 4 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥
- **`g-4`** ‚Äî –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ (gap)

---

## üéØ –ö–æ–º–º–∏—Ç 3: –ñ–∏–≤–æ–π –ø–æ–∏—Å–∫ —Å HTMX

–¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º **–∂–∏–≤–æ–π –ø–æ–∏—Å–∫**. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç, –∏ —á–µ—Ä–µ–∑ –ø–æ–ª—Å–µ–∫—É–Ω–¥—ã —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è. –ë–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ë–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è JavaScript.

---

## üì¶ –°–æ–∑–¥–∞–Ω–∏–µ partial (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞)

–°–Ω–∞—á–∞–ª–∞ –≤—ã–Ω–æ—Å–∏–º –≤–µ—Ä—Å—Ç–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª.

### –§–∞–π–ª: `templates/partials/product_card.html`

```html
<div class="col">
    <div class="card h-100 shadow-sm">
        {% if product.image_url %}
        <img src="{{ product.image_url }}" class="card-img-top" alt="{{ product.name }}" style="height: 200px; object-fit: cover;">
        {% else %}
        <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
            <span class="text-white fs-1">üì¶</span>
        </div>
        {% endif %}
        
        <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ product.name }}</h5>
            <p class="card-text text-muted small flex-grow-1">
                {{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}
            </p>
            
            <div class="mt-auto">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <span class="badge bg-primary">{{ product.price_credits }} ‚ÇΩ</span>
                    {% if product.price_shmeckles %}
                    <span class="badge bg-success">{{ product.price_shmeckles }} Sh</span>
                    {% endif %}
                </div>
                
                <button class="btn btn-sm btn-outline-primary w-100">
                    üõí –í –∫–æ—Ä–∑–∏–Ω—É
                </button>
            </div>
        </div>
    </div>
</div>
```

–≠—Ç–æ **—Ç–æ—á–Ω–æ —Ç–∞–∫–∞—è –∂–µ** –∫–∞—Ä—Ç–æ—á–∫–∞, —á—Ç–æ –±—ã–ª–∞ –≤ `index.html`, –Ω–æ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ.

### –ó–∞—á–µ–º –≤—ã–Ω–æ—Å–∏—Ç—å –≤ partial?

**–ü—Ä–∏–Ω—Ü–∏–ø DRY** (Don't Repeat Yourself) ‚Äî –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π—Å—è. –ï—Å–ª–∏ –Ω–∞–º –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–∫–∏, –º—ã –º–µ–Ω—è–µ–º –µ–≥–æ –≤ **–æ–¥–Ω–æ–º –º–µ—Å—Ç–µ** (`product_card.html`), –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç–æ—Ç partial.

---

## üîç –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –≤ index.html

–¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ–º `index.html`, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å partial –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞.

### –§–∞–π–ª: `templates/index.html` (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```html
{% extends "base.html" %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ - Python419 Shop{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="mb-3">üõçÔ∏è –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤</h1>
    </div>
</div>

<!-- –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å HTMX -->
<div class="row mb-4">
    <div class="col-md-6 col-lg-4">
        <input 
            type="text" 
            class="form-control" 
            placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..."
            name="search"
            hx-get="/"
            hx-trigger="keyup changed delay:500ms"
            hx-target="#product-grid"
            hx-select="#product-grid"
            hx-swap="outerHTML"
        >
        <small class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</small>
    </div>
    <div class="col-md-6 col-lg-8">
        <p class="text-muted mb-0 mt-2">–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ products|length }}</strong></p>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4" id="product-grid">
    {% for product in products %}
    {% include "partials/product_card.html" %}
    {% else %}
    <div class="col-12">
        <div class="alert alert-info" role="alert">
            <h5 class="alert-heading">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h5>
            <p class="mb-0">–í –∫–∞—Ç–∞–ª–æ–≥–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
```

### –†–∞–∑–±–æ—Ä HTMX-–∞—Ç—Ä–∏–±—É—Ç–æ–≤

#### 1. –î–∏—Ä–µ–∫—Ç–∏–≤–∞ include

```html
{% include "partials/product_card.html" %}
```

–≠—Ç–æ –∫–∞–∫ `import` –≤ Python. Jinja2 –±–µ—Ä—ë—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `partials/product_card.html` –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å—é–¥–∞. –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `product`) –¥–æ—Å—Ç—É–ø–Ω—ã –≤–Ω—É—Ç—Ä–∏ included-—Ñ–∞–π–ª–∞.

#### 2. –ê—Ç—Ä–∏–±—É—Ç—ã HTMX

```html
<input 
    type="text" 
    name="search"
    hx-get="/"
    hx-trigger="keyup changed delay:500ms"
    hx-target="#product-grid"
    hx-select="#product-grid"
    hx-swap="outerHTML"
>
```

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º –∫–∞–∂–¥—ã–π –∞—Ç—Ä–∏–±—É—Ç –ø–æ–¥—Ä–æ–±–Ω–æ:

**`hx-get="/"`** ‚Äî –ø—Ä–∏ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–¥—Ä–µ—Å `/`.

**`hx-trigger="keyup changed delay:500ms"`** ‚Äî —Å–æ–±—ã—Ç–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:

- **`keyup`** ‚Äî –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—É—Å–∫–∞–µ—Ç –∫–ª–∞–≤–∏—à—É
- **`changed`** ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å—Ç—Ä–µ–ª–∫–∏ –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑)
- **`delay:500ms`** ‚Äî –ø–æ–¥–æ–∂–¥–∏ 500 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥ (–ø–æ–ª—Å–µ–∫—É–Ω–¥—ã) –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–∂–∞—Ç–∏—è

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **debounce** (–¥–µ–±–∞—É–Ω—Å). –ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏ –∫–∞–∂–¥–∞—è –±—É–∫–≤–∞ –≤—ã–∑—ã–≤–∞–ª–∞ –±—ã –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä. –° –∑–∞–¥–µ—Ä–∂–∫–æ–π –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å **–ø–µ—Ä–µ—Å—Ç–∞–ª –ø–µ—á–∞—Ç–∞—Ç—å**.

–°—Ö–µ–º–∞:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç: "–ü–ª—é"
    ‚Üì
'–ü' ‚Üí keyup ‚Üí —Ç–∞–π–º–µ—Ä 500ms
    ‚Üì
'–ª' ‚Üí keyup ‚Üí —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞, –Ω–æ–≤—ã–π 500ms
    ‚Üì
'—é' ‚Üí keyup ‚Üí —Å–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞, –Ω–æ–≤—ã–π 500ms
    ‚Üì
(–ø–∞—É–∑–∞ 500ms)
    ‚Üì
–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: GET /?search=–ü–ª—é
```

**`hx-target="#product-grid"`** ‚Äî –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞. –ò—â–µ—Ç —ç–ª–µ–º–µ–Ω—Ç —Å `id="product-grid"`.

**`hx-select="#product-grid"`** ‚Äî —á—Ç–æ –≤—ã—Ä–µ–∑–∞—Ç—å –∏–∑ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞.

–≠—Ç–æ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç! –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** (—Å —à–∞–ø–∫–æ–π, —Ñ—É—Ç–µ—Ä–æ–º, –≤—Å–µ–º HTML). –ù–æ –Ω–∞–º –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –±–ª–æ–∫ —Å —Ç–æ–≤–∞—Ä–∞–º–∏. HTMX —É–º–Ω—ã–π ‚Äî –æ–Ω **–ø–∞—Ä—Å–∏—Ç –æ—Ç–≤–µ—Ç**, –Ω–∞—Ö–æ–¥–∏—Ç –≤ –Ω—ë–º —ç–ª–µ–º–µ–Ω—Ç `#product-grid` –∏ –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ –µ–≥–æ.

**`hx-swap="outerHTML"`** ‚Äî –∫–∞–∫ –∑–∞–º–µ–Ω–∏—Ç—å:

- **`innerHTML`** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–¥–µ—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç–∞)
- **`outerHTML`** ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –≤–µ—Å—å —ç–ª–µ–º–µ–Ω—Ç —Ü–µ–ª–∏–∫–æ–º

–°—Ö–µ–º–∞:

```
–î–æ –∑–∞–ø—Ä–æ—Å–∞:
<div id="product-grid">
    <div class="col">–¢–æ–≤–∞—Ä 1</div>
    <div class="col">–¢–æ–≤–∞—Ä 2</div>
</div>

–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª:
<div id="product-grid">
    <div class="col">–ü–ª—é–º–±—É—Å</div>
</div>

–ü–æ—Å–ª–µ hx-swap="outerHTML":
<div id="product-grid">
    <div class="col">–ü–ª—é–º–±—É—Å</div>
</div>
```

---

## ‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

–¢–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–æ—É—Ç–µ—Ä, —á—Ç–æ–±—ã –æ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –ø–∞—Ä–∞–º–µ—Ç—Ä `search`.

### –§–∞–π–ª: `routes/pages.py` (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```python
@router.get("/", include_in_schema=False)
async def index(
    request: Request, 
    session: AsyncSession = Depends(get_db_session),
    search: str | None = None
):
    """
    –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤
    
    –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
    - search: –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
    """
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å —É—á–µ—Ç–æ–º –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    products = await products_get_with_filters(session, search=search)
    
    return templates.TemplateResponse(
        "index.html",
        {
            "request": request,
            "products": products,
        }
    )
```

### –ß—Ç–æ –¥–æ–±–∞–≤–∏–ª–æ—Å—å

```python
search: str | None = None
```

**`str | None`** ‚Äî —ç—Ç–æ type hint (–∞–Ω–Ω–æ—Ç–∞—Ü–∏—è —Ç–∏–ø–∞). –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `search` –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –∏–ª–∏ `None`.

**`= None`** ‚Äî –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ –∑–∞–ø—Ä–æ—Å–µ, –æ–Ω –±—É–¥–µ—Ç `None`.

–ö–æ–≥–¥–∞ HTMX –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å —Å `<input name="search">`, FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –ë–µ—Ä—ë—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è
2. –î–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ URL: `/?search=–ü–ª—é–º–±—É—Å`
3. –ü–∞—Ä—Å–∏—Ç query-–ø–∞—Ä–∞–º–µ—Ç—Ä
4. –ü–µ—Ä–µ–¥–∞—ë—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ `search="–ü–ª—é–º–±—É—Å"`

---

## üéØ –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–∏—Å–∫–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç "–ü–ª—é" –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
    ‚Üì
2. HTMX –∂–¥—ë—Ç 500ms –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
    ‚Üì
3. HTMX –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: GET /?search=–ü–ª—é
    ‚Üì
4. FastAPI –≤—ã–∑—ã–≤–∞–µ—Ç index(request, session, search="–ü–ª—é")
    ‚Üì
5. –§—É–Ω–∫—Ü–∏—è products_get_with_filters(session, search="–ü–ª—é")
    ‚Üì
6. SQL-–∑–∞–ø—Ä–æ—Å: SELECT * FROM products WHERE name LIKE '%–ü–ª—é%' OR ...
    ‚Üì
7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: [–ü–ª—é–º–±—É—Å]
    ‚Üì
8. FastAPI —Ä–µ–Ω–¥–µ—Ä–∏—Ç templates/index.html —Å products=[–ü–ª—é–º–±—É—Å]
    ‚Üì
9. HTMX –ø–æ–ª—É—á–∞–µ—Ç HTML –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    ‚Üì
10. HTMX –ø–∞—Ä—Å–∏—Ç HTML –∏ –Ω–∞—Ö–æ–¥–∏—Ç #product-grid
    ‚Üì
11. HTMX –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–π #product-grid –Ω–∞ –Ω–æ–≤—ã–π
    ‚Üì
12. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ü–ª—é–º–±—É—Å –≤ —Å–ø–∏—Å–∫–µ
```

---

## ‚úÖ –ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–ª–∏

–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–æ–≤ 2 –∏ 3:

- ‚úÖ –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢–æ–≤–∞—Ä—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ –∫—Ä–∞—Å–∏–≤—ã—Ö –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- ‚úÖ –°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π partial `product_card.html`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∂–∏–≤–æ–π –ø–æ–∏—Å–∫ –±–µ–∑ JavaScript
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è debounce –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ HTMX –∑–∞–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—É—é —á–∞—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç: –º–æ—â–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ —Å –∂–∏–≤—ã–º –ø–æ–∏—Å–∫–æ–º, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –Ω–∞ —á–∏—Å—Ç–æ–º Python + HTML! üöÄ
