# üìö –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç: Celery + Redis + FastAPI –Ω–∞ Windows

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 15 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–ü—Ä–æ–µ–∫—Ç**: Python419 - –£—á–µ–±–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI —Å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏  
**–ê–≤—Ç–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## üéØ –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Celery](#–ø–æ–¥—Ä–æ–±–Ω—ã–π-—Ä–∞–∑–±–æ—Ä-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤-celery)
3. [–†–∞–∑–±–æ—Ä –∫–æ–¥–∞ –ø–æ —Ñ–∞–π–ª–∞–º](#—Ä–∞–∑–±–æ—Ä-–∫–æ–¥–∞-–ø–æ-—Ñ–∞–π–ª–∞–º)
4. [–î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã](#–¥–∏–∞–≥—Ä–∞–º–º–∞-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏-—Ä–∞–±–æ—Ç—ã)
5. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è Windows](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–º–æ–º–µ–Ω—Ç—ã-–¥–ª—è-windows)
6. [–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å](#–ø–æ—á–µ–º—É-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç-—Å–µ–π—á–∞—Å)

---

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä—ë—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ **Redis**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   FastAPI       ‚îÇ      ‚îÇ     Redis       ‚îÇ      ‚îÇ  Celery Worker  ‚îÇ
‚îÇ   (–í–µ–±-—Å–µ—Ä–≤–µ—Ä)  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   (–ë—Ä–æ–∫–µ—Ä)      ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  (–û–±—Ä–∞–±–æ—Ç—á–∏–∫)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                        ‚îÇ                         ‚îÇ
        ‚îÇ                        ‚îÇ                         ‚îÇ
   HTTP –∑–∞–ø—Ä–æ—Å—ã          –û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á            –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á
   –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤           (Message Queue)          –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
```

### –†–æ–ª–∏ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

1. **FastAPI (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)**:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å Redis —á–µ—Ä–µ–∑ Celery
   - –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É (–Ω–µ –∂–¥—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏)

2. **Redis (–±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π)**:
   - –•—Ä–∞–Ω–∏—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –º–µ–∂–¥—É FastAPI –∏ Celery Worker
   - –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á (backend)

3. **Celery Worker (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–¥–∞—á)**:
   - –ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å Redis
   - –ë–µ—Ä—ë—Ç –∑–∞–¥–∞—á–∏ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ñ–æ–Ω–µ
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞—Ç–Ω–æ –≤ Redis

---

## üîß –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Celery

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Celery

#### –§–∞–π–ª: `tasks/celery_app.py`

```python
celery_app = Celery(
    "tasks",
    broker=f"redis://{settings.REDIS_HOST}:{settings.REDIS_PORT}/0",
    backend=f"redis://{settings.REDIS_HOST}:{settings.REDIS_PORT}/0",
)
```

#### –†–∞–∑–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|------------|
| `"tasks"` | –ò–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Celery. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö –∏ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∑–∞–¥–∞—á |
| `broker` | `redis://localhost:6379/0` | **–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π** - –∫—É–¥–∞ Celery –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏. Redis –±–∞–∑–∞ ‚Ññ0 |
| `backend` | `redis://localhost:6379/0` | **Backend —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –∫—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á |

**–ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º Redis –∏ –∫–∞–∫ –±—Ä–æ–∫–µ—Ä, –∏ –∫–∞–∫ backend?**

- **Broker (–±—Ä–æ–∫–µ—Ä)**: –•—Ä–∞–Ω–∏—Ç –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
- **Backend (–±—ç–∫–µ–Ω–¥)**: –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- Redis –±—ã—Å—Ç—Ä—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –¥–ª—è –æ–±–µ–∏—Ö —Ä–æ–ª–µ–π

**–§–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis:**

```
redis://<host>:<port>/<database_number>
```

- `localhost` - –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ Redis
- `6379` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç Redis
- `0` - –Ω–æ–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Redis (Redis –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 16 –±–∞–∑: 0-15)

---

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Celery –¥–ª—è Windows

```python
celery_app.conf.update(
    worker_concurrency=1,
    task_acks_late=True,
    worker_pool="solo",
    broker_connection_retry_on_startup=True,
)
```

#### –î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

#### ‚úÖ `worker_concurrency=1`

**–ß–¢–û**: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤/–ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

**–ó–ù–ê–ß–ï–ù–ò–ï**: `1` - –æ–¥–∏–Ω worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É –∑–∞ —Ä–∞–∑

**–ó–ê–ß–ï–ú**:

- –ù–∞ Windows multiprocessing —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ
- –£–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**:

- `2-4` - –¥–ª—è –±–æ–ª–µ–µ –º–æ—â–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (–Ω–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –Ω–∞ Windows)
- –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä CPU

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- –ë–æ–ª—å—à–µ 1: –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º "OSError: [WinError 6]" –Ω–∞ Windows
- 0 –∏–ª–∏ None: Celery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä (–æ–ø–∞—Å–Ω–æ –Ω–∞ Windows)

---

#### ‚úÖ `task_acks_late=True`

**–ß–¢–û**: –ö–æ–≥–¥–∞ –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è "–ø—Ä–∏–Ω—è—Ç–æ–π" (acknowledged)

**–ó–ù–ê–ß–ï–ù–ò–ï**: `True` - –∑–∞–¥–∞—á–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è –ü–û–°–õ–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∞ –Ω–µ –¥–æ

**–ó–ê–ß–ï–ú**:

- –ï—Å–ª–∏ worker —É–ø–∞–¥—ë—Ç –î–û –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, –∑–∞–¥–∞—á–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –∑–∞–¥–∞—á

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:

```
task_acks_late=False (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
1. Worker –±–µ—Ä—ë—Ç –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
2. ‚úì –°—Ä–∞–∑—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç: "–Ø –≤–∑—è–ª –∑–∞–¥–∞—á—É" (–∑–∞–¥–∞—á–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏)
3. –ù–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
4. ‚ùå –°–ë–û–ô - –∑–∞–¥–∞—á–∞ –ø–æ—Ç–µ—Ä—è–Ω–∞ –Ω–∞–≤—Å–µ–≥–¥–∞!

task_acks_late=True (–Ω–∞—à–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞):
1. Worker –±–µ—Ä—ë—Ç –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
2. –ù–∞—á–∏–Ω–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–∑–∞–¥–∞—á–∞ –ï–©–Å –≤ –æ—á–µ—Ä–µ–¥–∏)
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
4. ‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
5. ‚ùå –°–ë–û–ô –Ω–∞ —à–∞–≥–µ 3 - –∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏, –¥—Ä—É–≥–æ–π worker –µ—ë –≤–æ–∑—å–º—ë—Ç
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- `False`: –ë—ã—Å—Ç—Ä–µ–µ, –Ω–æ –µ—Å—Ç—å —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –∑–∞–¥–∞—á –ø—Ä–∏ —Å–±–æ—è—Ö
- `True`: –ù–∞–¥—ë–∂–Ω–µ–µ, –Ω–æ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è –¥–≤–∞–∂–¥—ã, –µ—Å–ª–∏ worker —É–ø–∞–ª –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –Ω–æ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

#### ‚úÖ `worker_pool="solo"` ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ù–û –î–õ–Ø WINDOWS**

**–ß–¢–û**: –¢–∏–ø –ø—É–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á

**–ó–ù–ê–ß–ï–ù–ò–ï**: `"solo"` - –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å, –±–µ–∑ —Ñ–æ—Ä–∫–∞, –±–µ–∑ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏

**–ó–ê–ß–ï–ú**:

- Windows **–ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢** Unix-style –ø—Ä–æ—Ü–µ—Å—Å—ã (fork)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É–ª `prefork` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–¥—ë–∂–Ω—ã–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Windows

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã –ø—É–ª–æ–≤**:

| –¢–∏–ø –ø—É–ª–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | Windows | Linux | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|----------|----------|---------|-------|-------------------|
| `prefork` | –§–æ—Ä–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢ | ‚úÖ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| `solo` | –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å, –±–µ–∑ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏ | ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ | ‚úÖ | ‚≠ê‚≠ê |
| `threads` | –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ | ‚≠ê‚≠ê‚≠ê |
| `gevent` | –ó–µ–ª—ë–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (–Ω—É–∂–µ–Ω gevent) | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ | ‚≠ê‚≠ê‚≠ê‚≠ê |
| `eventlet` | –ó–µ–ª—ë–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (–Ω—É–∂–µ–Ω eventlet) | ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã | ‚úÖ | ‚≠ê‚≠ê‚≠ê‚≠ê |

**–ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ –±–µ–∑ `worker_pool="solo"`**:

```python
# –ë–ï–ó worker_pool="solo" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é prefork):
[ERROR] OSError: [WinError 6] –ù–µ–≤–µ—Ä–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
[ERROR] PermissionError: [WinError 5] –û—Ç–∫–∞–∑–∞–Ω–æ –≤ –¥–æ—Å—Ç—É–ø–µ
# ‚Üë Celery –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fork(), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ Windows
```

```python
# –° worker_pool="solo":
[INFO] celery@WIN-44L29R8TDST ready.
# ‚Üë –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è Windows**:

```python
worker_pool="threads"  # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–º–µ—Å—Ç–æ solo –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
worker_concurrency=4    # –¢–æ–≥–¥–∞ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 4 –ø–æ—Ç–æ–∫–æ–≤
```

---

#### ‚úÖ `broker_connection_retry_on_startup=True`

**–ß–¢–û**: –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–ó–ù–ê–ß–ï–ù–ò–ï**: `True` - –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞

**–ó–ê–ß–ï–ú**:

- Redis –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —á–µ–º Celery worker
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞–¥–µ–Ω–∏–µ worker, –µ—Å–ª–∏ Redis –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤
- –£–¥–æ–±–Ω–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–∑–∞–±—ã–ª –∑–∞–ø—É—Å—Ç–∏—Ç—å Redis - –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**:

```
1. Celery worker –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis
3. ‚ùå Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
4. ‚è≥ –ñ–¥—ë—Ç 1 —Å–µ–∫—É–Ω–¥—É
5. üîÑ –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É
6. ‚úÖ Redis –∑–∞—Ä–∞–±–æ—Ç–∞–ª - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):

```python
broker_connection_retry_on_startup=True,
broker_connection_retry=True,        # –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
broker_connection_max_retries=10,    # –ú–∞–∫—Å–∏–º—É–º 10 –ø–æ–ø—ã—Ç–æ–∫
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è**:

- `False`: Worker —É–ø–∞–¥—ë—Ç —Å—Ä–∞–∑—É, –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- `True`: Worker –±—É–¥–µ—Ç –∂–¥–∞—Ç—å Redis (—É–¥–æ–±–Ω–µ–µ)

---

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á

```python
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–¥–∞—á–∏ —è–≤–Ω–æ, —á—Ç–æ–±—ã –æ–Ω–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å
from tasks import notifications  # noqa: E402
```

#### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

**–ü–†–û–ë–õ–ï–ú–ê**: Celery –¥–æ–ª–∂–µ–Ω **–∑–Ω–∞—Ç—å** –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ **–î–û** —Ç–æ–≥–æ, –∫–∞–∫ –µ—ë –≤—ã–∑–æ–≤—É—Ç

**–†–ï–®–ï–ù–ò–ï**: –Ø–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è —Å –∑–∞–¥–∞—á–∞–º–∏

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ**:

```python
# 1. Python –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–∞–π–ª tasks/notifications.py
# 2. –í—Å—Ç—Ä–µ—á–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä @celery_app.task
# 3. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –≤ celery_app
# 4. –¢–µ–ø–µ—Ä—å celery_app –∑–Ω–∞–µ—Ç –æ –∑–∞–¥–∞—á–µ "tasks.notifications.send_tg_notification"
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**:

```python
# –°–ø–æ—Å–æ–± 1: –Ø–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ–º –º—ã)
from tasks import notifications

# –°–ø–æ—Å–æ–± 2: autodiscover_tasks (–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú - –≤—ã–∑—ã–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã)
celery_app.autodiscover_tasks(['tasks'])

# –°–ø–æ—Å–æ–± 3: –ò–º–ø–æ—Ä—Ç –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ
# celery_worker.py –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
from tasks.celery_app import celery_app
from tasks import notifications  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å–µ –º–æ–¥—É–ª–∏ —Å –∑–∞–¥–∞—á–∞–º–∏
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `# noqa: E402`**:

- `E402` - –∫–æ–¥ –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞ "module level import not at top of file"
- `noqa` = "no quality assurance" - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –æ—à–∏–±–∫—É
- –ò–º–ø–æ—Ä—Ç –≤–Ω–∏–∑—É —Ñ–∞–π–ª–∞ –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## üìÑ –†–∞–∑–±–æ—Ä –∫–æ–¥–∞ –ø–æ —Ñ–∞–π–ª–∞–º

### –§–∞–π–ª 1: `config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```python
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    REDIS_HOST: str
    REDIS_PORT: int
    TG_BOT_KEY: str

    model_config = SettingsConfigDict(env_file=".env", env_file_encoding="utf-8")

settings = Settings()
```

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Pydantic BaseSettings** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` —Ñ–∞–π–ª–∞
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤**: `REDIS_PORT` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `int`, –∏–Ω–∞—á–µ –æ—à–∏–±–∫–∞
3. **Singleton –ø–∞—Ç—Ç–µ—Ä–Ω**: `settings` - –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

#### –û—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è

```env
# .env —Ñ–∞–π–ª
REDIS_HOST=localhost
REDIS_PORT=6379
TG_BOT_KEY=your_bot_key_here
```

#### –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –±–µ–∑ .env —Ñ–∞–π–ª–∞

```python
pydantic_core._pydantic_core.ValidationError: 3 validation errors for Settings
REDIS_HOST
  Field required [type=missing, input_value={}, input_type=dict]
```

---

### –§–∞–π–ª 2: `tasks/celery_app.py` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Celery

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏**:

```python
# tasks/celery_app.py
from celery import Celery
from config import settings

# ========================================
# –°–û–ó–î–ê–ù–ò–ï –≠–ö–ó–ï–ú–ü–õ–Ø–†–ê CELERY
# ========================================
celery_app = Celery(
    "tasks",  # –ò–º—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
    broker=f"redis://{settings.REDIS_HOST}:{settings.REDIS_PORT}/0",  # –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∑–∞–¥–∞—á–∏
    backend=f"redis://{settings.REDIS_HOST}:{settings.REDIS_PORT}/0",  # –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
)

# ========================================
# –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –î–õ–Ø WINDOWS
# ========================================
celery_app.conf.update(
    # –û–¥–∏–Ω worker = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    worker_concurrency=1,
    
    # –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å –∑–∞–¥–∞—á—É –ü–û–°–õ–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä—å)
    task_acks_late=True,
    
    # ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –†–µ–∂–∏–º solo –¥–ª—è Windows (–±–µ–∑ fork)
    worker_pool="solo",
    
    # –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    broker_connection_retry_on_startup=True,
)

# ========================================
# –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ó–ê–î–ê–ß
# ========================================
# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª—å notifications, —á—Ç–æ–±—ã –∑–∞–¥–∞—á–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å
# noqa: E402 - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ª–∏–Ω—Ç–µ—Ä–∞ –æ–± –∏–º–ø–æ—Ä—Ç–µ –Ω–µ –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
from tasks import notifications  # noqa: E402
```

#### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

```
1. Python –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç config.py
2. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ .env
3. –°–æ–∑–¥–∞—ë—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä celery_app
4. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ .conf.update()
5. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –º–æ–¥—É–ª—å notifications
6. –î–µ–∫–æ—Ä–∞—Ç–æ—Ä @celery_app.task —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é send_tg_notification
7. celery_app —Ç–µ–ø–µ—Ä—å –∑–Ω–∞–µ—Ç –æ –∑–∞–¥–∞—á–µ
```

---

### –§–∞–π–ª 3: `tasks/notifications.py` - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏

**–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏**:

```python
# tasks/notifications.py
import time
from tasks.celery_app import celery_app

# ========================================
# –î–ï–ö–û–†–ê–¢–û–† –ó–ê–î–ê–ß–ò CELERY
# ========================================
@celery_app.task(
    bind=True,           # –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å self (—ç–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–¥–∞—á–∏) –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º
    max_retries=3,       # –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
    name="tasks.notifications.send_tg_notification"  # –Ø–≤–Ω–æ–µ –∏–º—è –∑–∞–¥–∞—á–∏
)
def send_tg_notification(self, product_name: str, product_id: int):
    """
    –ò–º–∏—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram.
    
    Args:
        self: –≠–∫–∑–µ–º–ø–ª—è—Ä –∑–∞–¥–∞—á–∏ (–¥–æ—Å—Ç—É–ø–µ–Ω –±–ª–∞–≥–æ–¥–∞—Ä—è bind=True)
        product_name: –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        product_id: ID —Ç–æ–≤–∞—Ä–∞
        
    Returns:
        dict: –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    """
    try:
        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        message = f"""
**–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –º–∞–≥–∞–∑–∏–Ω–µ!**
**–ù–∞–∑–≤–∞–Ω–∏–µ:** {product_name}
**ID:** {product_id}

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: http://localhost:8000/products/{product_id}
"""
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
        print(f"[Celery Task] –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram...")
        print(f"[Celery Task] –¢–æ–≤–∞—Ä: {product_name} (ID: {product_id})")
        
        # ‚è±Ô∏è –ò–ú–ò–¢–ê–¶–ò–Ø –î–õ–ò–¢–ï–õ–¨–ù–û–ô –û–ü–ï–†–ê–¶–ò–ò (–æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram API)
        time.sleep(30)  # 30 —Å–µ–∫—É–Ω–¥
        
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        print(f"[Celery Task] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
        
        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ backend)
        return {"status": "success", "message": message}
        
    except Exception as exc:
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
        print(f"[Celery Task] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {exc}")
        
        # ‚ö†Ô∏è –ü–û–í–¢–û–†–ù–ê–Ø –ü–û–ü–´–¢–ö–ê —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
        # raise self.retry() –ù–ï –≤–µ—Ä–Ω—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∑–∞–¥–∞—á—É
        raise self.retry(exc=exc, countdown=5)
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@celery_app.task`

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|------------|
| `bind=True` | –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å `self` | –î–æ—Å—Ç—É–ø –∫ –º–µ—Ç–æ–¥–∞–º –∑–∞–¥–∞—á–∏: `self.retry()`, `self.request.id` |
| `max_retries=3` | 3 –ø–æ–ø—ã—Ç–∫–∏ | –ü–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ Failed |
| `name="..."` | –Ø–≤–Ω–æ–µ –∏–º—è | Celery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ |

#### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `self.retry()`

```python
# –ü–æ–ø—ã—Ç–∫–∞ 1:
try:
    send_telegram_request()  # ‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
except:
    raise self.retry(countdown=5)  # –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥, –ø–æ–ø—ã—Ç–∫–∞ 2

# –ü–æ–ø—ã—Ç–∫–∞ 2 (—á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥):
try:
    send_telegram_request()  # ‚ùå –°–Ω–æ–≤–∞ –æ—à–∏–±–∫–∞
except:
    raise self.retry(countdown=5)  # –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥, –ø–æ–ø—ã—Ç–∫–∞ 3

# –ü–æ–ø—ã—Ç–∫–∞ 3 (—á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥ –æ—Ç –Ω–∞—á–∞–ª–∞):
try:
    send_telegram_request()  # ‚ùå –í—Å—ë –µ—â—ë –æ—à–∏–±–∫–∞
except:
    raise self.retry(countdown=5)  # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!

# –ü–æ–ø—ã—Ç–∫–∞ 4 –ù–ï –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è FAILED
```

---

### –§–∞–π–ª 4: `routes/products.py` - –í—ã–∑–æ–≤ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏

**–§—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞**:

```python
from tasks.notifications import send_tg_notification

@router.post("/", response_model=Product, summary="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä", status_code=201)
async def create_product(product: CreateProduct):
    """
    –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.
    """
    # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID
    new_product_id = max(item["id"] for item in products) + 1 if products else 1
    
    # 2. –°–æ–∑–¥–∞—ë–º —Ç–æ–≤–∞—Ä
    new_product = product.model_dump()
    new_product["id"] = new_product_id
    products.append(new_product)
    
    # 3. ‚ö° –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ó–ê–î–ê–ß–£ –í CELERY
    # .delay() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏
    # FastAPI –ù–ï –ñ–î–Å–¢ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Å—Ä–∞–∑—É –∏–¥—ë—Ç –¥–∞–ª—å—à–µ
    send_tg_notification.delay(
        product_name=new_product["name"], 
        product_id=new_product_id
    )
    
    # 4. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
    return new_product
```

#### –ß—Ç–æ —Ç–∞–∫–æ–µ `.delay()`?

```python
# .delay() - —ç—Ç–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–ª—è .apply_async()

# –≠—Ç–∏ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã:
send_tg_notification.delay(product_name="–ü–ª—é–º–±—É—Å", product_id=21)
send_tg_notification.apply_async(kwargs={"product_name": "–ü–ª—é–º–±—É—Å", "product_id": 21})
```

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –≤—ã–∑–æ–≤–∞

```python
# 1. .delay() - –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± (–∏—Å–ø–æ–ª—å–∑—É–µ–º –º—ã)
task = send_tg_notification.delay(product_name="–ü–ª—é–º–±—É—Å", product_id=21)

# 2. .apply_async() - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
task = send_tg_notification.apply_async(
    kwargs={"product_name": "–ü–ª—é–º–±—É—Å", "product_id": 21},
    countdown=10,      # –í—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
    expires=3600,      # –ó–∞–¥–∞—á–∞ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç —á–µ—Ä–µ–∑ 1 —á–∞—Å
    retry=True,        # –ü–æ–≤—Ç–æ—Ä—è—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    retry_policy={
        'max_retries': 5,
        'interval_start': 0,
        'interval_step': 2,
    }
)

# 3. .apply() - –°–ò–ù–•–†–û–ù–ù–û–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–ë–õ–û–ö–ò–†–£–ï–¢ –∫–æ–¥!)
result = send_tg_notification.apply(
    kwargs={"product_name": "–ü–ª—é–º–±—É—Å", "product_id": 21}
)
# ‚Üë –ö–æ–¥ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è!

# 4. –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (–≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –≤—Ä–µ–º—è)
from datetime import datetime, timedelta
eta = datetime.now() + timedelta(hours=1)
task = send_tg_notification.apply_async(
    kwargs={"product_name": "–ü–ª—é–º–±—É—Å", "product_id": 21},
    eta=eta  # –í—ã–ø–æ–ª–Ω–∏—Ç—å —á–µ—Ä–µ–∑ 1 —á–∞—Å
)
```

#### –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `.delay()`?

```python
task = send_tg_notification.delay(product_name="–ü–ª—é–º–±—É—Å", product_id=21)

print(task.id)        # UUID –∑–∞–¥–∞—á–∏: "20dc413f-756e-45bd-a874-165fbffc1089"
print(task.state)     # –°—Ç–∞—Ç—É—Å: PENDING / STARTED / SUCCESS / FAILURE
print(task.ready())   # False - –∑–∞–¥–∞—á–∞ –µ—â—ë –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
print(task.result)    # None (–ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)

# –î–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–±–ª–æ–∫–∏—Ä—É–µ—Ç –∫–æ–¥!)
result = task.get(timeout=60)  # –ñ–¥–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥
print(result)  # {"status": "success", "message": "..."}
```

---

## üîÑ –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã

### Mermaid –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞

```mermaid
sequenceDiagram
    participant Client as üë§ –ö–ª–∏–µ–Ω—Ç (–±—Ä–∞—É–∑–µ—Ä)
    participant FastAPI as üöÄ FastAPI Server
    participant Redis as üóÑÔ∏è Redis Broker
    participant Celery as ‚öôÔ∏è Celery Worker
    participant Telegram as üì± Telegram API

    Note over Client,Telegram: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)
    
    FastAPI->>FastAPI: –ó–∞–≥—Ä—É–∑–∫–∞ config.py
    FastAPI->>FastAPI: –°–æ–∑–¥–∞–Ω–∏–µ celery_app
    FastAPI->>FastAPI: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á (import notifications)
    
    Celery->>Celery: –ó–∞–ø—É—Å–∫ worker
    Celery->>Redis: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±—Ä–æ–∫–µ—Ä—É
    Note over Celery,Redis: worker_pool="solo" –¥–ª—è Windows
    Celery->>Redis: –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏...
    
    Note over Client,Telegram: === –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–≤–∞—Ä ===
    
    Client->>FastAPI: POST /products/<br/>{"name": "–ü–ª—é–º–±—É—Å", ...}
    activate FastAPI
    
    FastAPI->>FastAPI: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (Pydantic)
    FastAPI->>FastAPI: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID —Ç–æ–≤–∞—Ä–∞
    FastAPI->>FastAPI: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫ products[]
    
    Note over FastAPI: –í—ã–∑–æ–≤ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
    FastAPI->>FastAPI: send_tg_notification.delay()
    FastAPI->>Redis: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å
    Note over Redis: –ó–∞–¥–∞—á–∞ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ JSON<br/>–∏ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å "celery"
    
    FastAPI-->>Client: HTTP 201 Created<br/>{"id": 21, "name": "–ü–ª—é–º–±—É—Å", ...}
    deactivate FastAPI
    Note over Client: –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!<br/>(–Ω–µ –∂–¥–∞–ª 30 —Å–µ–∫—É–Ω–¥)
    
    Note over Celery,Redis: === Celery –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É ===
    
    Redis->>Celery: –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –≤ –æ—á–µ—Ä–µ–¥–∏!
    activate Celery
    Celery->>Celery: –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á–∏
    Celery->>Celery: –ü–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ –∏–º–µ–Ω–∏<br/>"tasks.notifications.send_tg_notification"
    
    Note over Celery: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (30 —Å–µ–∫—É–Ω–¥)
    Celery->>Celery: print("[Celery Task] –û—Ç–ø—Ä–∞–≤–∫–∞...")
    Celery->>Celery: time.sleep(30)
    
    Note over Celery,Telegram: –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram
    Celery->>Telegram: HTTP POST /sendMessage<br/>(–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏)
    Telegram-->>Celery: {"ok": true, "result": {...}}
    
    Celery->>Celery: print("[Celery Task] –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
    Celery->>Redis: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ backend
    Note over Redis: –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è<br/>–ø–æ–¥ –∫–ª—é—á–æ–º "celery-task-meta-{task_id}"
    Celery->>Redis: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (ACK)
    Note over Celery,Redis: task_acks_late=True:<br/>–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ü–û–°–õ–ï –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    deactivate Celery
    
    Celery->>Redis: –û–∂–∏–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏...
    
    Note over Client,Telegram: === –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ ===
    
    Client->>FastAPI: POST /products/ (–µ—â—ë –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä)
    FastAPI->>Redis: –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏
    Redis->>Celery: –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
    
    activate Celery
    Celery->>Celery: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏
    Celery->>Telegram: HTTP POST /sendMessage
    Telegram--xCelery: ‚ùå Network Error
    
    Note over Celery: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
    Celery->>Celery: except Exception as exc
    Celery->>Celery: self.retry(countdown=5)
    Celery->>Redis: –ó–∞–¥–∞—á–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
    Note over Celery,Redis: –ó–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥<br/>(max_retries=3)
    deactivate Celery
    
    Note over Celery: –ñ–¥—ë–º 5 —Å–µ–∫—É–Ω–¥...
    
    Redis->>Celery: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
    activate Celery
    Celery->>Telegram: HTTP POST /sendMessage
    Telegram-->>Celery: ‚úÖ {"ok": true}
    Celery->>Redis: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    deactivate Celery
```

### –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

#### –§–∞–∑–∞ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–æ–≤)

1. **FastAPI Server** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `.env`
   - –°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `celery_app`
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç

2. **Celery Worker** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
   - –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Redis –±—Ä–æ–∫–µ—Ä—É
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `worker_pool="solo"` –¥–ª—è Windows
   - –ñ–¥—ë—Ç –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏

3. **Redis** —Ä–∞–±–æ—Ç–∞–µ—Ç:
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç FastAPI –∏ Celery
   - –ì–æ—Ç–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–∞—á–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

#### –§–∞–∑–∞ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–±—ã—Å—Ç—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)

1. **–ö–ª–∏–µ–Ω—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å: `POST /products/`
2. **FastAPI** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:
   - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Pydantic
   - –°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
   - –í—ã–∑—ã–≤–∞–µ—Ç `send_tg_notification.delay()` ‚ö°
3. **FastAPI** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á—É –≤ **Redis**
4. **FastAPI** –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É (201 Created)
5. **–ö–ª–∏–µ–Ω—Ç** –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–Ω–µ –∂–¥—ë—Ç 30 —Å–µ–∫—É–Ω–¥!)

#### –§–∞–∑–∞ 3: –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏ (–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)

1. **Celery Worker** –∑–∞–º–µ—á–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ **Redis**
2. **Celery** –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–¥–∞—á—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
3. **Celery** –Ω–∞—Ö–æ–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é –ø–æ –∏–º–µ–Ω–∏ `tasks.notifications.send_tg_notification`
4. **Celery** –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é (30 —Å–µ–∫—É–Ω–¥)
5. **Celery** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ **Redis** backend
6. **Celery** –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (ACK) –±–ª–∞–≥–æ–¥–∞—Ä—è `task_acks_late=True`
7. **Celery** –∂–¥—ë—Ç —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É

#### –§–∞–∑–∞ 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

1. **Celery** –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á—É
2. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
3. `except Exception` –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
4. `self.retry(countdown=5)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
5. **Celery** –∂–¥—ë—Ç 5 —Å–µ–∫—É–Ω–¥
6. **Celery** –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–¥–∞—á—É (–ø–æ–ø—ã—Ç–∫–∞ 2 –∏–∑ 3)
7. –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
8. –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ –æ—à–∏–±–∫–∞ - –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –¥–æ `max_retries=3`

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è Windows

### –ü—Ä–æ–±–ª–µ–º–∞ 1: OSError [WinError 6] "–ù–µ–≤–µ—Ä–Ω—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä"

**–ü—Ä–∏—á–∏–Ω–∞**:

```python
# Celery –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fork() (–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
# Windows –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢ fork()
```

**–†–µ—à–µ–Ω–∏–µ**:

```python
celery_app.conf.update(
    worker_pool="solo"  # ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –±–µ–∑ fork
)

# –ò–ª–∏ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ:
celery -A tasks.celery_app worker --pool=solo -l info
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:

- `solo` —Ä–µ–∂–∏–º –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multiprocessing
- –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å Windows API

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Received unregistered task"

**–ü—Ä–∏—á–∏–Ω–∞**:

```python
# Celery Worker –Ω–µ –∑–Ω–∞–µ—Ç –æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏
# –ó–∞–¥–∞—á–∞ –Ω–µ –±—ã–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ worker
```

**–†–µ—à–µ–Ω–∏–µ**:

```python
# –í tasks/celery_app.py:
from tasks import notifications  # ‚úÖ –Ø–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è —Å –∑–∞–¥–∞—á–∞–º–∏

# –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å autodiscover_tasks - –≤—ã–∑—ã–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã:
# celery_app.autodiscover_tasks(['tasks'])  # ‚ùå
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**:

```powershell
celery -A tasks.celery_app inspect registered
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: tasks.notifications.send_tg_notification
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** (–≤—ã–∑—ã–≤–∞–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å):

```python
# tasks/celery_app.py
celery_app = Celery(...)
celery_app.autodiscover_tasks(['tasks'])  # ‚ùå –ò—â–µ—Ç –∑–∞–¥–∞—á–∏ –≤ —Ç–æ–º –∂–µ –º–æ–¥—É–ª–µ
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ**:

```python
# tasks/celery_app.py
celery_app = Celery(...)
# ... –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ...
from tasks import notifications  # ‚úÖ –ò–º–ø–æ—Ä—Ç –≤ –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã**:

```
[ERROR] Consumer: Cannot connect to redis://localhost:6379/0
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞**:

```powershell
redis-cli ping
# –î–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å: PONG
```

**–†–µ—à–µ–Ω–∏–µ**:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Redis: `redis-server`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç –≤ `.env`: `REDIS_PORT=6379`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω firewall

---

## ‚úÖ –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–ù–ï —Ä–∞–±–æ—Ç–∞–ª–æ)

```python
# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è prefork pool (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows)
celery_app = Celery(...)  # worker_pool –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = "prefork"

# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 2: autodiscover –≤—ã–∑—ã–≤–∞–ª —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∏–º–ø–æ—Ä—Ç—ã
celery_app.autodiscover_tasks(['tasks'])

# ‚ùå –ü–†–û–ë–õ–ï–ú–ê 3: –ó–∞–¥–∞—á–∞ –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞—Å—å
# –†–µ–∑—É–ª—å—Ç–∞—Ç: "Received unregistered task"
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```python
# ‚úÖ –†–ï–®–ï–ù–ò–ï 1: –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º worker_pool="solo"
celery_app.conf.update(
    worker_pool="solo",  # –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å, –±–µ–∑ fork()
)

# ‚úÖ –†–ï–®–ï–ù–ò–ï 2: –£–±—Ä–∞–ª–∏ autodiscover_tasks
# celery_app.autodiscover_tasks(['tasks'])  # –£–î–ê–õ–ï–ù–û

# ‚úÖ –†–ï–®–ï–ù–ò–ï 3: –Ø–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–¥–∞—á
from tasks import notifications  # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É

# ‚úÖ –†–ï–®–ï–ù–ò–ï 4: –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
celery -A tasks.celery_app worker --pool=solo -l info
```

### –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|------|-------|-----------|
| **worker_pool** | `prefork` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | `"solo"` | ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ WinError |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** | `autodiscover_tasks()` | –Ø–≤–Ω—ã–π `import` | ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è |
| **–ò–º–ø–æ—Ä—Ç—ã** | –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –õ–∏–Ω–µ–π–Ω—ã–µ | ‚úÖ –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ |
| **–ó–∞–ø—É—Å–∫** | `celery worker` | `celery worker --pool=solo` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows |

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

1. **`worker_pool="solo"`** - –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Windows
2. **`task_acks_late=True`** - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –∑–∞–¥–∞—á
3. **`worker_concurrency=1`** - –û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ —Ä–∞–∑
4. **`broker_connection_retry_on_startup=True`** - –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
5. **–Ø–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞–¥–∞—á** - –ò–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

```powershell
# 1. Redis Server
redis-server

# 2. FastAPI (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
uvicorn main:app --reload

# 3. Celery Worker (–≤ —Ç—Ä–µ—Ç—å–µ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
celery -A tasks.celery_app worker --pool=solo -l info
```

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

1. **Redis**: `redis-cli ping` ‚Üí `PONG`
2. **FastAPI**: <http://localhost:8000/docs>
3. **Celery**: `celery -A tasks.celery_app inspect registered`
4. **–°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä**: POST <http://localhost:8000/products/>
5. **–°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏**: –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Celery Worker

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω**: 15 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–ü—Ä–æ–µ–∫—Ç**: Python419 - FastAPI + Celery + Redis

**–û–±—â–∏–π –æ–±—ä–µ–º**: 350+ —Å—Ç—Ä–æ–∫ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π
