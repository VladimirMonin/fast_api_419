# üìö –ó–∞–Ω—è—Ç–∏–µ ‚Ññ2: Cookie-Based Authentication (–ß–∞—Å—Ç—å 4)

## –ö–æ–º–º–∏—Ç: –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞–≤–±–∞—Ä–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üéØ –ß—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç—Ä–∞–∂–∞–ª —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –î–ª—è –Ω–µ–∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏". –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Äî –µ–≥–æ email –∏ –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–æ–π "–í—ã–π—Ç–∏". –î–ª—è –∞–¥–º–∏–Ω–∞ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤.

–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **—É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥** ‚Äî –∫–æ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø–µ—Ä–µ–¥–∞—ë–º –≤ —à–∞–±–ª–æ–Ω. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∫–ª—é—á–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ‚Äî `user`. –ï—Å–ª–∏ –æ–Ω–∞ —Ä–∞–≤–Ω–∞ `None` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–¥–Ω–æ. –ï—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ä–µ–∫—Ç User ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥—Ä—É–≥–æ–µ.

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å –¥–≤–µ –∑–∞–¥–∞—á–∏: –≤–æ-–ø–µ—Ä–≤—ã—Ö, –ø–æ–ª—É—á–∞—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–∞–∂–¥–æ–º —Ä–æ—É—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –í–æ-–≤—Ç–æ—Ä—ã—Ö, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Jinja2 —à–∞–±–ª–æ–Ω–µ —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏ `{% if %}`.

---

## üì° –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —à–∞–±–ª–æ–Ω—ã

–ù–∞—á–Ω—ë–º —Å —Ä–æ—É—Ç–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:

```python
@router.get("/", response_class=HTMLResponse)
async def index(
    request: Request,
    user: User | None = Depends(get_current_user_from_cookie),
    session: AsyncSession = Depends(get_session),
):
    products = await get_all_products(session)
    return templates.TemplateResponse("index.html", {
        "request": request,
        "products": products,
        "user": user  # ‚Üê –ü–µ—Ä–µ–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —à–∞–±–ª–æ–Ω
    })
```

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä `user: User | None = Depends(get_current_user_from_cookie)`. –≠—Ç–æ dependency injection ‚Äî FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ `auth/dependencies.py`, –∏–∑–≤–ª–µ—á—ë—Ç JWT –∏–∑ cookie, –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å, –Ω–∞–π–¥—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ.

–í–∞–∂–Ω–æ: —Ç–∏–ø `User | None` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å. –ï—Å–ª–∏ cookie –Ω–µ—Ç –∏–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω, —Ñ—É–Ω–∫—Ü–∏—è –≤–µ—Ä–Ω—ë—Ç `None`, –∏ —ç—Ç–æ **–Ω–µ –æ—à–∏–±–∫–∞**. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º ‚Äî –∏ –≥–æ—Å—Ç—è–º, –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ü—Ä–æ—Å—Ç–æ UI –±—É–¥–µ—Ç —Ä–∞–∑–Ω—ã–π.

–ú—ã –ø–µ—Ä–µ–¥–∞—ë–º `user` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞ –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏. Jinja2 –ø–æ–ª—É—á–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å `{"request": ..., "products": ..., "user": ...}` –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —Ä–∞–∑–º–µ—Ç–∫–µ.

–¢–∞–∫–æ–π –∂–µ –ø–∞—Ç—Ç–µ—Ä–Ω –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º —Ä–æ—É—Ç–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –∑–∞–±—ã–≤–∞–µ—Ç–µ –ø–µ—Ä–µ–¥–∞—Ç—å `user`, –≤ —à–∞–±–ª–æ–Ω–µ –æ–Ω –±—É–¥–µ—Ç `undefined`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—à–∏–±–∫–∞–º –ø—Ä–∏ —É—Å–ª–æ–≤–Ω–æ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ.

---

## üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ base.html

–¢–µ–ø–µ—Ä—å –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –Ω–∞–≤–±–∞—Ä –≤ `templates/base.html`. –ò—Å—Ö–æ–¥–Ω—ã–π –Ω–∞–≤–±–∞—Ä –±—ã–ª —Å—Ç–∞—Ç–∏—á–Ω—ã–º ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é. –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫ —Å–ø—Ä–∞–≤–∞: –¥–ª—è –≥–æ—Å—Ç–µ–π ‚Äî –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏", –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –∏—Ö email —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é.

Bootstrap –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–ª–∞—Å—Å `ms-auto` (margin-start: auto), –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–∂–∏–º–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é –Ω–∞–≤–±–∞—Ä–∞. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏:

```html
<div class="navbar-nav ms-auto">
    {% if user %}
        <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    {% else %}
        <!-- –î–ª—è –≥–æ—Å—Ç–µ–π -->
    {% endif %}
</div>
```

Jinja2 —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `{% if user %}` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ `user` "truthy" –∑–Ω–∞—á–µ–Ω–∏–µ–º? –í Python `None` —ç—Ç–æ "falsy", –∞ –ª—é–±–æ–π –æ–±—ä–µ–∫—Ç (–≤–∫–ª—é—á–∞—è –Ω–∞—à –æ–±—ä–µ–∫—Ç User) ‚Äî "truthy". –ü–æ—ç—Ç–æ–º—É —É—Å–ª–æ–≤–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –±–ª–æ–∫, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî else-–±–ª–æ–∫.

–î–ª—è –≥–æ—Å—Ç–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å—Å—ã–ª–∫—É:

```html
{% else %}
    <a class="nav-link" href="/auth/login-page">–í–æ–π—Ç–∏</a>
{% endif %}
```

–≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å –∫–ª–∞—Å—Å–æ–º `nav-link` –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ Bootstrap. –ü—Ä–∏ –∫–ª–∏–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ñ–æ—Ä–º–∞–º–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é –º—ã —Å–æ–∑–¥–∞–ª–∏ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —á–∞—Å—Ç—è—Ö.

---

## üîΩ –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ–∑–¥–∞—ë–º dropdown (–≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é):

```html
{% if user %}
    <div class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" role="button" 
           data-bs-toggle="dropdown">
            {{ user.email }}
        </a>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="/auth/logout">–í—ã–π—Ç–∏</a></li>
        </ul>
    </div>
{% else %}
```

–†–∞–∑–±–µ—Ä—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `<div class="nav-item dropdown">` –≥–æ–≤–æ—Ä–∏—Ç Bootstrap, —á—Ç–æ —ç—Ç–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–±–∞—Ä–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é. –í–Ω—É—Ç—Ä–∏ –¥–≤–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: —Ç—Ä–∏–≥–≥–µ—Ä (–∫–Ω–æ–ø–∫–∞) –∏ —Å–∞–º–æ –º–µ–Ω—é.

–¢—Ä–∏–≥–≥–µ—Ä ‚Äî —ç—Ç–æ —Å—Å—ã–ª–∫–∞ —Å –∫–ª–∞—Å—Å–æ–º `dropdown-toggle`. –≠—Ç–æ—Ç –∫–ª–∞—Å—Å –¥–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç—Ä–µ–ª–æ—á–∫—É –≤–Ω–∏–∑ –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–∞. –ê—Ç—Ä–∏–±—É—Ç `data-bs-toggle="dropdown"` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç JavaScript Bootstrap, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç/—Å–∫—Ä—ã–≤–∞–µ—Ç –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ.

–í–Ω—É—Ç—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞ –º—ã –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `{{ user.email }}`. –≠—Ç–æ Jinja2 —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –≤—ã–≤–æ–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö. –î–≤–æ–π–Ω—ã–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ –æ–∑–Ω–∞—á–∞—é—Ç: –≤–∑—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ HTML.

–ú–µ–Ω—é ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫ `<ul>` —Å –∫–ª–∞—Å—Å–æ–º `dropdown-menu`. –ö–ª–∞—Å—Å `dropdown-menu-end` –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –º–µ–Ω—é –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é. –ë–µ–∑ –Ω–µ–≥–æ –º–µ–Ω—é –ø–æ—è–≤–ª—è–ª–æ—Å—å –±—ã —Å–ª–µ–≤–∞ –æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä–∞, —á—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Å—Ç—Ä–∞–Ω–Ω–æ, –∫–æ–≥–¥–∞ —Ç—Ä–∏–≥–≥–µ—Ä —Å–∞–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–ø—Ä–∞–≤–∞ –≤ –Ω–∞–≤–±–∞—Ä–µ.

–í–Ω—É—Ç—Ä–∏ –º–µ–Ω—é –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞ ‚Äî "–í—ã–π—Ç–∏". –≠—Ç–æ –æ–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ `/auth/logout`, –∫–æ—Ç–æ—Ä–∞—è —É–¥–∞–ª—è–µ—Ç cookie –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é.

---

## üëë –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è superuser, –µ–º—É –Ω—É–∂–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã. –î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏–µ –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```html
{% if user %}
    {% if user.is_superuser %}
        <a class="nav-link" href="/admin/products/new">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    {% endif %}
    
    <div class="nav-item dropdown">
        ...
    </div>
{% else %}
```

–î–≤–æ–π–Ω–æ–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ: —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ `user` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º `user.is_superuser`. –ï—Å–ª–∏ –æ–±–∞ —É—Å–ª–æ–≤–∏—è –∏—Å—Ç–∏–Ω–Ω—ã, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤. –°–Ω–∞—á–∞–ª–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä", –ø–æ—Ç–æ–º dropdown —Å email. –≠—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –ª–æ–≥–∏—á–Ω–æ: –∞–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–ª–µ–≤–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ (–≤—ã—Ö–æ–¥) ‚Äî —Å–ø—Ä–∞–≤–∞.

–°—Å—ã–ª–∫–∞ –≤–µ–¥—ë—Ç –Ω–∞ `/admin/products/new` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —Ñ–æ—Ä–º–æ–π —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —á–∞—Å—Ç—è—Ö. –ü–æ–∫–∞ —Ä–æ—É—Ç–∞ –Ω–µ—Ç, –Ω–æ navbar —É–∂–µ –≥–æ—Ç–æ–≤ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ is_superuser

–ö–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º `{% if user.is_superuser %}`, Jinja2 –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –∞—Ç—Ä–∏–±—É—Ç—É –æ–±—ä–µ–∫—Ç–∞ User. –≠—Ç–æ SQLAlchemy –º–æ–¥–µ–ª—å, —É –∫–æ—Ç–æ—Ä–æ–π –µ—Å—Ç—å –∫–æ–ª–æ–Ω–∫–∞:

```python
class User(SQLAlchemyBaseUserTable[int], Base):
    is_superuser = Column(Boolean, default=False, nullable=False)
```

–ö–æ–≥–¥–∞ –º—ã –∏–∑–≤–ª–µ–∫–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î –≤ `get_current_user_from_cookie`, SQLAlchemy —Å–æ–∑–¥–∞–ª –æ–±—ä–µ–∫—Ç User —Å–æ –≤—Å–µ–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏. –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `user.email`, `user.is_superuser`, `user.id` –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

–≠—Ç–æ —É–¥–æ–±–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ª–æ–≥–∏–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Python. –ú—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π. Jinja2 –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã.

–ï—Å–ª–∏ –±—ã –º—ã —Ö–æ—Ç–µ–ª–∏ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID –º–µ–Ω—å—à–µ 10 –∏–ª–∏ –∏–∑ –¥–æ–º–µ–Ω–∞ @admin.com"), –º—ã –±—ã —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ –≤ Python:

```python
user_is_privileged = user.id < 10 or user.email.endswith("@admin.com")
return templates.TemplateResponse("index.html", {
    "user": user,
    "user_is_privileged": user_is_privileged
})
```

–ê –≤ —à–∞–±–ª–æ–Ω–µ –ø—Ä–æ—Å—Ç–æ `{% if user_is_privileged %}`. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

---

## üé≠ –ü–æ—á–µ–º—É dropdown-menu-end –≤–∞–∂–µ–Ω

–î–∞–≤–∞–π—Ç–µ –≥–ª—É–±–∂–µ —Ä–∞–∑–±–µ—Ä—ë–º—Å—è –≤ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–∏ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Bootstrap –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç dropdown —Ç–∞–∫, —á—Ç–æ–±—ã –ª–µ–≤—ã–π –∫—Ä–∞–π –º–µ–Ω—é —Å–æ–≤–ø–∞–¥–∞–ª —Å –ª–µ–≤—ã–º –∫—Ä–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä–∞. –≠—Ç–æ —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–ª–µ–≤–∞ –∏–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É:

```
[–ö–Ω–æ–ø–∫–∞ ‚ñº]
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—É–Ω–∫—Ç 1  ‚îÇ
‚îÇ –ü—É–Ω–∫—Ç 2  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ù–æ –µ—Å–ª–∏ —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–∏–∂–∞—Ç –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é —ç–∫—Ä–∞–Ω–∞ (–∫–∞–∫ –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Å `ms-auto`), –º–µ–Ω—é –º–æ–∂–µ—Ç –≤—ã–ª–µ–∑—Ç–∏ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã:

```
                          [–ö–Ω–æ–ø–∫–∞ ‚ñº]
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ –ü—É–Ω–∫—Ç 1  ‚îÇ ‚Üê –í—ã–ª–µ–∑–∞–µ—Ç –∑–∞ –∫—Ä–∞–π!
                          ‚îÇ –ü—É–Ω–∫—Ç 2  ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–ª–∞—Å—Å `dropdown-menu-end` –º–µ–Ω—è–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ: —Ç–µ–ø–µ—Ä—å **–ø—Ä–∞–≤—ã–π** –∫—Ä–∞–π –º–µ–Ω—é —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–∞–≤—ã–º –∫—Ä–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä–∞:

```
                          [–ö–Ω–æ–ø–∫–∞ ‚ñº]
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ –ü—É–Ω–∫—Ç 1  ‚îÇ
                   ‚îÇ –ü—É–Ω–∫—Ç 2  ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ú–µ–Ω—é –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞. –≠—Ç–æ –º–µ–ª–∫–∞—è –¥–µ—Ç–∞–ª—å, –Ω–æ –æ–Ω–∞ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ UX, –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö.

---

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–æ—É—Ç–æ–≤

–í–∞–∂–Ω–æ –Ω–µ –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å **–≤—Å–µ** —Ä–æ—É—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–∏—Ç–µ `user` —Ç–æ–ª—å–∫–æ –≤ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –Ω–æ –∑–∞–±—É–¥–µ—Ç–µ –ø—Ä–æ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç:

```
–ì–ª–∞–≤–Ω–∞—è ‚Üí –Ω–∞–≤–±–∞—Ä —Å email ‚úì
–¢–æ–≤–∞—Ä ‚Üí –Ω–∞–≤–±–∞—Ä –±–µ–∑ email ‚úó (–æ—à–∏–±–∫–∞!)
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–π UX, –≥–¥–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –Ω–∞–≤–±–∞—Ä "–º–∏–≥–∞–µ—Ç" ‚Äî —Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç user, —Ç–æ –Ω–µ—Ç.

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∂–¥—ã–π —Ä–æ—É—Ç –≤ `routes/pages.py` (–∏–ª–∏ –≥–¥–µ –≤—ã —Ö—Ä–∞–Ω–∏—Ç–µ —Ä–æ—É—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü) –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```python
user: User | None = Depends(get_current_user_from_cookie)
```

–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏, –∏:

```python
"user": user
```

–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞.

–≠—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥, –Ω–æ –ø–æ–∫–∞ FastAPI –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ø–æ—Å–æ–±–∞ "–≥–ª–æ–±–∞–ª—å–Ω–æ" –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤–æ –≤—Å–µ —Ä–æ—É—Ç—ã. –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –∏–ª–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, –Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞ —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –≤ –∫–∞–∂–¥–æ–º —Ä–æ—É—Ç–µ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: —Å–∫—Ä—ã–≤–∞—Ç—å –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å?

–ú—ã **—Å–∫—Ä—ã–≤–∞–µ–º** —Å—Å—ã–ª–∫—É "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä" –¥–ª—è –Ω–µ-–∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ `{% if user.is_superuser %}`. –ù–æ —ç—Ç–æ –Ω–µ –∑–∞—â–∏—Ç–∞! –≠—Ç–æ —Ç–æ–ª—å–∫–æ UI-—É–¥–æ–±—Å—Ç–≤–æ.

–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–∫—Ä—ã—Ç—å DevTools, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å HTML –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—É—é —Å—Å—ã–ª–∫—É. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±—Ä–∞—Ç—å –≤ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ `/admin/products/new`.

–†–µ–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–Ω–∞ –±—ç–∫–µ–Ω–¥–µ**. –í —Ä–æ—É—Ç–µ `/admin/products/new` –º—ã –æ–±—è–∑–∞–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```python
@router.get("/admin/products/new")
async def create_product_page(
    user: User = Depends(get_current_user_from_cookie)
):
    if not user:
        return RedirectResponse("/auth/login-page")
    if not user.is_superuser:
        raise HTTPException(403, "Forbidden: Admin only")
    ...
```

–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥–∏–Ω. –ó–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–Ω superuser. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî 403 Forbidden.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, UI-—Å–∫—Ä—ã—Ç–∏–µ —É–ª—É—á—à–∞–µ—Ç UX (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç –ª–∏—à–Ω–∏—Ö –∫–Ω–æ–ø–æ–∫), –∞ –±—ç–∫–µ–Ω–¥-–ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–¥–∞–∂–µ –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–æ–π—Ç–∏ UI, –±—ç–∫–µ–Ω–¥ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç).

---

## üí° –†–µ–∑—é–º–µ

–ú—ã –æ–±–Ω–æ–≤–∏–ª–∏ –Ω–∞–≤–±–∞—Ä –≤ `base.html`, –¥–æ–±–∞–≤–∏–≤ —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `user`. –î–ª—è –≥–æ—Å—Ç–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–í–æ–π—Ç–∏", –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî –∏—Ö email —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é, –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä".

–ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ `user` –≤ –∫–∞–∂–¥—ã–π —Ä–æ—É—Ç —á–µ—Ä–µ–∑ dependency injection –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω–µ —á–µ—Ä–µ–∑ Jinja2 —É—Å–ª–æ–≤–∏—è `{% if user %}`. Bootstrap –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (dropdown, navbar) —Å –∫–ª–∞—Å—Å–∞–º–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.

–í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ —Å–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ UI ‚Äî —ç—Ç–æ –Ω–µ –∑–∞–º–µ–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ù–∞—Å—Ç–æ—è—â–∞—è –∑–∞—â–∏—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –±—ç–∫–µ–Ω–¥–µ, –≥–¥–µ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏–π.

–í —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏ –º—ã —Å–æ–∑–¥–∞–¥–∏–º —Ñ–æ—Ä–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—É—é —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.
