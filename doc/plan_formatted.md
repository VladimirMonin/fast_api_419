# –ü–ª–∞–Ω –∫—É—Ä—Å–∞ FastAPI - –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

> [!info]
>
> #### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∞–≥–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ üìã
>
> –≠—Ç–æ—Ç –ø–ª–∞–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ—Ç–∫–∏–µ —É–∫–∞–∑–∞–Ω–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—á–µ–±–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
>
> - **[–¢–ï–ö–°–¢]** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏
> - **[–ö–û–î]** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏ –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
> - **[–î–ò–ê–ì–†–ê–ú–ú–ê]** ‚Äî —Å–æ–∑–¥–∞—Ç—å Mermaid –¥–∏–∞–≥—Ä–∞–º–º—É
> - **[–î–ï–ú–û]** ‚Äî –æ–ø–∏—Å–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é

******

## –£—Ä–æ–∫ 1: –û—Å–Ω–æ–≤—ã FastAPI –∏ —Å–∏–ª–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ üöÄ

### 1. –í–≤–µ–¥–µ–Ω–∏–µ: –ü–æ—á–µ–º—É FastAPI? ü§î

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å —è—Ä–∫–æ–π –∞–Ω–∞–ª–æ–≥–∏–∏ –ø—Ä–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –Ω–µ–±–æ—Å–∫—Ä–µ–±–∞. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã —Å—Ç—Ä–æ–∏—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –Ω–µ–±–æ—Å–∫—Ä–µ–±, –Ω–æ —É –≤–∞—Å –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–∞—è –¥—Ä–µ–ª—å –∏ –º–æ–ª–æ—Ç–æ–∫. –ú–æ–∂–Ω–æ –ª–∏ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å? –î–∞. –ë—É–¥–µ—Ç –ª–∏ —ç—Ç–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ? –ù–µ—Ç. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ (–∫–∞–∫ Flask/Django –≤ –∏—Ö –±–∞–∑–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏) ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å —Ç–æ—Ç —Å–∞–º—ã–π –º–æ–ª–æ—Ç–æ–∫. –û–Ω–∏ –Ω–∞–¥–µ–∂–Ω—ã, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á —Å —Ç—ã—Å—è—á–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º –∫–æ–Ω—Ü–µ–ø—Ü–∏—é I/O-bound –∑–∞–¥–∞—á. –ß—Ç–æ —Ç–∞–∫–æ–µ I/O-bound –∑–∞–¥–∞—á–∞? –≠—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—Ä–æ–¥–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –¥—Ä—É–≥–æ–º—É API –∏–ª–∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞. –í —ç—Ç–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä "–ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç" ‚Äî –æ–Ω –≥–æ—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º—ã. –í —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –º–∏—Ä–µ –æ–¥–∏–Ω —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞, –±–ª–æ–∫–∏—Ä—É—è –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –°–æ–∑–¥–∞–π—Ç–µ –¥–∏–∞–≥—Ä–∞–º–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ–∫–∞–∑—ã–≤–∞—é—â—É—é —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–æ–≤:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç1 üë®‚Äçüíª
    participant –ö–ª–∏–µ–Ω—Ç2 üë©‚Äçüíª
    participant –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä üêå
    participant –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö üíæ
    
    Note over –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    –ö–ª–∏–µ–Ω—Ç1->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –ó–∞–ø—Ä–æ—Å 1
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT *
    Note over –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä,–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: –û–∂–∏–¥–∞–Ω–∏–µ... —Å–µ—Ä–≤–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –î–∞–Ω–Ω—ã–µ
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä-->>–ö–ª–∏–µ–Ω—Ç1: –û—Ç–≤–µ—Ç
    
    Note over –ö–ª–∏–µ–Ω—Ç2: –ö–ª–∏–µ–Ω—Ç2 –∂–¥–∞–ª –≤—Å–µ —ç—Ç–æ –≤—Ä–µ–º—è!
    –ö–ª–∏–µ–Ω—Ç2->>–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä: –ó–∞–ø—Ä–æ—Å 2
    –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –°–µ—Ä–≤–µ—Ä-->>–ö–ª–∏–µ–Ω—Ç2: –û—Ç–≤–µ—Ç
```

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç1 üë®‚Äçüíª
    participant –ö–ª–∏–µ–Ω—Ç2 üë©‚Äçüíª
    participant FastAPI ‚ö°
    participant –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö üíæ
    
    Note over FastAPI: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    –ö–ª–∏–µ–Ω—Ç1->>FastAPI: –ó–∞–ø—Ä–æ—Å 1
    FastAPI->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT * (async)
    Note over FastAPI: –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è! –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–∏–µ –∑–∞–¥–∞—á–∏
    
    –ö–ª–∏–µ–Ω—Ç2->>FastAPI: –ó–∞–ø—Ä–æ—Å 2
    FastAPI->>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö: SELECT * (async)
    
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>FastAPI: –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ 1
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç1: –û—Ç–≤–µ—Ç
    
    –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö-->>FastAPI: –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ 2
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç2: –û—Ç–≤–µ—Ç
```

**[–¢–ï–ö–°–¢]** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ FastAPI –∫–∞–∫ "—ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç" –≤ –Ω–∞—à–µ–π –∞–Ω–∞–ª–æ–≥–∏–∏. –û–Ω –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–∏** (–±–ª–∞–≥–æ–¥–∞—Ä—è ASGI-—Å–µ—Ä–≤–µ—Ä–∞–º –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ Starlette). –ü–æ–∫–∞ FastAPI –∂–¥–µ—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ–¥–Ω–æ–º—É –∑–∞–ø—Ä–æ—Å—É, –æ–Ω –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –∞ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ –¥—Ä—É–≥–∏—Ö. –≠—Ç–æ –¥–∞–µ—Ç –∫–æ–ª–æ—Å—Å–∞–ª—å–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–Ω–æ –≤ I/O-bound –∑–∞–¥–∞—á–∞—Ö.

******

### 2. –ü–µ—Ä–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ "Hello, World" üëã

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å –±–ª–æ–∫–∞: –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞–±–æ—á–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –û—Ç –∏–¥–µ–∏ –¥–æ —Ä–∞–±–æ—Ç–∞—é—â–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –∑–∞ 2 –º–∏–Ω—É—Ç—ã.

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å FastAPI –∏ ASGI-—Å–µ—Ä–≤–µ—Ä uvicorn. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
>
>```
>pip install fastapi "uvicorn[standard]"
>```

******

**[–ö–û–î: main.py]** –°–æ–∑–¥–∞–π—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/")
async def read_root():
    return {"Hello": "World"}
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É –∫–æ–¥–∞:

- `app = FastAPI()` ‚Äî —ç—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ "–º–æ–∑–≥–∞" –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ FastAPI
- `@app.get("/")` ‚Äî —ç—Ç–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–∏. –ú—ã –≥–æ–≤–æ—Ä–∏–º FastAPI: "–ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –¥–µ–ª–∞–µ—Ç `GET`-–∑–∞–ø—Ä–æ—Å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π URL (`/`), –≤—ã–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é –Ω–∏–∂–µ"
- `async def` ‚Äî –ø–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ FastAPI "–¥—É–º–∞–µ—Ç" –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ. –î–∞–∂–µ –µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `async` ‚Äî —Ö–æ—Ä–æ—à–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞

>[!info]
>
>#### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ üöÄ
>
>–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É:
>
>```
>uvicorn main:app --reload
>```
>
>–ì–¥–µ:
>
>- `main` ‚Äî –∏–º—è —Ñ–∞–π–ª–∞ `main.py`
>- `app` ‚Äî –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–∞
>- `--reload` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)

**[–î–ï–ú–û]** –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://127.0.0.1:8000`. –í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å JSON-–æ—Ç–≤–µ—Ç: `{"Hello": "World"}`. –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç!

******

### 3. –°–∏–ª–∞ Pydantic: —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ üí™

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é –∏–¥–µ—é: –Ω–∞ –±—ç–∫–µ–Ω–¥, –∫–∞–∫ –∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ. –ò –º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω—ã –≤ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Ç–∏–ø–∞—Ö. Pydantic ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–∫–æ–Ω—Ç—Ä–∞–∫—Ç" –∏–ª–∏ "—Ñ–æ—Ä–º—É" –¥–ª—è –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

**[–ö–û–î: main.py]** –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é Pydantic-–º–æ–¥–µ–ª—å –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–∏ "–¢–æ–≤–∞—Ä":

```python
from pydantic import BaseModel
from typing import Optional

class Product(BaseModel):
    id: int
    name: str
    description: Optional[str] = None  # –ü–æ–ª–µ –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
    price: float
```

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É Pydantic-–º–æ–¥–µ–ª–∏:

```mermaid
classDiagram
    class Product {
        +int id
        +str name
        +str description
        +float price
        +model_dump() dict
        +model_validate() Product
    }
    
    class BaseModel {
        <<abstract>>
        +model_dump()
        +model_validate()
        +model_json()
    }
    
    BaseModel <|-- Product : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
```

**[–¢–ï–ö–°–¢]** –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Pydantic:

**–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º. –ú—ã –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ–º, –∫–∞–∫–∏–µ –ø–æ–ª—è –µ—Å—Ç—å —É —Ç–æ–≤–∞—Ä–∞ –∏ –∫–∞–∫–æ–≥–æ –æ–Ω–∏ —Ç–∏–ø–∞. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Ü–µ–ª—ã–π –∫–ª–∞—Å—Å –æ—à–∏–±–æ–∫ –µ—â–µ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–æ–π –º–æ–¥–µ–ª–∏. –ï—Å–ª–∏ –ø—Ä–∏–¥–µ—Ç –∑–∞–ø—Ä–æ—Å —Å `price: "–¥–µ—à–µ–≤–æ"`, FastAPI —Å–∞–º –æ—Ç–∫–ª–æ–Ω–∏—Ç –µ–≥–æ —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π.

**–ê–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ì–ª–∞–≤–Ω–∞—è "–º–∞–≥–∏—è" FastAPI. –§—Ä–µ–π–º–≤–æ—Ä–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –º–æ–¥–µ–ª–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI.

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö "–Ω–∞ –ª–µ—Ç—É" ‚úÖ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å –±–ª–æ–∫–∞: –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ç–µ–æ—Ä–∏—é, –∞ –Ω–∞–≥–ª—è–¥–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å "–º–∞–≥–∏—é" FastAPI –∏ Pydantic –≤ –¥–µ–π—Å—Ç–≤–∏–∏.

**[–ö–û–î: main.py]** –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π `POST`-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞:

```python
@app.post("/products/")
async def create_product(product: Product):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    # 1. –ü—Ä–æ—á–∏—Ç–∞–µ—Ç —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
    # 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç –µ–≥–æ –ø–æ –º–æ–¥–µ–ª–∏ Product
    # 3. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ –æ–±—ä–µ–∫—Ç Python
    # 4. –ü–µ—Ä–µ–¥–∞—Å—Ç –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é
    return product
```

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã –ø—Ä–æ—Å—Ç–æ —É–∫–∞–∑–∞–ª–∏ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–∞ `product: Product`, –∏ FastAPI —Å–∞–º –ø–æ–Ω—è–ª, —á—Ç–æ –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å —Ç–µ–ª–æ `POST`-–∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ –ø–æ –º–æ–¥–µ–ª–∏ `Product` –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é.

******

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant Pydantic üîç
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç üìç
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /products/ + JSON
    FastAPI->>Pydantic: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –º–æ–¥–µ–ª–∏ Product
    
    alt –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã ‚úÖ
        Pydantic->>FastAPI: –û–±—ä–µ–∫—Ç Product —Å–æ–∑–¥–∞–Ω
        FastAPI->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–±—ä–µ–∫—Ç–æ–º
        –≠–Ω–¥–ø–æ–∏–Ω—Ç-->>FastAPI: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + JSON
    else –î–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã ‚ùå
        Pydantic->>FastAPI: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 422 Unprocessable Entity + –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
    end
```

**[–î–ï–ú–û]** –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs` ‚Äî —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /products/` –∏ —Ä–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –µ–≥–æ
3. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Å—Ö–µ–º–µ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `Product` —Å —Ç–∏–ø–∞–º–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π
4. –ù–∞–∂–º–∏—Ç–µ "Try it out" –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON:

   ```json
   {
     "id": 1,
     "name": "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä",
     "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
     "price": 99.99
   }
   ```

5. –ü–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç `200 OK`
6. –¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ **–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π** JSON —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ç–∏–ø–æ–º:

   ```json
   {
     "id": 1,
     "name": "–¢–æ–≤–∞—Ä",
     "price": "–¥–µ—à–µ–≤–æ"
   }
   ```

7. –ü–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É `422 Unprocessable Entity` —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ç–∞–∫

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–°–æ–∑–¥–∞–π—Ç–µ Pydantic-–º–æ–¥–µ–ª–∏ –¥–ª—è "–¢–æ–≤–∞—Ä–∞" –∏ "–ö–∞—Ç–µ–≥–æ—Ä–∏–∏". –†–µ–∞–ª–∏–∑—É–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –≤—ã —Å–∞–º–∏ –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é FastAPI.

******

## –£—Ä–æ–∫ 2: –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ API –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å APIRouter üó∫Ô∏è

### 1. –ü—Ä–æ–±–ª–µ–º–∞ —Ä–æ—Å—Ç–∞: –û–¥–∏–Ω —Ñ–∞–π–ª ‚Äî —ç—Ç–æ —Ö–∞–æ—Å üòµ

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞. –ù–∞—à `main.py` –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–≤–∞–ª–∏–ª–∏ –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –ü–æ–∫–∞ –∏—Ö –¥–≤–∞-—Ç—Ä–∏ ‚Äî –≤—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ. –ù–æ —á—Ç–æ –±—É–¥–µ—Ç, –∫–æ–≥–¥–∞ –∏—Ö —Å—Ç–∞–Ω–µ—Ç 50? –ù–∞–º –Ω—É–∂–Ω—ã –ø–∞–ø–∫–∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å, —á—Ç–æ –∫—Ä–æ–º–µ —Ç–æ–≤–∞—Ä–æ–≤, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `main.py` CRUD –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∑–∞–∫–∞–∑–æ–≤, –∫–æ—Ä–∑–∏–Ω... –§–∞–π–ª —Ä–∞–∑—Ä–∞—Å—Ç–µ—Ç—Å—è –¥–æ —Å–æ—Ç–µ–Ω, –∞ —Ç–æ –∏ —Ç—ã—Å—è—á —Å—Ç—Ä–æ–∫, –∏ –Ω–∞–π—Ç–∏ —á—Ç–æ-—Ç–æ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥", –∏ –º—ã –¥–æ–ª–∂–Ω—ã –∏–∑–±–µ–≥–∞—Ç—å –µ–≥–æ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.

******

### 2. –†–µ—à–µ–Ω–∏–µ: `APIRouter` –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ üóÇÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—É—é –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: `APIRouter` ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –Ω–∞—à–∏ "–ø–∞–ø–∫–∏" –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ú—ã —Å–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π Python-—Ñ–∞–π–ª –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `products.py`), –æ–±—ä—è–≤–ª—è–µ–º –≤ –Ω–µ–º —Ä–æ—É—Ç–µ—Ä –∏ —Å–∫–ª–∞–¥—ã–≤–∞–µ–º —Ç—É–¥–∞ –≤—Å–µ –ø—É—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —Å —Ç–æ–≤–∞—Ä–∞–º–∏. –ó–∞—Ç–µ–º –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (`main.py`) –ø—Ä–æ—Å—Ç–æ "–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç" —ç—Ç—É –ø–∞–ø–∫—É.

**[–¢–ï–ö–°–¢]** –û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

```
/my_project
‚îú‚îÄ‚îÄ /app
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îî‚îÄ‚îÄ /routers
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ products.py
‚îî‚îÄ‚îÄ ...
```

******

**[–ö–û–î: app/routers/products.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤:

```python
from fastapi import APIRouter

router = APIRouter()

# –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ç–æ–≤–∞—Ä–∞–º–∏, –±—É–¥—É—Ç –∑–¥–µ—Å—å
# –ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ—Ç, —á—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–∞ –ø—Ä–æ—à–ª–æ–º —É—Ä–æ–∫–µ
@router.post("/")
async def create_product(product: Product):  # Product - –º–æ–¥–µ–ª—å Pydantic –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞
    return product
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ –≥–ª–∞–≤–Ω–æ–º —Ñ–∞–π–ª–µ:

```python
from fastapi import FastAPI
from .routers import products

app = FastAPI()

# "–ü–æ–¥–∫–ª—é—á–∞–µ–º" —Ä–æ—É—Ç–µ—Ä —Å —Ç–æ–≤–∞—Ä–∞–º–∏
app.include_router(
    products.router,
    prefix="/products",  # –í—Å–µ URL –≤ —ç—Ç–æ–º —Ä–æ—É—Ç–µ—Ä–µ –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å /products
    tags=["Products"]     # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ /docs
)
```

**[–¢–ï–ö–°–¢]** –°–¥–µ–ª–∞–π—Ç–µ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö `prefix` –∏ `tags`:

- `prefix="/products"` –∏–∑–±–∞–≤–ª—è–µ—Ç –Ω–∞—Å –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∏—Å–∞—Ç—å `/products` –≤ –∫–∞–∂–¥–æ–º URL –≤–Ω—É—Ç—Ä–∏ `products.py`
- `tags=["Products"]` —Å–æ–∑–¥–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –≤ –∞–≤—Ç–æ-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Swagger UI

******

### 3. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ üìä

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø–æ–∫–∞ –º—ã –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ –Ω–∞—Å—Ç–æ—è—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–¥–∏–º –≤—Ä–µ–º–µ–Ω–Ω—É—é "in-memory" –±–∞–∑—É –ø—Ä—è–º–æ –≤ —Ñ–∞–π–ª–µ —Ä–æ—É—Ç–µ—Ä–∞.

******

**[–ö–û–î: app/routers/products.py]** –°–æ–∑–¥–∞–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```python
from typing import List
from pydantic import BaseModel

# –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–∏ Product

# –ù–∞—à–∞ –≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –≤ –ø–∞–º—è—Ç–∏
db_products: List[Product] = [
    Product(id=1, name="–ü–ª—é–º–±—É—Å", description="–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", price=10.5),
    Product(id=2, name="–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏", description="–ó–∞–≥–∞–¥–æ—á–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ", price=25.0)
]
```

**[–ö–û–î: app/routers/products.py]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ CRUD:

**Read All (GET /)** ‚Äî –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã:

```python
@router.get("/", response_model=List[Product])
async def get_all_products():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤"""
    return db_products
```

**Read One (GET /{product_id})** ‚Äî –ø–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø–æ ID:

```python
@router.get("/{product_id}", response_model=Product)
async def get_product(product_id: int):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID.
    Path-–ø–∞—Ä–∞–º–µ—Ç—Ä product_id –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ URL.
    """
    for product in db_products:
        if product.id == product_id:
            return product
    # –ß—Ç–æ –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏? –†–∞–∑–±–µ—Ä–µ–º –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ —Å –∫–æ–Ω—Ü–µ–ø—Ü–∏–µ–π **Path-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** ‚Äî –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø—Ä—è–º–æ –∏–∑ URL. FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `{product_id}` –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤ `int`, –±–ª–∞–≥–æ–¥–∞—Ä—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–∞.

**Create (POST /)** ‚Äî —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä:

```python
@router.post("/", response_model=Product, status_code=201)
async def create_product(product: Product):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä (ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)"""
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID
    new_id = max([p.id for p in db_products]) + 1 if db_products else 1
    product.id = new_id
    
    db_products.append(product)
    return product
```

**Update (PUT /{product_id})** ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä:

```python
@router.put("/{product_id}", response_model=Product)
async def update_product(product_id: int, updated_product: Product):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä"""
    for index, product in enumerate(db_products):
        if product.id == product_id:
            updated_product.id = product_id  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID
            db_products[index] = updated_product
            return updated_product
    # –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –æ—à–∏–±–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

**Delete (DELETE /{product_id})** ‚Äî —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä:

```python
@router.delete("/{product_id}", status_code=204)
async def delete_product(product_id: int):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID"""
    for index, product in enumerate(db_products):
        if product.id == product_id:
            db_products.pop(index)
            return None  # 204 No Content - —É—Å–ø–µ—à–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –±–µ–∑ —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞
    # –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω - –æ–±—Ä–∞–±–æ—Ç–∞–µ–º –æ—à–∏–±–∫—É –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ
```

******

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: `HTTPException` ‚ö†Ô∏è

**[–î–ï–ú–û]** –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–¥ –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä `/products/999`. –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É `500 Internal Server Error`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∏—á–µ–≥–æ –Ω–µ –≤–µ—Ä–Ω—É–ª–∞ –∏–ª–∏ —É–ø–∞–ª–∞. –≠—Ç–æ –ø–ª–æ—Ö–æ ‚Äî –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—É—é –æ—à–∏–±–∫—É `404 Not Found`.

**[–¢–ï–ö–°–¢]** –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ —Å `HTTPException` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º FastAPI "–≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å" –æ—à–∏–±–∫–∏ —Å –Ω—É–∂–Ω—ã–º HTTP-—Å—Ç–∞—Ç—É—Å–æ–º –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
******
**[–ö–û–î: app/routers/products.py]** –î–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `get_product`:

```python
from fastapi import HTTPException

@router.get("/{product_id}", response_model=Product)
async def get_product(product_id: int):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–∫–∏"""
    for product in db_products:
        if product.id == product_id:
            return product
    
    # –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    raise HTTPException(
        status_code=404,
        detail=f"–¢–æ–≤–∞—Ä —Å ID {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
    )
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ flow –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product üìç
    participant –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory) üíæ
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: GET /products/999
    FastAPI->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: –í—ã–∑–æ–≤ —Å product_id=999
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product->>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory): –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞ —Å ID=999
    –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (in-memory)-->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product->>–≠–Ω–¥–ø–æ–∏–Ω—Ç get_product: raise HTTPException(404)
    –≠–Ω–¥–ø–æ–∏–Ω—Ç get_product-->>FastAPI: HTTPException
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 404 Not Found + {"detail": "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"}
```

**[–î–ï–ú–û]** –ü–æ–≤—Ç–æ—Ä–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç–µ `/products/999` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ —Ç–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç:

- –°—Ç–∞—Ç—É—Å: **404 Not Found**
- –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞: `{"detail": "–¢–æ–≤–∞—Ä —Å ID 999 –Ω–µ –Ω–∞–π–¥–µ–Ω"}`

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç –∂–¥–µ—Ç frontend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω".

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π (`app/routers/categories.py`) –∏ —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –¥–ª—è –Ω–∏—Ö –ø–æ–ª–Ω—ã–π CRUD —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫. –ü–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Å—Ç–æ–º —Å–ø–∏—Å–∫–µ, –∫–∞–∫ –º—ã –¥–µ–ª–∞–ª–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏.

******

## –£—Ä–æ–∫ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ ORM —Å SQLAlchemy üóÑÔ∏è

### 1. –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞—à–∏ –¥–∞–Ω–Ω—ã–µ ‚Äî –æ–¥–Ω–æ–¥–Ω–µ–≤–∫–∏ üí®

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏–∑ –£—Ä–æ–∫–∞ 2
2. –ß–µ—Ä–µ–∑ `/docs` –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å –ø–æ–º–æ—â—å—é `POST /products/`
3. –°–¥–µ–ª–∞–π—Ç–µ `GET /products/` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ —Å–ø–∏—Å–∫–µ
4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `uvicorn` –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (Ctrl+C) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –µ–≥–æ —Å–Ω–æ–≤–∞
5. –°–¥–µ–ª–∞–π—Ç–µ –µ—â–µ –æ–¥–∏–Ω `GET /products/` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä **–∏—Å—á–µ–∑**!

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ Python ‚Äî —ç—Ç–æ **–≤–æ–ª–∞—Ç–∏–ª—å–Ω–∞—è (–Ω–µ–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) –ø–∞–º—è—Ç—å**. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è. –ß—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–∂–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞, –∏—Ö –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Äî –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

******

### 2. –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å ORM –∏ SQLAlchemy üîÑ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é ORM —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫":

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ Python. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ SQL. –ù–∞–ø—Ä—è–º—É—é –æ–Ω–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç. **ORM (Object-Relational Mapping)**, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ **SQLAlchemy**, ‚Äî —ç—Ç–æ –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É –Ω–∏–º–∏.

–ú—ã –ø–∏—à–µ–º Python-–∫–æ–¥: `product.price = 99.9`, –∞ ORM –Ω–∞ –ª–µ—Ç—É –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–æ –≤ SQL-–∫–æ–º–∞–Ω–¥—É: `UPDATE products SET price = 99.9 WHERE id = 1`, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤ Python-–æ–±—ä–µ–∫—Ç—ã.
******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–æ–ª—å ORM:

```mermaid
sequenceDiagram
    participant Python –ö–æ–¥ üêç
    participant SQLAlchemy ORM üîÑ
    participant PostgreSQL üêò
    
    Python –ö–æ–¥->>SQLAlchemy ORM: product.price = 99.9
    SQLAlchemy ORM->>PostgreSQL: UPDATE products SET price = 99.9 WHERE id = 1
    PostgreSQL-->>SQLAlchemy ORM: OK (1 row affected)
    SQLAlchemy ORM-->>Python –ö–æ–¥: –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
    
    Python –ö–æ–¥->>SQLAlchemy ORM: db.query(Product).all()
    SQLAlchemy ORM->>PostgreSQL: SELECT * FROM products
    PostgreSQL-->>SQLAlchemy ORM: –°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
    SQLAlchemy ORM-->>Python –ö–æ–¥: [Product(id=1, ...), Product(id=2, ...)]
```

**[–¢–ï–ö–°–¢]** –ö—Ä–∞—Ç–∫–æ —É–ø–æ–º—è–Ω–∏—Ç–µ –¥–≤–µ —á–∞—Å—Ç–∏ SQLAlchemy, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

**SQLAlchemy Core** ‚Äî "–¥–≤–∏–∂–æ–∫" –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—â–∞—Ç—å—Å—è —Å —Ä–∞–∑–Ω—ã–º–∏ –¥–∏–∞–ª–µ–∫—Ç–∞–º–∏ SQL (PostgreSQL, MySQL, SQLite –∏ –¥—Ä.)

**SQLAlchemy ORM** ‚Äî "—Å–ª–æ–≤–∞—Ä—å" –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–≤—è–∑—ã–≤–∞–µ—Ç –Ω–∞—à–∏ Python-–∫–ª–∞—Å—Å—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é SQLAlchemy**, –∫–æ—Ç–æ—Ä–∞—è –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤—è–∑–∫–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –ø—Ä–∏—Ä–æ–¥–æ–π FastAPI. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

******

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î ‚öôÔ∏è

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SQLAlchemy –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL:
>
>```
>pip install sqlalchemy asyncpg
>```
>
>–ì–¥–µ `asyncpg` ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL.

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–∞—Ä–æ–ª–∏, –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤) **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—à–∏—Ç—ã –ø—Ä—è–º–æ –≤ –∫–æ–¥–µ. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
******
**[–ö–û–î: app/config.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```python
# app/config.py

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
# –§–æ—Ä–º–∞—Ç: postgresql+asyncpg://<user>:<password>@<host>:<port>/<dbname>
DATABASE_URL = "postgresql+asyncpg://postgres:mysecretpassword@localhost:5432/store_db"

# –í production —ç—Ç—É —Å—Ç—Ä–æ–∫—É –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:
# import os
# DATABASE_URL = os.getenv("DATABASE_URL")
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —á–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:

- `postgresql+asyncpg://` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º PostgreSQL —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä asyncpg
- `postgres:mysecretpassword` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å
- `localhost:5432` ‚Äî –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ë–î
- `store_db` ‚Äî –∏–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**[–ö–û–î: app/database.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è –≤—Å–µ–π –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ë–î:

```python
# app/database.py
from sqlalchemy.ext.asyncio import create_async_engine, async_sessionmaker
from .config import DATABASE_URL

# –°–æ–∑–¥–∞–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π "–¥–≤–∏–∂–æ–∫" –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
engine = create_async_engine(
    DATABASE_URL,
    echo=True  # –í—ã–≤–æ–¥–∏—Ç—å –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Å–æ–ª—å (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
)

# –°–æ–∑–¥–∞–µ–º "—Ñ–∞–±—Ä–∏–∫—É", –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å —Å–µ—Å—Å–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
async_session_factory = async_sessionmaker(
    engine,
    expire_on_commit=False  # –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –ø–æ—Å–ª–µ commit
)
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã:

**`engine`** ‚Äî –≥–ª–∞–≤–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–≤—è–∑–∏ —Å –ë–î. –ü–∞—Ä–∞–º–µ—Ç—Ä `echo=True` –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: –æ–Ω –≤—ã–≤–æ–¥–∏—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –≤—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQLAlchemy. –¢–∞–∫ –≤—ã –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º".

**`async_session_factory`** ‚Äî —ç—Ç–æ –Ω–µ —Å–∞–º–∞ —Å–µ—Å—Å–∏—è, –∞ "—Å—Ç–∞–Ω–æ–∫", –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ –Ω–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É. –ö–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–∏—Ç —Å–≤–æ—é –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.

******

### 4. –°–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π FastAPI (`Depends`) üîó

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ API –Ω–∞–º –Ω—É–∂–µ–Ω **–æ–¥–∏–Ω** —Å–µ–∞–Ω—Å —Ä–∞–±–æ—Ç—ã —Å –ë–î. –ï–≥–æ –Ω—É–∂–Ω–æ:

1. –û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

–ü–∏—Å–∞—Ç—å —ç—Ç—É –ª–æ–≥–∏–∫—É –≤ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ ‚Äî –¥–æ–ª–≥–æ, —Å–∫—É—á–Ω–æ –∏ –ª–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è (–∑–∞–±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é). –ù—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ—à–µ–Ω–∏–µ: –º—ã –Ω–∞–ø–∏—à–µ–º –æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —É–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏, –∞ FastAPI –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞—Ç—å –µ–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **Dependency Injection (–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)**.

**[–ö–û–î: app/database.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

```python
# app/database.py
# ... –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–¥ ...

async def get_db_session():
    """
    –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–π –ë–î.
    FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑–æ–≤–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.
    """
    # –°–æ–∑–¥–∞–µ–º —Å–µ—Å—Å–∏—é —Å –ø–æ–º–æ—â—å—é –Ω–∞—à–µ–π —Ñ–∞–±—Ä–∏–∫–∏
    async with async_session_factory() as session:
        try:
            yield session  # "–ü–µ—Ä–µ–¥–∞–µ–º" —Å–µ—Å—Å–∏—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç
        finally:
            # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            await session.close()
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç `yield`:

1. –ö–æ–¥ **–¥–æ** `yield` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–¥–æ** –≤—ã–∑–æ–≤–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
2. `yield session` "–ø–µ—Ä–µ–¥–∞–µ—Ç" —Å–µ—Å—Å–∏—é –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é
3. –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É —Å —Å–µ—Å—Å–∏–µ–π
4. –ö–æ–¥ –≤ –±–ª–æ–∫–µ `finally` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–µ—Å—Å–∏–∏

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏ –ë–î:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant get_db_session() üîó
    participant –≠–Ω–¥–ø–æ–∏–Ω—Ç üìç
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: HTTP –∑–∞–ø—Ä–æ—Å
    FastAPI->>get_db_session(): –í—ã–∑–æ–≤ (–∫–æ–¥ –¥–æ yield)
    get_db_session()->>get_db_session(): –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
    get_db_session()->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: yield session
    
    –≠–Ω–¥–ø–æ–∏–Ω—Ç->>PostgreSQL: SQL –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é
    PostgreSQL-->>–≠–Ω–¥–ø–æ–∏–Ω—Ç: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
    
    –≠–Ω–¥–ø–æ–∏–Ω—Ç-->>get_db_session(): –í–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    get_db_session()->>get_db_session(): finally: –∑–∞–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é
    get_db_session()-->>FastAPI: –ó–∞–≤–µ—Ä—à–µ–Ω–æ
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: HTTP –æ—Ç–≤–µ—Ç
```

**[–ö–û–î: app/routers/products.py]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```python
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession
from app.database import get_db_session  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å

router = APIRouter()

@router.get("/")
async def get_all_products(db: AsyncSession = Depends(get_db_session)):
    """
    –í–Ω—É—Ç—Ä–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `db` —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≥–æ—Ç–æ–≤–∞—è –∫ —Ä–∞–±–æ—Ç–µ —Å–µ—Å—Å–∏—è –ë–î!
    FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
    1. –í—ã–∑–≤–∞–ª get_db_session()
    2. –ü–æ–ª—É—á–∏–ª —Å–µ—Å—Å–∏—é
    3. –ü–µ—Ä–µ–¥–∞–ª –µ–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä db
    4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã–ª —Å–µ—Å—Å–∏—é
    """
    return {"message": "–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏ –ë–î!", "db": str(type(db))}
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –º–∞–≥–∏—é `Depends`: —ç—Ç–∞ –æ–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ `db: AsyncSession = Depends(get_db_session)` –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ç—è–∂–µ–ª—É—é —Ä–∞–±–æ—Ç—É –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Å—Å–∏–∏.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–°–æ–∑–¥–∞–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ). –ü—Ä–æ–ø–∏—à–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ `DATABASE_URL`. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `/products/` –≤—ã:
>
>1. –ù–µ –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
>2. –í–∏–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ SQL-–ª–æ–≥–∏ –æ—Ç `echo=True`
>
>–≠—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç –Ω–∞—Å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–∫—É, –≥–¥–µ –º—ã –±—É–¥–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –Ω–∏—Ö –¥–∞–Ω–Ω—ã–µ.

******

## –£—Ä–æ–∫ 4: –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–∞–∑–µ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ üîó

### 1. –û—Ç Pydantic-—Å—Ö–µ–º –∫ SQLAlchemy-–º–æ–¥–µ–ª—è–º üîÄ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é:

**Pydantic-—Å—Ö–µ–º–∞** ‚Äî —ç—Ç–æ **—Ç–∞–º–æ–∂–µ–Ω–Ω–∞—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è** –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –≤–∞—à–µ–≥–æ API. –û–Ω–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ "—Ç–æ–≤–∞—Ä—ã" (–¥–∞–Ω–Ω—ã–µ) –∏ –≤ –∫–∞–∫–æ–º –≤–∏–¥–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ—á—å –≥—Ä–∞–Ω–∏—Ü—É: –≤–æ–π—Ç–∏ –≤ –∑–∞–ø—Ä–æ—Å (request) –∏–ª–∏ –≤—ã–π—Ç–∏ –≤ –æ—Ç–≤–µ—Ç–µ (response).

**SQLAlchemy-–º–æ–¥–µ–ª—å** ‚Äî —ç—Ç–æ **—á–µ—Ä—Ç–µ–∂ —Å–∫–ª–∞–¥–∞** (—Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î), –≥–¥–µ —ç—Ç–∏ —Ç–æ–≤–∞—Ä—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è. –ß–µ—Ä—Ç–µ–∂ –æ–ø–∏—Å—ã–≤–∞–µ—Ç "—Å—Ç–µ–ª–ª–∞–∂–∏" (–∫–æ–ª–æ–Ω–∫–∏), –∏—Ö —Ç–∏–ø, —Ä–∞–∑–º–µ—Ä –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è.

–û–Ω–∏ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –Ω–æ —Å–ª—É–∂–∞—Ç —Ä–∞–∑–Ω—ã–º —Ü–µ–ª—è–º –∏ –∂–∏–≤—É—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö "—É—Ä–æ–≤–Ω—è—Ö" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –¥–∞–Ω–Ω—ã—Ö:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant Pydantic Schema üìã
    participant FastAPI Logic üíº
    participant SQLAlchemy Model üóÑÔ∏è
    participant PostgreSQL üêò
    
    Note over –ö–ª–∏–µ–Ω—Ç,Pydantic Schema: –ì—Ä–∞–Ω–∏—Ü–∞ API
    –ö–ª–∏–µ–Ω—Ç->>Pydantic Schema: JSON –¥–∞–Ω–Ω—ã–µ
    Pydantic Schema->>FastAPI Logic: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Python –æ–±—ä–µ–∫—Ç
    
    Note over FastAPI Logic,SQLAlchemy Model: –°–ª–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
    FastAPI Logic->>SQLAlchemy Model: –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –∏–∑ —Å—Ö–µ–º—ã
    
    Note over SQLAlchemy Model,PostgreSQL: –°–ª–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    SQLAlchemy Model->>PostgreSQL: INSERT INTO products ...
    PostgreSQL-->>SQLAlchemy Model: OK
    SQLAlchemy Model-->>Pydantic Schema: –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
    Pydantic Schema-->>–ö–ª–∏–µ–Ω—Ç: JSON –æ—Ç–≤–µ—Ç
```

******
**[–ö–û–î: app/models.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è "—á–µ—Ä—Ç–µ–∂–µ–π —Å–∫–ª–∞–¥–∞" (—Ç–∞–±–ª–∏—Ü –ë–î):

```python
# app/models.py
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column
from sqlalchemy import String, Text

# –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –±—É–¥—É—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è
class Base(DeclarativeBase):
    pass

# SQLAlchemy-–º–æ–¥–µ–ª—å –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "products"
class Product(Base):
    __tablename__ = "products"  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î
    
    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º Mapped
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)  # NULL —Ä–∞–∑—Ä–µ—à–µ–Ω
    price: Mapped[float]
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É SQLAlchemy-–º–æ–¥–µ–ª–∏:

```mermaid
classDiagram
    class Base {
        <<DeclarativeBase>>
        +metadata
    }
    
    class Product {
        +int id [PK]
        +str name [indexed]
        +str|None description
        +float price
    }
    
    Base <|-- Product : –Ω–∞—Å–ª–µ–¥—É–µ—Ç
    
    note for Product "–¢–∞–±–ª–∏—Ü–∞: products\n–ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á: id\n–ò–Ω–¥–µ–∫—Å: name"
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç:

- `Base` ‚Äî –æ–±—â–∏–π "—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç" –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π. –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
- `__tablename__ = "products"` ‚Äî –ø—Ä—è–º–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `Mapped[int]` ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQLAlchemy –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤. –£–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –≤ Python
- `mapped_column(primary_key=True)` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á)
- `mapped_column(String(100), index=True)` ‚Äî —Å—Ç—Ä–æ–∫–∞ –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤ —Å –∏–Ω–¥–µ–∫—Å–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- `mapped_column(Text)` ‚Äî –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- `Mapped[str | None]` ‚Äî –ø–æ–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å `NULL` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

******

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü üèóÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: –Ω–∞—à–∏ –º–æ–¥–µ–ª–∏ –≤ `models.py` ‚Äî —ç—Ç–æ –ø–æ–∫–∞ —á—Ç–æ –ø—Ä–æ—Å—Ç–æ Python-–∫–æ–¥. –ù–∞–º –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ —ç—Ç–∏–º "—á–µ—Ä—Ç–µ–∂–∞–º" –ø–æ—Å—Ç—Ä–æ–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ "—Å–∫–ª–∞–¥—ã" (—Ç–∞–±–ª–∏—Ü—ã) –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

**[–ö–û–î: create_tables.py]** –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

```python
# create_tables.py
import asyncio
from app.database import engine
from app.models import Base

async def create_db_and_tables():
    """
    –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π SQLAlchemy.
    –í–ù–ò–ú–ê–ù–ò–ï: –£–¥–∞–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã!
    """
    async with engine.begin() as conn:
        # –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —á–∏—Å—Ç–æ—Ç—ã —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞)
        await conn.run_sync(Base.metadata.drop_all)
        print("–°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã.")
        
        # –°–æ–∑–¥–∞–µ–º –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π, —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç Base
        await conn.run_sync(Base.metadata.create_all)
        print("–ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã.")

if __name__ == "__main__":
    asyncio.run(create_db_and_tables())
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É:

- `Base.metadata.drop_all` ‚Äî —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!)
- `Base.metadata.create_all` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –º–æ–¥–µ–ª—è–º
- `run_sync` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**[–î–ï–ú–û]** –ü–æ—à–∞–≥–æ–≤–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ pgAdmin:

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: `python create_tables.py`
2. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin (–∏–ª–∏ –¥—Ä—É–≥–æ–π GUI-–∫–ª–∏–µ–Ω—Ç –¥–ª—è PostgreSQL)
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö `store_db`
4. –í –¥–µ—Ä–µ–≤–µ –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞—Å–∫—Ä–æ–π—Ç–µ: Databases ‚Üí store_db ‚Üí Schemas ‚Üí public ‚Üí Tables
5. **–ü–æ–∫–∞–∂–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `products`** —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
   - `id` (integer, PRIMARY KEY)
   - `name` (character varying(100), —Å –∏–Ω–¥–µ–∫—Å–æ–º)
   - `description` (text, nullable)
   - `price` (double precision)

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –≤–∏–∑—É–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏: —Å—Ç—É–¥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã —Å–≤–æ–∏–º–∏ –≥–ª–∞–∑–∞–º–∏ —É–≤–∏–¥–µ—Ç—å, —á—Ç–æ Python-–∫–æ–¥ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª—Å—è –≤ —Ä–µ–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

******

### 3. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º CRUD —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SQLAlchemy üîÑ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ü–µ–ª—å: –≤—ã–±—Ä–æ—Å–∏—Ç—å "in-memory" —Å–ø–∏—Å–æ–∫ –∏–∑ `app/routers/products.py` –∏ –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ SQLAlchemy.

**[–ö–û–î: app/routers/products.py]** –û–±–Ω–æ–≤–∏—Ç–µ –∏–º–ø–æ—Ä—Ç—ã –∏ —É–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ë–î:

```python
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from typing import List

from app.database import get_db_session
from app.models import Product as ProductModel
from app.schemas import Product as ProductSchema, ProductCreate

router = APIRouter()

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ø–∏—Å–æ–∫ db_products - –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Create (POST /)**:

```python
@router.post("/", response_model=ProductSchema, status_code=201)
async def create_product(
    product_data: ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
    ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ PostgreSQL.
    """
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä SQLAlchemy-–º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ Pydantic-—Å—Ö–µ–º—ã
    new_product = ProductModel(**product_data.model_dump())
    
    db.add(new_product)        # –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Å—Å–∏—é (–ø–æ–º–µ—Ç–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
    await db.commit()          # –§–∏–∫—Å–∏—Ä—É–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (—Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î)
    await db.refresh(new_product)  # –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –ë–î (–ø–æ–ª—É—á–∞–µ–º ID)
    
    return new_product
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Å—Å–∏–∏:

1. `db.add()` ‚Äî –ø–æ–º–µ—á–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫–∞ –≤ –ø–∞–º—è—Ç–∏)
2. `await db.commit()` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
3. `await db.refresh()` ‚Äî –ø–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ë–î (–≤–∞–∂–Ω–æ –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π)

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Read All (GET /)**:

```python
@router.get("/", response_model=List[ProductSchema])
async def get_all_products(db: AsyncSession = Depends(get_db_session)):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
    # –°–æ–∑–¥–∞–µ–º SQL-–∑–∞–ø—Ä–æ—Å: SELECT * FROM products
    query = select(ProductModel)
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
    result = await db.execute(query)
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –º–æ–¥–µ–ª–∏ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    products = result.scalars().all()
    
    return products
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Read One (GET /{product_id})**:

```python
@router.get("/{product_id}", response_model=ProductSchema)
async def get_product(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –ø–æ ID —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–∫–∏."""
    # –£–¥–æ–±–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ primary key
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(
            status_code=404,
            detail=f"–¢–æ–≤–∞—Ä —Å ID {product_id} –Ω–µ –Ω–∞–π–¥–µ–Ω"
        )
    
    return product
```

**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Update (PUT /{product_id})**:

```python
@router.put("/{product_id}", response_model=ProductSchema)
async def update_product(
    product_id: int,
    updated_data: ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä."""
    # –ù–∞—Ö–æ–¥–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–æ–≤–∞—Ä
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –∏–∑ Pydantic-—Å—Ö–µ–º—ã
    for key, value in updated_data.model_dump().items():
        setattr(product, key, value)
    
    await db.commit()
    await db.refresh(product)
    
    return product
```

******
**[–ö–û–î]** –†–µ–∞–ª–∏–∑—É–π—Ç–µ **Delete (DELETE /{product_id})**:

```python
@router.delete("/{product_id}", status_code=204)
async def delete_product(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö."""
    product = await db.get(ProductModel, product_id)
    
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    await db.delete(product)
    await db.commit()
    
    return None  # 204 No Content
```

**[–î–ï–ú–û]** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ Swagger UI:

1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ `POST /products/`
2. –ü–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ `GET /products/` ‚Äî –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
4. –°–Ω–æ–≤–∞ –ø–æ–ª—É—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ ‚Äî **—Ç–æ–≤–∞—Ä –æ—Å—Ç–∞–ª—Å—è!** –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ –ë–î

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–ª–∏ CRUD —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π CRUD –¥–ª—è —Å–æ–∑–¥–∞–Ω–Ω–æ–π –Ω–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–∏ `Category`. –ê —Ç–∞–∫–∂–µ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã –æ–Ω –ø—Ä–∏–Ω–∏–º–∞–ª `category_id` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑—ã–≤–∞–ª –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π.

******

### 4. –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü: –û—Ç–Ω–æ—à–µ–Ω–∏—è (Relationships) üîó

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é: —Ç–æ–≤–∞—Ä—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ –≤–∞–∫—É—É–º–µ, –æ–Ω–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º. –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å "–º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É" (many-to-one).

**[–¢–ï–ö–°–¢]** –†–∞–∑–±–µ—Ä–∏—Ç–µ –¥–≤–∞ —É—Ä–æ–≤–Ω—è —Å–≤—è–∑–∏:

**ForeignKey (–≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á)** ‚Äî —ç—Ç–æ –∫–∞–∫ "–∑–∞–ø–∏—Å–∞—Ç—å ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–∞ —Ü–µ–Ω–Ω–∏–∫–µ —Ç–æ–≤–∞—Ä–∞". –≠—Ç–æ —Å–≤—è–∑—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î, –∫–æ—Ç–æ—Ä–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.

**relationship** ‚Äî —ç—Ç–æ "–º–∞–≥–∏—è" SQLAlchemy, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç, –∏–º–µ—è –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞, –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É –æ–±—ä–µ–∫—Ç—É —Å–≤—è–∑–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`my_product.category.name`), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫ –µ—ë ID.

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å Category –∏ —Å–≤—è–∑–∏:

```python
# app/models.py
from sqlalchemy import ForeignKey, String, Text
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column, relationship

class Base(DeclarativeBase):
    pass

class Category(Base):
    """–ú–æ–¥–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤."""
    __tablename__ = "categories"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(50), unique=True)
    description: Mapped[str | None] = mapped_column(Text)
    
    # –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å: –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã
    products: Mapped[list["Product"]] = relationship(
        back_populates="category",
        cascade="all, delete-orphan"  # –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
    )

class Product(Base):
    """–ú–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏."""
    __tablename__ = "products"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)
    price: Mapped[float]
    
    # –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á - —Å—Å—ã–ª–∫–∞ –Ω–∞ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    category_id: Mapped[int | None] = mapped_column(ForeignKey("categories.id"))
    
    # –°–≤—è–∑—å: –∏–∑ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    category: Mapped["Category"] = relationship(back_populates="products")
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤—è–∑—å –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏:

```mermaid
classDiagram
    class Category {
        +int id [PK]
        +str name [unique]
        +str|None description
        +List~Product~ products
    }
    
    class Product {
        +int id [PK]
        +str name [indexed]
        +str|None description
        +float price
        +int|None category_id [FK]
        +Category category
    }
    
    Category "1" --> "0..*" Product : –∏–º–µ–µ—Ç —Ç–æ–≤–∞—Ä—ã
    Product "0..*" --> "0..1" Category : –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    
    note for Product "ForeignKey: category_id ‚Üí categories.id"
    note for Category "Cascade: delete-orphan"
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `ForeignKey("categories.id")` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ë–î: —ç—Ç–æ –ø–æ–ª–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `id` –≤ —Ç–∞–±–ª–∏—Ü–µ `categories`
- `relationship(back_populates="...")` ‚Äî —Å–æ–∑–¥–∞–µ—Ç –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –Ω–∞–≤–∏–≥–∞—Ü–∏—é –≤ Python-–∫–æ–¥–µ
- `cascade="all, delete-orphan"` ‚Äî –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –µ—ë —Ç–æ–≤–∞—Ä—ã

**[–î–ï–ú–û]** –ü–æ–∫–∞–∂–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤—è–∑–µ–π –≤ –∫–æ–¥–µ:

```python
# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è relationship
async def demo_relationships(db: AsyncSession):
    # –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –µ—ë —Ç–æ–≤–∞—Ä–∞–º–∏
    category = await db.get(Category, 1)
    
    # –õ–µ–≥–∫–æ –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    for product in category.products:
        print(f"–¢–æ–≤–∞—Ä: {product.name}, –¶–µ–Ω–∞: {product.price}")
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä —Å –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π
    product = await db.get(Product, 1)
    
    # –õ–µ–≥–∫–æ –ø–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–∞
    if product.category:
        print(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞: {product.category.name}")
```

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –Ω–µ –∑–∞–±—É–¥—å—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–æ–± —ç—Ç–æ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ) –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ `create_tables.py`.

******

## –£—Ä–æ–∫ 5: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î —Å Alembic üì¶

### 1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ üèõÔ∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø **"–†–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏" (Separation of Concerns)**:

–†–æ—É—Ç–µ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, –∫–∞–∫ –ø–∏—Å–∞—Ç—å –≤ –ë–î ‚Äî –µ–≥–æ –∑–∞–¥–∞—á–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–¥–∞–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã. –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –¥–æ–ª–∂–Ω—ã –∂–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ, –ø—Ä–æ—â–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

**[–¢–ï–ö–°–¢]** –ü–æ–∫–∞–∂–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞:

```
/my_project
‚îú‚îÄ‚îÄ /app
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py          # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (DATABASE_URL –∏ —Ç.–¥.)
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models.py        # SQLAlchemy-–º–æ–¥–µ–ª–∏ (—Å–ª–æ–π –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py       # Pydantic-—Å—Ö–µ–º—ã (—Å–ª–æ–π API)
‚îÇ   ‚îú‚îÄ‚îÄ crud.py          # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (—Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º)
‚îÇ   ‚îî‚îÄ‚îÄ /routers
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ products.py  # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
‚îÇ       ‚îî‚îÄ‚îÄ categories.py # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îî‚îÄ‚îÄ create_tables.py
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:

- **models.py** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –ë–î (—á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è)
- **schemas.py** ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö API (—á—Ç–æ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è)
- **crud.py** ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (–∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏)
- **routers/** ‚Äî —Å–æ–¥–µ—Ä–∂–∞—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ HTTP)

******
**[–ö–û–î: app/schemas.py]** –°–æ–∑–¥–∞–π—Ç–µ Pydantic-—Å—Ö–µ–º—ã —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:

```python
# app/schemas.py
from pydantic import BaseModel
from typing import Optional

# –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ —Å –æ–±—â–∏–º–∏ –ø–æ–ª—è–º–∏
class ProductBase(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    category_id: Optional[int] = None

# –°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è (–±–µ–∑ ID)
class ProductCreate(ProductBase):
    pass

# –°—Ö–µ–º–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã)
class ProductUpdate(BaseModel):
    name: Optional[str] = None
    description: Optional[str] = None
    price: Optional[float] = None
    category_id: Optional[int] = None

# –°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î (—Å ID –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π ORM)
class Product(ProductBase):
    id: int
    
    class Config:
        from_attributes = True  # –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑ SQLAlchemy-–º–æ–¥–µ–ª–∏
```

**[–ö–û–î: app/crud.py]** –°–æ–∑–¥–∞–π—Ç–µ —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º:

```python
# app/crud.py
from sqlalchemy.ext.asyncio import AsyncSession
from sqlalchemy import select
from typing import List, Optional

from . import models, schemas

# ============= CRUD –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ =============

async def get_product(db: AsyncSession, product_id: int) -> Optional[models.Product]:
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID."""
    return await db.get(models.Product, product_id)

async def get_products(
    db: AsyncSession,
    skip: int = 0,
    limit: int = 100
) -> List[models.Product]:
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π."""
    query = select(models.Product).offset(skip).limit(limit)
    result = await db.execute(query)
    return result.scalars().all()

async def create_product(
    db: AsyncSession,
    product: schemas.ProductCreate
) -> models.Product:
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä."""
    db_product = models.Product(**product.model_dump())
    db.add(db_product)
    await db.commit()
    await db.refresh(db_product)
    return db_product

async def update_product(
    db: AsyncSession,
    product_id: int,
    product_update: schemas.ProductUpdate
) -> Optional[models.Product]:
    """–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    db_product = await db.get(models.Product, product_id)
    if not db_product:
        return None
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è
    update_data = product_update.model_dump(exclude_unset=True)
    for key, value in update_data.items():
        setattr(db_product, key, value)
    
    await db.commit()
    await db.refresh(db_product)
    return db_product

async def delete_product(db: AsyncSession, product_id: int) -> bool:
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω."""
    db_product = await db.get(models.Product, product_id)
    if not db_product:
        return False
    
    await db.delete(db_product)
    await db.commit()
    return True
```

**[–ö–û–î: app/routers/products.py]** –û—á–∏—Å—Ç–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä ‚Äî —Ç–µ–ø–µ—Ä—å –æ–Ω –æ—á–µ–Ω—å "—Ç–æ–Ω–∫–∏–π":

```python
# app/routers/products.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession
from typing import List

from .. import crud, schemas
from ..database import get_db_session

router = APIRouter()

@router.post("/", response_model=schemas.Product, status_code=status.HTTP_201_CREATED)
async def create_product_endpoint(
    product: schemas.ProductCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä."""
    return await crud.create_product(db=db, product=product)

@router.get("/", response_model=List[schemas.Product])
async def get_products_endpoint(
    skip: int = 0,
    limit: int = 100,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤."""
    return await crud.get_products(db=db, skip=skip, limit=limit)

@router.get("/{product_id}", response_model=schemas.Product)
async def get_product_endpoint(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä –ø–æ ID."""
    product = await crud.get_product(db=db, product_id=product_id)
    if not product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return product

@router.put("/{product_id}", response_model=schemas.Product)
async def update_product_endpoint(
    product_id: int,
    product_update: schemas.ProductUpdate,
    db: AsyncSession = Depends(get_db_session)
):
    """–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    updated_product = await crud.update_product(
        db=db, product_id=product_id, product_update=product_update
    )
    if not updated_product:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return updated_product

@router.delete("/{product_id}", status_code=status.HTTP_204_NO_CONTENT)
async def delete_product_endpoint(
    product_id: int,
    db: AsyncSession = Depends(get_db_session)
):
    """–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä."""
    deleted = await crud.delete_product(db=db, product_id=product_id)
    if not deleted:
        raise HTTPException(status_code=404, detail="–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return None
```

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

- –†–æ—É—Ç–µ—Ä —Å—Ç–∞–ª –ø—Ä–æ—Å—Ç—ã–º –∏ —á–∏—Ç–∞–µ–º—ã–º
- –õ–æ–≥–∏–∫—É –ë–î –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –Ω–µ —Ç—Ä–æ–≥–∞—è API
- –ö–æ–¥ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–æ–¥–Ω—É —Ñ—É–Ω–∫—Ü–∏—é CRUD –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)

******

### 2. –ü—Ä–æ–±–ª–µ–º–∞: –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å? ü§î

**[–¢–ï–ö–°–¢]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

"–ó–∞–∫–∞–∑—á–∏–∫ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã —É –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –±—ã–ª —Ñ–ª–∞–≥ `is_active`, —á—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã —Å —Å–∞–π—Ç–∞, –Ω–µ —É–¥–∞–ª—è—è –∏—Ö –∏–∑ –±–∞–∑—ã. –ù–∞–º –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É `products` –Ω–æ–≤—É—é –∫–æ–ª–æ–Ω–∫—É `is_active` —Ç–∏–ø–∞ `boolean`."

**[–¢–ï–ö–°–¢]** –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –∞—É–¥–∏—Ç–æ—Ä–∏–∏: "–ú—ã –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `models.py`. –ù–æ —á—Ç–æ –¥–∞–ª—å—à–µ?"

**[–¢–ï–ö–°–¢]** –ü–æ–∫–∞–∂–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

–ï—Å–ª–∏ –º—ã —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç `create_tables.py`, –æ–Ω –≤—ã–∑–æ–≤–µ—Ç `drop_all` –∏ **—Å–æ—Ç—Ä–µ—Ç –≤—Å–µ —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –º—ã —É–∂–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –±–∞–∑—É**! –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ —ç—Ç–æ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞ ‚Äî –º—ã –ø–æ—Ç–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤.

**[–¢–ï–ö–°–¢]** –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—É: –Ω–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± **–∏–∑–º–µ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö**.

******

### 3. –†–µ—à–µ–Ω–∏–µ: Alembic ‚Äî Git –¥–ª—è –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö üìú

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é —Å Git:

Alembic –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ Git –¥–ª—è –∫–æ–¥–∞. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ö–µ–º—É –ë–î –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

**[–¢–ï–ö–°–¢]** –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –ø—Ä—è–º—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏:

| Git | Alembic | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|---------|----------|
| `git commit` | `alembic revision` | –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ö–µ–º–µ |
| `git push` | `alembic upgrade` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ë–î |
| `git log` | `alembic history` | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π |
| `git checkout <hash>` | `alembic downgrade <hash>` | –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã |

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Alembic üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Alembic –≤ –≤–∞—à–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
>
>```bash
>pip install alembic
>```

**[–¢–ï–ö–°–¢]** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ Alembic –≤ –ø—Ä–æ–µ–∫—Ç–µ:

```bash
alembic init alembic
```

**[–¢–ï–ö–°–¢]** –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç:

- –ü–∞–ø–∫—É `alembic/` —Å —Ñ–∞–π–ª–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–π
- –§–∞–π–ª `alembic.ini` —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ü—Ä–æ–≤–æ–¥–∏–º –ø–µ—Ä–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é üéØ

**[–¢–ï–ö–°–¢]** –®–∞–≥ 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

**[–ö–û–î: alembic.ini]** –ù–∞–π–¥–∏—Ç–µ –∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É —Å `sqlalchemy.url`:

```ini
# alembic.ini

# ...

# sqlalchemy.url = driver://user:pass@localhost/dbname
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º —ç—Ç—É —Å—Ç—Ä–æ–∫—É - –±—É–¥–µ–º –±—Ä–∞—Ç—å URL –∏–∑ config.py
```

******
**[–ö–û–î: alembic/env.py]** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```python
# alembic/env.py
from logging.config import fileConfig
from sqlalchemy import engine_from_config, pool
from alembic import context

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
from app.models import Base
from app.config import DATABASE_URL

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
config = context.config

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–∞—à–µ–≥–æ config.py
config.set_main_option("sqlalchemy.url", DATABASE_URL)

# –£–∫–∞–∑—ã–≤–∞–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–∞—à–∏—Ö –º–æ–¥–µ–ª–µ–π –∫–∞–∫ —Ü–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
target_metadata = Base.metadata

# ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
```

**[–¢–ï–ö–°–¢]** –®–∞–≥ 2: –ò–∑–º–µ–Ω—è–µ–º –º–æ–¥–µ–ª—å ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ.

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `is_active` –≤ –º–æ–¥–µ–ª—å `Product`:

```python
class Product(Base):
    __tablename__ = "products"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100), index=True)
    description: Mapped[str | None] = mapped_column(Text)
    price: Mapped[float]
    category_id: Mapped[int | None] = mapped_column(ForeignKey("categories.id"))
    
    # –ù–æ–≤–æ–µ –ø–æ–ª–µ!
    is_active: Mapped[bool] = mapped_column(server_default="true")
    
    category: Mapped["Category"] = relationship(back_populates="products")
```

******
**[–¢–ï–ö–°–¢]** –®–∞–≥ 3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

```bash
alembic revision --autogenerate -m "Add is_active field to Product"
```

**[–¢–ï–ö–°–¢]** Alembic —Å—Ä–∞–≤–Ω–∏—Ç –≤–∞—à–∏ –º–æ–¥–µ–ª–∏ Python —Å —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

**[–¢–ï–ö–°–¢]** –®–∞–≥ 4: –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏.

–û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª –≤ –ø–∞–ø–∫–µ `alembic/versions/`. –û–Ω –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∏–º—è –≤—Ä–æ–¥–µ `xxxx_add_is_active_field_to_product.py`.

**[–ö–û–î: alembic/versions/xxxx_add_is_active.py]** –ü–æ–∫–∞–∂–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞:

```python
"""Add is_active field to Product

Revision ID: abc123def456
Revises: prev_revision_id
Create Date: 2025-10-01 12:00:00.000000

"""
from alembic import op
import sqlalchemy as sa

# revision identifiers, used by Alembic.
revision = 'abc123def456'
down_revision = 'prev_revision_id'  # –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–∏–≥—Ä–∞—Ü–∏—é
branch_labels = None
depends_on = None

def upgrade():
    """–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ –ë–î."""
    # Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —ç—Ç–æ—Ç –∫–æ–¥!
    op.add_column('products', sa.Column('is_active', sa.Boolean(), 
                  server_default='true', nullable=False))

def downgrade():
    """–û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)."""
    op.drop_column('products', 'is_active')
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

- `upgrade()` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É)
- `downgrade()` ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è (—É–¥–∞–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫—É)
- `revision` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- `down_revision` ‚Äî ID –ø—Ä–µ–¥—ã–¥—É—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ–±—Ä–∞–∑—É–µ—Ç—Å—è —Ü–µ–ø–æ—á–∫–∞)

**[–¢–ï–ö–°–¢]** –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

```bash
alembic upgrade head
```

******
**[–¢–ï–ö–°–¢]** –ö–æ–º–∞–Ω–¥–∞ `upgrade head` –æ–∑–Ω–∞—á–∞–µ—Ç: "–ø—Ä–∏–º–µ–Ω–∏ –≤—Å–µ –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ —Å–∞–º–æ–π –ø–æ—Å–ª–µ–¥–Ω–µ–π".

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã" ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ pgAdmin:

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —Ç–∞–±–ª–∏—Ü–µ `products`
3. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ `is_active` —Ç–∏–ø–∞ `boolean`
4. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å –∏ —É –Ω–∏—Ö `is_active = true`

**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –º–∞–≥–∏—é: –º—ã –∏–∑–º–µ–Ω–∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –µ–¥–∏–Ω–æ–π –∑–∞–ø–∏—Å–∏!

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Alembic:

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
alembic current

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
alembic history

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞–∑–∞–¥
alembic downgrade -1

# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
alembic downgrade <revision_id>
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–æ—Ä–≥–∞–Ω–∏–∑—É–π—Ç–µ —Å–≤–æ–π –∫–æ–¥ –ø–æ –Ω–æ–≤–æ–º—É –æ–±—Ä–∞–∑—Ü—É (schemas.py, crud.py, models.py). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥–µ–ª—å `Category` –Ω–æ–≤–æ–µ –ø–æ–ª–µ `description: Mapped[str | None]` –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤ –∏ –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–≤–æ—é –ø–µ—Ä–≤—É—é Alembic-–º–∏–≥—Ä–∞—Ü–∏—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ pgAdmin.

******

## –£—Ä–æ–∫ 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React –∏ CORS üåê

### 1. –î–≤–∞ —Å–µ—Ä–≤–µ—Ä–∞: –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ üé≠

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 (–ë—ç–∫–µ–Ω–¥ FastAPI):**

```bash
cd path/to/fastapi_project
uvicorn app.main:app --reload
```

–ü–æ–∫–∞–∂–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://127.0.0.1:8000/docs` ‚Äî API —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 (–§—Ä–æ–Ω—Ç–µ–Ω–¥ React):**

```bash
cd path/to/react_project
npm run dev
```

–ü–æ–∫–∞–∂–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:5173` ‚Äî —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è.

**[–¢–ï–ö–°–¢]** –ß–µ—Ç–∫–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ü–µ–ª—å:

"–°–µ–π—á–∞—Å –Ω–∞—à React-—Å–∞–π—Ç –±–µ—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–∞–π–ª–∞ `data.ts`. –ù–∞—à–∞ —Ü–µ–ª—å ‚Äî –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ —Å–µ—Ç–∏, –¥–µ–ª–∞—è —Ä–µ–∞–ª—å–Ω—ã–π HTTP-–∑–∞–ø—Ä–æ—Å –∫ –Ω–∞—à–µ–º—É Python-—Å–µ—Ä–≤–µ—Ä—É –Ω–∞ –ø–æ—Ä—Ç—É 8000."

******

### 2. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏ –ø–µ—Ä–≤–∞—è –æ—à–∏–±–∫–∞: CORS üö´

**[–ö–û–î: src/components/ProductsPage.tsx]** –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å API:

```tsx
// src/components/ProductsPage.tsx
import { useState, useEffect } from 'react';
import { ProductCard } from './ProductCard';
import { Product } from '../types';

// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç
// import { products } from '../data/products';

export function ProductsPage() {
  const [products, setProducts] = useState<Product[]>([]);  // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [searchQuery, setSearchQuery] = useState('');
  
  useEffect(() => {
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –±—ç–∫–µ–Ω–¥–∞
    const fetchProducts = async () => {
      console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –±—ç–∫–µ–Ω–¥–∞...');
      
      try {
        const response = await fetch('http://127.0.0.1:8000/products');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        setProducts(data);
        console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!', data);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        setError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã');
      } finally {
        setLoading(false);
      }
    };
    
    fetchProducts();
  }, []);  // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π - —Ö—É–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  
  if (loading) return <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>;
  if (error) return <div>–û—à–∏–±–∫–∞: {error}</div>;
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) ...
}
```

******
**[–î–ï–ú–û]** –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏ CORS:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (`http://localhost:5173`)
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (F12)
4. **–ü–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—É—Å—Ç–∞, —Ç–æ–≤–∞—Ä—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
   - –í –∫–æ–Ω—Å–æ–ª–∏ **–∫—Ä–∞—Å–Ω–∞—è –æ—à–∏–±–∫–∞**:

```
Access to fetch at 'http://127.0.0.1:8000/products' from origin 'http://localhost:5173' 
has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present 
on the requested resource.
```

**[–¢–ï–ö–°–¢]** –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –º–æ–º–µ–Ω—Ç: "–í–æ—Ç –æ–Ω–∞ ‚Äî –∑–Ω–∞–º–µ–Ω–∏—Ç–∞—è –æ—à–∏–±–∫–∞ CORS, —Å –∫–æ—Ç–æ—Ä–æ–π —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫."

******

### 3. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ CORS: "–ü–æ–ª–∏—Ç–∏–∫–∞ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞" üîí

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é —Å –±–∞–Ω–∫–æ–º:

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –Ω–∞ —Å–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ –±–∞–Ω–∫–∞ `mybank.com`. –ó–∞—Ç–µ–º –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π —Å–∞–π—Ç `evil.com`.

–ë–µ–∑ –ø–æ–ª–∏—Ç–∏–∫–∏ CORS, JavaScript-–∫–æ–¥ —Å —Å–∞–π—Ç–∞ `evil.com` –º–æ–≥ –±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ `mybank.com/api/transfer?to=hacker&amount=1000`.

–í–∞—à –±—Ä–∞—É–∑–µ—Ä, –≤–∏–¥—è, —á—Ç–æ –≤—ã –∑–∞–ª–æ–≥–∏–Ω–µ–Ω—ã –≤ –±–∞–Ω–∫–µ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–ª–æ–∂–∏–ª –±—ã –∫ —ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—É –≤–∞—à–∏ cookies (—Å–µ—Å—Å–∏—é), –∏ –¥–µ–Ω—å–≥–∏ –±—ã —É—à–ª–∏!

**–ü–æ–ª–∏—Ç–∏–∫–∞ CORS –∑–∞–ø—Ä–µ—â–∞–µ—Ç —ç—Ç–æ.** –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç `evil.com` –∫ `mybank.com` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å—É—Ç—å:

–î–ª—è –±—Ä–∞—É–∑–µ—Ä–∞ –¥–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö (`localhost:5173` –∏ `localhost:8000`) ‚Äî —ç—Ç–æ **—Ä–∞–∑–Ω—ã–µ "–∏—Å—Ç–æ—á–Ω–∏–∫–∏" (origins)**.

**Origin** = –ø—Ä–æ—Ç–æ–∫–æ–ª + –¥–æ–º–µ–Ω + –ø–æ—Ä—Ç:

- `http://localhost:5173` ‚Äî –æ–¥–∏–Ω origin
- `http://localhost:8000` ‚Äî –¥—Ä—É–≥–æ–π origin

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ origins –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**[–¢–ï–ö–°–¢]** –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Ç—É–∞—Ü–∏–∏:

–ß—Ç–æ–±—ã –Ω–∞—à "—Ö–æ—Ä–æ—à–∏–π" –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—à–µ–ª, **—Å–µ—Ä–≤–µ—Ä** `:8000` –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Å–∫–∞–∑–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä—É:

"–Ø —Ä–∞–∑—Ä–µ—à–∞—é –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç `:5173`, –µ–º—É –º–æ–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å."

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏.

******

### 4. –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `CORSMiddleware` –≤ FastAPI ‚úÖ

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é Middleware:

**Middleware** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ—Ç–æ—Ä—ã–π "–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç" –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—É—Ç–∏ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É –∏ –∫–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –ø—É—Ç–∏ –∫ –∫–ª–∏–µ–Ω—Ç—É.

`CORSMiddleware` –¥–æ–±–∞–≤–ª—è–µ—Ç –∫ –æ—Ç–≤–µ—Ç–∞–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ (`Access-Control-Allow-Origin` –∏ –¥—Ä.), –∫–æ—Ç–æ—Ä—ã–µ –∏ —è–≤–ª—è—é—Ç—Å—è "—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º" –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞.

**[–ö–û–î: app/main.py]** –î–æ–±–∞–≤—å—Ç–µ CORS middleware:

```python
# app/main.py
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware  # 1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º

from .routers import products, categories

app = FastAPI(
    title="Store API",
    description="API –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞",
    version="1.0.0"
)

# 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
origins = [
    "http://localhost:5173",      # React dev server (Vite)
    "http://localhost:3000",      # React dev server (Create React App)
    "http://127.0.0.1:5173",
    # –í production –∑–¥–µ—Å—å –±—É–¥–µ—Ç –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
    # "https://mystore.com",
]

# 3. –î–æ–±–∞–≤–ª—è–µ–º Middleware –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,           # –†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —ç—Ç–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    allow_credentials=True,          # –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É cookies
    allow_methods=["*"],             # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –º–µ—Ç–æ–¥—ã (GET, POST, PUT, DELETE –∏ —Ç.–¥.)
    allow_headers=["*"],             # –†–∞–∑—Ä–µ—à–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
)

# –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã
app.include_router(products.router, prefix="/products", tags=["Products"])
app.include_router(categories.router, prefix="/categories", tags=["Categories"])

@app.get("/")
async def root():
    return {"message": "Welcome to Store API"}
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `allow_origins` ‚Äî **–±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**. –í production –¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `allow_credentials=True` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–µ—Ä–µ–¥–∞—á—É cookies –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `allow_methods=["*"]` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ HTTP-–º–µ—Ç–æ–¥—ã. –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å: `["GET", "POST"]`
- `allow_headers=["*"]` ‚Äî —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏. –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏

>[!warning]
>
>#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Production üîê
>
>–í production **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `allow_origins=["*"]` ‚Äî —ç—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ! –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã.

******

### 5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –û–∂–∏–≤–ª—è–µ–º –∫–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ üéâ

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã":

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `uvicorn` –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è `main.py` (–µ—Å–ª–∏ `--reload` –≤–∫–ª—é—á–µ–Ω)
2. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤–æ –≤–∫–ª–∞–¥–∫—É —Å React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
3. **–ü—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)**

**[–î–ï–ú–û]** –ü–æ–∫–∞–∂–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. **–í –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**
   - –û—à–∏–±–∫–∞ CORS –∏—Å—á–µ–∑–ª–∞ ‚úÖ
   - –ü–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!` —Å –º–∞—Å—Å–∏–≤–æ–º —Ç–æ–≤–∞—Ä–æ–≤

2. **–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:**
   - –ü–æ—è–≤–∏–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–º–∫–Ω—É–ª—Å—è: `PostgreSQL ‚Üí SQLAlchemy ‚Üí FastAPI ‚Üí HTTP ‚Üí React ‚Üí DOM`

******
**[–î–ï–ú–û]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ Swagger UI (`http://127.0.0.1:8000/docs`)
2. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è! –î–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –∂–∏–≤—É—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –Ω–∞–¥–µ–∂–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, API –∑–∞—â–∏—â–µ–Ω–æ —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π, –∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫—Ä–∞—Å–∏–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–û–∂–∏–≤–∏–ª–∏ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ç–∞–ª–æ–≥–∞. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–∞ (`ProductDetailPage.tsx`).
>
>–í–∞–º –Ω—É–∂–Ω–æ:
>
>1. –ü–æ–ª—É—á–∏—Ç—å ID —Ç–æ–≤–∞—Ä–∞ –∏–∑ URL —Å –ø–æ–º–æ—â—å—é —Ö—É–∫–∞ `useParams` –∏–∑ `react-router-dom`
>2. –°–¥–µ–ª–∞—Ç—å `fetch`-–∑–∞–ø—Ä–æ—Å –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /products/{id}`
>3. –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Ç–æ–≤–∞—Ä–µ
>4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ —Ç–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω (–æ—à–∏–±–∫–∞ 404)

******

## –£—Ä–æ–∫ 7: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π üîê

### 1. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" üë§

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª—å User:

```python
# app/models.py
from sqlalchemy import Boolean, String
from sqlalchemy.orm import Mapped, mapped_column

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ ...

class User(Base):
    """–ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–∏—Å—Ç–µ–º—ã."""
    __tablename__ = "users"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    email: Mapped[str] = mapped_column(String(150), unique=True, index=True)
    hashed_password: Mapped[str] = mapped_column(String(255))
    is_active: Mapped[bool] = mapped_column(default=True)
    is_superuser: Mapped[bool] = mapped_column(default=False)
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

**`email`** ‚Äî –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ª–æ–≥–∏–Ω. `unique=True` ‚Äî —ç—Ç–æ constraint –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–∑–≤–æ–ª–∏—Ç —Å–æ–∑–¥–∞—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º email.

**`hashed_password`** ‚Äî –ø–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ, —á—Ç–æ –º—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–µ—Å—å –ø–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, —Ç–æ–ª—å–∫–æ –µ–≥–æ —Ö—ç—à.

**`is_active`** ‚Äî —Ñ–ª–∞–≥ –¥–ª—è "–º—è–≥–∫–æ–≥–æ" —É–¥–∞–ª–µ–Ω–∏—è (ban) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –ë–î.

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "Create users table"
alembic upgrade head
```

******

### 2. "–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ! ‚ö†Ô∏è

**[–¢–ï–ö–°–¢]** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é —Å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π:

–•—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å PIN-–∫–æ–¥ –º–∞—Ä–∫–µ—Ä–æ–º –ø—Ä—è–º–æ –Ω–∞ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–µ.

–ï—Å–ª–∏ –≤–æ—Ä —É–∫—Ä–∞–¥–µ—Ç –∫–æ—à–µ–ª–µ–∫ (—Ö–∞–∫–µ—Ä –≤–∑–ª–æ–º–∞–µ—Ç –ë–î), –æ–Ω –ø–æ–ª—É—á–∏—Ç —Å—Ä–∞–∑—É –≤—Å—ë: –∫–∞—Ä—Ç—É —Å PIN-–∫–æ–¥–æ–º.

–ù–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –¥–∞–∂–µ —É–∫—Ä–∞–≤ "–∫–∞—Ä—Ç—É" (–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö), –≤–æ—Ä –Ω–µ —Å–º–æ–≥ —É–∑–Ω–∞—Ç—å "PIN-–∫–æ–¥" (–ø–∞—Ä–æ–ª—å).

**[–¢–ï–ö–°–¢]** –û–ø–∏—à–∏—Ç–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —É—Ç–µ—á–∫–∏ –ø–∞—Ä–æ–ª–µ–π:

1. **–ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö** ‚Äî –ª—é–¥–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –≤–µ–∑–¥–µ
2. **–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã** ‚Äî –≤–æ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö —ç—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞ –æ –∑–∞—â–∏—Ç–µ –¥–∞–Ω–Ω—ã—Ö (GDPR –∏ –¥—Ä.)
3. **–†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥—É—Ç –¥–æ–≤–µ—Ä—è—Ç—å –≤–∞—à–µ–º—É —Å–µ—Ä–≤–∏—Å—É
4. **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —É–±—ã—Ç–∫–∏** ‚Äî —à—Ç—Ä–∞—Ñ—ã –∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–º

**[–¢–ï–ö–°–¢]** –í—ã–≤–æ–¥: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–ª–æ—Ö–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞, —ç—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–µ–ø—Ä–∏–≥–æ–¥–Ω–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

******

### 3. –†–µ—à–µ–Ω–∏–µ: –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å `passlib` üîê

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–ú—è—Å–æ—Ä—É–±–∫–∞":

–•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞—è –º—è—Å–æ—Ä—É–±–∫–∞:

- –í—ã –∫–ª–∞–¥–µ—Ç–µ –∫—É—Å–æ–∫ –º—è—Å–∞ (–ø–∞—Ä–æ–ª—å) ‚Üí –ø–æ–ª—É—á–∞–µ—Ç–µ —Ñ–∞—Ä—à (—Ö—ç—à)
- –í—ã **–Ω–∏–∫–æ–≥–¥–∞** –Ω–µ —Å–º–æ–∂–µ—Ç–µ –∑–∞—Å—É–Ω—É—Ç—å —Ñ–∞—Ä—à –æ–±—Ä–∞—Ç–Ω–æ –∏ –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫—É—Å–æ–∫ –º—è—Å–∞
- –≠—Ç–æ **–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è** –æ–ø–µ—Ä–∞—Ü–∏—è

–î–∞–∂–µ –∑–Ω–∞—è —Ö—ç—à, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –ø–∞—Ä–æ–ª—å.

**[–¢–ï–ö–°–¢]** –ö–∞–∫ —Ç–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –≤—Ö–æ–¥–µ?

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –º—ã –Ω–µ "—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ–º" —Ö—ç—à. –ú—ã:

1. –ë–µ—Ä–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –ø–∞—Ä–æ–ª—å
2. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ —Ç—É –∂–µ "–º—è—Å–æ—Ä—É–±–∫—É" (—Ö—ç—à–∏—Ä—É–µ–º)
3. **–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –¥–≤–∞ —Ö—ç—à–∞**

–ï—Å–ª–∏ —Ö—ç—à–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç ‚Äî –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π!

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ passlib üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
>
>```bash
>pip install "passlib[bcrypt]"
>```
>
>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º **bcrypt** ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –Ω–∞–¥–µ–∂–Ω—ã—Ö –¥–ª—è –ø–∞—Ä–æ–ª–µ–π.

**[–ö–û–î: app/security.py]** –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é:

```python
# app/security.py
from passlib.context import CryptContext

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–æ–ª—è–º–∏
# schemes=["bcrypt"] - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º bcrypt
# deprecated="auto" - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Å—Ö–µ–º—ã
pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def verify_password(plain_password: str, hashed_password: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å —Ö—ç—à—É.
    
    Args:
        plain_password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ (–≤–≤–µ–¥–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
        hashed_password: –•—ç—à –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    
    Returns:
        True –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π, False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ö—ç—à –ø–∞—Ä–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î.
    
    Args:
        password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
    
    Returns:
        –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ö—ç—à –ø–∞—Ä–æ–ª—è
    """
    return pwd_context.hash(password)
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ `passlib` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –î–æ–±–∞–≤–ª—è–µ—Ç "—Å–æ–ª—å" (salt) ‚Äî —Å–ª—É—á–∞–π–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –∏–º–µ–ª–∏ —Ä–∞–∑–Ω—ã–µ —Ö—ç—à–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞—É–Ω–¥—ã —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç brute-force –∞—Ç–∞–∫
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks)

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –†–µ–∞–ª–∏–∑—É–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ üìù

**[–ö–û–î: app/schemas.py]** –î–æ–±–∞–≤—å—Ç–µ Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```python
# app/schemas.py
from pydantic import BaseModel, EmailStr

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class UserBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    email: EmailStr  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email

class UserCreate(UserBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å –ø–∞—Ä–æ–ª–µ–º)."""
    password: str

class User(UserBase):
    """–°—Ö–µ–º–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è!)."""
    id: int
    is_active: bool
    
    class Config:
        from_attributes = True
```

**[–¢–ï–ö–°–¢]** –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –≤ —Å—Ö–µ–º–µ `User` (–¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ API) **–Ω–µ—Ç –ø–æ–ª—è password**! –ú—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–¥–∞–µ–º –ø–∞—Ä–æ–ª—å –∏–ª–∏ –µ–≥–æ —Ö—ç—à –∫–ª–∏–µ–Ω—Ç—É.

**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```python
# app/crud.py
from sqlalchemy import select
from . import models, schemas, security

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

# ============= CRUD –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π =============

async def get_user_by_email(
    db: AsyncSession,
    email: str
) -> Optional[models.User]:
    """–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email."""
    query = select(models.User).where(models.User.email == email)
    result = await db.execute(query)
    return result.scalar_one_or_none()

async def create_user(
    db: AsyncSession,
    user: schemas.UserCreate
) -> models.User:
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –í–ê–ñ–ù–û: –ü–∞—Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ö—ç—à–∏—Ä—É–µ—Ç—Å—è!
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    existing_user = await get_user_by_email(db, user.email)
    if existing_user:
        from fastapi import HTTPException
        raise HTTPException(
            status_code=400,
            detail="Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"
        )
    
    # –•—ç—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
    hashed_password = security.get_password_hash(user.password)
    
    # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
    db_user = models.User(
        email=user.email,
        hashed_password=hashed_password
    )
    
    db.add(db_user)
    await db.commit()
    await db.refresh(db_user)
    
    return db_user
```

******
**[–ö–û–î: app/routers/users.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```python
# app/routers/users.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from .. import crud, schemas
from ..database import get_db_session

router = APIRouter()

@router.post(
    "/",
    response_model=schemas.User,
    status_code=status.HTTP_201_CREATED,
    summary="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
)
async def register_user(
    user_data: schemas.UserCreate,
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    - **email**: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - **password**: –ü–∞—Ä–æ–ª—å (–±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω)
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è).
    """
    return await crud.create_user(db=db, user=user_data)
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä:

```python
# app/main.py
from .routers import products, categories, users  # –î–æ–±–∞–≤–∏–ª–∏ users

# ...

app.include_router(users.router, prefix="/users", tags=["Users"])
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant Pydantic üîç
    participant CRUD üíº
    participant Security üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /users/ + {email, password}
    FastAPI->>Pydantic: –í–∞–ª–∏–¥–∞—Ü–∏—è UserCreate
    Pydantic->>FastAPI: ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
    
    FastAPI->>CRUD: create_user(user_data)
    CRUD->>PostgreSQL: SELECT WHERE email = ?
    PostgreSQL-->>CRUD: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
    
    CRUD->>Security: get_password_hash(password)
    Security-->>CRUD: $2b$12$hashed...
    
    CRUD->>PostgreSQL: INSERT (email, hashed_password)
    PostgreSQL-->>CRUD: User created (id=1)
    
    CRUD-->>FastAPI: User object
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 201 Created + {id, email, is_active}
```

******
**[–î–ï–ú–û]** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /users/`
3. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

   ```json
   {
     "email": "test@example.com",
     "password": "mysecretpassword123"
   }
   ```

4. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç `201 Created`:

   ```json
   {
     "id": 1,
     "email": "test@example.com",
     "is_active": true
   }
   ```

5. **–û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin** –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É `users`
6. **–ü–æ–∫–∞–∂–∏—Ç–µ –∫–æ–ª–æ–Ω–∫—É `hashed_password`** ‚Äî —Ç–∞–º –¥–ª–∏–Ω–Ω–∞—è "–∞–±—Ä–∞–∫–∞–¥–∞–±—Ä–∞", –∞ –Ω–µ –≤–∞—à –ø–∞—Ä–æ–ª—å!

–ü—Ä–∏–º–µ—Ä —Ö—ç—à–∞: `$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5GyYzS7OQ/Tay`

**[–¢–ï–ö–°–¢]** –≠—Ç–æ –∏ –µ—Å—Ç—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî –ø–∞—Ä–æ–ª—å –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω!

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ –±—ç–∫–µ–Ω–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ñ–æ—Ä–º–æ–π (–ø–æ–ª—è email –∏ password) –∏ "–ø–æ–¥–∫–ª—é—á–∏—Ç—å" –µ–µ –∫ –Ω–∞—à–µ–º—É –Ω–æ–≤–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É `POST /users/`.
>
>–û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ (email —É–∂–µ –∑–∞–Ω—è—Ç, —Å–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å –∏ —Ç.–¥.)

******

## –£—Ä–æ–∫ 8: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ JWT-—Ç–æ–∫–µ–Ω—ã üé´

### 1. –ü—Ä–æ–±–ª–µ–º–∞: HTTP "–±–µ–∑ –ø–∞–º—è—Ç–∏" ü§∑

**[–¢–ï–ö–°–¢]** –ù–∞—á–Ω–∏—Ç–µ —Å –∞–Ω–∞–ª–æ–≥–∏–∏ "–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –≤ –∞–≤—Ç–æ–±—É—Å–µ":

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ HTTP ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä —Å –∞–º–Ω–µ–∑–∏–µ–π. –í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ –≤ –∞–≤—Ç–æ–±—É—Å, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç–µ –µ–º—É –±–∏–ª–µ—Ç (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å). –û–Ω –≤–∞—Å –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç.

–ß–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç –æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –∫ –≤–∞–º —Å–Ω–æ–≤–∞ –∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∏–ª–µ—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –≤–∞—Å –Ω–µ –ø–æ–º–Ω–∏—Ç!

–ù–æ—Å–∏—Ç—å —Å —Å–æ–±–æ–π –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –±–∏–ª–µ—Ç (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ) ‚Äî –Ω–µ—É–¥–æ–±–Ω–æ –∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ.

–ì–æ—Ä–∞–∑–¥–æ –ª—É—á—à–µ –ø–æ–ª—É—á–∏—Ç—å —É –≤–æ–¥–∏—Ç–µ–ª—è **"–ø—Ä–æ–µ–∑–¥–Ω–æ–π"** (—Ç–æ–∫–µ–Ω), –∫–æ—Ç–æ—Ä—ã–π:

- –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –≤—Å—é –ø–æ–µ–∑–¥–∫—É (—Å–µ—Å—Å–∏—é)
- –õ–µ–≥–∫–æ –ø—Ä–µ–¥—ä—è–≤–∏—Ç—å –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ
- –ú–æ–∂–Ω–æ –æ—Ç–æ–∑–≤–∞—Ç—å, –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–Ω

**[–¢–ï–ö–°–¢]** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:

–ù–∞–º –Ω—É–∂–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç –∫–ª–∏–µ–Ω—Ç—É (React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º **–±—ã—Å—Ç—Ä–æ –¥–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—É**, —á—Ç–æ –æ–Ω —É–∂–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏.
******
**[–¢–ï–ö–°–¢]** –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ä–∞–∑–Ω—ã–µ:

1. **Cookies + Sessions** ‚Äî —Å–µ—Ä–≤–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏, –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie
2. **OAuth 2.0** ‚Äî —Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ (Google, Facebook login)
3. **JWT (JSON Web Tokens)** ‚Äî —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–Ω—É—Ç—Ä–∏

–ú—ã –≤—ã–±–µ—Ä–µ–º **JWT** –∏–∑-–∑–∞ –µ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö SPA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö.

**[–¢–ï–ö–°–¢]** –î–µ—Ç–∞–ª—å–Ω–æ —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø—Ä–æ JWT:

**JWT (JSON Web Token)** ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞. –¢–æ–∫–µ–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö —á–∞—Å—Ç–µ–π, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞–º–∏:

```
eyJhbGci.eyJzdWIi.SflKxwRJ
Header.Payload.Signature
```

- **Header** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–ø–µ —Ç–æ–∫–µ–Ω–∞ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **Payload** ‚Äî –¥–∞–Ω–Ω—ã–µ (–∫—Ç–æ —ç—Ç–æ, –∫–æ–≥–¥–∞ –≤—ã–¥–∞–Ω, –∫–æ–≥–¥–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç)
- **Signature** ‚Äî —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏

******

### 2. –†–µ—à–µ–Ω–∏–µ: JWT-—Ç–æ–∫–µ–Ω—ã üîë

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª–æ–≥–∏—é "–¶–∏—Ñ—Ä–æ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫":

JWT ‚Äî —ç—Ç–æ –∫–∞–∫ **–ø—Ä–æ–ø—É—Å–∫ —Å –≥–æ–ª–æ–≥—Ä–∞–º–º–æ–π**:

**Payload (–î–∞–Ω–Ω—ã–µ)** ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ:

- `sub: 'user@example.com'` ‚Äî —Å—É–±—ä–µ–∫—Ç (–∫–æ–º—É –≤—ã–¥–∞–Ω)
- `exp: 1678886400` ‚Äî expiration (–¥–æ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω)
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä–æ–ª–∏, –∏–º—è –∏ —Ç.–¥.)

**Signature (–ü–æ–¥–ø–∏—Å—å)** ‚Äî —ç—Ç–æ "–≥–æ–ª–æ–≥—Ä–∞–º–º–∞" –Ω–∞ –ø—Ä–æ–ø—É—Å–∫–µ:

- –°–æ–∑–¥–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞, –∫–æ—Ç–æ—Ä—ã–π –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ —É —Å–µ—Ä–≤–µ—Ä–∞
- –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –≤–∞—à –ø—Ä–æ–ø—É—Å–∫ –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤–ø–∏—Å–∞—Ç—å –≤ –Ω–µ–≥–æ —á—É–∂–æ–µ –∏–º—è, –≥–æ–ª–æ–≥—Ä–∞–º–º–∞ –ø–æ–≤—Ä–µ–¥–∏—Ç—Å—è
- –û—Ö—Ä–∞–Ω–∞ (—Å–µ—Ä–≤–µ—Ä) —ç—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç

>[!info]
>
>#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π üì¶
>
>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JWT:
>
>```bash
>pip install python-jose[cryptography] python-multipart
>```
>
>- `python-jose` ‚Äî –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
>- `python-multipart` ‚Äî –¥–ª—è –ø—Ä–∏–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML-—Ñ–æ—Ä–º (–Ω—É–∂–Ω–æ –¥–ª—è OAuth2PasswordRequestForm)

**[–ö–û–î: app/config.py]** –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è JWT:

```python
# app/config.py
import os

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
DATABASE_URL = "postgresql+asyncpg://postgres:mysecretpassword@localhost:5432/store_db"

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ JWT
# –í–ê–ñ–ù–û: –í production SECRET_KEY –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π: openssl rand -hex 32
SECRET_KEY = os.getenv("SECRET_KEY", "your_super_secret_key_change_this_in_production")
ALGORITHM = "HS256"  # –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–∞
ACCESS_TOKEN_EXPIRE_MINUTES = 30  # –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
```

******
**[–¢–ï–ö–°–¢]** –ü–æ–¥—á–µ—Ä–∫–Ω–∏—Ç–µ –≤–∞–∂–Ω–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

`SECRET_KEY` ‚Äî —ç—Ç–æ **—Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Å–µ–∫—Ä–µ—Ç** –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! –° –µ–≥–æ –ø–æ–º–æ—â—å—é –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ç–æ–∫–µ–Ω—ã. –ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∏—Ç —ç—Ç–æ—Ç –∫–ª—é—á, –æ–Ω —Å–º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –æ—Ç –∏–º–µ–Ω–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–í production:

1. –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –¥–ª–∏–Ω–Ω—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
2. –•—Ä–∞–Ω–∏—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –≤ Git

**[–ö–û–î: app/security.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ–∑–¥–∞–Ω–∏—è JWT:

```python
# app/security.py
from datetime import datetime, timedelta, timezone
from jose import jwt
from passlib.context import CryptContext

from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å pwd_context ...

def create_access_token(data: dict, expires_delta: timedelta | None = None) -> str:
    """
    –°–æ–∑–¥–∞—Ç—å JWT access token.
    
    Args:
        data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤ —Ç–æ–∫–µ–Ω (–æ–±—ã—á–Ω–æ {"sub": email})
        expires_delta: –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞ (–µ—Å–ª–∏ None, —Ç–æ 15 –º–∏–Ω—É—Ç)
    
    Returns:
        JWT —Ç–æ–∫–µ–Ω –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
    """
    to_encode = data.copy()
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
    if expires_delta:
        expire = datetime.now(timezone.utc) + expires_delta
    else:
        expire = datetime.now(timezone.utc) + timedelta(minutes=15)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤ –¥–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–∞
    to_encode.update({"exp": expire})
    
    # –ö–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω —Å –Ω–∞—à–∏–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    
    return encoded_jwt
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `data` ‚Äî –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç `{"sub": "user@example.com"}`, –≥–¥–µ `sub` (subject) ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ JWT –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `exp` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ JWT –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è. JWT –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- `jwt.encode()` ‚Äî —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω, –ø–æ–¥–ø–∏—Å—ã–≤–∞—è –µ–≥–æ –Ω–∞—à–∏–º —Å–µ–∫—Ä–µ—Ç–Ω—ã–º –∫–ª—é—á–æ–º

******

### 3. –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∏ `OAuth2PasswordRequestForm` üìã

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é:

–ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ –º–µ—Ö–∞–Ω–∏–∑–º **OAuth2PasswordRequestForm**.

–≠—Ç–æ –Ω–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π OAuth2, –∞ –µ–≥–æ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –ª–æ–≥–∏–Ω–∞ –ø–æ username/password.

–§–æ—Ä–º–∞ –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç `POST`-–∑–∞–ø—Ä–æ—Å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `x-www-form-urlencoded` (–∫–∞–∫ –æ–±—ã—á–Ω–∞—è HTML-—Ñ–æ—Ä–º–∞), —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –¥–≤–∞ –ø–æ–ª—è:

- `username` ‚Äî –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ email
- `password` ‚Äî –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/crud.py
from typing import Optional
from . import security

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

async def authenticate_user(
    db: AsyncSession,
    email: str,
    password: str
) -> Optional[models.User]:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credentials –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    Args:
        db: –°–µ—Å—Å–∏—è –ë–î
        email: Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        password: –ü–∞—Ä–æ–ª—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
    
    Returns:
        User –µ—Å–ª–∏ credentials –≤–µ—Ä–Ω—ã–µ, None –µ—Å–ª–∏ –Ω–µ—Ç
    """
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
    user = await get_user_by_email(db, email=email)
    
    if not user:
        return None
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    if not security.verify_password(password, user.hashed_password):
        return None
    
    return user
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ª–æ–≥–∏–∫—É:

1. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ `verify_password`
4. –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`
5. –ï—Å–ª–∏ –≤—Å—ë –û–ö ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ª–æ–≥–∏–Ω–∞ üö™

**[–ö–û–î: app/schemas.py]** –î–æ–±–∞–≤—å—Ç–µ —Å—Ö–µ–º—É –¥–ª—è —Ç–æ–∫–µ–Ω–∞:

```python
# app/schemas.py

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class Token(BaseModel):
    """–°—Ö–µ–º–∞ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏."""
    access_token: str
    token_type: str

class TokenData(BaseModel):
    """–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö, –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –∏–∑ —Ç–æ–∫–µ–Ω–∞."""
    email: str | None = None
```

**[–ö–û–î: app/routers/auth.py]** –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/routers/auth.py
from datetime import timedelta
from fastapi import APIRouter, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, security
from app.database import get_db_session
from app.config import ACCESS_TOKEN_EXPIRE_MINUTES

router = APIRouter()

@router.post("/token", response_model=schemas.Token)
async def login_for_access_token(
    form_data: OAuth2PasswordRequestForm = Depends(),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ (–ª–æ–≥–∏–Ω).
    
    –ü—Ä–∏–Ω–∏–º–∞–µ—Ç credentials —á–µ—Ä–µ–∑ OAuth2PasswordRequestForm:
    - username: email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - password: –ø–∞—Ä–æ–ª—å
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT access token.
    """
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º credentials (form_data.username —Å–æ–¥–µ—Ä–∂–∏—Ç email)
    user = await crud.authenticate_user(
        db,
        email=form_data.username,
        password=form_data.password
    )
    
    if not user:
        # –ï—Å–ª–∏ credentials –Ω–µ–≤–µ—Ä–Ω—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 401 Unauthorized
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å",
            headers={"WWW-Authenticate": "Bearer"},
        )
    
    # –°–æ–∑–¥–∞–µ–º access token
    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)
    access_token = security.create_access_token(
        data={"sub": user.email},  # sub - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
        expires_delta=access_token_expires
    )
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    return {
        "access_token": access_token,
        "token_type": "bearer"  # –¢–∏–ø —Ç–æ–∫–µ–Ω–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç OAuth2)
    }
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

- `OAuth2PasswordRequestForm` ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å FastAPI, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç —Ñ–æ—Ä–º—É
- `form_data.username` ‚Äî –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É OAuth2 —ç—Ç–æ –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `username`, –Ω–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è email
- `headers={"WWW-Authenticate": "Bearer"}` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `token_type: "bearer"` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø —Ç–æ–∫–µ–Ω–∞ –≤ OAuth2

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# app/main.py
from .routers import products, categories, users, auth  # –î–æ–±–∞–≤–∏–ª–∏ auth

# ...

app.include_router(auth.router, tags=["Authentication"])
```

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ª–æ–≥–∏–Ω–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant OAuth2Form üìã
    participant CRUD üíº
    participant Security üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: POST /token + {username, password}
    FastAPI->>OAuth2Form: –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–æ—Ä–º—ã
    OAuth2Form->>FastAPI: ‚úÖ –§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞
    
    FastAPI->>CRUD: authenticate_user(email, password)
    CRUD->>PostgreSQL: SELECT WHERE email = ?
    PostgreSQL-->>CRUD: User found
    
    CRUD->>Security: verify_password(plain, hashed)
    Security-->>CRUD: ‚úÖ Password correct
    CRUD-->>FastAPI: User object
    
    FastAPI->>Security: create_access_token({sub: email})
    Security->>Security: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Å –ø–æ–¥–ø–∏—Å—å—é
    Security-->>FastAPI: eyJhbGci...
    
    FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + {access_token, token_type: "bearer"}
```

**[–î–ï–ú–û]** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Swagger UI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /token`
3. –ù–∞–∂–º–∏—Ç–µ "Try it out"
4. –í–≤–µ–¥–∏—Ç–µ credentials –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - `username`: `test@example.com` (—Ö–æ—Ç—è –ø–æ–ª–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è username, –≤–≤–æ–¥–∏–º email)
   - `password`: `mysecretpassword123`
5. –ù–∞–∂–º–∏—Ç–µ "Execute"
6. –ü–æ–ª—É—á–∏—Ç–µ –æ—Ç–≤–µ—Ç:

   ```json
   {
     "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXhwIjoxNzI4MDQ2NDAwfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
     "token_type": "bearer"
   }
   ```

******
**[–î–ï–ú–û]** –ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç ‚Äî –∫–Ω–æ–ø–∫–∞ Authorize:

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ** –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`
2. –í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É Swagger UI –Ω–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** (–∑–∞–º–æ—á–µ–∫)
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ—ë
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ
5. –ù–∞–∂–º–∏—Ç–µ "Authorize" –∏ "Close"

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

–¢–µ–ø–µ—Ä—å Swagger –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>` –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º.

–≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ç–æ, –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ú—ã –Ω–∞—É—á–∏–ª–∏ –±—ç–∫–µ–Ω–¥ –≤—ã–¥–∞–≤–∞—Ç—å "–ø—Ä–æ–ø—É—Å–∫–∞" (JWT —Ç–æ–∫–µ–Ω—ã). –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞.
>
>–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/token`, –≤—ã –¥–æ–ª–∂–Ω—ã:
>
>1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token` –≤ `localStorage` –±—Ä–∞—É–∑–µ—Ä–∞
>2. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
>3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å logout (–æ—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage)

******

## –£—Ä–æ–∫ 9: –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ —Å JWT üîí

### 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –ü—É–±–ª–∏—á–Ω—ã–µ –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã üö¶

**[–¢–ï–ö–°–¢]** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—é "–ù–æ—á–Ω–æ–π –∫–ª—É–±":

–ù–∞—à API ‚Äî —ç—Ç–æ –Ω–æ—á–Ω–æ–π –∫–ª—É–±. –í –Ω–µ–º –µ—Å—Ç—å –¥–≤–µ –∑–æ–Ω—ã:

**–û–±—â–∏–π –∑–∞–ª** (–ø—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã):

- –í—Ö–æ–¥ —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö
- `GET /products` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã
- `POST /users` ‚Äî –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
- `POST /token` ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω (–∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è)

**VIP-–∑–æ–Ω–∞** (–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã):

- –í—Ö–æ–¥ —Ç–æ–ª—å–∫–æ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –±—Ä–∞—Å–ª–µ—Ç–∞–º (JWT —Ç–æ–∫–µ–Ω–∞–º)
- `GET /users/me` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Å–µ–±–µ
- `POST /orders` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `GET /cart` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ—é –∫–æ—Ä–∑–∏–Ω—É

–°–µ–≥–æ–¥–Ω—è –º—ã —Å—Ç–∞–≤–∏–º –Ω–∞ –≤—Ö–æ–¥–µ –≤ VIP-–∑–æ–Ω—É **"–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞"**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–∏ –±—Ä–∞—Å–ª–µ—Ç—ã.

**[–¢–ï–ö–°–¢]** –¶–µ–ª—å —É—Ä–æ–∫–∞:

–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ("–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞"), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ª–µ–≥–∫–æ "–ø–æ—Å—Ç–∞–≤–∏—Ç—å" –ø–µ—Ä–µ–¥ –ª—é–±—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–æ–π –∫–æ–¥–∞, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º.

******

### 2. –°—Ö–µ–º–∞ `OAuth2PasswordBearer` üì±

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏—é:

`OAuth2PasswordBearer` ‚Äî —ç—Ç–æ –Ω–µ —Å–∞–º "–æ—Ö—Ä–∞–Ω–Ω–∏–∫", –∞ –µ–≥–æ –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç ‚Äî **—Å–∫–∞–Ω–µ—Ä –±—Ä–∞—Å–ª–µ—Ç–æ–≤**.

–≠—Ç–æ—Ç –∫–ª–∞—Å—Å-–ø–æ–º–æ—â–Ω–∏–∫ —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –≤–µ—â—å: –∏—Å–∫–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö HTTP-–∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª–µ `Authorization` –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –æ—Ç—Ç—É–¥–∞ —Ç–æ–∫–µ–Ω.

–§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞: `Authorization: Bearer eyJhbGci...`

–ï—Å–ª–∏ –æ–Ω –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ —Ç–æ–∫–µ–Ω, –æ–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å –æ—à–∏–±–∫–æ–π `401 Unauthorized`.
******
**[–ö–û–î: app/security.py]** –°–æ–∑–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä "—Å–∫–∞–Ω–µ—Ä–∞":

```python
# app/security.py
from fastapi.security import OAuth2PasswordBearer
from datetime import datetime, timedelta, timezone
from jose import jwt
from passlib.context import CryptContext

from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

# –°–æ–∑–¥–∞–µ–º "—Å–∫–∞–Ω–µ—Ä" —Ç–æ–∫–µ–Ω–æ–≤
# tokenUrl —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω
oauth2_scheme = OAuth2PasswordBearer(tokenUrl="/token")
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `tokenUrl`:

`tokenUrl="/token"` ‚Äî —ç—Ç–æ –Ω–µ URL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞, –∞ URL, –≥–¥–µ –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç **–ø–æ–ª—É—á–∏—Ç—å** —Ç–æ–∫–µ–Ω (–Ω–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç –ª–æ–≥–∏–Ω–∞).

Swagger UI –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∫–Ω–æ–ø–∫–∏ "Authorize".

******

### 3. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ üîç

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∑–∞–¥–∞—á—É "—É–º–Ω–æ–≥–æ –æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞":

–ù–∞—à "–æ—Ö—Ä–∞–Ω–Ω–∏–∫" –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–º–Ω—ã–º. –ü–æ–ª—É—á–∏–≤ —Ç–æ–∫–µ–Ω –æ—Ç "—Å–∫–∞–Ω–µ—Ä–∞", –æ–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

1. **–≠—Ç–æ –Ω–µ –ø–æ–¥–¥–µ–ª–∫–∞?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤—É—é –ø–æ–¥–ø–∏—Å—å
2. **–û–Ω –Ω–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–µ `exp`
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?** ‚Äî –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ –ë–î

–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —Ç—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**[–ö–û–î: app/security.py]** –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å "–æ—Ö—Ä–∞–Ω–Ω–∏–∫–∞":

```python
# app/security.py
from fastapi import Depends, HTTPException, status
from jose import JWTError, jwt
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas
from app.database import get_db_session
from app.config import SECRET_KEY, ALGORITHM

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...

async def get_current_user(
    token: str = Depends(oauth2_scheme),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞.
    
    –≠—Ç–æ dependency, –∫–æ—Ç–æ—Ä–∞—è:
    1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
    2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
    3. –ò–∑–≤–ª–µ–∫–∞–µ—Ç email –∏–∑ —Ç–æ–∫–µ–Ω–∞
    4. –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç User
    
    –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ - –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç 401 Unauthorized.
    """
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –æ—à–∏–±–∫–∏
    credentials_exception = HTTPException(
        status_code=status.HTTP_401_UNAUTHORIZED,
        detail="–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å credentials",
        headers={"WWW-Authenticate": "Bearer"},
    )
    
    try:
        # 1. –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
        # jose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (exp)
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        
        # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º email –∏–∑ –ø–æ–ª—è "sub" (subject)
        email: str = payload.get("sub")
        
        if email is None:
            raise credentials_exception
        
        # –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ç–æ–∫–µ–Ω–∞
        token_data = schemas.TokenData(email=email)
        
    except JWTError:
        # –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω –∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç
        raise credentials_exception
    
    # 3. –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
    user = await crud.get_user_by_email(db, email=token_data.email)
    
    if user is None:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª —É–¥–∞–ª–µ–Ω –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞
        raise credentials_exception
    
    # 4. –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    return user
```

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—ã–π —à–∞–≥:

**–®–∞–≥ 1: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî `jwt.decode()` –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏ –≤–µ—â–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å (–Ω–µ –±—ã–ª –ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–¥–¥–µ–ª–∞–Ω)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `exp` (–Ω–µ –∏—Å—Ç–µ–∫ –ª–∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (payload)

**–®–∞–≥ 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** ‚Äî –∏–∑ –ø–æ–ª—è `sub` –ø–æ–ª—É—á–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î** ‚Äî –∏—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –≤–∞–∂–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –≤—ã–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–∞

**–®–∞–≥ 4: –í–æ–∑–≤—Ä–∞—Ç** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç `User` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ

**[–î–ò–ê–ì–†–ê–ú–ú–ê: sequenceDiagram]** –ü–æ–∫–∞–∂–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞:

```mermaid
sequenceDiagram
    participant –ö–ª–∏–µ–Ω—Ç üë®‚Äçüíª
    participant FastAPI ‚ö°
    participant oauth2_scheme üì±
    participant get_current_user üîç
    participant jose (JWT) üîê
    participant PostgreSQL üêò
    
    –ö–ª–∏–µ–Ω—Ç->>FastAPI: GET /users/me + Header: Authorization
    FastAPI->>oauth2_scheme: –ò–∑–≤–ª–µ—á—å —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    
    alt –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω ‚úÖ
        oauth2_scheme->>get_current_user: token = "eyJhbGci..."
        
        get_current_user->>jose (JWT): –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
        
        alt –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω ‚úÖ
            jose (JWT)-->>get_current_user: {sub: "user@example.com", exp: ...}
            get_current_user->>PostgreSQL: SELECT WHERE email = ?
            PostgreSQL-->>get_current_user: User found
            get_current_user-->>FastAPI: User object
            FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 200 OK + –¥–∞–Ω–Ω—ã–µ
        else –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω ‚ùå
            jose (JWT)-->>get_current_user: JWTError
            get_current_user-->>FastAPI: HTTPException 401
            FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 401 Unauthorized
        end
        
    else –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω ‚ùå
        oauth2_scheme-->>FastAPI: HTTPException 401
        FastAPI-->>–ö–ª–∏–µ–Ω—Ç: 401 Unauthorized
    end
```

******

### 4. –ü—Ä–∞–∫—Ç–∏–∫–∞: –°–æ–∑–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –∑–∞—â–∏—â–∞–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç üõ°Ô∏è

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ:

–¢–µ–ø–µ—Ä—å, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ª—é–±–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–º, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `Depends(get_current_user)`. –í—Å—è —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

**[–ö–û–î: app/routers/users.py]** –°–æ–∑–¥–∞–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/me`:

```python
# app/routers/users.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, models, security
from app.database import get_db_session

router = APIRouter()

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ...

@router.get("/me", response_model=schemas.User)
async def read_users_me(
    current_user: models.User = Depends(security.get_current_user)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    
    –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –ó–ê–©–ò–©–ï–ù - —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω.
    –ï—Å–ª–∏ –∫–æ–¥ –¥–æ—à–µ–ª –¥–æ —ç—Ç–æ–π —Å—Ç—Ä–æ—á–∫–∏, –∑–Ω–∞—á–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.
    """
    # –í –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π current_user –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
    return current_user
```

**[–¢–ï–ö–°–¢]** –°–¥–µ–ª–∞–π—Ç–µ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ø—Ä–æ—Å—Ç–æ—Ç–µ:

–û–¥–Ω–∞ —Å—Ç—Ä–æ—á–∫–∞ `current_user: models.User = Depends(security.get_current_user)` –¥–µ–ª–∞–µ—Ç –≤—Å—é —Ä–∞–±–æ—Ç—É:

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å
3. –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
4. –ü–µ—Ä–µ–¥–∞–µ—Ç –≤ –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é

–ï—Å–ª–∏ –ª—é–±–∞—è –∏–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî —Ñ—É–Ω–∫—Ü–∏—è –¥–∞–∂–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `401 Unauthorized`.

**[–î–ï–ú–û]** –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ Swagger UI:

**–ü–æ–ø—ã—Ç–∫–∞ 1: –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞ (–ø–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8000/docs`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **–ù–ï** –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã (–∫–Ω–æ–ø–∫–∞ "Authorize" –Ω–µ –∑–µ–ª–µ–Ω–∞—è)
3. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /users/me`
4. –ù–∞–∂–º–∏—Ç–µ "Try it out" ‚Üí "Execute"
5. **–ü–æ–∫–∞–∂–∏—Ç–µ –æ—à–∏–±–∫—É:**

   ```json
   {
     "detail": "Not authenticated"
   }
   ```

   –°—Ç–∞—Ç—É—Å: `401 Unauthorized`

**–ü–æ–ø—ã—Ç–∫–∞ 2: –° —Ç–æ–∫–µ–Ω–æ–º (–ø–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—Ö)**

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å —á–µ—Ä–µ–∑ `POST /token`:
   - username: `test@example.com`
   - password: `mysecretpassword123`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É **"Authorize"** –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω
5. –ù–∞–∂–º–∏—Ç–µ "Authorize" ‚Üí "Close"
6. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ `GET /users/me`
7. –ù–∞–∂–º–∏—Ç–µ "Execute"
8. **–ü–æ–∫–∞–∂–∏—Ç–µ —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

   ```json
   {
     "id": 1,
     "email": "test@example.com",
     "is_active": true
   }
   ```

   –°—Ç–∞—Ç—É—Å: `200 OK`

******
**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

Swagger —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <–≤–∞—à_—Ç–æ–∫–µ–Ω>` –∫–æ –≤—Å–µ–º –∑–∞–ø—Ä–æ—Å–∞–º. –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç, –∫–∞–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–æ–∫–µ–Ω–æ–º.

**[–¢–ï–ö–°–¢]** –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –ª—é–±–æ–π –¥—Ä—É–≥–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å –ª—é–±–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç, –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä:

```python
async def my_protected_endpoint(
    current_user: models.User = Depends(security.get_current_user)
):
    # –≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    # –í current_user –±—É–¥–µ—Ç –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    pass
```

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:

```python
async def get_current_active_user(
    current_user: models.User = Depends(get_current_user)
):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω."""
    if not current_user.is_active:
        raise HTTPException(status_code=400, detail="Inactive user")
    return current_user

async def get_current_superuser(
    current_user: models.User = Depends(get_current_user)
):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä."""
    if not current_user.is_superuser:
        raise HTTPException(
            status_code=403,
            detail="The user doesn't have enough privileges"
        )
    return current_user
```

–ó–∞—Ç–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö:

```python
@router.delete("/{product_id}")
async def delete_product_admin_only(
    product_id: int,
    current_user: models.User = Depends(get_current_superuser),  # –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã!
    db: AsyncSession = Depends(get_db_session)
):
    # –≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
    pass
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–ú—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∑–∞—â–∏—â–∞—Ç—å –±—ç–∫–µ–Ω–¥. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ "–ø—Ä–µ–¥—ä—è–≤–ª—è—Ç—å –ø—Ä–æ–ø—É—Å–∫".
>
>–í React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ `ProfilePage.tsx`:
>
>1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ `localStorage`
>2. –°–¥–µ–ª–∞–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `GET /users/me`
>3. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫: `Authorization: Bearer <token>`
>4. –û—Ç–æ–±—Ä–∞–∑–∏—Ç–µ email –∏ –¥—Ä—É–≥–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
>5. –û–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ (–æ—à–∏–±–∫–∞ 401) ‚Äî –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤—å—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞

******

## –£—Ä–æ–∫ 10: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ üõí

### 1. –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∫–æ—Ä–∑–∏–Ω–∞ ‚Äî —ç—Ç–æ –ø–ª–æ—Ö–æ? ü§î

**[–¢–ï–ö–°–¢]** –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è:

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `src/hooks/useCart.tsx` –∏ –ø–æ–∫–∞–∂–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º, —á—Ç–æ –≤—Å—è –ª–æ–≥–∏–∫–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ `useState`. –°–æ—Å—Ç–æ—è–Ω–∏–µ `items` —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.

**[–î–ï–ú–û]** –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º:

**–°—Ü–µ–Ω–∞—Ä–∏–π –ê: –ü—Ä–æ–±–ª–µ–º–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏**

1. –û—Ç–∫—Ä–æ–π—Ç–µ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Chrome
2. –î–æ–±–∞–≤—å—Ç–µ 2-3 —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Firefox (–∏–ª–∏ —Ä–µ–∂–∏–º–µ "–∏–Ω–∫–æ–≥–Ω–∏—Ç–æ")
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!

**–í—ã–≤–æ–¥:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–∞–º–∏/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏.

**–°—Ü–µ–Ω–∞—Ä–∏–π –ë: –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö**

1. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Application ‚Üí Storage
3. –û—á–∏—Å—Ç–∏—Ç–µ localStorage –∏ sessionStorage
4. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!

**–í—ã–≤–æ–¥:** –°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏ –ª–µ–≥–∫–æ —Ç–µ—Ä—è–µ—Ç—Å—è.

**[–¢–ï–ö–°–¢]** –ò—Ç–æ–≥ –∏ —Ä–µ—à–µ–Ω–∏–µ:

–î–ª—è —Å–µ—Ä—å–µ–∑–Ω–æ–≥–æ e-commerce –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

- –•—Ä–∞–Ω–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–≤—è–∑—ã–≤–∞—Ç—å –µ—ë —Å —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

******

### 2. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã üìê

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö:

–ù—É–∂–Ω–æ —Å–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è:

- –û–¥–∏–Ω **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (`User`) –∏–º–µ–µ—Ç –æ–¥–Ω—É **–ö–æ—Ä–∑–∏–Ω—É** (`Cart`) ‚Äî —Å–≤—è–∑—å "–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É"
- –û–¥–Ω–∞ **–ö–æ—Ä–∑–∏–Ω–∞** (`Cart`) –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ **–ü–æ–∑–∏—Ü–∏–π** (`CartItem`) ‚Äî —Å–≤—è–∑—å "–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º"
- –ö–∞–∂–¥–∞—è **–ü–æ–∑–∏—Ü–∏—è** (`CartItem`) —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω **–¢–æ–≤–∞—Ä** (`Product`) –∏ —Ö—Ä–∞–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ

**[–ö–û–î: app/models.py]** –î–æ–±–∞–≤—å—Ç–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/models.py
from sqlalchemy import ForeignKey, Integer
from sqlalchemy.orm import relationship, Mapped, mapped_column

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ ...

class Cart(Base):
    """–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    __tablename__ = "carts"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    user_id: Mapped[int] = mapped_column(ForeignKey("users.id"), unique=True)
    
    # –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É" —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
    user: Mapped["User"] = relationship("User", back_populates="cart")
    
    # –°–≤—è–∑—å "–æ–¥–∏–Ω-–∫–æ-–º–Ω–æ–≥–∏–º" —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ
    items: Mapped[list["CartItem"]] = relationship(
        "CartItem",
        back_populates="cart",
        cascade="all, delete-orphan"  # –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    )

class CartItem(Base):
    """–ü–æ–∑–∏—Ü–∏—è –≤ –∫–æ—Ä–∑–∏–Ω–µ (—Ç–æ–≤–∞—Ä + –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)."""
    __tablename__ = "cart_items"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    cart_id: Mapped[int] = mapped_column(ForeignKey("carts.id"))
    product_id: Mapped[int] = mapped_column(ForeignKey("products.id"))
    quantity: Mapped[int] = mapped_column(default=1)
    
    # –°–≤—è–∑–∏
    cart: Mapped["Cart"] = relationship("Cart", back_populates="items")
    product: Mapped["Product"] = relationship("Product")

# –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –≤ –º–æ–¥–µ–ª—å User
class User(Base):
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è ...
    
    # –°–≤—è–∑—å —Å –∫–æ—Ä–∑–∏–Ω–æ–π
    cart: Mapped["Cart"] = relationship(
        "Cart",
        back_populates="user",
        cascade="all, delete-orphan",
        uselist=False  # –û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É
    )
```

******
**[–î–ò–ê–ì–†–ê–ú–ú–ê: classDiagram]** –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è:

```mermaid
classDiagram
    class User {
        +int id [PK]
        +str email
        +str hashed_password
        +bool is_active
        +Cart cart
    }
    
    class Cart {
        +int id [PK]
        +int user_id [FK, unique]
        +User user
        +List~CartItem~ items
    }
    
    class CartItem {
        +int id [PK]
        +int cart_id [FK]
        +int product_id [FK]
        +int quantity
        +Cart cart
        +Product product
    }
    
    class Product {
        +int id [PK]
        +str name
        +float price
    }
    
    User "1" -- "1" Cart : –∏–º–µ–µ—Ç –∫–æ—Ä–∑–∏–Ω—É
    Cart "1" -- "0..*" CartItem : —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏–∏
    CartItem "0..*" -- "1" Product : —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–≤–∞—Ä
    
    note for Cart "Cascade: delete-orphan"
    note for CartItem "–•—Ä–∞–Ω–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞"
```

**[–¢–ï–ö–°–¢]** –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π —Å–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
alembic revision --autogenerate -m "Add cart models"
alembic upgrade head
```

******

### 3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∫–æ—Ä–∑–∏–Ω—ã üîí

**[–¢–ï–ö–°–¢]** –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ—Ä–∑–∏–Ω–æ–π –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å, **–¥–ª—è –∫–∞–∫–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –æ–Ω–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –±—É–¥–µ—Ç –∑–∞—â–∏—â–µ–Ω –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å—é `Depends(security.get_current_user)`.

**[–ö–û–î: app/schemas.py]** –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—ã –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/schemas.py

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ö–µ–º—ã ...

class CartItemBase(BaseModel):
    """–ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ."""
    product_id: int
    quantity: int

class CartItemCreate(CartItemBase):
    """–°—Ö–µ–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É."""
    pass

class CartItem(CartItemBase):
    """–°—Ö–µ–º–∞ –ø–æ–∑–∏—Ü–∏–∏ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π."""
    id: int
    cart_id: int
    
    # –í–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ
    product: Product
    
    class Config:
        from_attributes = True

class Cart(BaseModel):
    """–°—Ö–µ–º–∞ –∫–æ—Ä–∑–∏–Ω—ã —Å –ø–æ–∑–∏—Ü–∏—è–º–∏."""
    id: int
    user_id: int
    items: list[CartItem]
    
    class Config:
        from_attributes = True
```

******
**[–ö–û–î: app/crud.py]** –î–æ–±–∞–≤—å—Ç–µ CRUD-—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/crud.py
from sqlalchemy import select

# ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ ...

# ============= CRUD –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã =============

async def get_or_create_cart(
    db: AsyncSession,
    user_id: int
) -> models.Cart:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é.
    """
    # –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
    query = select(models.Cart).where(models.Cart.user_id == user_id)
    result = await db.execute(query)
    cart = result.scalar_one_or_none()
    
    if not cart:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É
        cart = models.Cart(user_id=user_id)
        db.add(cart)
        await db.commit()
        await db.refresh(cart)
    
    return cart

async def add_item_to_cart(
    db: AsyncSession,
    user_id: int,
    product_id: int,
    quantity: int = 1
) -> models.Cart:
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
    """
    # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart = await get_or_create_cart(db, user_id)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω–µ
    query = select(models.CartItem).where(
        models.CartItem.cart_id == cart.id,
        models.CartItem.product_id == product_id
    )
    result = await db.execute(query)
    cart_item = result.scalar_one_or_none()
    
    if cart_item:
        # –¢–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
        cart_item.quantity += quantity
    else:
        # –¢–æ–≤–∞—Ä–∞ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–æ–∑–∏—Ü–∏—é
        cart_item = models.CartItem(
            cart_id=cart.id,
            product_id=product_id,
            quantity=quantity
        )
        db.add(cart_item)
    
    await db.commit()
    await db.refresh(cart)
    
    return cart

async def remove_item_from_cart(
    db: AsyncSession,
    user_id: int,
    item_id: int
) -> models.Cart:
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    cart = await get_or_create_cart(db, user_id)
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é
    cart_item = await db.get(models.CartItem, item_id)
    
    if cart_item and cart_item.cart_id == cart.id:
        await db.delete(cart_item)
        await db.commit()
    
    await db.refresh(cart)
    return cart

async def clear_cart(db: AsyncSession, user_id: int) -> models.Cart:
    """
    –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    """
    cart = await get_or_create_cart(db, user_id)
    
    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏
    for item in cart.items:
        await db.delete(item)
    
    await db.commit()
    await db.refresh(cart)
    
    return cart
```

**[–ö–û–î: app/routers/cart.py]** –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç–µ—Ä –¥–ª—è –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/routers/cart.py
from fastapi import APIRouter, Depends, HTTPException, status
from sqlalchemy.ext.asyncio import AsyncSession

from app import crud, schemas, models, security
from app.database import get_db_session

router = APIRouter()

@router.get("/", response_model=schemas.Cart)
async def get_my_cart(
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ï—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω—ã –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
    """
    cart = await crud.get_or_create_cart(db, user_id=current_user.id)
    return cart

@router.post("/items", response_model=schemas.Cart, status_code=status.HTTP_201_CREATED)
async def add_item_to_cart(
    item_data: schemas.CartItemCreate,
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É.
    –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –µ—Å—Ç—å - —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.
    """
    cart = await crud.add_item_to_cart(
        db,
        user_id=current_user.id,
        product_id=item_data.product_id,
        quantity=item_data.quantity
    )
    return cart

@router.delete("/items/{item_id}", response_model=schemas.Cart)
async def remove_item_from_cart(
    item_id: int,
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –£–¥–∞–ª–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
    """
    cart = await crud.remove_item_from_cart(
        db,
        user_id=current_user.id,
        item_id=item_id
    )
    return cart

@router.delete("/", response_model=schemas.Cart)
async def clear_cart(
    current_user: models.User = Depends(security.get_current_user),
    db: AsyncSession = Depends(get_db_session)
):
    """
    –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É.
    """
    cart = await crud.clear_cart(db, user_id=current_user.id)
    return cart
```

**[–ö–û–î: app/main.py]** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã:

```python
# app/main.py
from .routers import products, categories, users, auth, cart  # –î–æ–±–∞–≤–∏–ª–∏ cart

# ...

app.include_router(cart.router, prefix="/cart", tags=["Cart"])
```

******

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å React: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ö—É–∫–∞ `useCart` üîÑ

**[–¢–ï–ö–°–¢]** –¶–µ–ª—å:

–ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (`useState`) –Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API-–≤—ã–∑–æ–≤—ã –∫ —Å–µ—Ä–≤–µ—Ä—É. –ö–æ—Ä–∑–∏–Ω–∞ —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç "–∂–∏—Ç—å" –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**[–ö–û–î: src/hooks/useCart.tsx]** –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–Ω—ã–π —Ö—É–∫ (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ):

```typescript
// src/hooks/useCart.tsx
import { useState, useEffect } from 'react';
import { Product } from '../types';

interface CartItem {
  id: number;
  product: Product;
  quantity: number;
}

export function useCart() {
  const [items, setItems] = useState<CartItem[]>([]);
  const [loading, setLoading] = useState(false);

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage
  const getToken = () => {
    return localStorage.getItem('access_token');
  };

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞
  const fetchCart = async () => {
    const token = getToken();
    if (!token) return;

    setLoading(true);
    try {
      const response = await fetch('http://127.0.0.1:8000/cart', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        const cart = await response.json();
        setItems(cart.items);
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã:', error);
    } finally {
      setLoading(false);
    }
  };

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  useEffect(() => {
    fetchCart();
  }, []);

  // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const addToCart = async (product: Product, quantity: number = 1) => {
    const token = getToken();
    if (!token) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
      return;
    }

    try {
      const response = await fetch('http://127.0.0.1:8000/cart/items', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          product_id: product.id,
          quantity: quantity
        })
      });

      if (response.ok) {
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
        await fetchCart();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
    }
  };

  // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
  const removeFromCart = async (itemId: number) => {
    const token = getToken();
    if (!token) return;

    try {
      const response = await fetch(`http://127.0.0.1:8000/cart/items/${itemId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        await fetchCart();
      }
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã:', error);
    }
  };

  return {
    items,
    loading,
    addToCart,
    removeFromCart,
    fetchCart  // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  };
}
```

******
**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã" ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

**–®–∞–≥ 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
2. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É
3. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools ‚Üí Network
4. **–ü–æ–∫–∞–∂–∏—Ç–µ** —É—Ö–æ–¥—è—â–∏–π `POST`-–∑–∞–ø—Ä–æ—Å —Å —Ç–æ–∫–µ–Ω–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ

**–®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î**

1. –û—Ç–∫—Ä–æ–π—Ç–µ pgAdmin
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å:

   ```sql
   SELECT c.id, c.user_id, ci.product_id, ci.quantity
   FROM carts c
   JOIN cart_items ci ON c.id = ci.cart_id;
   ```

3. **–ü–æ–∫–∞–∂–∏—Ç–µ**, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏

**–®–∞–≥ 3: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏**

1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã –∏ –∑–∞–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞, –æ–Ω–∞ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å —Å —Å–µ—Ä–≤–µ—Ä–∞!
3. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –ø–æ–¥ —Ç–µ–º –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞ –∂–µ —Å–∞–º–∞—è –∫–æ—Ä–∑–∏–Ω–∞!

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≤–µ–¥–∏—Ç–µ –∏—Ç–æ–≥:

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å:

- –ö–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –≤—Å–µ–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- –ó–∞—â–∏—â–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (–∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –∫–æ—Ä–∑–∏–Ω—É)

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–†–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ —Å–µ—Ä–≤–µ—Ä–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–¥–µ–ª–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:
>
>1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
>2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–æ–≤–∞—Ä–∞ (PUT /cart/items/{item_id})
>3. –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É" (DELETE /cart)
>4. –ü–æ–∫–∞–∂–∏—Ç–µ –æ–±—â—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ—Ä–∑–∏–Ω—ã (—Å—É–º–º–∏—Ä—É–π—Ç–µ product.price * quantity)

******

## –£—Ä–æ–∫ 11: –§–∏–Ω–∞–ª ‚Äî —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å Docker –∏ Docker Compose üê≥

### 1. –ü—Ä–æ–±–ª–µ–º–∞: "–£ –º–µ–Ω—è –Ω–∞ –º–∞—à–∏–Ω–µ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ!" üò´

**[–¢–ï–ö–°–¢]** –¢–∏–ø–∏—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è:

"–í—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ –ø—Ä–æ–µ–∫—Ç, –æ–Ω –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤–∞—à–µ–º –Ω–æ—É—Ç–±—É–∫–µ. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –µ–≥–æ –¥—Ä—É–≥—É –∏–ª–∏ –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

–î—Ä—É–≥ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É:

- `ModuleNotFoundError: No module named 'fastapi'` ‚Äî –∑–∞–±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- `OperationalError: connection refused` ‚Äî –¥—Ä—É–≥–∞—è –≤–µ—Ä—Å–∏—è PostgreSQL
- `Error: port 5432 already in use` ‚Äî –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç

**[–¢–ï–ö–°–¢]** –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

–†–∞–∑–ª–∏—á–∏—è –≤ –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö:

- –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Python (3.9 vs 3.11)
- –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
- –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –†–∞–∑–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (Windows vs Linux)

**[–¢–ï–ö–°–¢]** –í—ã–≤–æ–¥:

–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —Ö–∞–æ—Å –∏–∑-–∑–∞ —Ä–∞–∑–ª–∏—á–∏–π –≤ –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –ù–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± –ø–æ—Å—Ç–∞–≤–ª—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥, –Ω–æ –∏ **–≤—Å—ë –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ü–µ–ª–∏–∫–æ–º**: Python, –≤—Å–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

******

### 2. –†–µ—à–µ–Ω–∏–µ: Docker ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä" –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è üì¶

**[–¢–ï–ö–°–¢]** –ê–Ω–∞–ª–æ–≥–∏—è "–ú–æ—Ä—Å–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä":

Docker ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤–∞—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—Å–µ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –æ–¥–∏–Ω —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π **"–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä"** (–æ–±—Ä–∞–∑).

–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ:

- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ —Å Docker
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–ª–ª–µ–≥–µ
- –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–û–Ω –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **–∞–±—Å–æ–ª—é—Ç–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ** –≤–µ–∑–¥–µ.

–ú—ã –±–æ–ª—å—à–µ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ–º "–º–µ–±–µ–ª—å" (–∫–æ–¥), –º—ã –¥–æ—Å—Ç–∞–≤–ª—è–µ–º "–∫–æ–º–Ω–∞—Ç—É —Å –º–µ–±–µ–ª—å—é" (–æ–±—Ä–∞–∑ —Å –∫–æ–¥–æ–º –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º).

**[–¢–ï–ö–°–¢]** –ö–ª—é—á–µ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è:

**–û–±—Ä–∞–∑ (Image)** ‚Äî —ç—Ç–æ —á–µ—Ä—Ç–µ–∂, —à–∞–±–ª–æ–Ω, "—Å–ª–µ–ø–æ–∫" —Å–∏—Å—Ç–µ–º—ã:

- –°–æ–¥–µ—Ä–∂–∏—Ç Python, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –≤–∞—à –∫–æ–¥
- –ù–µ –∑–∞–ø—É—â–µ–Ω, —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–π–ª
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å, –ø–µ—Ä–µ–¥–∞—Ç—å

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (Container)** ‚Äî —ç—Ç–æ —Ä–∞–±–æ—Ç–∞—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ–±—Ä–∞–∑–∞:

- –ó–∞–ø—É—â–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ò–º–µ–µ—Ç —Å–≤–æ—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É, –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ò–∑ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

******

### 3. `Dockerfile`: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–±–æ—Ä–∫–µ –Ω–∞—à–µ–≥–æ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞" üîß

**[–¢–ï–ö–°–¢]** –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:

–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.

```bash
pip freeze > requirements.txt
```

**[–ö–û–î: Dockerfile]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `Dockerfile` (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```dockerfile
# –®–∞–≥ 1: –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ - –±–µ—Ä–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python 3.11 –≤ "–ª–µ–≥–∫–æ–π" –≤–µ—Ä—Å–∏–∏
FROM python:3.11-slim

# –®–∞–≥ 2: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –ø–∞–ø–∫—É –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
WORKDIR /app

# –®–∞–≥ 3: –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
COPY requirements.txt .

# –®–∞–≥ 4: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
# --no-cache-dir - –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫—ç—à pip (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
RUN pip install --no-cache-dir -r requirements.txt

# –®–∞–≥ 5: –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –®–∞–≥ 6: –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç 8000 (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞)
EXPOSE 8000

# –®–∞–≥ 7: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
# --host 0.0.0.0 - —Å–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (–≤–∞–∂–Ω–æ –¥–ª—è Docker!)
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–∞–∂–¥—É—é –∫–æ–º–∞–Ω–¥—É:

- `FROM python:3.11-slim` ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º —Å –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å Python
- `WORKDIR /app` ‚Äî –≤—Å–µ –¥–∞–ª—å–Ω–µ–π—à–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ
- `COPY requirements.txt .` ‚Äî –∫–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `RUN pip install...` ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (—ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞)
- `COPY . .` ‚Äî –∫–æ–ø–∏—Ä—É–µ–º –≤–µ—Å—å –∫–æ–¥
- `EXPOSE 8000` ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8000
- `CMD [...]` ‚Äî –∫–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- `--host 0.0.0.0` ‚Äî **–ö–†–ò–¢–ò–ß–ù–û**: –±–µ–∑ —ç—Ç–æ–≥–æ —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞!

******

### 4. `docker-compose`: –î–∏—Ä–∏–∂–µ—Ä –¥–ª—è –Ω–∞—à–µ–≥–æ –æ—Ä–∫–µ—Å—Ç—Ä–∞ üéº

**[–¢–ï–ö–°–¢]** –ü—Ä–æ–±–ª–µ–º–∞ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

–ù–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

1. FastAPI (–Ω–∞—à –∫–æ–¥)
2. PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

–ó–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ—É–¥–æ–±–Ω–æ. **Docker Compose** –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å–∞—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –µ–π –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

**[–ö–û–î: docker-compose.yml]** –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ:

```yaml
version: '3.8'

services:
  # –ù–∞—à FastAPI —Å–µ—Ä–≤–∏—Å
  api:
    build: .  # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ Dockerfile –≤ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–µ
    ports:
      - "8000:8000"  # –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä—Ç 8000 –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç
    environment:
      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      - DATABASE_URL=postgresql+asyncpg://postgres:mysecretpassword@db:5432/store_db
      - SECRET_KEY=docker_secret_key_change_in_production_12345
    depends_on:
      - db  # –ó–∞–ø—É—Å–∫–∞—Ç—å API —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ë–î
    volumes:
      - ./app:/app/app  # –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ø–∞–ø–∫—É app –¥–ª—è live reload
  
  # –°–µ—Ä–≤–∏—Å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
  db:
    image: postgres:15-alpine  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–æ—Ç–æ–≤—ã–π –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
    ports:
      - "5432:5432"  # –î–æ—Å—Ç—É–ø –∫ –ë–î —Å —Ö–æ—Å—Ç–∞ (–¥–ª—è pgAdmin)
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=mysecretpassword
      - POSTGRES_DB=store_db
    volumes:
      - postgres_data:/var/lib/postgresql/data  # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ç–æ–º–µ

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ë–î
volumes:
  postgres_data:
```

**[–¢–ï–ö–°–¢]** –û–±—ä—è—Å–Ω–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

**services** ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã:

- `api` ‚Äî –Ω–∞—à–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `db` ‚Äî PostgreSQL

**build vs image**:

- `build: .` ‚Äî —Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –∏–∑ Dockerfile
- `image: postgres:15-alpine` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π –æ–±—Ä–∞–∑ –∏–∑ Docker Hub

**ports** ‚Äî `"8000:8000"` –æ–∑–Ω–∞—á–∞–µ—Ç:

- `8000` (—Å–ª–µ–≤–∞) ‚Äî –ø–æ—Ä—Ç –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- `8000` (—Å–ø—Ä–∞–≤–∞) ‚Äî –ø–æ—Ä—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**environment** ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

- –î–ª—è API: DATABASE_URL (–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: —Ö–æ—Å—Ç —Ç–µ–ø–µ—Ä—å `db`, –∞ –Ω–µ `localhost`!)
- –î–ª—è PostgreSQL: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ë–î

**depends_on** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞

**volumes** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:

- `postgres_data:/var/lib/postgresql/data` ‚Äî –¥–∞–Ω–Ω—ã–µ –ë–î —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–æ–º–µ –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

******

### 5. –ü—Ä–∞–∫—Ç–∏–∫–∞: –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å—é —Å–∏—Å—Ç–µ–º—É –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π üöÄ

**[–î–ï–ú–û]** "–ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã":

–ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É:

```bash
docker-compose up --build
```

**[–¢–ï–ö–°–¢]** –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. Docker —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –¥–ª—è `api` –ø–æ `Dockerfile`
2. Docker —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑ `postgres:15-alpine`
3. –°–æ–∑–¥–∞–µ—Ç —Å–µ—Ç—å –¥–ª—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç `db` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç `api` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
6. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**[–î–ï–ú–û]** –ü–æ–∫–∞–∑ –ª–æ–≥–æ–≤:

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –æ–±–æ–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤–º–µ—Å—Ç–µ:

```
db_1  | database system is ready to accept connections
api_1 | INFO:     Started server process
api_1 | INFO:     Uvicorn running on http://0.0.0.0:8000
```

**[–î–ï–ú–û]** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:8000/docs`
2. API —Ä–∞–±–æ—Ç–∞–µ—Ç!
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ Swagger
4. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `Ctrl+C` –∏–ª–∏ `docker-compose down`
5. –°–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker-compose up`
6. **–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å! –¢–æ–≤–∞—Ä –Ω–µ –∏—Å—á–µ–∑, –ø–æ—Ç–æ–º—É —á—Ç–æ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ volume

**[–¢–ï–ö–°–¢]** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (detached)
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose stop

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–º–µ—Å—Ç–µ —Å volumes (–£–î–ê–õ–ò–¢ –î–ê–ù–ù–´–ï!)
docker-compose down -v
```

**[–¢–ï–ö–°–¢]** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤ Docker:

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π Alembic:

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä api
docker-compose exec api bash

# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
alembic upgrade head

# –í—ã–π—Ç–∏
exit
```

>[!info]
>
>#### –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ üìù
>
>–£–ø–∞–∫–æ–≤–∞–ª–∏ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Docker! –í–∞—à–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:
>
>1. –°–æ–∑–¥–∞–π—Ç–µ `Dockerfile` –∏ `docker-compose.yml` –¥–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
>2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç —á–µ—Ä–µ–∑ `docker-compose up`
>3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
>
> - API –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:8000`
> - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
> - React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API
>
>**–ü–æ–∑–¥—Ä–∞–≤–ª—è—é!** –í—ã –ø—Ä–æ—à–ª–∏ –ø—É—Ç—å –æ—Ç –∏–¥–µ–∏ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üéâ

******

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ üéì

–í—ã –æ—Å–≤–æ–∏–ª–∏:

- ‚úÖ –û—Å–Ω–æ–≤—ã FastAPI –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Pydantic –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ SQLAlchemy ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π —Å—Ö–µ–º—ã –ë–î
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å React —á–µ—Ä–µ–∑ CORS
- ‚úÖ Docker –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. –ò–∑—É—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (pytest, TestClient)
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞–∫–∞–∑–æ–≤ –∏ –æ–ø–ª–∞—Ç—ã
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∏–Ω–¥–µ–∫—Å—ã)
5. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (AWS, DigitalOcean, Heroku)

**–£–¥–∞—á–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**
