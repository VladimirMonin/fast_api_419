{% extends "base.html" %}

{% block title %}{{ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä" if product else "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä" }} - Python419 Shop{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">
                    {% if product %}
                        ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
                    {% else %}
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä
                    {% endif %}
                </h3>
            </div>
            <div class="card-body">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
                <div id="form-messages"></div>

                <!-- –§–æ—Ä–º–∞ —Ç–æ–≤–∞—Ä–∞ -->
                <form method="post" 
                      enctype="multipart/form-data"
                      {% if product %}
                          hx-post="/admin/products/{{ product.id }}/edit"
                          hx-target="#product-{{ product.id }}"
                          hx-swap="outerHTML"
                          hx-encoding="multipart/form-data"
                      {% else %}
                          action="/admin/products/new"
                      {% endif %}>
                    
                    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                    <div class="mb-3">
                        <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                        <input type="text" 
                               class="form-control" 
                               id="name" 
                               name="name"
                               value="{{ product.name if product else '' }}"
                               required
                               maxlength="100"
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–ª—é–º–±—É—Å">
                    </div>

                    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
                    <div class="mb-3">
                        <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="form-control" 
                                  id="description" 
                                  name="description"
                                  rows="4"
                                  placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...">{{ product.description if product else '' }}</textarea>
                    </div>

                    <!-- –¶–µ–Ω—ã -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="price_shmeckles" class="form-label">–¶–µ–Ω–∞ (–®–º–µ–∫–µ–ª–∏) *</label>
                                <input type="number" 
                                       class="form-control" 
                                       id="price_shmeckles" 
                                       name="price_shmeckles"
                                       value="{{ product.price_shmeckles if product else '' }}"
                                       step="0.01"
                                       min="0"
                                       required
                                       placeholder="0.00">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="price_flurbos" class="form-label">–¶–µ–Ω–∞ (–§–ª—É—Ä–±–æ) *</label>
                                <input type="number" 
                                       class="form-control" 
                                       id="price_flurbos" 
                                       name="price_flurbos"
                                       value="{{ product.price_flurbos if product else '' }}"
                                       step="0.01"
                                       min="0"
                                       required
                                       placeholder="0.00">
                            </div>
                        </div>
                    </div>

                    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
                    <div class="mb-3">
                        <label for="image" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="file" 
                               class="form-control" 
                               id="image" 
                               name="image"
                               accept="image/*">
                        <div class="form-text">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (JPG, PNG, WEBP)</div>
                        {% if product and product.image_url %}
                            <div class="mt-2">
                                <small>–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</small>
                                <img src="{{ product.image_url }}" alt="{{ product.name }}" style="max-width: 200px; max-height: 200px;" class="d-block mt-1">
                            </div>
                        {% endif %}
                    </div>

                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                    <div class="mb-3">
                        <label for="category_id" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select class="form-select" id="category_id" name="category_id">
                            <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            {% for category in categories %}
                                <option value="{{ category.id }}" 
                                        {% if product and product.category_id == category.id %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- –¢–µ–≥–∏ -->
                    <div class="mb-4">
                        <label class="form-label">–¢–µ–≥–∏</label>
                        <div class="row">
                            {% for tag in tags %}
                                <div class="col-md-4 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" 
                                               type="checkbox" 
                                               id="tag_{{ tag.id }}" 
                                               name="tag_ids"
                                               value="{{ tag.id }}"
                                               {% if product and tag.id in product_tag_ids %}checked{% endif %}>
                                        <label class="form-check-label" for="tag_{{ tag.id }}">
                                            {{ tag.name }}
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-success">
                            {% if product %}
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                            {% else %}
                                ‚ûï –°–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä
                            {% endif %}
                        </button>
                        <a href="/" class="btn btn-secondary">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
