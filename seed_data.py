"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ Rick & Morty.
–ö–æ–ø–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ data/images –≤ uploads/products.

–ó–ê–ü–£–°–ö:
-------
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ fast_api_419
2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å):
   .\venv\Scripts\activate  # Windows PowerShell
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   python seed_data.py

–û–ü–¶–ò–ò:
------
--clear     –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
--images    –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î)

–ü–†–ò–ú–ï–†–´:
--------
python seed_data.py              # –û–±—ã—á–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
python seed_data.py --clear      # –û—á–∏—Å—Ç–∏—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∑–∞–Ω–æ–≤–æ
python seed_data.py --images     # –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏

–¢–†–ï–ë–û–í–ê–ù–ò–Ø:
-----------
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–∞ (alembic upgrade head)
- –ü–∞–ø–∫–∞ data/images –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- –ú–æ–¥–µ–ª–∏ Category, Tag, Product –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
"""

import asyncio
import logging
import shutil
import sys
from pathlib import Path

from sqlalchemy import select, text
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine, async_sessionmaker

from core.database import DATABASE_URL
from models.product import Category, Product, Tag

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format="%(asctime)s | %(levelname)-8s | %(message)s",
    datefmt="%H:%M:%S",
)
logger = logging.getLogger(__name__)

# –ü—É—Ç–∏ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º
BASE_DIR = Path(__file__).parent
# –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ C:\PY\–ü–†–ò–ú–ï–†–´ –ö–û–î–ê\fast_api_419\data\images
SOURCE_IMAGES_DIR = BASE_DIR / "data" / "images"
TARGET_IMAGES_DIR = BASE_DIR / "uploads" / "products"

# –°–æ–∑–¥–∞–µ–º async engine
engine = create_async_engine(DATABASE_URL, echo=False)
async_session_maker = async_sessionmaker(
    bind=engine, expire_on_commit=False, class_=AsyncSession
)


# --- –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è ---

CATEGORIES = [
    {"name": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "description": "–í—ã—Å–æ–∫–æ—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"},
    {"name": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã", "description": "–î–ª—è –¥–æ–º–∞ –∏ –±—ã—Ç–∞"},
    {"name": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è", "description": "–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–Ω–µ—Ä–≥–∏–∏"},
    {"name": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", "description": "–ò–≥—Ä—ã –∏ —Å–∏–º—É–ª—è—Ç–æ—Ä—ã"},
    {"name": "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è", "description": "–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏"},
    {"name": "–ú–µ–¥–∏—Ü–∏–Ω–∞", "description": "–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –∏ –º–µ–¥—Ç–µ—Ö–Ω–∏–∫–∞"},
    {"name": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", "description": "–°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è"},
    {"name": "–û—Ä—É–∂–∏–µ", "description": "–ë–æ–µ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"},
]

TAGS = [
    "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ",
    "–û–ø–∞—Å–Ω–æ",
    "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞",
    "–Æ–º–æ—Ä",
    "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å",
    "–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ",
    "–ù–æ–≤–∏–Ω–∫–∞",
    "–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞",
    "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ",
    "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è",
]

# –ö—É—Ä—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏: 1 –®–º–µ–∫–µ–ª—å = 2 –§–ª—ë—Ä–±–æ
SHMECKLES_TO_FLURBOS = 2.0

PRODUCTS = [
    {
        "name": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ü–ª—é–º–±—É—Å",
        "description": "–ö–∞–∂–¥—ã–π –¥–æ–º –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø–ª—é–º–±—É—Å. –ú—ã –Ω–µ –∑–Ω–∞–µ–º, —á—Ç–æ –æ–Ω –¥–µ–ª–∞–µ—Ç, –Ω–æ –æ–Ω –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ. –í –∫–æ–º–ø–ª–µ–∫—Ç–µ: —à–ª–µ–µ, –≥—Ä—É–º–±–æ –∏ —Ñ–ª–∏–±.",
        "price_shmeckles": 6.5,
        "image": "plumbus.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–Æ–º–æ—Ä"],
    },
    {
        "name": "–ö–æ—Ä–æ–±–∫–∞ —Å –ú–∏—Å–∏–∫—Å–∞–º–∏",
        "description": "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å –ø–æ –¥–æ–º—É? –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –∏ –ø–æ—è–≤–∏—Ç—Å—è –ú–∏—Å–∏–∫—Å, –≥–æ—Ç–æ–≤—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ –≤–∞—à–µ –ø–æ—Ä—É—á–µ–Ω–∏–µ. –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ–≥–æ ‚Äî –±–æ–ª—å, —Ç–∞–∫ —á—Ç–æ –Ω–µ –∑–∞—Ç—è–≥–∏–≤–∞–π—Ç–µ!",
        "price_shmeckles": 19.99,
        "image": "meeseeks-box.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ü–æ—Ä—Ç–∞–ª—å–Ω–∞—è –ø—É—à–∫–∞ (–±/—É)",
        "description": "–°–ª–µ–≥–∫–∞ –ø–æ—Ü–∞—Ä–∞–ø–∞–Ω–∞, –∑–∞—Ä—è–¥ –ø–æ—Ä—Ç–∞–ª—å–Ω–æ–π –∂–∏–¥–∫–æ—Å—Ç–∏ –Ω–∞ 37%. –í–æ–∑–≤—Ä–∞—Ç—É –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç. –ú–æ–∂–µ—Ç –ø–∞—Ö–Ω—É—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∏ —á—É–∂–∏–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è–º–∏. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ: –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –¶–∏—Ç–∞–¥–µ–ª–∏.",
        "price_shmeckles": 9999.99,
        "image": "portal-gun.webp",
        "category": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ"],
    },
    {
        "name": "–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ç–µ–º–Ω–∞—è –º–∞—Ç–µ—Ä–∏—è",
        "description": "–ò–¥–µ–∞–ª—å–Ω–æ–µ —Ç–æ–ø–ª–∏–≤–æ –¥–ª—è –≤–∞—à–µ–≥–æ –∫–æ—Å–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–∞–±–ª—è. –í—Å–µ–≥–æ –æ–¥–Ω–∞ –∫–∞–ø–ª—è –ø–æ–∑–≤–æ–ª–∏—Ç –≤–∞–º —É–ª–µ—Ç–µ—Ç—å –æ—Ç –ª—é–±—ã—Ö —ç–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∫—Ä–∏–∑–∏—Å–æ–≤. –ù–µ —É–ø–æ—Ç—Ä–µ–±–ª—è—Ç—å –≤–Ω—É—Ç—Ä—å!",
        "price_shmeckles": 850.0,
        "image": "dark-matter.webp",
        "category": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ú–∞—Å–ª–æ-—Ä–æ–±–æ—Ç '–ü–µ—Ä–µ–¥–∞–π –º–∞—Å–ª–æ'",
        "description": "–ï–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ü–µ–ª—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –º–∞—Å–ª–æ. –û–Ω –æ—Å–æ–∑–Ω–∞–µ—Ç —ç—Ç–æ –∏ –≤–ø–∞–¥–∞–µ—Ç –≤ –¥–µ–ø—Ä–µ—Å—Å–∏—é. –û—Ç–ª–∏—á–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞ –≤ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–µ.",
        "price_shmeckles": 25.5,
        "image": "butter-robot.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–Æ–º–æ—Ä", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–®–ª–µ–º –¥–ª—è —á—Ç–µ–Ω–∏—è –º—ã—Å–ª–µ–π —Å–æ–±–∞–∫",
        "description": "–¢–µ–ø–µ—Ä—å –≤—ã –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ —É–∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –≤–∞—à –ø—ë—Å —Å–ø—Ä—è—Ç–∞–ª —Ç–∞–ø–∫–∏ –∏ –ø–æ—á–µ–º—É –æ–Ω –ª–∞–µ—Ç –Ω–∞ –ø—ã–ª–µ—Å–æ—Å. –°–ø–æ–π–ª–µ—Ä: –æ–Ω —Å—á–∏—Ç–∞–µ—Ç –≤–∞—Å —Ö–æ—Ä–æ—à–∏–º –º–∞–ª—å—á–∏–∫–æ–º.",
        "price_shmeckles": 120.0,
        "image": "dog-helmet.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–Æ–º–æ—Ä"],
    },
    {
        "name": "–ó–µ—Ä–Ω–æ–≤—ã–µ '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–∏'",
        "description": "–ú–∞–ª–µ–Ω—å–∫–∏–µ –≥–ª–∞–∑–∞—Å—Ç—ã–µ —á–µ–ª–æ–≤–µ—á–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∂–∏–≤—É—Ç –≤ –∫–æ—Ä–æ–±–∫–µ –∏ —É–º–æ–ª—è—é—Ç –≤–∞—Å —Å—ä–µ—Å—Ç—å –∏—Ö. –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫ —Å –Ω–æ—Ç–∫–∞–º–∏ –æ—Ç—á–∞—è–Ω–∏—è.",
        "price_shmeckles": 4.20,
        "image": "eyeholes.webp",
        "category": "–ü—Ä–æ–¥—É–∫—Ç—ã –ø–∏—Ç–∞–Ω–∏—è",
        "tags": ["–Æ–º–æ—Ä", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–ú–∏–∫—Ä–æ-–≤—Å–µ–ª–µ–Ω–Ω–∞—è –≤ –∫–æ—Ä–æ–±–∫–µ",
        "description": "–ò—Å—Ç–æ—á–Ω–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è. –ï—ë –∂–∏—Ç–µ–ª–∏ –ø–æ–∫–ª–æ–Ω—è—é—Ç—Å—è –≤–∞–º –∫–∞–∫ –±–æ–≥—É, –ø–æ–∫–∞ –≤—ã –Ω–µ –∑–∞–≤–æ–¥–∏—Ç–µ –º–∞—à–∏–Ω—É. –≠—Ç–∏—á–Ω–æ? –†–µ—à–∞—Ç—å –≤–∞–º.",
        "price_shmeckles": 2500.0,
        "image": "microverse-battery.webp",
        "category": "–¢–æ–ø–ª–∏–≤–æ –∏ —ç–Ω–µ—Ä–≥–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ù–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–∞–º—è—Ç–∏",
        "description": "–í–∏–¥–µ–ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ –Ω–µ —Å–ª–µ–¥–æ–≤–∞–ª–æ? –°–æ—Ç—Ä–∏—Ç–µ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –∏–∑ —Å–≤–æ–µ–π –ø–∞–º—è—Ç–∏ –∏–ª–∏ –ø–∞–º—è—Ç–∏ –¥—Ä—É–∑–µ–π. –ü–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç: –≤–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∑–∞–±—É–¥–µ—Ç–µ, –∫–∞–∫ –∑–∞–≤—è–∑—ã–≤–∞—Ç—å —à–Ω—É—Ä–∫–∏.",
        "price_shmeckles": 350.75,
        "image": "memory-neutralizer.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–°–µ–º–µ–Ω–∞ –∏–∑ –ú–µ–≥–∞-–¥–µ—Ä–µ–≤—å–µ–≤",
        "description": "–ü—Ä–∏–¥–∞—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç. –î–ª—è –ø—Ä–æ–≤–æ–∑–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤ –æ—á–µ–Ω—å... —É–∫—Ä–æ–º–Ω–æ–µ –º–µ—Å—Ç–æ. –¢–∞–º–æ–∂–Ω—è –Ω–µ –æ–¥–æ–±—Ä–∏—Ç.",
        "price_shmeckles": 55.0,
        "image": "mega-seeds.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–ù–µ–∑–∞–∫–æ–Ω–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ê–Ω–∞—Ç–æ–º–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫ (–ù–∞–±–æ—Ä '–°–¥–µ–ª–∞–π —Å–∞–º')",
        "description": "–£–º–µ–Ω—å—à–∏—Ç–µ—Å—å –∏ –ø–æ—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∫ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –±–µ–∑–¥–æ–º–Ω–æ–≥–æ! –í –Ω–∞–±–æ—Ä–µ –≤—Å–µ –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã: '–ü–∏—Ä–∞—Ç—Å–∫–∞—è –°–µ–ª–µ–∑–µ–Ω–∫–∞', '–ö–æ—Å—Ç—è–Ω–æ–π –≠–∫—Å–ø—Ä–µ—Å—Å' –∏ –¥—Ä—É–≥–∏–µ. –ë–µ–∑–¥–æ–º–Ω—ã–π –≤ –∫–æ–º–ø–ª–µ–∫—Ç –Ω–µ –≤—Ö–æ–¥–∏—Ç.",
        "price_shmeckles": 199.99,
        "image": "anatomy-park.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–Æ–º–æ—Ä", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–ö—Ä–∏—Å—Ç–∞–ª–ª —Å–º–µ—Ä—Ç–∏",
        "description": "–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–∞—à–µ–π —Å–º–µ—Ä—Ç–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä–æ–≤ –∏ –∏–ø–æ—Ö–æ–Ω–¥—Ä–∏–∫–æ–≤.",
        "price_shmeckles": 77.0,
        "image": "death-crystal.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ì–æ–≤–æ—Ä—è—â–∏–π –∫–æ—Ç (–±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π)",
        "description": "–û–Ω —É–º–µ–µ—Ç –≥–æ–≤–æ—Ä–∏—Ç—å, –Ω–æ –ª—É—á—à–µ –±—ã –≤—ã –Ω–µ –∑–Ω–∞–ª–∏, –æ —á—ë–º. –ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –µ–≥–æ, —á—Ç–æ –æ–Ω –≤–∏–¥–µ–ª. –ü—Ä–æ—Å—Ç–æ –∫–æ—Ä–º–∏—Ç–µ –∏ –Ω–∞–¥–µ–π—Ç–µ—Å—å –Ω–∞ –ª—É—á—à–µ–µ.",
        "price_shmeckles": 5.0,
        "image": "talking-cat.webp",
        "category": "–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã",
        "tags": ["–Æ–º–æ—Ä", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–ë–æ—Ç–∏–Ω–∫–∏ –¥–ª—è —Ö–æ–¥—å–±—ã –ø–æ —Å—Ç–µ–Ω–∞–º",
        "description": "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏—è ‚Äî –¥–ª—è —Å–ª–∞–±–∞–∫–æ–≤. –¢–µ–ø–µ—Ä—å –ø–æ–ª, —Å—Ç–µ–Ω—ã –∏ –ø–æ—Ç–æ–ª–æ–∫ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏. –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ –ø–ª–æ—Ç–Ω–æ–≥–æ –æ–±–µ–¥–∞.",
        "price_shmeckles": 210.0,
        "image": "gravity-shoes.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–æ–≤–∏–Ω–∫–∞"],
    },
    {
        "name": "–ü—Ä–∏–±–æ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–Ω–∞–º–∏",
        "description": "–ü—Ä–æ–Ω–∏–∫–Ω–∏—Ç–µ –≤ —Å–Ω—ã –≤–∞—à–µ–≥–æ —É—á–∏—Ç–µ–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –∏ –∑–∞—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤–∞–º –ø—è—Ç–µ—Ä–∫—É. –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞—Ç–∞–π—Ç–µ—Å—å –Ω–∞ –¥–∏–Ω–æ–∑–∞–≤—Ä–µ. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã!",
        "price_shmeckles": 400.0,
        "image": "dream-inator.webp",
        "category": "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
        "tags": ["–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ"],
    },
    {
        "name": "–ö–ª–æ–Ω-–ø–∏—Å—Ç–æ–ª–µ—Ç",
        "description": "–°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—É—é –∫–æ–ø–∏—é –ª—é–±–æ–≥–æ –∂–∏–≤–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞. –ö–æ–ø–∏—è –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∞—è—Ç—å —á–µ—Ä–µ–∑ —á–∞—Å. –ò–¥–µ–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–ª–æ–Ω–∞ –Ω–∞ —Å–∫—É—á–Ω–æ–µ —Å–æ–≤–µ—â–∞–Ω–∏–µ.",
        "price_shmeckles": 555.55,
        "image": "clone-gun.webp",
        "category": "–û—Ä—É–∂–∏–µ",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞", "–ù–µ–∑–∞–∫–æ–Ω–Ω–æ"],
    },
    {
        "name": "–ü–∏—Å—Ç–æ–ª–µ—Ç-—É–º–µ–Ω—å—à–∏—Ç–µ–ª—å",
        "description": "–£–º–µ–Ω—å—à–∞–µ—Ç –ª—é–±–æ–π –ø—Ä–µ–¥–º–µ—Ç –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤–æ –¥–æ –∫–∞—Ä–º–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–æ–≤ –∏–ª–∏ –µ—Å–ª–∏ –≤—ã –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π –±—É—Ç–µ—Ä–±—Ä–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –≤ —Ä—É–∫–µ.",
        "price_shmeckles": 320.0,
        "image": "shrinking-ray.webp",
        "category": "–û—Ä—É–∂–∏–µ",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ù–∞—É—á–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞"],
    },
    {
        "name": "–ö—Ä–µ–º '–í–µ—á–Ω–∞—è –º–æ–ª–æ–¥–æ—Å—Ç—å'",
        "description": "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å—Ç–∞—Ä–µ–Ω–∏—è. –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ. –ü–æ–¥—É–º–∞–π—Ç–µ –¥–≤–∞–∂–¥—ã, –ø—Ä–µ–∂–¥–µ —á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –Ω–∞ —Å–≤–æ–µ–º —Ä–µ–±–µ–Ω–∫–µ. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è, –Ω–æ –∫—Ç–æ –µ–µ —á–∏—Ç–∞–µ—Ç?",
        "price_shmeckles": 680.0,
        "image": "age-cream.webp",
        "category": "–ú–µ–¥–∏—Ü–∏–Ω–∞",
        "tags": ["–û–ø–∞—Å–Ω–æ", "–ì–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è"],
    },
    {
        "name": "–°–∏–º—É–ª—è—Ç–æ—Ä '–†–æ–π'",
        "description": "–ü—Ä–æ–∂–∏–≤–∏—Ç–µ —Ü–µ–ª—É—é –∂–∏–∑–Ω—å –æ–±—ã—á–Ω–æ–≥–æ –ø–∞—Ä–Ω—è –ø–æ –∏–º–µ–Ω–∏ –†–æ–π. –û—Å—Ç–æ—Ä–æ–∂–Ω–æ, –≤—ã–∑—ã–≤–∞–µ—Ç –ø—Ä–∏–≤—ã–∫–∞–Ω–∏–µ –∏ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–¥—É–º–∞—Ç—å—Å—è –æ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∫–æ–≤—Ä–æ–≤.",
        "price_shmeckles": 12.50,
        "image": "roy-game.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å"],
    },
    {
        "name": "–ì–∞—Ä–º–æ–Ω–∏–∑–∞—Ç–æ—Ä –º–µ–∂–≤—Å–µ–ª–µ–Ω—Å–∫–æ–≥–æ –¢–í",
        "description": "–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –≤–∞—à–µ–º—É –æ–±—ã—á–Ω–æ–º—É —Ç–µ–ª–µ–≤–∏–∑–æ—Ä—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–º—É —á–∏—Å–ª—É –∫–∞–Ω–∞–ª–æ–≤ —Å–æ –≤—Å–µ–π –º—É–ª—å—Ç–∏–≤—Å–µ–ª–µ–Ω–Ω–æ–π. –í–∫–ª—é—á–∞—è —Ä–µ–∫–ª–∞–º—É '–ì–ª–∞–∑–∞—Å—Ç–∏–∫–æ–≤' –∏ —Å–µ—Ä–∏–∞–ª '–ú–∏—Å—Ç–∏–∫—Å-–ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–π'.",
        "price_shmeckles": 49.99,
        "image": "interdimensional-cable.webp",
        "category": "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è",
        "tags": ["–ú–µ–∂–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ", "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ", "–†–∞—Å–ø—Ä–æ–¥–∞–∂–∞"],
    },
]


def copy_images():
    """–ö–æ–ø–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ data/images –≤ uploads/products"""
    logger.info("üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...")

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–π –ø–∞–ø–∫–∏
    if not SOURCE_IMAGES_DIR.exists():
        logger.error(f"‚ùå –ü–∞–ø–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {SOURCE_IMAGES_DIR}")
        return False

    # –°–æ–∑–¥–∞—ë–º —Ü–µ–ª–µ–≤—É—é –ø–∞–ø–∫—É
    TARGET_IMAGES_DIR.mkdir(parents=True, exist_ok=True)

    # –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    copied = 0
    for image_file in SOURCE_IMAGES_DIR.glob("*.webp"):
        target_file = TARGET_IMAGES_DIR / image_file.name
        shutil.copy2(image_file, target_file)
        logger.info(f"  ‚úÖ {image_file.name}")
        copied += 1

    logger.info(f"‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ {copied} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    return True


async def seed_database():
    """–ó–∞–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
    async with async_session_maker() as session:
        try:
            logger.info("üå± –ù–∞—á–∞–ª–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")

            # 1. –°–æ–∑–¥–∞—ë–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            logger.info("üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...")
            categories_dict = {}
            for cat_data in CATEGORIES:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                result = await session.execute(
                    select(Category).where(Category.name == cat_data["name"])
                )
                category = result.scalar_one_or_none()

                # –ï—Å–ª–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é
                if not category:
                    category = Category(name=cat_data["name"])
                    session.add(category)
                    logger.info(f"  ‚ûï {cat_data['name']}")
                else:
                    logger.info(f"  ‚è≠Ô∏è  {cat_data['name']} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")

                categories_dict[cat_data["name"]] = category

            # –ü–æ–ª—É—á–∞–µ–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            await session.flush()
            logger.info(f"‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –≥–æ—Ç–æ–≤—ã")

            # 2. –°–æ–∑–¥–∞—ë–º —Ç–µ–≥–∏
            logger.info("üè∑Ô∏è  –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–æ–≤...")
            tags_dict = {}
            for tag_name in TAGS:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–µ–≥
                result = await session.execute(select(Tag).where(Tag.name == tag_name))
                tag = result.scalar_one_or_none()

                if not tag:
                    tag = Tag(name=tag_name)
                    session.add(tag)
                    logger.info(f"  ‚ûï {tag_name}")
                else:
                    logger.info(f"  ‚è≠Ô∏è  {tag_name} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")

                tags_dict[tag_name] = tag

            await session.flush()
            logger.info(f"‚úÖ –¢–µ–≥–∏ –≥–æ—Ç–æ–≤—ã")

            # 3. –°–æ–∑–¥–∞—ë–º —Ç–æ–≤–∞—Ä—ã
            logger.info("üõí –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤...")
            for idx, product_data in enumerate(PRODUCTS, 1):
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–æ–≤–∞—Ä
                result = await session.execute(
                    select(Product).where(Product.name == product_data["name"])
                )
                existing_product = result.scalar_one_or_none()

                if existing_product:
                    logger.info(f"  ‚è≠Ô∏è  {idx}. {product_data['name']} (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)")
                    continue

                # –°–æ–∑–¥–∞—ë–º –ø—Ä–æ–¥—É–∫—Ç
                product = Product(
                    name=product_data["name"],
                    description=product_data["description"],
                    price_shmeckles=product_data["price_shmeckles"],
                    price_flurbos=product_data["price_shmeckles"]
                    * SHMECKLES_TO_FLURBOS,
                    image_url=f"/uploads/products/{product_data['image']}",
                    category=categories_dict.get(product_data["category"]),
                )

                # –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–≥–∏
                for tag_name in product_data["tags"]:
                    if tag_name in tags_dict:
                        product.tags.append(tags_dict[tag_name])

                session.add(product)
                logger.info(f"  ‚ûï {idx}. {product.name}")

            await session.commit()
            logger.info(f"‚úÖ –¢–æ–≤–∞—Ä—ã —Å–æ–∑–¥–∞–Ω—ã")
            logger.info("üéâ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!")

        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –ë–î: {e}")
            await session.rollback()
            raise


async def clear_database():
    """–û—á–∏—â–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)"""
    async with async_session_maker() as session:
        try:
            logger.warning("üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
            await session.execute(text("DELETE FROM product_tag_association"))
            await session.execute(text("DELETE FROM products"))
            await session.execute(text("DELETE FROM tags"))
            await session.execute(text("DELETE FROM categories"))
            await session.commit()
            logger.info("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞")
        except Exception as e:
            logger.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ –ë–î: {e}")
            await session.rollback()
            raise


async def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —Å –æ–ø—Ü–∏—è–º–∏:
    --clear     –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    --images    –¢–æ–ª—å–∫–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î)
    –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞:
    python seed_data.py --clear --images
    """
    args = sys.argv[1:]

    # –¢–æ–ª—å–∫–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    if "--images" in args:
        copy_images()
        return

    # –û—á–∏—Å—Ç–∫–∞ –ë–î –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º
    if "--clear" in args:
        await clear_database()

    # –ö–æ–ø–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    if not copy_images():
        logger.error("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ.")
        return

    # –ó–∞–ø–æ–ª–Ω—è–µ–º –ë–î
    await seed_database()


if __name__ == "__main__":
    asyncio.run(main())
